var Su=Object.defineProperty;var Eu=(n,t,e)=>t in n?Su(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var F=(n,t,e)=>Eu(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function Wi(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(e[s[i]]=n[s[i]]);return e}function Tu(n,t,e,s){function i(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(d){try{c(s.next(d))}catch(u){o(u)}}function l(d){try{c(s.throw(d))}catch(u){o(u)}}function c(d){d.done?r(d.value):i(d.value).then(a,l)}c((s=s.apply(n,t||[])).next())})}const Au=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class go extends Error{constructor(t,e="FunctionsError",s){super(t),this.name=e,this.context=s}}class Cu extends go{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class ra extends go{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class oa extends go{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var $r;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})($r||($r={}));class Ou{constructor(t,{headers:e={},customFetch:s,region:i=$r.Any}={}){this.url=t,this.headers=e,this.region=i,this.fetch=Au(s)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Tu(this,arguments,void 0,function*(e,s={}){var i;let r,o;try{const{headers:a,method:l,body:c,signal:d,timeout:u}=s;let h={},{region:f}=s;f||(f=this.region);const g=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let p;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",p=c):typeof c=="string"?(h["Content-Type"]="text/plain",p=c):typeof FormData<"u"&&c instanceof FormData?p=c:(h["Content-Type"]="application/json",p=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?p=JSON.stringify(c):p=c;let m=d;u&&(o=new AbortController,r=setTimeout(()=>o.abort(),u),d?(m=o.signal,d.addEventListener("abort",()=>o.abort())):m=o.signal);const b=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:p,signal:m}).catch(A=>{throw new Cu(A)}),v=b.headers.get("x-relay-error");if(v&&v==="true")throw new ra(b);if(!b.ok)throw new oa(b);let w=((i=b.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),k;return w==="application/json"?k=yield b.json():w==="application/octet-stream"||w==="application/pdf"?k=yield b.blob():w==="text/event-stream"?k=b:w==="multipart/form-data"?k=yield b.formData():k=yield b.text(),{data:k,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof oa||a instanceof ra?a.context:void 0}}finally{r&&clearTimeout(r)}})}}var Ru=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},Iu=class{constructor(n){var t,e,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(e=n.isMaybeSingle)!==null&&e!==void 0?e:!1,this.urlLengthLimit=(s=n.urlLengthLimit)!==null&&s!==void 0?s:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var e=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let o=null,a=null,l=null,c=r.status,d=r.statusText;if(r.ok){var u,h;if(e.method!=="HEAD"){var f;const b=await r.text();b===""||(e.headers.get("Accept")==="text/csv"||e.headers.get("Accept")&&(!((f=e.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=b:a=JSON.parse(b))}const p=(u=e.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(h=r.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");p&&m&&m.length>1&&(l=parseInt(m[1])),e.isMaybeSingle&&e.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var g;const p=await r.text();try{o=JSON.parse(p),Array.isArray(o)&&r.status===404&&(a=[],o=null,c=200,d="OK")}catch{r.status===404&&p===""?(c=204,d="No Content"):o={message:p}}if(o&&e.isMaybeSingle&&(!(o==null||(g=o.details)===null||g===void 0)&&g.includes("0 rows"))&&(o=null,c=200,d="OK"),o&&e.shouldThrowOnError)throw new Ru(o)}return{error:o,data:a,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(i=i.catch(r=>{var o;let a="",l="",c="";const d=r==null?void 0:r.cause;if(d){var u,h,f,g;const b=(u=d==null?void 0:d.message)!==null&&u!==void 0?u:"",v=(h=d==null?void 0:d.code)!==null&&h!==void 0?h:"";a=`${(f=r==null?void 0:r.name)!==null&&f!==void 0?f:"FetchError"}: ${r==null?void 0:r.message}`,a+=`

Caused by: ${(g=d==null?void 0:d.name)!==null&&g!==void 0?g:"Error"}: ${b}`,v&&(a+=` (${v})`),d!=null&&d.stack&&(a+=`
${d.stack}`)}else{var p;a=(p=r==null?void 0:r.stack)!==null&&p!==void 0?p:""}const m=this.url.toString().length;return(r==null?void 0:r.name)==="AbortError"||(r==null?void 0:r.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((d==null?void 0:d.name)==="HeadersOverflowError"||(d==null?void 0:d.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(l+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:a,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),i.then(n,t)}returns(){return this}overrideTypes(){return this}},Mu=class extends Iu{select(n){let t=!1;const e=(n??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",e),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:e,foreignTable:s,referencedTable:i=s}={}){const r=i?`${i}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${n}.${t?"asc":"desc"}${e===void 0?"":e?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:e=t}={}){const s=typeof e>"u"?"limit":`${e}.limit`;return this.url.searchParams.set(s,`${n}`),this}range(n,t,{foreignTable:e,referencedTable:s=e}={}){const i=typeof s>"u"?"offset":`${s}.offset`,r=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(r,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:e=!1,buffers:s=!1,wal:i=!1,format:r="text"}={}){var o;const a=[n?"analyze":null,t?"verbose":null,e?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const aa=new RegExp("[,()]");var jn=class extends Mu{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const e=Array.from(new Set(t)).map(s=>typeof s=="string"&&aa.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(n,`in.(${e})`),this}notIn(n,t){const e=Array.from(new Set(t)).map(s=>typeof s=="string"&&aa.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(n,`not.in.(${e})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:e,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const r=e===void 0?"":`(${e})`;return this.url.searchParams.append(n,`${i}fts${r}.${t}`),this}match(n){return Object.entries(n).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(n,t,e){return this.url.searchParams.append(n,`not.${t}.${e}`),this}or(n,{foreignTable:t,referencedTable:e=t}={}){const s=e?`${e}.or`:"or";return this.url.searchParams.append(s,`(${n})`),this}filter(n,t,e){return this.url.searchParams.append(n,`${t}.${e}`),this}},Pu=class{constructor(n,{headers:t={},schema:e,fetch:s,urlLengthLimit:i=8e3}){this.url=n,this.headers=new Headers(t),this.schema=e,this.fetch=s,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,t){const{head:e=!1,count:s}=t??{},i=e?"HEAD":"GET";let r=!1;const o=(n??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),s&&l.append("Prefer",`count=${s}`),new jn({method:i,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:t,defaultToNull:e=!0}={}){var s;const i="POST",{url:r,headers:o}=this.cloneRequestState();if(t&&o.append("Prefer",`count=${t}`),e||o.append("Prefer","missing=default"),Array.isArray(n)){const a=n.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);r.searchParams.set("columns",l.join(","))}}return new jn({method:i,url:r,headers:o,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:t,ignoreDuplicates:e=!1,count:s,defaultToNull:i=!0}={}){var r;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${e?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),s&&l.append("Prefer",`count=${s}`),i||l.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);a.searchParams.set("columns",d.join(","))}}return new jn({method:o,url:a,headers:l,schema:this.schema,body:n,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:t}={}){var e;const s="PATCH",{url:i,headers:r}=this.cloneRequestState();return t&&r.append("Prefer",`count=${t}`),new jn({method:s,url:i,headers:r,schema:this.schema,body:n,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var t;const e="DELETE",{url:s,headers:i}=this.cloneRequestState();return n&&i.append("Prefer",`count=${n}`),new jn({method:e,url:s,headers:i,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Cs(n){"@babel/helpers - typeof";return Cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cs(n)}function Lu(n,t){if(Cs(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(Cs(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Du(n){var t=Lu(n,"string");return Cs(t)=="symbol"?t:t+""}function $u(n,t,e){return(t=Du(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function la(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function ti(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?la(Object(e),!0).forEach(function(s){$u(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):la(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}var Bu=class ac{constructor(t,{headers:e={},schema:s,fetch:i,timeout:r,urlLengthLimit:o=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=s,this.urlLengthLimit=o;const a=i??globalThis.fetch;r!==void 0&&r>0?this.fetch=(l,c)=>{const d=new AbortController,u=setTimeout(()=>d.abort(),r),h=c==null?void 0:c.signal;if(h){if(h.aborted)return clearTimeout(u),a(l,c);const f=()=>{clearTimeout(u),d.abort()};return h.addEventListener("abort",f,{once:!0}),a(l,ti(ti({},c),{},{signal:d.signal})).finally(()=>{clearTimeout(u),h.removeEventListener("abort",f)})}return a(l,ti(ti({},c),{},{signal:d.signal})).finally(()=>clearTimeout(u))}:this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Pu(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new ac(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:s=!1,get:i=!1,count:r}={}){var o;let a;const l=new URL(`${this.url}/rpc/${t}`);let c;const d=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(d)),u=s&&Object.values(e).some(d);u?(a="POST",c=e):s||i?(a=s?"HEAD":"GET",Object.entries(e).filter(([f,g])=>g!==void 0).map(([f,g])=>[f,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([f,g])=>{l.searchParams.append(f,g)})):(a="POST",c=e);const h=new Headers(this.headers);return u?h.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&h.set("Prefer",`count=${r}`),new jn({method:a,url:l,headers:h,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class Nu{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const s=e.versions;if(s&&s.node){const i=s.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const s=this.getWebSocketConstructor();return new s(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const ju="2.94.1",Fu=`realtime-js/${ju}`,Uu="1.0.0",lc="2.0.0",ca=lc,Br=1e4,zu=1e3,Hu=100;var He;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(He||(He={}));var Nt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Nt||(Nt={}));var ye;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(ye||(ye={}));var Nr;(function(n){n.websocket="websocket"})(Nr||(Nr={}));var gn;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(gn||(gn={}));class Wu{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let s=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,s;const i=(s=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(t){var e,s;const i=(s=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,s){var i,r;const o=t.topic,a=(i=t.ref)!==null&&i!==void 0?i:"",l=(r=t.join_ref)!==null&&r!==void 0?r:"",c=t.payload.event,d=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+h);let g=new DataView(f),p=0;g.setUint8(p++,this.KINDS.userBroadcastPush),g.setUint8(p++,l.length),g.setUint8(p++,a.length),g.setUint8(p++,o.length),g.setUint8(p++,c.length),g.setUint8(p++,u.length),g.setUint8(p++,e),Array.from(l,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(a,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(o,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(c,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(u,b=>g.setUint8(p++,b.charCodeAt(0)));var m=new Uint8Array(f.byteLength+s.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(s),f.byteLength),m.buffer}decode(t,e){if(this._isArrayBuffer(t)){let s=this._binaryDecode(t);return e(s)}if(typeof t=="string"){const s=JSON.parse(t),[i,r,o,a,l]=s;return e({join_ref:i,ref:r,topic:o,event:a,payload:l})}return e({})}_binaryDecode(t){const e=new DataView(t),s=e.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,e,i)}}_decodeUserBroadcast(t,e,s){const i=e.getUint8(1),r=e.getUint8(2),o=e.getUint8(3),a=e.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(t.slice(l,l+i));l=l+i;const d=s.decode(t.slice(l,l+r));l=l+r;const u=s.decode(t.slice(l,l+o));l=l+o;const h=t.slice(l,t.byteLength),f=a===this.JSON_ENCODING?JSON.parse(s.decode(h)):h,g={type:this.BROADCAST_EVENT,event:d,payload:f};return o>0&&(g.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([s])=>e.includes(s)))}}class cc{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var yt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(yt||(yt={}));const da=(n,t,e={})=>{var s;const i=(s=e.skipTypes)!==null&&s!==void 0?s:[];return t?Object.keys(t).reduce((r,o)=>(r[o]=Vu(o,n,t,i),r),{}):{}},Vu=(n,t,e,s)=>{const i=t.find(a=>a.name===n),r=i==null?void 0:i.type,o=e[n];return r&&!s.includes(r)?dc(r,o):jr(o)},dc=(n,t)=>{if(n.charAt(0)==="_"){const e=n.slice(1,n.length);return Ku(t,e)}switch(n){case yt.bool:return Gu(t);case yt.float4:case yt.float8:case yt.int2:case yt.int4:case yt.int8:case yt.numeric:case yt.oid:return qu(t);case yt.json:case yt.jsonb:return Yu(t);case yt.timestamp:return Ju(t);case yt.abstime:case yt.date:case yt.daterange:case yt.int4range:case yt.int8range:case yt.money:case yt.reltime:case yt.text:case yt.time:case yt.timestamptz:case yt.timetz:case yt.tsrange:case yt.tstzrange:return jr(t);default:return jr(t)}},jr=n=>n,Gu=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},qu=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Yu=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},Ku=(n,t)=>{if(typeof n!="string")return n;const e=n.length-1,s=n[e];if(n[0]==="{"&&s==="}"){let r;const o=n.slice(1,e);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>dc(t,a))}return n},Ju=n=>typeof n=="string"?n.replace(" ","T"):n,uc=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class lr{constructor(t,e,s={},i=Br){this.channel=t,this.event=e,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var s;return this._hasReceived(t)&&e((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var ua;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ua||(ua={}));class vs{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(e==null?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=vs.syncState(this.state,i,r,o),this.pendingDiffs.forEach(l=>{this.state=vs.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=vs.syncDiff(this.state,i,r,o),a())}),this.onJoin((i,r,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:o})}),this.onLeave((i,r,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,s,i){const r=this.cloneDeep(t),o=this.transformState(e),a={},l={};return this.map(r,(c,d)=>{o[c]||(l[c]=d)}),this.map(o,(c,d)=>{const u=r[c];if(u){const h=d.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),g=d.filter(m=>f.indexOf(m.presence_ref)<0),p=u.filter(m=>h.indexOf(m.presence_ref)<0);g.length>0&&(a[c]=g),p.length>0&&(l[c]=p)}else a[c]=d}),this.syncDiff(r,{joins:a,leaves:l},s,i)}static syncDiff(t,e,s,i){const{joins:r,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,(a,l)=>{var c;const d=(c=t[a])!==null&&c!==void 0?c:[];if(t[a]=this.cloneDeep(l),d.length>0){const u=t[a].map(f=>f.presence_ref),h=d.filter(f=>u.indexOf(f.presence_ref)<0);t[a].unshift(...h)}s(a,d,l)}),this.map(o,(a,l)=>{let c=t[a];if(!c)return;const d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),t[a]=c,i(a,c,l),c.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(s=>e(s,t[s]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,s)=>{const i=t[s];return"metas"in i?e[s]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):e[s]=i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ha;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ha||(ha={}));var ws;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(ws||(ws={}));var $e;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})($e||($e={}));class zn{constructor(t,e={config:{}},s){var i,r;if(this.topic=t,this.params=e,this.socket=s,this.bindings={},this.state=Nt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new lr(this,ye.join,this.params,this.timeout),this.rejoinTimer=new cc(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Nt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Nt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Nt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ye.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new vs(this),this.broadcastEndpointURL=uc(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var s,i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Nt.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[ws.PRESENCE]&&this.bindings[ws.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,u={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>t==null?void 0:t($e.CHANNEL_ERROR,f)),this._onClose(()=>t==null?void 0:t($e.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){t==null||t($e.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,m=(g=p==null?void 0:p.length)!==null&&g!==void 0?g:0,b=[];for(let v=0;v<m;v++){const w=p[v],{filter:{event:k,schema:A,table:C,filter:E}}=w,y=f&&f[v];if(y&&y.event===k&&zn.isFilterValueEqual(y.schema,A)&&zn.isFilterValueEqual(y.table,C)&&zn.isFilterValueEqual(y.filter,E))b.push(Object.assign(Object.assign({},w),{id:y.id}));else{this.unsubscribe(),this.state=Nt.errored,t==null||t($e.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,t&&t($e.SUBSCRIBED);return}}).receive("error",f=>{this.state=Nt.errored,t==null||t($e.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t==null||t($e.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,s){return this.state===Nt.joined&&t===ws.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,s)}async httpSend(t,e,s={}){var i;if(e==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(t,e={}){var s,i;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=e.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const c=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),c.receive("ok",()=>r("ok")),c.receive("error",()=>r("error")),c.receive("timeout",()=>r("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Nt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ye.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new lr(this,ye.leave,{},t),s.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Nt.closed,this.bindings={}}async _fetchWithTimeout(t,e,s){const i=new AbortController,r=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(r),o}_push(t,e,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new lr(this,t,e,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Hu){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,s){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,s){var i,r;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:c,join:d}=ye;if(s&&[a,l,c,d].indexOf(o)>=0&&s!==this._joinRef())return;let h=this._onMessage(o,e,s);if(e&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var g,p,m;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((m=(p=f.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(h,s)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var g,p,m,b,v,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const k=f.id,A=(g=f.filter)===null||g===void 0?void 0:g.event;return k&&((p=e.ids)===null||p===void 0?void 0:p.includes(k))&&(A==="*"||(A==null?void 0:A.toLocaleLowerCase())===((m=e.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const k=(v=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return k==="*"||k===((w=e==null?void 0:e.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:p,table:m,commit_timestamp:b,type:v,errors:w}=g;h=Object.assign(Object.assign({},{schema:p,table:m,commit_timestamp:b,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(g))}f.callback(h,s)})}_isClosed(){return this.state===Nt.closed}_isJoined(){return this.state===Nt.joined}_isJoining(){return this.state===Nt.joining}_isLeaving(){return this.state===Nt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,s){const i=t.toLocaleLowerCase(),r={type:i,filter:e,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(t,e){const s=t.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===s&&zn.isEqual(i.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ye.close,{},t)}_onError(t){this._on(ye.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Nt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=da(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=da(t.columns,t.old_record)),e}}const cr=()=>{},ei={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Xu=[1e3,2e3,5e3,1e4],Qu=1e4,Zu=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class th{constructor(t,e){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Br,this.transport=null,this.heartbeatIntervalMs=ei.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=cr,this.ref=0,this.reconnectTimer=null,this.vsn=ca,this.logger=cr,this.conn=null,this.sendBuffer=[],this.serializer=new Wu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...r)=>i(...r):(...r)=>fetch(...r),!(!((s=e==null?void 0:e.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Nr.websocket}`,this.httpEndpoint=uc(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e==null?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Nu.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,s){this.logger(t,e,s)}connectionState(){switch(this.conn&&this.conn.readyState){case He.connecting:return gn.Connecting;case He.open:return gn.Open;case He.closing:return gn.Closing;default:return gn.Closed}}isConnected(){return this.connectionState()===gn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const s=`realtime:${t}`,i=this.getChannels().find(r=>r.topic===s);if(i)return i;{const r=new zn(`realtime:${t}`,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:s,payload:i,ref:r}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${s} (${r})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(zu,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},ei.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(s=>s.topic===t&&(s._isJoined()||s._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply"&&e.ref&&e.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error",c)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:i,payload:r,ref:o}=e,a=o?`(${o})`:"",l=r.status||"";this.log("receive",`${l} ${s} ${i} ${a}`.trim(),r),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,r,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===He.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===He.open||this.conn.readyState===He.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(ye.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const s=t.match(/\?/)?"&":"?",i=new URLSearchParams(e);return`${t}${s}${i}`}_workerObjectUrl(t){let e;if(t)e=t;else{const s=new Blob([Zu],{type:"application/javascript"});e=URL.createObjectURL(s)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,s=!1;if(t)e=t,s=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),e=this.accessTokenValue}else e=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(i=>{const r={access_token:e,version:Fu};e&&i.updateJoinPayload(r),i.joinedOnce&&i._isJoined()&&i._push(ye.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(s=>{try{s(e)}catch(i){this.log("error",`error in ${t} callback`,i)}})}catch(s){this.log("error",`error triggering ${t} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new cc(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ei.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,s,i,r,o,a,l,c,d,u,h,f;switch(this.transport=(e=t==null?void 0:t.transport)!==null&&e!==void 0?e:null,this.timeout=(s=t==null?void 0:t.timeout)!==null&&s!==void 0?s:Br,this.heartbeatIntervalMs=(i=t==null?void 0:t.heartbeatIntervalMs)!==null&&i!==void 0?i:ei.HEARTBEAT_INTERVAL,this.worker=(r=t==null?void 0:t.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=t==null?void 0:t.heartbeatCallback)!==null&&a!==void 0?a:cr,this.vsn=(l=t==null?void 0:t.vsn)!==null&&l!==void 0?l:ca,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:g=>Xu[g-1]||Qu,this.vsn){case Uu:this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(g,p)=>p(JSON.stringify(g)),this.decode=(u=t==null?void 0:t.decode)!==null&&u!==void 0?u:(g,p)=>p(JSON.parse(g));break;case lc:this.encode=(h=t==null?void 0:t.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=t==null?void 0:t.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Os=class extends Error{constructor(n,t){var e;super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((e=t.icebergType)==null?void 0:e.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function eh(n,t,e){const s=new URL(t,n);if(e)for(const[i,r]of Object.entries(e))r!==void 0&&s.searchParams.set(i,r);return s.toString()}async function nh(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function sh(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:e,path:s,query:i,body:r,headers:o}){const a=eh(n.baseUrl,s,i),l=await nh(n.auth),c=await t(a,{method:e,headers:{...r?{"Content-Type":"application/json"}:{},...l,...o},body:r?JSON.stringify(r):void 0}),d=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),h=u&&d?JSON.parse(d):d;if(!c.ok){const f=u?h:void 0,g=f==null?void 0:f.error;throw new Os((g==null?void 0:g.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:f})}return{status:c.status,headers:c.headers,data:h}}}}function ni(n){return n.join("")}var ih=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:ni(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(n,t){const e={namespace:n.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ni(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ni(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ni(n.namespace)}`}),!0}catch(t){if(t instanceof Os&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(e){if(e instanceof Os&&e.status===409)return;throw e}}};function In(n){return n.join("")}var rh=class{constructor(n,t="",e){this.client=n,this.prefix=t,this.accessDelegation=e}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(n,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${In(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(e){if(e instanceof Os&&e.status===404)return!1;throw e}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(e){if(e instanceof Os&&e.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw e}}},oh=class{constructor(n){var s;let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const e=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=sh({baseUrl:e,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=(s=n.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new ih(this.client,t),this.tableOps=new rh(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Vi=class extends Error{constructor(n,t="storage",e,s){super(n),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=e,this.statusCode=s}};function Gi(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var si=class extends Vi{constructor(n,t,e,s="storage"){super(n,s,t,e),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},hc=class extends Vi{constructor(n,t,e="storage"){super(n,e),this.name=e==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const ah=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),lh=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Fr=n=>{if(Array.isArray(n))return n.map(e=>Fr(e));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([e,s])=>{const i=e.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));t[i]=Fr(s)}),t},ch=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Rs(n){"@babel/helpers - typeof";return Rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rs(n)}function dh(n,t){if(Rs(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(Rs(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function uh(n){var t=dh(n,"string");return Rs(t)=="symbol"?t:t+""}function hh(n,t,e){return(t=uh(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function fa(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function J(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fa(Object(e),!0).forEach(function(s){hh(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):fa(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const ga=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},fh=async(n,t,e,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!(e!=null&&e.noResolveJson)){const i=n,r=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||r+"";t(new si(ga(o),r,a,s))}).catch(()=>{if(s==="vectors"){const o=r+"";t(new si(i.statusText||`HTTP ${r} error`,r,o,s))}else{const o=r+"";t(new si(i.statusText||`HTTP ${r} error`,r,o,s))}});else{const o=r+"";t(new si(i.statusText||`HTTP ${r} error`,r,o,s))}}else t(new hc(ga(n),n,s))},gh=(n,t,e,s)=>{const i={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"||n==="HEAD"||!s?J(J({},i),e):(lh(s)?(i.headers=J({"Content-Type":"application/json"},t==null?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,t!=null&&t.duplex&&(i.duplex=t.duplex),J(J({},i),e))};async function Zn(n,t,e,s,i,r,o){return new Promise((a,l)=>{n(e,gh(t,s,i,r)).then(c=>{if(!c.ok)throw c;if(s!=null&&s.noResolveJson)return c;if(o==="vectors"){const d=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!d||!d.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>fh(c,l,s,o))})}function fc(n="storage"){return{get:async(t,e,s,i)=>Zn(t,"GET",e,s,i,void 0,n),post:async(t,e,s,i,r)=>Zn(t,"POST",e,i,r,s,n),put:async(t,e,s,i,r)=>Zn(t,"PUT",e,i,r,s,n),head:async(t,e,s,i)=>Zn(t,"HEAD",e,J(J({},s),{},{noResolveJson:!0}),i,void 0,n),remove:async(t,e,s,i,r)=>Zn(t,"DELETE",e,i,r,s,n)}}const ph=fc("storage"),{get:Is,post:me,put:Ur,head:mh,remove:po}=ph,de=fc("vectors");var Yn=class{constructor(n,t={},e,s="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.fetch=ah(e),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(n){var t=this;try{return{data:await n(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Gi(e))return{data:null,error:e};throw e}}},yh=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Gi(t))return{data:null,error:t};throw t}}};let gc;gc=Symbol.toStringTag;var bh=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[gc]="BlobDownloadBuilder",this.promise=null}asStream(){return new yh(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Gi(t))return{data:null,error:t};throw t}}};const _h={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},pa={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var vh=class extends Yn{constructor(n,t={},e,s){super(n,t,s,"storage"),this.bucketId=e}async uploadOrUpdate(n,t,e,s){var i=this;return i.handleOperation(async()=>{let r;const o=J(J({},pa),s);let a=J(J({},i.headers),n==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&e instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",i.encodeMetadata(l)),r.append("",e)):typeof FormData<"u"&&e instanceof FormData?(r=e,r.has("cacheControl")||r.append("cacheControl",o.cacheControl),l&&!r.has("metadata")&&r.append("metadata",i.encodeMetadata(l))):(r=e,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!o.duplex&&(o.duplex="half")),s!=null&&s.headers&&(a=J(J({},a),s.headers));const c=i._removeEmptyFolders(t),d=i._getFinalPath(c),u=await(n=="PUT"?Ur:me)(i.fetch,`${i.url}/object/${d}`,r,J({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(n,t,e){return this.uploadOrUpdate("POST",n,t,e)}async uploadToSignedUrl(n,t,e,s){var i=this;const r=i._removeEmptyFolders(n),o=i._getFinalPath(r),a=new URL(i.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",t),i.handleOperation(async()=>{let l;const c=J({upsert:pa.upsert},s),d=J(J({},i.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&e instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",e)):typeof FormData<"u"&&e instanceof FormData?(l=e,l.append("cacheControl",c.cacheControl)):(l=e,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType),{path:r,fullPath:(await Ur(i.fetch,a.toString(),l,{headers:d})).Key}})}async createSignedUploadUrl(n,t){var e=this;return e.handleOperation(async()=>{let s=e._getFinalPath(n);const i=J({},e.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=await me(e.fetch,`${e.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(e.url+r.url),a=o.searchParams.get("token");if(!a)throw new Vi("No token returned by API");return{signedUrl:o.toString(),path:n,token:a}})}async update(n,t,e){return this.uploadOrUpdate("PUT",n,t,e)}async move(n,t,e){var s=this;return s.handleOperation(async()=>await me(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:n,destinationKey:t,destinationBucket:e==null?void 0:e.destinationBucket},{headers:s.headers}))}async copy(n,t,e){var s=this;return s.handleOperation(async()=>({path:(await me(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:n,destinationKey:t,destinationBucket:e==null?void 0:e.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(n,t,e){var s=this;return s.handleOperation(async()=>{let i=s._getFinalPath(n),r=await me(s.fetch,`${s.url}/object/sign/${i}`,J({expiresIn:t},e!=null&&e.transform?{transform:e.transform}:{}),{headers:s.headers});const o=e!=null&&e.download?`&download=${e.download===!0?"":e.download}`:"";return{signedUrl:encodeURI(`${s.url}${r.signedURL}${o}`)}})}async createSignedUrls(n,t,e){var s=this;return s.handleOperation(async()=>{const i=await me(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:n},{headers:s.headers}),r=e!=null&&e.download?`&download=${e.download===!0?"":e.download}`:"";return i.map(o=>J(J({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${r}`):null}))})}download(n,t){const e=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=s?`?${s}`:"",r=this._getFinalPath(n),o=()=>Is(this.fetch,`${this.url}/${e}/${r}${i}`,{headers:this.headers,noResolveJson:!0});return new bh(o,this.shouldThrowOnError)}async info(n){var t=this;const e=t._getFinalPath(n);return t.handleOperation(async()=>Fr(await Is(t.fetch,`${t.url}/object/info/${e}`,{headers:t.headers})))}async exists(n){var t=this;const e=t._getFinalPath(n);try{return await mh(t.fetch,`${t.url}/object/${e}`,{headers:t.headers}),{data:!0,error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Gi(s)&&s instanceof hc){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}}getPublicUrl(n,t){const e=this._getFinalPath(n),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const r=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});o!==""&&s.push(o);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${e}${a}`)}}}async remove(n){var t=this;return t.handleOperation(async()=>await po(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}))}async list(n,t,e){var s=this;return s.handleOperation(async()=>{const i=J(J(J({},_h),t),{},{prefix:n||""});return await me(s.fetch,`${s.url}/object/list/${s.bucketId}`,i,{headers:s.headers},e)})}async listV2(n,t){var e=this;return e.handleOperation(async()=>{const s=J({},n);return await me(e.fetch,`${e.url}/object/list-v2/${e.bucketId}`,s,{headers:e.headers},t)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const wh="2.94.1",Hs={"X-Client-Info":`storage-js/${wh}`};var xh=class extends Yn{constructor(n,t={},e,s){const i=new URL(n);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const r=i.href.replace(/\/$/,""),o=J(J({},Hs),t);super(r,o,e,"storage")}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const e=t.listBucketOptionsToQueryString(n);return await Is(t.fetch,`${t.url}/bucket${e}`,{headers:t.headers})})}async getBucket(n){var t=this;return t.handleOperation(async()=>await Is(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}))}async createBucket(n,t={public:!1}){var e=this;return e.handleOperation(async()=>await me(e.fetch,`${e.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async updateBucket(n,t){var e=this;return e.handleOperation(async()=>await Ur(e.fetch,`${e.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async emptyBucket(n){var t=this;return t.handleOperation(async()=>await me(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await po(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},kh=class extends Yn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=J(J({},Hs),t);super(s,i,e,"storage")}async createBucket(n){var t=this;return t.handleOperation(async()=>await me(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}))}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const e=new URLSearchParams;(n==null?void 0:n.limit)!==void 0&&e.set("limit",n.limit.toString()),(n==null?void 0:n.offset)!==void 0&&e.set("offset",n.offset.toString()),n!=null&&n.sortColumn&&e.set("sortColumn",n.sortColumn),n!=null&&n.sortOrder&&e.set("sortOrder",n.sortOrder),n!=null&&n.search&&e.set("search",n.search);const s=e.toString(),i=s?`${t.url}/bucket?${s}`:`${t.url}/bucket`;return await Is(t.fetch,i,{headers:t.headers})})}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await po(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}from(n){var t=this;if(!ch(n))throw new Vi("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new oh({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(e,{get(i,r){const o=i[r];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(i,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}},Sh=class extends Yn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=J(J({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async createIndex(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{})}async getIndex(n,t){var e=this;return e.handleOperation(async()=>await de.post(e.fetch,`${e.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:e.headers}))}async listIndexes(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}))}async deleteIndex(n,t){var e=this;return e.handleOperation(async()=>await de.post(e.fetch,`${e.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:e.headers})||{})}},Eh=class extends Yn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=J(J({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async putVectors(n){var t=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{})}async getVectors(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}))}async listVectors(n){var t=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}))}async queryVectors(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}))}async deleteVectors(n){var t=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{})}},Th=class extends Yn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=J(J({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async createBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}async getBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}))}async listBuckets(n={}){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}},Ah=class extends Th{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new Ch(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,e=this;return t().call(e,n)}async getBucket(n){var t=()=>super.getBucket,e=this;return t().call(e,n)}async listBuckets(n={}){var t=()=>super.listBuckets,e=this;return t().call(e,n)}async deleteBucket(n){var t=()=>super.deleteBucket,e=this;return t().call(e,n)}},Ch=class extends Sh{constructor(n,t,e,s){super(n,t,s),this.vectorBucketName=e}async createIndex(n){var t=()=>super.createIndex,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,e=this;return t().call(e,e.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,e=this;return t().call(e,e.vectorBucketName,n)}index(n){return new Oh(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},Oh=class extends Eh{constructor(n,t,e,s,i){super(n,t,i),this.vectorBucketName=e,this.indexName=s}async putVectors(n){var t=()=>super.putVectors,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(n){var t=()=>super.getVectors,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,e=this;return t().call(e,J(J({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},Rh=class extends xh{constructor(n,t={},e,s){super(n,t,e,s)}from(n){return new vh(this.url,this.headers,n,this.fetch)}get vectors(){return new Ah(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new kh(this.url+"/iceberg",this.headers,this.fetch)}};const pc="2.94.1",Fn=30*1e3,zr=3,dr=zr*Fn,Ih="http://localhost:9999",Mh="supabase.auth.token",Ph={"X-Client-Info":`gotrue-js/${pc}`},Hr="X-Supabase-Api-Version",mc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Lh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Dh=10*60*1e3;class Ms extends Error{constructor(t,e,s){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=s}}function G(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $h extends Ms{constructor(t,e,s){super(t,e,s),this.name="AuthApiError",this.status=e,this.code=s}}function Bh(n){return G(n)&&n.name==="AuthApiError"}class pn extends Ms{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class ze extends Ms{constructor(t,e,s,i){super(t,s,i),this.name=e,this.status=s}}class ae extends ze{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ur(n){return G(n)&&n.name==="AuthSessionMissingError"}class Mn extends ze{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ii extends ze{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ri extends ze{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Nh(n){return G(n)&&n.name==="AuthImplicitGrantRedirectError"}class ma extends ze{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jh extends ze{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Wr extends ze{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function hr(n){return G(n)&&n.name==="AuthRetryableFetchError"}class ya extends ze{constructor(t,e,s){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=s}}class Vr extends ze{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Pi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ba=` 	
\r=`.split(""),Fh=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<ba.length;t+=1)n[ba[t].charCodeAt(0)]=-2;for(let t=0;t<Pi.length;t+=1)n[Pi[t].charCodeAt(0)]=t;return n})();function _a(n,t,e){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;e(Pi[s]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;e(Pi[s]),t.queuedBits-=6}}function yc(n,t,e){const s=Fh[n];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function va(n){const t=[],e=o=>{t.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},r=o=>{Hh(o,s,e)};for(let o=0;o<n.length;o+=1)yc(n.charCodeAt(o),i,r);return t.join("")}function Uh(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function zh(n,t){for(let e=0;e<n.length;e+=1){let s=n.charCodeAt(e);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(e+1)-56320&65535|i)+65536,e+=1}Uh(s,t)}}function Hh(n,t,e){if(t.utf8seq===0){if(n<=127){e(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){t.utf8seq=s;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Hn(n){const t=[],e={queue:0,queuedBits:0},s=i=>{t.push(i)};for(let i=0;i<n.length;i+=1)yc(n.charCodeAt(i),e,s);return new Uint8Array(t)}function Wh(n){const t=[];return zh(n,e=>t.push(e)),new Uint8Array(t)}function mn(n){const t=[],e={queue:0,queuedBits:0},s=i=>{t.push(i)};return n.forEach(i=>_a(i,e,s)),_a(null,e,s),t.join("")}function Vh(n){return Math.round(Date.now()/1e3)+n}function Gh(){return Symbol("auth-callback")}const Ht=()=>typeof window<"u"&&typeof document<"u",rn={tested:!1,writable:!1},bc=()=>{if(!Ht())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(rn.tested)return rn.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),rn.tested=!0,rn.writable=!0}catch{rn.tested=!0,rn.writable=!1}return rn.writable};function qh(n){const t={},e=new URL(n);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((i,r)=>{t[r]=i})}catch{}return e.searchParams.forEach((s,i)=>{t[i]=s}),t}const _c=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),Yh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Un=async(n,t,e)=>{await n.setItem(t,JSON.stringify(e))},on=async(n,t)=>{const e=await n.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},zt=async(n,t)=>{await n.removeItem(t)};class qi{constructor(){this.promise=new qi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}qi.promiseConstructor=Promise;function oi(n){const t=n.split(".");if(t.length!==3)throw new Vr("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Lh.test(t[s]))throw new Vr("JWT not in base64url format");return{header:JSON.parse(va(t[0])),payload:JSON.parse(va(t[1])),signature:Hn(t[2]),raw:{header:t[0],payload:t[1]}}}async function Kh(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function Jh(n,t){return new Promise((s,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await n(r);if(!t(r,null,o)){s(o);return}}catch(o){if(!t(r,o)){i(o);return}}})()})}function Xh(n){return("0"+n.toString(16)).substr(-2)}function Qh(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=e.length;let i="";for(let r=0;r<56;r++)i+=e.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(t),Array.from(t,Xh).join("")}async function Zh(n){const e=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(s);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}async function tf(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=await Zh(n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Pn(n,t,e=!1){const s=Qh();let i=s;e&&(i+="/PASSWORD_RECOVERY"),await Un(n,`${t}-code-verifier`,i);const r=await tf(s);return[r,s===r?"plain":"s256"]}const ef=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function nf(n){const t=n.headers.get(Hr);if(!t||!t.match(ef))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function sf(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function rf(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const of=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ln(n){if(!of.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function fr(){const n={};return new Proxy(n,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const s=e.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function af(n,t){return new Proxy(n,{get:(e,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,s,i)}return!t.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,s,i)}})}function wa(n){return JSON.parse(JSON.stringify(n))}const un=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),lf=[502,503,504];async function xa(n){var t;if(!Yh(n))throw new Wr(un(n),0);if(lf.includes(n.status))throw new Wr(un(n),n.status);let e;try{e=await n.json()}catch(r){throw new pn(un(r),r)}let s;const i=nf(n);if(i&&i.getTime()>=mc["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?s=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(s=e.error_code),s){if(s==="weak_password")throw new ya(un(e),n.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(s==="session_not_found")throw new ae}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new ya(un(e),n.status,e.weak_password.reasons);throw new $h(un(e),n.status||500,s)}const cf=(n,t,e,s)=>{const i={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),e))};async function Y(n,t,e,s){var i;const r=Object.assign({},s==null?void 0:s.headers);r[Hr]||(r[Hr]=mc["2024-01-01"].name),s!=null&&s.jwt&&(r.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await df(n,t,e+a,{headers:r,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function df(n,t,e,s,i,r){const o=cf(t,s,i,r);let a;try{a=await n(e,Object.assign({},o))}catch(l){throw console.error(l),new Wr(un(l),0)}if(a.ok||await xa(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await xa(l)}}function ge(n){var t;let e=null;ff(n)&&(e=Object.assign({},n),n.expires_at||(e.expires_at=Vh(n.expires_in)));const s=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:e,user:s},error:null}}function ka(n){const t=ge(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((e,s)=>e&&typeof s=="string",!0)&&(t.data.weak_password=n.weak_password),t}function We(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function uf(n){return{data:n,error:null}}function hf(n){const{action_link:t,email_otp:e,hashed_token:s,redirect_to:i,verification_type:r}=n,o=Wi(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:s,redirect_to:i,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Sa(n){return n}function ff(n){return n.access_token&&n.refresh_token&&n.expires_in}const gr=["global","local","others"];class gf{constructor({url:t="",headers:e={},fetch:s}){this.url=t,this.headers=e,this.fetch=_c(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=gr[0]){if(gr.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gr.join(", ")}`);try{return await Y(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(s){if(G(s))return{data:null,error:s};throw s}}async inviteUserByEmail(t,e={}){try{return await Y(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:We})}catch(s){if(G(s))return{data:{user:null},error:s};throw s}}async generateLink(t){try{const{options:e}=t,s=Wi(t,["options"]),i=Object.assign(Object.assign({},s),e);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await Y(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:hf,redirectTo:e==null?void 0:e.redirectTo})}catch(e){if(G(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await Y(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:We})}catch(e){if(G(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,s,i,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await Y(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(e=t==null?void 0:t.page)===null||e===void 0?void 0:e.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:Sa});if(d.error)throw d.error;const u=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(G(c))return{data:{users:[]},error:c};throw c}}async getUserById(t){Ln(t);try{return await Y(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:We})}catch(e){if(G(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){Ln(t);try{return await Y(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:We})}catch(s){if(G(s))return{data:{user:null},error:s};throw s}}async deleteUser(t,e=!1){Ln(t);try{return await Y(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:We})}catch(s){if(G(s))return{data:{user:null},error:s};throw s}}async _listFactors(t){Ln(t.userId);try{const{data:e,error:s}=await Y(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:e,error:s}}catch(e){if(G(e))return{data:null,error:e};throw e}}async _deleteFactor(t){Ln(t.userId),Ln(t.id);try{return{data:await Y(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(G(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,s,i,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await Y(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(e=t==null?void 0:t.page)===null||e===void 0?void 0:e.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:Sa});if(d.error)throw d.error;const u=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(G(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await Y(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(G(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await Y(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(G(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await Y(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(G(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(t){try{return await Y(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(G(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await Y(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(G(e))return{data:null,error:e};throw e}}}function Ea(n={}){return{getItem:t=>n[t]||null,setItem:(t,e)=>{n[t]=e},removeItem:t=>{delete n[t]}}}const Dn={debug:!!(globalThis&&bc()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vc extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class pf extends vc{}async function mf(n,t,e){Dn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),Dn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Dn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await e()}finally{Dn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(t===0)throw Dn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new pf(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Dn.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}function yf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function wc(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function bf(n){return parseInt(n,16)}function _f(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}function vf(n){var t;const{chainId:e,domain:s,expirationTime:i,issuedAt:r=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:d,uri:u,version:h}=n;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const f=wc(n.address),g=d?`${d}://${s}`:s,p=n.statement?`${n.statement}
`:"",m=`${g} wants you to sign in with your Ethereum account:
${f}

${p}`;let b=`URI: ${u}
Version: ${h}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${r.toISOString()}`;if(i&&(b+=`
Expiration Time: ${i.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),l&&(b+=`
Request ID: ${l}`),c){let v=`
Resources:`;for(const w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}b+=v}return`${m}
${b}`}class $t extends Error{constructor({message:t,code:e,cause:s,name:i}){var r;super(t,{cause:s}),this.__isWebAuthnError=!0,this.name=(r=i??(s instanceof Error?s.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=e}}class Li extends $t{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function wf({error:n,options:t}){var e,s,i;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new $t({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((e=r.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new $t({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((s=r.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new $t({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=r.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new $t({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new $t({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new $t({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new $t({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new $t({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const o=window.location.hostname;if(xc(o)){if(r.rp.id!==o)return new $t({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new $t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new $t({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new $t({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new $t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function xf({error:n,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new $t({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new $t({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const s=window.location.hostname;if(xc(s)){if(e.rpId!==s)return new $t({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new $t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new $t({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new $t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class kf{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Sf=new kf;function Ef(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:e,excludeCredentials:s}=n,i=Wi(n,["challenge","user","excludeCredentials"]),r=Hn(t).buffer,o=Object.assign(Object.assign({},e),{id:Hn(e.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:r,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Hn(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function Tf(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:e}=n,s=Wi(n,["challenge","allowCredentials"]),i=Hn(t).buffer,r=Object.assign(Object.assign({},s),{challenge:i});if(e&&e.length>0){r.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const a=e[o];r.allowCredentials[o]=Object.assign(Object.assign({},a),{id:Hn(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return r}function Af(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const e=n;return{id:n.id,rawId:n.id,response:{attestationObject:mn(new Uint8Array(n.response.attestationObject)),clientDataJSON:mn(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Cf(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const e=n,s=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:mn(new Uint8Array(i.authenticatorData)),clientDataJSON:mn(new Uint8Array(i.clientDataJSON)),signature:mn(new Uint8Array(i.signature)),userHandle:i.userHandle?mn(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function xc(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Ta(){var n,t;return!!(Ht()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function Of(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Li("Browser returned unexpected credential type",t)}:{data:null,error:new Li("Empty credential response",t)}}catch(t){return{data:null,error:wf({error:t,options:n})}}}async function Rf(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Li("Browser returned unexpected credential type",t)}:{data:null,error:new Li("Empty credential response",t)}}catch(t){return{data:null,error:xf({error:t,options:n})}}}const If={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Mf={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Di(...n){const t=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),e=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of n)if(i)for(const r in i){const o=i[r];if(o!==void 0)if(Array.isArray(o))s[r]=o;else if(e(o))s[r]=o;else if(t(o)){const a=s[r];t(a)?s[r]=Di(a,o):s[r]=Di(o)}else s[r]=o}return s}function Pf(n,t){return Di(If,n,t||{})}function Lf(n,t){return Di(Mf,n,t||{})}class Df{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:s,signal:i},r){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!a)return{data:null,error:l};const c=i??Sf.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:d}=a.webauthn.credential_options.publicKey;if(!d.name){const u=s;if(u)d.name=`${d.id}:${u}`;else{const f=(await this.client.getUser()).data.user,g=((o=f==null?void 0:f.user_metadata)===null||o===void 0?void 0:o.name)||(f==null?void 0:f.email)||(f==null?void 0:f.id)||"User";d.name=`${d.id}:${g}`}}d.displayName||(d.displayName=d.name)}switch(a.webauthn.type){case"create":{const d=Pf(a.webauthn.credential_options.publicKey,r==null?void 0:r.create),{data:u,error:h}=await Of({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=Lf(a.webauthn.credential_options.publicKey,r==null?void 0:r.request),{data:u,error:h}=await Rf(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(a){return G(a)?{data:null,error:a}:{data:null,error:new pn("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:e,webauthn:s}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:s})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},r){if(!e)return{data:null,error:new Ms("rpId is required for WebAuthn authentication")};try{if(!Ta())return{data:null,error:new pn("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:s},signal:i},{request:r});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:l.type,rpId:e,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return G(o)?{data:null,error:o}:{data:null,error:new pn("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},r){if(!e)return{data:null,error:new Ms("rpId is required for WebAuthn registration")};try{if(!Ta())return{data:null,error:new pn("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(d=>{var u;return(u=d.data)===null||u===void 0?void 0:u.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:s},signal:i},{create:r});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:e,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return G(o)?{data:null,error:o}:{data:null,error:new pn("Unexpected error in register",o)}}}}yf();const $f={url:Ih,storageKey:Mh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ph,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Aa(n,t,e){return await e()}const $n={};class Ps{get jwks(){var t,e;return(e=(t=$n[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){$n[this.storageKey]=Object.assign(Object.assign({},$n[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=$n[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){$n[this.storageKey]=Object.assign(Object.assign({},$n[this.storageKey]),{cachedAt:t})}constructor(t){var e,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},$f),t);if(this.storageKey=r.storageKey,this.instanceID=(e=Ps.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,Ps.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&Ht()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new gf({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=_c(r.fetch),this.lock=r.lock||Aa,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&Ht()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=mf:this.lock=Aa,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Df(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:bc()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ea(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Ea(this.memoryStorage)),Ht()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${pc}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},s="none";if(Ht()&&(e=qh(window.location.href),this._isImplicitGrantCallback(e)?s="implicit":await this._isPKCECallback(e)&&(s="pkce")),Ht()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:r}=await this._getSessionFromURL(e,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),Nh(r)){const l=(t=r.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return G(e)?this._returnResult({error:e}):this._returnResult({error:new pn("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,s,i;try{const r=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(e=t==null?void 0:t.options)===null||e===void 0?void 0:e.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.captchaToken}},xform:ge}),{data:o,error:a}=r;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(G(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(t){var e,s,i;try{let r;if("email"in t){const{email:d,password:u,options:h}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Pn(this.storage,this.storageKey)),r=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:u,data:(e=h==null?void 0:h.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:g},xform:ge})}else if("phone"in t){const{phone:d,password:u,options:h}=t;r=await Y(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:ge})}else throw new ii("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return await zt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:o,options:a}=t;e=await Y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ka})}else if("phone"in t){const{phone:r,password:o,options:a}=t;e=await Y(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:ka})}else throw new ii("You must provide either an email or phone number and a password");const{data:s,error:i}=e;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const r=new Mn;return this._returnResult({data:{user:null,session:null},error:r})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(e){if(G(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,s,i,r;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=t.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=t.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,s,i,r,o,a,l,c,d,u,h;let f,g;if("message"in t)f=t.message,g=t.signature;else{const{chain:p,wallet:m,statement:b,options:v}=t;let w;if(Ht())if(typeof m=="object")w=m;else{const _=window;if("ethereum"in _&&typeof _.ethereum=="object"&&"request"in _.ethereum&&typeof _.ethereum.request=="function")w=_.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=m}const k=new URL((e=v==null?void 0:v.url)!==null&&e!==void 0?e:window.location.href),A=await w.request({method:"eth_requestAccounts"}).then(_=>_).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!A||A.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=wc(A[0]);let E=(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!E){const _=await w.request({method:"eth_chainId"});E=bf(_)}const y={domain:k.host,address:C,statement:b,uri:k.href,version:"1",chainId:E,nonce:(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(r=v==null?void 0:v.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=v==null?void 0:v.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=v==null?void 0:v.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=vf(y),g=await w.request({method:"personal_sign",params:[_f(f),C]})}try{const{data:p,error:m}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:ge});if(m)throw m;if(!p||!p.session||!p.user){const b=new Mn;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:m})}catch(p){if(G(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(t){var e,s,i,r,o,a,l,c,d,u,h,f;let g,p;if("message"in t)g=t.message,p=t.signature;else{const{chain:m,wallet:b,statement:v,options:w}=t;let k;if(Ht())if(typeof b=="object")k=b;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))k=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}const A=new URL((e=w==null?void 0:w.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in k&&k.signIn){const C=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),v?{statement:v}:null));let E;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")E=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)E=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)g=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),p=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${A.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(i=(s=w==null?void 0:w.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((r=w==null?void 0:w.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((u=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...w.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const C=await k.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=C}}try{const{data:m,error:b}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:mn(p)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:ge});if(b)throw b;if(!m||!m.session||!m.user){const v=new Mn;return this._returnResult({data:{user:null,session:null},error:v})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:b})}catch(m){if(G(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(t){const e=await on(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(e??"").split("/");try{if(!s&&this.flowType==="pkce")throw new jh;const{data:r,error:o}=await Y(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:ge});if(await zt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!r||!r.session||!r.user){const a=new Mn;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:o})}catch(r){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(t){try{const{options:e,provider:s,token:i,access_token:r,nonce:o}=t,a=await Y(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:e==null?void 0:e.captchaToken}},xform:ge}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new Mn;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(e){if(G(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,s,i,r,o;try{if("email"in t){const{email:a,options:l}=t;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Pn(this.storage,this.storageKey));const{error:u}=await Y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(e=l==null?void 0:l.data)!==null&&e!==void 0?e:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:a,options:l}=t,{data:c,error:d}=await Y(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new ii("You must provide either an email or phone number.")}catch(a){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var e,s;try{let i,r;"options"in t&&(i=(e=t.options)===null||e===void 0?void 0:e.redirectTo,r=(s=t.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await Y(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:ge});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(G(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(t){var e,s,i,r,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Pn(this.storage,this.storageKey));const c=await Y(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=t==null?void 0:t.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:uf});return!((r=c.data)===null||r===void 0)&&r.url&&Ht()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:s}=t;if(s)throw s;if(!e)throw new ae;const{error:i}=await Y(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(t){if(G(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:s,type:i,options:r}=t,{error:o}=await Y(this.fetch,"POST",e,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:s,type:i,options:r}=t,{data:o,error:a}=await Y(this.fetch,"POST",e,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new ii("You must provide either an email or phone number and a type")}catch(e){if(G(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=e();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await on(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const s=t.expires_at?t.expires_at*1e3-Date.now()<dr:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){const o=await on(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=fr()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=af(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:i,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await Y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:We}):await this._useSession(async e=>{var s,i,r;const{data:o,error:a}=e;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ae}:await Y(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:We})})}catch(e){if(G(e))return ur(e)&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new ae;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Pn(this.storage,this.storageKey));const{data:c,error:d}=await Y(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e==null?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:We});if(d)throw d;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new ae;const e=Date.now()/1e3;let s=e,i=!0,r=null;const{payload:o}=oi(t.access_token);if(o.exp&&(s=o.exp,i=s<=e),i){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});r={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:s-e,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(e){if(G(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var s;if(!t){const{data:o,error:a}=e;if(a)throw a;t=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(t!=null&&t.refresh_token))throw new ae;const{data:i,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(G(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!Ht())throw new ri("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ri(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new ma("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ri("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ma("No code detected.");const{data:v,error:w}=await this._exchangeCodeForSession(t.code);if(w)throw w;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!r||!a||!o||!c)throw new ri("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(a);let h=d+u;l&&(h=parseInt(l));const f=h-d;f*1e3<=Fn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=h-u;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,d);const{data:p,error:m}=await this._getUser(r);if(m)throw m;const b={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:u,expires_at:h,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:t.type},error:null})}catch(s){if(G(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await on(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r&&!ur(r))return this._returnResult({error:r});const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(Bh(a)&&(a.status===404||a.status===401||a.status===403)||ur(a)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await zt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=Gh(),s={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:s}}}async _emitInitialSession(t){return await this._useSession(async e=>{var s,i;try{const{data:{session:r},error:o}=e;if(o)throw o;await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",r),console.error(r)}})}async resetPasswordForEmail(t,e={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await Pn(this.storage,this.storageKey,!0));try{return await Y(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var t;try{const{data:e,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:s,error:i}=await this._useSession(async r=>{var o,a,l,c,d;const{data:u,error:h}=r;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Y(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return Ht()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:t.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(G(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var s;try{const{error:i,data:{session:r}}=e;if(i)throw i;const{options:o,provider:a,token:l,access_token:c,nonce:d}=t,u=await Y(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=r==null?void 0:r.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ge}),{data:h,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Mn}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(i){if(await zt(this.storage,`${this.storageKey}-code-verifier`),G(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var s,i;const{data:r,error:o}=e;if(o)throw o;return await Y(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(i=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const s=Date.now();return await Jh(async i=>(i>0&&await Kh(200*Math.pow(2,i-1)),this._debug(e,"refreshing attempt",i),await Y(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:ge})),(i,r)=>{const o=200*Math.pow(2,i);return r&&hr(r)&&Date.now()+o-s<Fn})}catch(s){if(this._debug(e,"error",s),G(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const s=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",s),Ht()&&!e.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}}async _recoverAndRefresh(){var t,e;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await on(this.storage,this.storageKey);if(i&&this.userStorage){let o=await on(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await Un(this.userStorage,this.storageKey+"-user",o)),i.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:fr()}else if(i&&!i.user&&!i.user){const o=await on(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await zt(this.storage,this.storageKey+"-user"),await Un(this.storage,this.storageKey,i)):i.user=fr()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const r=((e=i.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<dr;if(this._debug(s,`session has${r?"":" not"} expired with margin of ${dr}s`),r){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),hr(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var e,s;if(!t)throw new ae;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new qi;const{data:r,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!r.session)throw new ae;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={data:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(i,"error",r),G(r)){const o={data:null,error:r};return hr(r)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(t,e,s=!0){const i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",e,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,e)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await zt(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),s=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&e.user&&await Un(this.userStorage,this.storageKey+"-user",{user:e.user});const i=Object.assign({},e);delete i.user;const r=wa(i);await Un(this.storage,this.storageKey,r)}else{const i=wa(e);await Un(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await zt(this.storage,this.storageKey),await zt(this.storage,this.storageKey+"-code-verifier"),await zt(this.storage,this.storageKey+"-user"),this.userStorage&&await zt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ht()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Fn);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-t)/Fn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Fn}ms, refresh threshold is ${zr} ticks`),i<=zr&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof vc)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ht()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,s){const i=[`provider=${encodeURIComponent(e)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[r,o]=await Pn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const r=new URLSearchParams(s.queryParams);i.push(r.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;return r?this._returnResult({data:null,error:r}):await Y(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var s,i;const{data:r,error:o}=e;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await Y(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Af(t.webauthn.credential_response):Cf(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await Y(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=await Y(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Ef(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Tf(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:s}=await this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const r of(t=e==null?void 0:e.factors)!==null&&t!==void 0?t:[])i.all.push(r),r.status==="verified"&&i[r.factor_type].push(r);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(t){var e,s,i,r;if(t)try{const{payload:f}=oi(t);let g=null;f.aal&&(g=f.aal);let p=g;const{data:{user:m},error:b}=await this.getUser(t);if(b)return this._returnResult({data:null,error:b});((s=(e=m==null?void 0:m.factors)===null||e===void 0?void 0:e.filter(k=>k.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(p="aal2");const w=f.amr||[];return{data:{currentLevel:g,nextLevel:p,currentAuthenticationMethods:w},error:null}}catch(f){if(G(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=oi(o.access_token);let c=null;l.aal&&(c=l.aal);let d=c;((r=(i=o.user.factors)===null||i===void 0?void 0:i.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(d="aal2");const h=l.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:s},error:i}=e;return i?this._returnResult({data:null,error:i}):s?await Y(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new ae})})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async s=>{const{data:{session:i},error:r}=s;if(r)return this._returnResult({data:null,error:r});if(!i)return this._returnResult({data:null,error:new ae});const o=await Y(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Ht()&&!(e!=null&&e.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(G(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(t,e){try{return await this._useSession(async s=>{const{data:{session:i},error:r}=s;if(r)return this._returnResult({data:null,error:r});if(!i)return this._returnResult({data:null,error:new ae});const o=await Y(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Ht()&&!(e!=null&&e.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(G(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:s}=t;return s?this._returnResult({data:null,error:s}):e?await Y(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new ae})})}catch(t){if(G(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:s},error:i}=e;return i?this._returnResult({data:null,error:i}):s?(await Y(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ae})})}catch(e){if(G(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let s=e.keys.find(a=>a.kid===t);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(a=>a.kid===t),s&&this.jwks_cached_at+Dh>i)return s;const{data:r,error:o}=await Y(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=i,s=r.keys.find(a=>a.kid===t),!s)?null:s}async getClaims(t,e={}){try{let s=t;if(!s){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});s=f.session.access_token}const{header:i,payload:r,signature:o,raw:{header:a,payload:l}}=oi(s);e!=null&&e.allowExpired||sf(r.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,e!=null&&e.keys?{keys:e.keys}:e==null?void 0:e.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:r,header:i,signature:o},error:null}}const d=rf(i.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,o,Wh(`${a}.${l}`)))throw new Vr("Invalid JWT signature");return{data:{claims:r,header:i,signature:o},error:null}}catch(s){if(G(s))return this._returnResult({data:null,error:s});throw s}}}Ps.nextInstanceID={};const Bf=Ps,Nf="2.94.1";let us="";typeof Deno<"u"?us="deno":typeof document<"u"?us="web":typeof navigator<"u"&&navigator.product==="ReactNative"?us="react-native":us="node";const jf={"X-Client-Info":`supabase-js-${us}/${Nf}`},Ff={headers:jf},Uf={schema:"public"},zf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Hf={};function Ls(n){"@babel/helpers - typeof";return Ls=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ls(n)}function Wf(n,t){if(Ls(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(Ls(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Vf(n){var t=Wf(n,"string");return Ls(t)=="symbol"?t:t+""}function Gf(n,t,e){return(t=Vf(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function Ca(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function Ct(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Ca(Object(e),!0).forEach(function(s){Gf(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):Ca(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const qf=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),Yf=()=>Headers,Kf=(n,t,e)=>{const s=qf(e),i=Yf();return async(r,o)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:n;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(r,Ct(Ct({},o),{},{headers:c}))}};function Jf(n){return n.endsWith("/")?n:n+"/"}function Xf(n,t){var e,s;const{db:i,auth:r,realtime:o,global:a}=n,{db:l,auth:c,realtime:d,global:u}=t,h={db:Ct(Ct({},l),i),auth:Ct(Ct({},c),r),realtime:Ct(Ct({},d),o),storage:{},global:Ct(Ct(Ct({},u),a),{},{headers:Ct(Ct({},(e=u==null?void 0:u.headers)!==null&&e!==void 0?e:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return n.accessToken?h.accessToken=n.accessToken:delete h.accessToken,h}function Qf(n){const t=n==null?void 0:n.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Jf(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Zf=class extends Bf{constructor(n){super(n)}},tg=class{constructor(n,t,e){var s,i;this.supabaseUrl=n,this.supabaseKey=t;const r=Qf(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const o=`sb-${r.hostname.split(".")[0]}-auth-token`,a={db:Uf,realtime:Hf,auth:Ct(Ct({},zf),{},{storageKey:o}),global:Ff},l=Xf(e??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=Kf(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Ct({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new Bu(new URL("rest/v1",r).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new Rh(this.storageUrl.href,this.headers,this.fetch,e==null?void 0:e.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Ou(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},e={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,e)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,e;if(n.accessToken)return await n.accessToken();const{data:s}=await n.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:e,storage:s,userStorage:i,storageKey:r,flowType:o,lock:a,debug:l,throwOnError:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Zf({url:this.authUrl.href,headers:Ct(Ct({},h),d),storageKey:r,autoRefreshToken:n,persistSession:t,detectSessionInUrl:e,storage:s,userStorage:i,flowType:o,lock:a,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new th(this.realtimeUrl.href,Ct(Ct({},n),{},{params:Ct(Ct({},{apikey:this.supabaseKey}),n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(n,t,e){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==e?(this.changedAccessToken=e,this.realtime.setAuth(e)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const eg=(n,t,e)=>new tg(n,t,e);function ng(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const t=n.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}ng()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Ws(n){return n+.5|0}const Ve=(n,t,e)=>Math.max(Math.min(n,e),t);function hs(n){return Ve(Ws(n*2.55),0,255)}function Je(n){return Ve(Ws(n*255),0,255)}function Be(n){return Ve(Ws(n/2.55)/100,0,1)}function Oa(n){return Ve(Ws(n*100),0,100)}const ue={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Gr=[..."0123456789ABCDEF"],sg=n=>Gr[n&15],ig=n=>Gr[(n&240)>>4]+Gr[n&15],ai=n=>(n&240)>>4===(n&15),rg=n=>ai(n.r)&&ai(n.g)&&ai(n.b)&&ai(n.a);function og(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ue[n[1]]*17,g:255&ue[n[2]]*17,b:255&ue[n[3]]*17,a:t===5?ue[n[4]]*17:255}:(t===7||t===9)&&(e={r:ue[n[1]]<<4|ue[n[2]],g:ue[n[3]]<<4|ue[n[4]],b:ue[n[5]]<<4|ue[n[6]],a:t===9?ue[n[7]]<<4|ue[n[8]]:255})),e}const ag=(n,t)=>n<255?t(n):"";function lg(n){var t=rg(n)?sg:ig;return n?"#"+t(n.r)+t(n.g)+t(n.b)+ag(n.a,t):void 0}const cg=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function kc(n,t,e){const s=t*Math.min(e,1-e),i=(r,o=(r+n/30)%12)=>e-s*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function dg(n,t,e){const s=(i,r=(i+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[s(5),s(3),s(1)]}function ug(n,t,e){const s=kc(n,1,.5);let i;for(t+e>1&&(i=1/(t+e),t*=i,e*=i),i=0;i<3;i++)s[i]*=1-t-e,s[i]+=t;return s}function hg(n,t,e,s,i){return n===i?(t-e)/s+(t<e?6:0):t===i?(e-n)/s+2:(n-t)/s+4}function mo(n){const e=n.r/255,s=n.g/255,i=n.b/255,r=Math.max(e,s,i),o=Math.min(e,s,i),a=(r+o)/2;let l,c,d;return r!==o&&(d=r-o,c=a>.5?d/(2-r-o):d/(r+o),l=hg(e,s,i,d,r),l=l*60+.5),[l|0,c||0,a]}function yo(n,t,e,s){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,s)).map(Je)}function bo(n,t,e){return yo(kc,n,t,e)}function fg(n,t,e){return yo(ug,n,t,e)}function gg(n,t,e){return yo(dg,n,t,e)}function Sc(n){return(n%360+360)%360}function pg(n){const t=cg.exec(n);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?hs(+t[5]):Je(+t[5]));const i=Sc(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?s=fg(i,r,o):t[1]==="hsv"?s=gg(i,r,o):s=bo(i,r,o),{r:s[0],g:s[1],b:s[2],a:e}}function mg(n,t){var e=mo(n);e[0]=Sc(e[0]+t),e=bo(e),n.r=e[0],n.g=e[1],n.b=e[2]}function yg(n){if(!n)return;const t=mo(n),e=t[0],s=Oa(t[1]),i=Oa(t[2]);return n.a<255?`hsla(${e}, ${s}%, ${i}%, ${Be(n.a)})`:`hsl(${e}, ${s}%, ${i}%)`}const Ra={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ia={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function bg(){const n={},t=Object.keys(Ia),e=Object.keys(Ra);let s,i,r,o,a;for(s=0;s<t.length;s++){for(o=a=t[s],i=0;i<e.length;i++)r=e[i],a=a.replace(r,Ra[r]);r=parseInt(Ia[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let li;function _g(n){li||(li=bg(),li.transparent=[0,0,0,0]);const t=li[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const vg=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function wg(n){const t=vg.exec(n);let e=255,s,i,r;if(t){if(t[7]!==s){const o=+t[7];e=t[8]?hs(o):Ve(o*255,0,255)}return s=+t[1],i=+t[3],r=+t[5],s=255&(t[2]?hs(s):Ve(s,0,255)),i=255&(t[4]?hs(i):Ve(i,0,255)),r=255&(t[6]?hs(r):Ve(r,0,255)),{r:s,g:i,b:r,a:e}}}function xg(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Be(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const pr=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Bn=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function kg(n,t,e){const s=Bn(Be(n.r)),i=Bn(Be(n.g)),r=Bn(Be(n.b));return{r:Je(pr(s+e*(Bn(Be(t.r))-s))),g:Je(pr(i+e*(Bn(Be(t.g))-i))),b:Je(pr(r+e*(Bn(Be(t.b))-r))),a:n.a+e*(t.a-n.a)}}function ci(n,t,e){if(n){let s=mo(n);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=bo(s),n.r=s[0],n.g=s[1],n.b=s[2]}}function Ec(n,t){return n&&Object.assign(t||{},n)}function Ma(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Je(n[3]))):(t=Ec(n,{r:0,g:0,b:0,a:1}),t.a=Je(t.a)),t}function Sg(n){return n.charAt(0)==="r"?wg(n):pg(n)}class Ds{constructor(t){if(t instanceof Ds)return t;const e=typeof t;let s;e==="object"?s=Ma(t):e==="string"&&(s=og(t)||_g(t)||Sg(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=Ec(this._rgb);return t&&(t.a=Be(t.a)),t}set rgb(t){this._rgb=Ma(t)}rgbString(){return this._valid?xg(this._rgb):void 0}hexString(){return this._valid?lg(this._rgb):void 0}hslString(){return this._valid?yg(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,i=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=s.a-i.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,s.r=255&c*s.r+r*i.r+.5,s.g=255&c*s.g+r*i.g+.5,s.b=255&c*s.b+r*i.b+.5,s.a=o*s.a+(1-o)*i.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=kg(this._rgb,t._rgb,e)),this}clone(){return new Ds(this.rgb)}alpha(t){return this._rgb.a=Je(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Ws(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return ci(this._rgb,2,t),this}darken(t){return ci(this._rgb,2,-t),this}saturate(t){return ci(this._rgb,1,t),this}desaturate(t){return ci(this._rgb,1,-t),this}rotate(t){return mg(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Pe(){}const Eg=(()=>{let n=0;return()=>n++})();function ot(n){return n==null}function Tt(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function lt(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Ot(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function le(n,t){return Ot(n)?n:t}function Z(n,t){return typeof n>"u"?t:n}const Tg=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,Tc=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function bt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function mt(n,t,e,s){let i,r,o;if(Tt(n))for(r=n.length,i=0;i<r;i++)t.call(e,n[i],i);else if(lt(n))for(o=Object.keys(n),r=o.length,i=0;i<r;i++)t.call(e,n[o[i]],o[i])}function $i(n,t){let e,s,i,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,s=n.length;e<s;++e)if(i=n[e],r=t[e],i.datasetIndex!==r.datasetIndex||i.index!==r.index)return!1;return!0}function Bi(n){if(Tt(n))return n.map(Bi);if(lt(n)){const t=Object.create(null),e=Object.keys(n),s=e.length;let i=0;for(;i<s;++i)t[e[i]]=Bi(n[e[i]]);return t}return n}function Ac(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Ag(n,t,e,s){if(!Ac(n))return;const i=t[n],r=e[n];lt(i)&&lt(r)?$s(i,r,s):t[n]=Bi(r)}function $s(n,t,e){const s=Tt(t)?t:[t],i=s.length;if(!lt(n))return n;e=e||{};const r=e.merger||Ag;let o;for(let a=0;a<i;++a){if(o=s[a],!lt(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)r(l[c],n,o,e)}return n}function xs(n,t){return $s(n,t,{merger:Cg})}function Cg(n,t,e){if(!Ac(n))return;const s=t[n],i=e[n];lt(s)&&lt(i)?xs(s,i):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Bi(i))}const Pa={"":n=>n,x:n=>n.x,y:n=>n.y};function Og(n){const t=n.split("."),e=[];let s="";for(const i of t)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function Rg(n){const t=Og(n);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function Qe(n,t){return(Pa[t]||(Pa[t]=Rg(t)))(n)}function _o(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Bs=n=>typeof n<"u",Ze=n=>typeof n=="function",La=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function Ig(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const ut=Math.PI,wt=2*ut,Mg=wt+ut,Ni=Number.POSITIVE_INFINITY,Pg=ut/180,Mt=ut/2,an=ut/4,Da=ut*2/3,Ge=Math.log10,Ce=Math.sign;function ks(n,t,e){return Math.abs(n-t)<e}function $a(n){const t=Math.round(n);n=ks(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(Ge(n))),s=n/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function Lg(n){const t=[],e=Math.sqrt(n);let s;for(s=1;s<e;s++)n%s===0&&(t.push(s),t.push(n/s));return e===(e|0)&&t.push(e),t.sort((i,r)=>i-r).pop(),t}function Dg(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Vn(n){return!Dg(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function $g(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Cc(n,t,e){let s,i,r;for(s=0,i=n.length;s<i;s++)r=n[s][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function _e(n){return n*(ut/180)}function vo(n){return n*(180/ut)}function Ba(n){if(!Ot(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function Oc(n,t){const e=t.x-n.x,s=t.y-n.y,i=Math.sqrt(e*e+s*s);let r=Math.atan2(s,e);return r<-.5*ut&&(r+=wt),{angle:r,distance:i}}function qr(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function Bg(n,t){return(n-t+Mg)%wt-ut}function qt(n){return(n%wt+wt)%wt}function Ns(n,t,e,s){const i=qt(n),r=qt(t),o=qt(e),a=qt(r-i),l=qt(o-i),c=qt(i-r),d=qt(i-o);return i===r||i===o||s&&r===o||a>l&&c<d}function Ft(n,t,e){return Math.max(t,Math.min(e,n))}function Ng(n){return Ft(n,-32768,32767)}function Ne(n,t,e,s=1e-6){return n>=Math.min(t,e)-s&&n<=Math.max(t,e)+s}function wo(n,t,e){e=e||(o=>n[o]<t);let s=n.length-1,i=0,r;for(;s-i>1;)r=i+s>>1,e(r)?i=r:s=r;return{lo:i,hi:s}}const je=(n,t,e,s)=>wo(n,e,s?i=>{const r=n[i][t];return r<e||r===e&&n[i+1][t]===e}:i=>n[i][t]<e),jg=(n,t,e)=>wo(n,e,s=>n[s][t]>=e);function Fg(n,t,e){let s=0,i=n.length;for(;s<i&&n[s]<t;)s++;for(;i>s&&n[i-1]>e;)i--;return s>0||i<n.length?n.slice(s,i):n}const Rc=["push","pop","shift","splice","unshift"];function Ug(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Rc.forEach(e=>{const s="_onData"+_o(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=i.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...r)}),o}})})}function Na(n,t){const e=n._chartjs;if(!e)return;const s=e.listeners,i=s.indexOf(t);i!==-1&&s.splice(i,1),!(s.length>0)&&(Rc.forEach(r=>{delete n[r]}),delete n._chartjs)}function Ic(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Mc=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Pc(n,t){let e=[],s=!1;return function(...i){e=i,s||(s=!0,Mc.call(window,()=>{s=!1,n.apply(t,e)}))}}function zg(n,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(n,t,s)):n.apply(this,s),t}}const xo=n=>n==="start"?"left":n==="end"?"right":"center",Gt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,Hg=(n,t,e,s)=>n===(s?"left":"right")?e:n==="center"?(t+e)/2:t;function Lc(n,t,e){const s=t.length;let i=0,r=s;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=o.axis,{min:u,max:h,minDefined:f,maxDefined:g}=o.getUserBounds();if(f){if(i=Math.min(je(l,d,u).lo,e?s:je(t,d,o.getPixelForValue(u)).lo),c){const p=l.slice(0,i+1).reverse().findIndex(m=>!ot(m[a.axis]));i-=Math.max(0,p)}i=Ft(i,0,s-1)}if(g){let p=Math.max(je(l,o.axis,h,!0).hi+1,e?0:je(t,d,o.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!ot(b[a.axis]));p+=Math.max(0,m)}r=Ft(p,i,s)-i}else r=s-i}return{start:i,count:r}}function Dc(n){const{xScale:t,yScale:e,_scaleRanges:s}=n,i={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return n._scaleRanges=i,!0;const r=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,i),r}const di=n=>n===0||n===1,ja=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*wt/e)),Fa=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*wt/e)+1,Ss={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Mt)+1,easeOutSine:n=>Math.sin(n*Mt),easeInOutSine:n=>-.5*(Math.cos(ut*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>di(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>di(n)?n:ja(n,.075,.3),easeOutElastic:n=>di(n)?n:Fa(n,.075,.3),easeInOutElastic(n){return di(n)?n:n<.5?.5*ja(n*2,.1125,.45):.5+.5*Fa(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Ss.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Ss.easeInBounce(n*2)*.5:Ss.easeOutBounce(n*2-1)*.5+.5};function ko(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Ua(n){return ko(n)?n:new Ds(n)}function mr(n){return ko(n)?n:new Ds(n).saturate(.5).darken(.1).hexString()}const Wg=["x","y","borderWidth","radius","tension"],Vg=["color","borderColor","backgroundColor"];function Gg(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:Vg},numbers:{type:"number",properties:Wg}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function qg(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const za=new Map;function Yg(n,t){t=t||{};const e=n+JSON.stringify(t);let s=za.get(e);return s||(s=new Intl.NumberFormat(n,t),za.set(e,s)),s}function Vs(n,t,e){return Yg(t,e).format(n)}const $c={values(n){return Tt(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const s=this.chart.options.locale;let i,r=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),r=Kg(n,e)}const o=Ge(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Vs(n,s,l)},logarithmic(n,t,e){if(n===0)return"0";const s=e[t].significand||n/Math.pow(10,Math.floor(Ge(n)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?$c.numeric.call(this,n,t,e):""}};function Kg(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Yi={formatters:$c};function Jg(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Yi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const xn=Object.create(null),Yr=Object.create(null);function Es(n,t){if(!t)return n;const e=t.split(".");for(let s=0,i=e.length;s<i;++s){const r=e[s];n=n[r]||(n[r]=Object.create(null))}return n}function yr(n,t,e){return typeof t=="string"?$s(Es(n,t),e):$s(Es(n,""),t)}class Xg{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>mr(i.backgroundColor),this.hoverBorderColor=(s,i)=>mr(i.borderColor),this.hoverColor=(s,i)=>mr(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return yr(this,t,e)}get(t){return Es(this,t)}describe(t,e){return yr(Yr,t,e)}override(t,e){return yr(xn,t,e)}route(t,e,s,i){const r=Es(this,t),o=Es(this,s),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[i];return lt(l)?Object.assign({},c,l):Z(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var At=new Xg({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Gg,qg,Jg]);function Qg(n){return!n||ot(n.size)||ot(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function ji(n,t,e,s,i){let r=t[i];return r||(r=t[i]=n.measureText(i).width,e.push(i)),r>s&&(s=r),s}function Zg(n,t,e,s){s=s||{};let i=s.data=s.data||{},r=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(i=s.data={},r=s.garbageCollect=[],s.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=e[l],u!=null&&!Tt(u))o=ji(n,i,r,o,u);else if(Tt(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!Tt(h)&&(o=ji(n,i,r,o,h));n.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete i[r[l]];r.splice(0,f)}return o}function ln(n,t,e){const s=n.currentDevicePixelRatio,i=e!==0?Math.max(e/2,.5):0;return Math.round((t-i)*s)/s+i}function Ha(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Kr(n,t,e,s){Bc(n,t,e,s,null)}function Bc(n,t,e,s,i){let r,o,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Pg;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,s),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(p)||p<=0)){switch(n.beginPath(),f){default:i?n.ellipse(e,s,i/2,p,0,0,wt):n.arc(e,s,p,0,wt),n.closePath();break;case"triangle":d=i?i/2:p,n.moveTo(e+Math.sin(m)*d,s-Math.cos(m)*p),m+=Da,n.lineTo(e+Math.sin(m)*d,s-Math.cos(m)*p),m+=Da,n.lineTo(e+Math.sin(m)*d,s-Math.cos(m)*p),n.closePath();break;case"rectRounded":c=p*.516,l=p-c,o=Math.cos(m+an)*l,u=Math.cos(m+an)*(i?i/2-c:l),a=Math.sin(m+an)*l,h=Math.sin(m+an)*(i?i/2-c:l),n.arc(e-u,s-a,c,m-ut,m-Mt),n.arc(e+h,s-o,c,m-Mt,m),n.arc(e+u,s+a,c,m,m+Mt),n.arc(e-h,s+o,c,m+Mt,m+ut),n.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=i?i/2:l,n.rect(e-d,s-l,2*d,2*l);break}m+=an;case"rectRot":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+h,s-o),n.lineTo(e+u,s+a),n.lineTo(e-h,s+o),n.closePath();break;case"crossRot":m+=an;case"cross":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o);break;case"star":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o),m+=an,u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o);break;case"line":o=i?i/2:Math.cos(m)*p,a=Math.sin(m)*p,n.moveTo(e-o,s-a),n.lineTo(e+o,s+a);break;case"dash":n.moveTo(e,s),n.lineTo(e+Math.cos(m)*(i?i/2:p),s+Math.sin(m)*p);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Fe(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Ki(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Ji(n){n.restore()}function tp(n,t,e,s,i){if(!t)return n.lineTo(e.x,e.y);if(i==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else i==="after"!=!!s?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function ep(n,t,e,s){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function np(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),ot(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function sp(n,t,e,s,i){if(i.strikethrough||i.underline){const r=n.measureText(s),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,d=i.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(o,d),n.lineTo(a,d),n.stroke()}}function ip(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function kn(n,t,e,s,i,r={}){const o=Tt(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(n.save(),n.font=i.string,np(n,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&ip(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),ot(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(c,e,s,r.maxWidth)),n.fillText(c,e,s,r.maxWidth),sp(n,e,s,c,r),s+=Number(i.lineHeight);n.restore()}function js(n,t){const{x:e,y:s,w:i,h:r,radius:o}=t;n.arc(e+o.topLeft,s+o.topLeft,o.topLeft,1.5*ut,ut,!0),n.lineTo(e,s+r-o.bottomLeft),n.arc(e+o.bottomLeft,s+r-o.bottomLeft,o.bottomLeft,ut,Mt,!0),n.lineTo(e+i-o.bottomRight,s+r),n.arc(e+i-o.bottomRight,s+r-o.bottomRight,o.bottomRight,Mt,0,!0),n.lineTo(e+i,s+o.topRight),n.arc(e+i-o.topRight,s+o.topRight,o.topRight,0,-Mt,!0),n.lineTo(e+o.topLeft,s)}const rp=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,op=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function ap(n,t){const e=(""+n).match(rp);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const lp=n=>+n||0;function So(n,t){const e={},s=lt(t),i=s?Object.keys(t):t,r=lt(n)?s?o=>Z(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of i)e[o]=lp(r(o));return e}function Nc(n){return So(n,{top:"y",right:"x",bottom:"y",left:"x"})}function _n(n){return So(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Kt(n){const t=Nc(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function jt(n,t){n=n||{},t=t||At.font;let e=Z(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=Z(n.style,t.style);s&&!(""+s).match(op)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:Z(n.family,t.family),lineHeight:ap(Z(n.lineHeight,t.lineHeight),e),size:e,style:s,weight:Z(n.weight,t.weight),string:""};return i.string=Qg(i),i}function fs(n,t,e,s){let i,r,o;for(i=0,r=n.length;i<r;++i)if(o=n[i],o!==void 0&&o!==void 0)return o}function cp(n,t,e){const{min:s,max:i}=n,r=Tc(t,(i-s)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(s,-Math.abs(r)),max:o(i,r)}}function tn(n,t){return Object.assign(Object.create(n),t)}function Eo(n,t=[""],e,s,i=()=>n[0]){const r=e||n;typeof s>"u"&&(s=zc("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:s,_getTarget:i,override:a=>Eo([a,...n],t,r,s)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return Fc(a,l,()=>yp(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Va(a).includes(l)},ownKeys(a){return Va(a)},set(a,l,c){const d=a._storage||(a._storage=i());return a[l]=d[l]=c,delete a._keys,!0}})}function Gn(n,t,e,s){const i={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:jc(n,s),setContext:r=>Gn(n,r,e,s),override:r=>Gn(n.override(r),t,e,s)};return new Proxy(i,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return Fc(r,o,()=>up(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function jc(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:i=t.allKeys}=n;return{allKeys:i,scriptable:e,indexable:s,isScriptable:Ze(e)?e:()=>e,isIndexable:Ze(s)?s:()=>s}}const dp=(n,t)=>n?n+_o(t):t,To=(n,t)=>lt(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Fc(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const s=e();return n[t]=s,s}function up(n,t,e){const{_proxy:s,_context:i,_subProxy:r,_descriptors:o}=n;let a=s[t];return Ze(a)&&o.isScriptable(t)&&(a=hp(t,a,n,e)),Tt(a)&&a.length&&(a=fp(t,a,n,o.isIndexable)),To(t,a)&&(a=Gn(a,i,r&&r[t],o)),a}function hp(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||s);return a.delete(n),To(n,l)&&(l=Ao(i._scopes,i,n,l)),l}function fp(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&s(n))return t[r.index%t.length];if(lt(t[0])){const l=t,c=i._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=Ao(c,i,n,d);t.push(Gn(u,r,o&&o[n],a))}}return t}function Uc(n,t,e){return Ze(n)?n(t,e):n}const gp=(n,t)=>n===!0?t:typeof n=="string"?Qe(t,n):void 0;function pp(n,t,e,s,i){for(const r of t){const o=gp(e,r);if(o){n.add(o);const a=Uc(o._fallback,e,i);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(o===!1&&typeof s<"u"&&e!==s)return null}return!1}function Ao(n,t,e,s){const i=t._rootScopes,r=Uc(t._fallback,e,s),o=[...n,...i],a=new Set;a.add(s);let l=Wa(a,o,e,r||e,s);return l===null||typeof r<"u"&&r!==e&&(l=Wa(a,o,r,l,s),l===null)?!1:Eo(Array.from(a),[""],i,r,()=>mp(t,e,s))}function Wa(n,t,e,s,i){for(;e;)e=pp(n,t,e,s,i);return e}function mp(n,t,e){const s=n._getTarget();t in s||(s[t]={});const i=s[t];return Tt(i)&&lt(e)?e:i||{}}function yp(n,t,e,s){let i;for(const r of t)if(i=zc(dp(r,n),e),typeof i<"u")return To(n,i)?Ao(e,s,n,i):i}function zc(n,t){for(const e of t){if(!e)continue;const s=e[n];if(typeof s<"u")return s}}function Va(n){let t=n._keys;return t||(t=n._keys=bp(n._scopes)),t}function bp(n){const t=new Set;for(const e of n)for(const s of Object.keys(e).filter(i=>!i.startsWith("_")))t.add(s);return Array.from(t)}function Hc(n,t,e,s){const{iScale:i}=n,{key:r="r"}=this._parsing,o=new Array(s);let a,l,c,d;for(a=0,l=s;a<l;++a)c=a+e,d=t[c],o[a]={r:i.parse(Qe(d,r),c)};return o}const _p=Number.EPSILON||1e-14,qn=(n,t)=>t<n.length&&!n[t].skip&&n[t],Wc=n=>n==="x"?"y":"x";function vp(n,t,e,s){const i=n.skip?t:n,r=t,o=e.skip?t:e,a=qr(r,i),l=qr(o,r);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=s*c,h=s*d;return{previous:{x:r.x-u*(o.x-i.x),y:r.y-u*(o.y-i.y)},next:{x:r.x+h*(o.x-i.x),y:r.y+h*(o.y-i.y)}}}function wp(n,t,e){const s=n.length;let i,r,o,a,l,c=qn(n,0);for(let d=0;d<s-1;++d)if(l=c,c=qn(n,d+1),!(!l||!c)){if(ks(t[d],0,_p)){e[d]=e[d+1]=0;continue}i=e[d]/t[d],r=e[d+1]/t[d],a=Math.pow(i,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[d]=i*o*t[d],e[d+1]=r*o*t[d])}}function xp(n,t,e="x"){const s=Wc(e),i=n.length;let r,o,a,l=qn(n,0);for(let c=0;c<i;++c){if(o=a,a=l,l=qn(n,c+1),!a)continue;const d=a[e],u=a[s];o&&(r=(d-o[e])/3,a[`cp1${e}`]=d-r,a[`cp1${s}`]=u-r*t[c]),l&&(r=(l[e]-d)/3,a[`cp2${e}`]=d+r,a[`cp2${s}`]=u+r*t[c])}}function kp(n,t="x"){const e=Wc(t),s=n.length,i=Array(s).fill(0),r=Array(s);let o,a,l,c=qn(n,0);for(o=0;o<s;++o)if(a=l,l=c,c=qn(n,o+1),!!l){if(c){const d=c[t]-l[t];i[o]=d!==0?(c[e]-l[e])/d:0}r[o]=a?c?Ce(i[o-1])!==Ce(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}wp(n,i,r),xp(n,r,t)}function ui(n,t,e){return Math.max(Math.min(n,e),t)}function Sp(n,t){let e,s,i,r,o,a=Fe(n[0],t);for(e=0,s=n.length;e<s;++e)o=r,r=a,a=e<s-1&&Fe(n[e+1],t),r&&(i=n[e],o&&(i.cp1x=ui(i.cp1x,t.left,t.right),i.cp1y=ui(i.cp1y,t.top,t.bottom)),a&&(i.cp2x=ui(i.cp2x,t.left,t.right),i.cp2y=ui(i.cp2y,t.top,t.bottom)))}function Ep(n,t,e,s,i){let r,o,a,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")kp(n,i);else{let c=s?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=vp(c,a,n[Math.min(r+1,o-(s?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&Sp(n,e)}function Co(){return typeof window<"u"&&typeof document<"u"}function Oo(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Fi(n,t,e){let s;return typeof n=="string"?(s=parseInt(n,10),n.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=n,s}const Xi=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function Tp(n,t){return Xi(n).getPropertyValue(t)}const Ap=["top","right","bottom","left"];function vn(n,t,e){const s={};e=e?"-"+e:"";for(let i=0;i<4;i++){const r=Ap[i];s[r]=parseFloat(n[t+"-"+r+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const Cp=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function Op(n,t){const e=n.touches,s=e&&e.length?e[0]:n,{offsetX:i,offsetY:r}=s;let o=!1,a,l;if(Cp(i,r,n.target))a=i,l=r;else{const c=t.getBoundingClientRect();a=s.clientX-c.left,l=s.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function hn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:s}=t,i=Xi(e),r=i.boxSizing==="border-box",o=vn(i,"padding"),a=vn(i,"border","width"),{x:l,y:c,box:d}=Op(n,e),u=o.left+(d&&a.left),h=o.top+(d&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((l-u)/f*e.width/s),y:Math.round((c-h)/g*e.height/s)}}function Rp(n,t,e){let s,i;if(t===void 0||e===void 0){const r=n&&Oo(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Xi(r),l=vn(a,"border","width"),c=vn(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,s=Fi(a.maxWidth,r,"clientWidth"),i=Fi(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:s||Ni,maxHeight:i||Ni}}const qe=n=>Math.round(n*10)/10;function Ip(n,t,e,s){const i=Xi(n),r=vn(i,"margin"),o=Fi(i.maxWidth,n,"clientWidth")||Ni,a=Fi(i.maxHeight,n,"clientHeight")||Ni,l=Rp(n,t,e);let{width:c,height:d}=l;if(i.boxSizing==="content-box"){const h=vn(i,"border","width"),f=vn(i,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-r.width),d=Math.max(0,s?c/s:d-r.height),c=qe(Math.min(c,o,l.maxWidth)),d=qe(Math.min(d,a,l.maxHeight)),c&&!d&&(d=qe(c/2)),(t!==void 0||e!==void 0)&&s&&l.height&&d>l.height&&(d=l.height,c=qe(Math.floor(d*s))),{width:c,height:d}}function Ga(n,t,e){const s=t||1,i=qe(n.height*s),r=qe(n.width*s);n.height=qe(n.height),n.width=qe(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==s||o.height!==i||o.width!==r?(n.currentDevicePixelRatio=s,o.height=i,o.width=r,n.ctx.setTransform(s,0,0,s,0,0),!0):!1}const Mp=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Co()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function qa(n,t){const e=Tp(n,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function fn(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function Pp(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:s==="middle"?e<.5?n.y:t.y:s==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function Lp(n,t,e,s){const i={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=fn(n,i,e),a=fn(i,r,e),l=fn(r,t,e),c=fn(o,a,e),d=fn(a,l,e);return fn(c,d,e)}const Dp=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},$p=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function Wn(n,t,e){return n?Dp(t,e):$p()}function Vc(n,t){let e,s;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=s)}function Gc(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function qc(n){return n==="angle"?{between:Ns,compare:Bg,normalize:qt}:{between:Ne,compare:(t,e)=>t-e,normalize:t=>t}}function Ya({start:n,end:t,count:e,loop:s,style:i}){return{start:n%e,end:t%e,loop:s&&(t-n+1)%e===0,style:i}}function Bp(n,t,e){const{property:s,start:i,end:r}=e,{between:o,normalize:a}=qc(s),l=t.length;let{start:c,end:d,loop:u}=n,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&o(a(t[c%l][s]),i,r);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function Yc(n,t,e){if(!e)return[n];const{property:s,start:i,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=qc(s),{start:d,end:u,loop:h,style:f}=Bp(n,t,e),g=[];let p=!1,m=null,b,v,w;const k=()=>l(i,w,b)&&a(i,w)!==0,A=()=>a(r,b)===0||l(r,w,b),C=()=>p||k(),E=()=>!p||A();for(let y=d,_=d;y<=u;++y)v=t[y%o],!v.skip&&(b=c(v[s]),b!==w&&(p=l(b,i,r),m===null&&C()&&(m=a(b,i)===0?y:_),m!==null&&E()&&(g.push(Ya({start:m,end:y,loop:h,count:o,style:f})),m=null),_=y,w=b));return m!==null&&g.push(Ya({start:m,end:u,loop:h,count:o,style:f})),g}function Kc(n,t){const e=[],s=n.segments;for(let i=0;i<s.length;i++){const r=Yc(s[i],n.points,t);r.length&&e.push(...r)}return e}function Np(n,t,e,s){let i=0,r=t-1;if(e&&!s)for(;i<t&&!n[i].skip;)i++;for(;i<t&&n[i].skip;)i++;for(i%=t,e&&(r+=i);r>i&&n[r%t].skip;)r--;return r%=t,{start:i,end:r}}function jp(n,t,e,s){const i=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%i];c.skip||c.stop?a.skip||(s=!1,r.push({start:t%i,end:(l-1)%i,loop:s}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%i,end:o%i,loop:s}),r}function Fp(n,t){const e=n.points,s=n.options.spanGaps,i=e.length;if(!i)return[];const r=!!n._loop,{start:o,end:a}=Np(e,i,r,s);if(s===!0)return Ka(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+i:a,c=!!n._fullLoop&&o===0&&a===i-1;return Ka(n,jp(e,o,l,c),e,t)}function Ka(n,t,e,s){return!s||!s.setContext||!e?t:Up(n,t,e,s)}function Up(n,t,e,s){const i=n._chart.getContext(),r=Ja(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,c=[];let d=r,u=t[0].start,h=u;function f(g,p,m,b){const v=a?-1:1;if(g!==p){for(g+=l;e[g%l].skip;)g-=v;for(;e[p%l].skip;)p+=v;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=e[u%l],m;for(h=u+1;h<=g.end;h++){const b=e[h%l];m=Ja(s.setContext(tn(i,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:o}))),zp(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Ja(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function zp(n,t){if(!t)return!1;const e=[],s=function(i,r){return ko(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,s)!==JSON.stringify(t,s)}function hi(n,t,e){return n.options.clip?n[e]:t[e]}function Hp(n,t){const{xScale:e,yScale:s}=n;return e&&s?{left:hi(e,t,"left"),right:hi(e,t,"right"),top:hi(s,t,"top"),bottom:hi(s,t,"bottom")}:t}function Jc(n,t){const e=t._clip;if(e.disabled)return!1;const s=Hp(t,n.chartArea);return{left:e.left===!1?0:s.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:s.right+(e.right===!0?0:e.right),top:e.top===!1?0:s.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:s.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Wp{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,i){const r=e.listeners[i],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(s-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Mc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const r=s.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,s,t,"progress")),r.length||(s.running=!1,this._notify(i,s,t,"complete"),s.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Le=new Wp;const Xa="transparent",Vp={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const s=Ua(n||Xa),i=s.valid&&Ua(t||Xa);return i&&i.valid?i.mix(s,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class Gp{constructor(t,e,s,i){const r=e[s];i=fs([t.to,i,r,t.from]);const o=fs([t.from,r,i]);this._active=!0,this._fn=t.fn||Vp[t.type||typeof o],this._easing=Ss[t.easing]||Ss.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const i=this._target[this._prop],r=s-this._start,o=this._duration-r;this._start=s,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=fs([t.to,e,i,t.from]),this._from=fs([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,i=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<s),!this._active){this._target[i]=a,this._notify(!0);return}if(e<0){this._target[i]=r;return}l=e/s%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][e]()}}class Xc{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!lt(t))return;const e=Object.keys(At.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!lt(r))return;const o={};for(const a of e)o[a]=r[a];(Tt(r.properties)&&r.properties||[i]).forEach(a=>{(a===i||!s.has(a))&&s.set(a,o)})})}_animateOptions(t,e){const s=e.options,i=Yp(t,s);if(!i)return[];const r=this._createAnimations(i,s);return s.$shared&&qp(t.options.$animations,s).then(()=>{t.options=s},()=>{}),r}_createAnimations(t,e){const s=this._properties,i=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(t,e));continue}const d=e[c];let u=r[c];const h=s.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}r[c]=u=new Gp(h,t,c,d),i.push(u)}return i}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Le.add(this._chart,s),!0}}function qp(n,t){const e=[],s=Object.keys(t);for(let i=0;i<s.length;i++){const r=n[s[i]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function Yp(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Qa(n,t){const e=n&&n.options||{},s=e.reverse,i=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:s?r:i,end:s?i:r}}function Kp(n,t,e){if(e===!1)return!1;const s=Qa(n,e),i=Qa(t,e);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function Jp(n){let t,e,s,i;return lt(n)?(t=n.top,e=n.right,s=n.bottom,i=n.left):t=e=s=i=n,{top:t,right:e,bottom:s,left:i,disabled:n===!1}}function Qc(n,t){const e=[],s=n._getSortedDatasetMetas(t);let i,r;for(i=0,r=s.length;i<r;++i)e.push(s[i].index);return e}function Za(n,t,e,s={}){const i=n.keys,r=s.mode==="single";let o,a,l,c;if(t===null)return;let d=!1;for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===e){if(d=!0,s.all)continue;break}c=n.values[l],Ot(c)&&(r||t===0||Ce(t)===Ce(c))&&(t+=c)}return!d&&!s.all?0:t}function Xp(n,t){const{iScale:e,vScale:s}=t,i=e.axis==="x"?"x":"y",r=s.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],a[l]={[i]:d,[r]:n[d]};return a}function br(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function Qp(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function Zp(n){const{min:t,max:e,minDefined:s,maxDefined:i}=n.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:i?e:Number.POSITIVE_INFINITY}}function tm(n,t,e){const s=n[t]||(n[t]={});return s[e]||(s[e]={})}function tl(n,t,e,s){for(const i of t.getMatchingVisibleMetas(s).reverse()){const r=n[i.index];if(e&&r>0||!e&&r<0)return i.index}return null}function el(n,t){const{chart:e,_cachedMeta:s}=n,i=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=s,l=r.axis,c=o.axis,d=Qp(r,o,s),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=tm(i,d,p),h[a]=m,h._top=tl(h,o,!0,s.type),h._bottom=tl(h,o,!1,s.type);const v=h._visualValues||(h._visualValues={});v[a]=m}}function _r(n,t){const e=n.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function em(n,t){return tn(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function nm(n,t,e){return tn(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function ts(n,t){const e=n.controller.index,s=n.vScale&&n.vScale.axis;if(s){t=t||n._parsed;for(const i of t){const r=i._stacks;if(!r||r[s]===void 0||r[s][e]===void 0)return;delete r[s][e],r[s]._visualValues!==void 0&&r[s]._visualValues[e]!==void 0&&delete r[s]._visualValues[e]}}}const vr=n=>n==="reset"||n==="none",nl=(n,t)=>t?n:Object.assign({},n),sm=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:Qc(e,!0),values:null};class ve{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=br(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&ts(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),i=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,r=e.xAxisID=Z(s.xAxisID,_r(t,"x")),o=e.yAxisID=Z(s.yAxisID,_r(t,"y")),a=e.rAxisID=Z(s.rAxisID,_r(t,"r")),l=e.indexAxis,c=e.iAxisID=i(l,r,o,a),d=e.vAxisID=i(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Na(this._data,this),t._stacked&&ts(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(lt(e)){const i=this._cachedMeta;this._data=Xp(e,i)}else if(s!==e){if(s){Na(s,this);const i=this._cachedMeta;ts(i),i._parsed=[]}e&&Object.isExtensible(e)&&Ug(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=br(e.vScale,e),e.stack!==s.stack&&(i=!0,ts(e),e.stack=s.stack),this._resyncElements(t),(i||r!==e._stacked)&&(el(this,e._parsed),e._stacked=br(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:i}=this,{iScale:r,_stacked:o}=s,a=r.axis;let l=t===0&&e===i.length?!0:s._sorted,c=t>0&&s._parsed[t-1],d,u,h;if(this._parsing===!1)s._parsed=i,s._sorted=!0,h=i;else{Tt(i[t])?h=this.parseArrayData(s,i,t,e):lt(i[t])?h=this.parseObjectData(s,i,t,e):h=this.parsePrimitiveData(s,i,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<e;++d)s._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);s._sorted=l}o&&el(this,h)}parsePrimitiveData(t,e,s,i){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),d=r===o,u=new Array(i);let h,f,g;for(h=0,f=i;h<f;++h)g=h+s,u[h]={[a]:d||r.parse(c[g],g),[l]:o.parse(e[g],g)};return u}parseArrayData(t,e,s,i){const{xScale:r,yScale:o}=t,a=new Array(i);let l,c,d,u;for(l=0,c=i;l<c;++l)d=l+s,u=e[d],a[l]={x:r.parse(u[0],d),y:o.parse(u[1],d)};return a}parseObjectData(t,e,s,i){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(i);let d,u,h,f;for(d=0,u=i;d<u;++d)h=d+s,f=e[h],c[d]={x:r.parse(Qe(f,a),h),y:o.parse(Qe(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const i=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:Qc(i,!0),values:e._stacks[t.axis]._visualValues};return Za(a,o,r.index,{mode:s})}updateRangeFromParsed(t,e,s,i){const r=s[e.axis];let o=r===null?NaN:r;const a=i&&s._stacks[e.axis];i&&a&&(i.values=a,o=Za(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const s=this._cachedMeta,i=s._parsed,r=s._sorted&&t===s.iScale,o=i.length,a=this._getOtherScale(t),l=sm(e,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=Zp(a);let h,f;function g(){f=i[h];const p=f[a.axis];return!Ot(f[t.axis])||d>p||u<p}for(h=0;h<o&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),r));++h);if(r){for(h=o-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let i,r,o;for(i=0,r=e.length;i<r;++i)o=e[i][t.axis],Ot(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:s?""+s.getLabelForValue(r[s.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Jp(Z(this.options.clip,Kp(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,i=s.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||i.length-a,c=this.options.drawActiveElementsOnTop;let d;for(s.dataset&&s.dataset.draw(t,r,a,l),d=a;d<a+l;++d){const u=i[d];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(d=0;d<o.length;++d)o[d].draw(t,r)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=nm(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=em(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=s,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const i=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&Bs(s);if(a)return nl(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=i?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(At.elements[t]),g=()=>this.getContext(s,i,e),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,r[o]=Object.freeze(nl(p,l))),p}_resolveAnimations(t,e,s){const i=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(i.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,s,e))}const c=new Xc(i,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||vr(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(s),o=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,s),{sharedOptions:r,includeOptions:o}}updateElement(t,e,s,i){vr(i)?Object.assign(t,s):this._resolveAnimations(e,i).update(t,s)}updateSharedOptions(t,e,s){t&&!vr(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,s,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const i=s.length,r=e.length,o=Math.min(r,i);o&&this.parse(0,o),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e,s=!0){const i=this._cachedMeta,r=i.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(t,e),s&&this.updateElements(r,t,e,"reset")}updateElements(t,e,s,i){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(t,e);s._stacked&&ts(s,i)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,i]=t;this[e](s,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}F(ve,"defaults",{}),F(ve,"datasetElementType",null),F(ve,"dataElementType",null);function im(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let s=[];for(let i=0,r=e.length;i<r;i++)s=s.concat(e[i].controller.getAllParsedValues(n));n._cache.$bar=Ic(s.sort((i,r)=>i-r))}return n._cache.$bar}function rm(n){const t=n.iScale,e=im(t,n.type);let s=t._length,i,r,o,a;const l=()=>{o===32767||o===-32768||(Bs(a)&&(s=Math.min(s,Math.abs(o-a)||s)),a=o)};for(i=0,r=e.length;i<r;++i)o=t.getPixelForValue(e[i]),l();for(a=void 0,i=0,r=t.ticks.length;i<r;++i)o=t.getPixelForTick(i),l();return s}function om(n,t,e,s){const i=e.barThickness;let r,o;return ot(i)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=i*s,o=1),{chunk:r/s,ratio:o,start:t.pixels[n]-r/2}}function am(n,t,e,s){const i=t.pixels,r=i[n];let o=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/s,ratio:e.barPercentage,start:c}}function lm(n,t,e,s){const i=e.parse(n[0],s),r=e.parse(n[1],s),o=Math.min(i,r),a=Math.max(i,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:i,end:r,min:o,max:a}}function Zc(n,t,e,s){return Tt(n)?lm(n,t,e,s):t[e.axis]=e.parse(n,s),t}function sl(n,t,e,s){const i=n.iScale,r=n.vScale,o=i.getLabels(),a=i===r,l=[];let c,d,u,h;for(c=e,d=e+s;c<d;++c)h=t[c],u={},u[i.axis]=a||i.parse(o[c],c),l.push(Zc(h,u,r,c));return l}function wr(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function cm(n,t,e){return n!==0?Ce(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function dm(n){let t,e,s,i,r;return n.horizontal?(t=n.base>n.x,e="left",s="right"):(t=n.base<n.y,e="bottom",s="top"),t?(i="end",r="start"):(i="start",r="end"),{start:e,end:s,reverse:t,top:i,bottom:r}}function um(n,t,e,s){let i=t.borderSkipped;const r={};if(!i){n.borderSkipped=r;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:d}=dm(n);i==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===s?i=c:(e._bottom||0)===s?i=d:(r[il(d,o,a,l)]=!0,i=c)),r[il(i,o,a,l)]=!0,n.borderSkipped=r}function il(n,t,e,s){return s?(n=hm(n,t,e),n=rl(n,e,t)):n=rl(n,t,e),n}function hm(n,t,e){return n===t?e:n===e?t:n}function rl(n,t,e){return n==="start"?t:n==="end"?e:n}function fm(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class ki extends ve{parsePrimitiveData(t,e,s,i){return sl(t,e,s,i)}parseArrayData(t,e,s,i){return sl(t,e,s,i)}parseObjectData(t,e,s,i){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,d=o.axis==="x"?a:l,u=[];let h,f,g,p;for(h=s,f=s+i;h<f;++h)p=e[h],g={},g[r.axis]=r.parse(Qe(p,c),h),u.push(Zc(Qe(p,d),g,o,h));return u}updateRangeFromParsed(t,e,s,i){super.updateRangeFromParsed(t,e,s,i);const r=s._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:i}=e,r=this.getParsed(t),o=r._custom,a=wr(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+s.getLabelForValue(r[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,i){const r=i==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i);for(let f=e;f<e+s;f++){const g=this.getParsed(f),p=r||ot(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],v={horizontal:c,base:p.base,enableBorderRadius:!b||wr(g._custom)||o===b._top||o===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(v.options=u||this.resolveDataElementOptions(f,t[f].active?"active":i));const w=v.options||t[f].options;um(v,w,b,o),fm(v,w,d.ratio),this.updateElement(t[f],f,v,i)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),r=s.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[s.axis],c=d=>{const u=d._parsed.find(f=>f[s.axis]===l),h=u&&u[d.vScale.axis];if(ot(h)||isNaN(h))return!0};for(const d of i)if(!(e!==void 0&&c(d))&&((r===!1||o.indexOf(d.stack)===-1||r===void 0&&d.stack===void 0)&&o.push(d.stack),d.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(s=>t[s].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)t[Z(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,s){const i=this._getStacks(t,s),r=e!==void 0?i.indexOf(e):-1;return r===-1?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,i=[];let r,o;for(r=0,o=e.data.length;r<o;++r)i.push(s.getPixelForValue(this.getParsed(r)[s.axis],r));const a=t.barThickness;return{min:a||rm(e),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:i},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,d=wr(c);let u=l[e.axis],h=0,f=s?this.applyStack(e,l,s):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Ce(u)!==Ce(c.barEnd)&&(h=0),h+=u);const m=!ot(r)&&!d?r:h;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<o){p=cm(p,e,a)*o,u===a&&(b-=p/2);const v=e.getPixelForDecimal(0),w=e.getPixelForDecimal(1),k=Math.min(v,w),A=Math.max(v,w);b=Math.max(Math.min(b,A),k),g=b+p,s&&!d&&(l._stacks[e.axis]._visualValues[i]=e.getValueForPixel(g)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const v=Ce(p)*e.getLineWidthForValue(a)/2;b+=v,p-=v}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,i=this.options,r=i.skipNull,o=Z(i.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const d=r?this._getStackCount(t):e.stackCount,u=i.barThickness==="flex"?am(t,e,i,d*c):om(t,e,i,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(Z(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,i=s.length;let r=0;for(;r<i;++r)this.getParsed(r)[e.axis]!==null&&!s[r].hidden&&s[r].draw(this._ctx)}}F(ki,"id","bar"),F(ki,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),F(ki,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Si extends ve{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,i){const r=super.parsePrimitiveData(t,e,s,i);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+s).radius;return r}parseArrayData(t,e,s,i){const r=super.parseArrayData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=Z(a[2],this.resolveDataElementOptions(o+s).radius)}return r}parseObjectData(t,e,s,i){const r=super.parseObjectData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=Z(a&&a.r&&+a.r,this.resolveDataElementOptions(o+s).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:s[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,i),d=o.axis,u=a.axis;for(let h=e;h<e+s;h++){const f=t[h],g=!r&&this.getParsed(h),p={},m=p[d]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[d]),b=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":i),r&&(p.options.radius=0)),this.updateElement(f,h,p,i)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return e!=="active"&&(i.radius=0),i.radius+=Z(s&&s._custom,r),i}}F(Si,"id","bubble"),F(Si,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),F(Si,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function gm(n,t,e){let s=1,i=1,r=0,o=0;if(t<wt){const a=n,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(w,k,A)=>Ns(w,a,l,!0)?1:Math.max(k,k*e,A,A*e),g=(w,k,A)=>Ns(w,a,l,!0)?-1:Math.min(k,k*e,A,A*e),p=f(0,c,u),m=f(Mt,d,h),b=g(ut,c,u),v=g(ut+Mt,d,h);s=(p-b)/2,i=(m-v)/2,r=-(p+b)/2,o=-(m+v)/2}return{ratioX:s,ratioY:i,offsetX:r,offsetY:o}}class yn extends ve{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let r=l=>+s[l];if(lt(s[t])){const{key:l="value"}=this._parsing;r=c=>+Qe(s[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)i._parsed[o]=r(o)}}_getRotation(){return _e(this.options.rotation-90)}_getCircumference(){return _e(this.options.circumference)}_getRotationExtents(){let t=wt,e=-wt;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,r=i._getRotation(),o=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,i=this._cachedMeta,r=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-o)/2,0),l=Math.min(Tg(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=gm(u,d,l),m=(s.width-o)/h,b=(s.height-o)/f,v=Math.max(Math.min(m,b)/2,0),w=Tc(this.options.radius,v),k=Math.max(w*l,0),A=(w-k)/this._getVisibleDatasetWeightTotal();this.offsetX=g*w,this.offsetY=p*w,i.total=this.calculateTotal(),this.outerRadius=w-A*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-A*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const s=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||i._parsed[t]===null||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/wt)}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=r&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,i);let b=this._getRotation(),v;for(v=0;v<e;++v)b+=this._circumference(v,r);for(v=e;v<e+s;++v){const w=this._circumference(v,r),k=t[v],A={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+w,circumference:w,outerRadius:g,innerRadius:f};m&&(A.options=p||this.resolveDataElementOptions(v,k.active?"active":i)),b+=w,this.updateElement(k,v,A,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,i;for(i=0;i<e.length;i++){const r=t._parsed[i];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(i)&&!e[i].hidden&&(s+=Math.abs(r))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?wt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=Vs(e._parsed[t],s.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const s=this.chart;let i,r,o,a,l;if(!t){for(i=0,r=s.data.datasets.length;i<r;++i)if(s.isDatasetVisible(i)){o=s.getDatasetMeta(i),t=o.data,a=o.controller;break}}if(!t)return 0;for(i=0,r=t.length;i<r;++i)l=a.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,i=t.length;s<i;++s){const r=this.resolveDataElementOptions(s);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(Z(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}F(yn,"id","doughnut"),F(yn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),F(yn,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),F(yn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:i,pointStyle:s,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class Ei extends ve{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:i=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Lc(e,i,o);this._drawStart=a,this._drawCount=l,Dc(e)&&(a=0,l=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=i;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:c},t),this.updateElements(i,a,l,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,i),h=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Vn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||i==="none",v=e+s,w=t.length;let k=e>0&&this.getParsed(e-1);for(let A=0;A<w;++A){const C=t[A],E=b?C:{};if(A<e||A>=v){E.skip=!0;continue}const y=this.getParsed(A),_=ot(y[f]),S=E[h]=o.getPixelForValue(y[h],A),T=E[f]=r||_?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,y,l):y[f],A);E.skip=isNaN(S)||isNaN(T)||_,E.stop=A>0&&Math.abs(y[h]-k[h])>m,p&&(E.parsed=y,E.raw=c.data[A]),u&&(E.options=d||this.resolveDataElementOptions(A,C.active?"active":i)),b||this.updateElement(C,A,E,i),k=y}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return s;const r=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}F(Ei,"id","line"),F(Ei,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),F(Ei,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Ts extends ve{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=Vs(e._parsed[t].r,s.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,s,i){return Hc.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,i)=>{const r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),o=Math.max(s.cutoutPercentage?r/100*s.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*ut;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,i,p);for(g=e;g<e+s;g++){const m=t[g];let b=f,v=f+this._computeAngle(g,i,p),w=o.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=v,r&&(l.animateScale&&(w=0),l.animateRotate&&(b=v=h));const k={x:d,y:u,innerRadius:0,outerRadius:w,startAngle:b,endAngle:v,options:this.resolveDataElementOptions(g,m.active?"active":i)};this.updateElement(m,g,k,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?_e(this.resolveDataElementOptions(t,e).angle||s):0}}F(Ts,"id","polarArea"),F(Ts,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),F(Ts,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:i}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Jr extends yn{}F(Jr,"id","pie"),F(Jr,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Ti extends ve{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,i){return Hc.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta,s=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(s.points=i,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:o};this.updateElement(s,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,s,i){const r=this._cachedMeta.rScale,o=i==="reset";for(let a=e;a<e+s;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":i),d=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:d.x,h=o?r.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,i)}}}F(Ti,"id","radar"),F(Ti,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),F(Ti,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Ai extends ve{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:s[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:o}=Lc(e,s,i);if(this._drawStart=r,this._drawCount=o,Dc(e)&&(r=0,o=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=s;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!i,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,i),u=this.getSharedOptions(d),h=this.includeOptions(i,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=Vn(p)?p:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||r||i==="none";let w=e>0&&this.getParsed(e-1);for(let k=e;k<e+s;++k){const A=t[k],C=this.getParsed(k),E=v?A:{},y=ot(C[g]),_=E[f]=o.getPixelForValue(C[f],k),S=E[g]=r||y?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,C,l):C[g],k);E.skip=isNaN(_)||isNaN(S)||y,E.stop=k>0&&Math.abs(C[f]-w[f])>b,m&&(E.parsed=C,E.raw=c.data[k]),h&&(E.options=u||this.resolveDataElementOptions(k,A.active?"active":i)),v||this.updateElement(A,k,E,i),w=C}this.updateSharedOptions(u,i,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const s=t.dataset,i=s.options&&s.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,o)/2}}F(Ai,"id","scatter"),F(Ai,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),F(Ai,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var pm=Object.freeze({__proto__:null,BarController:ki,BubbleController:Si,DoughnutController:yn,LineController:Ei,PieController:Jr,PolarAreaController:Ts,RadarController:Ti,ScatterController:Ai});function cn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ro{constructor(t){F(this,"options");this.options=t||{}}static override(t){Object.assign(Ro.prototype,t)}init(){}formats(){return cn()}parse(){return cn()}format(){return cn()}add(){return cn()}diff(){return cn()}startOf(){return cn()}endOf(){return cn()}}var mm={_date:Ro};function ym(n,t,e,s){const{controller:i,data:r,_sorted:o}=n,a=i._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?jg:je;if(s){if(i._sharedOptions){const d=r[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(r,t,e-u),f=c(r,t,e+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(r,t,e);if(l){const{vScale:u}=i._cachedMeta,{_parsed:h}=n,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!ot(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!ot(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:r.length-1}}function Qi(n,t,e,s,i){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:d}=r[a],{lo:u,hi:h}=ym(r[a],t,o,i);for(let f=u;f<=h;++f){const g=d[f];g.skip||s(g,c,f)}}}function bm(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(s,i){const r=t?Math.abs(s.x-i.x):0,o=e?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function xr(n,t,e,s,i){const r=[];return!i&&!n.isPointInArea(t)||Qi(n,e,t,function(a,l,c){!i&&!Fe(a,n.chartArea,0)||a.inRange(t.x,t.y,s)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function _m(n,t,e,s){let i=[];function r(o,a,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],s),{angle:u}=Oc(o,{x:t.x,y:t.y});Ns(u,c,d)&&i.push({element:o,datasetIndex:a,index:l})}return Qi(n,e,t,r),i}function vm(n,t,e,s,i,r){let o=[];const a=bm(e);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,i);if(s&&!f)return;const g=d.getCenterPoint(i);if(!(!!r||n.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(o=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&o.push({element:d,datasetIndex:u,index:h})}return Qi(n,e,t,c),o}function kr(n,t,e,s,i,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!s?_m(n,t,e,i):vm(n,t,e,s,i,r)}function ol(n,t,e,s,i){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Qi(n,e,t,(l,c,d)=>{l[o]&&l[o](t[e],i)&&(r.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,i))}),s&&!a?[]:r}var wm={modes:{index(n,t,e,s){const i=hn(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?xr(n,i,r,s,o):kr(n,i,r,!1,s,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,s){const i=hn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?xr(n,i,r,s,o):kr(n,i,r,!1,s,o);if(a.length>0){const l=a[0].datasetIndex,c=n.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(n,t,e,s){const i=hn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return xr(n,i,r,s,o)},nearest(n,t,e,s){const i=hn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return kr(n,i,r,e.intersect,s,o)},x(n,t,e,s){const i=hn(t,n);return ol(n,i,"x",e.intersect,s)},y(n,t,e,s){const i=hn(t,n);return ol(n,i,"y",e.intersect,s)}}};const td=["left","top","right","bottom"];function es(n,t){return n.filter(e=>e.pos===t)}function al(n,t){return n.filter(e=>td.indexOf(e.pos)===-1&&e.box.axis===t)}function ns(n,t){return n.sort((e,s)=>{const i=t?s:e,r=t?e:s;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function xm(n){const t=[];let e,s,i,r,o,a;for(e=0,s=(n||[]).length;e<s;++e)i=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=i,t.push({index:e,box:i,pos:r,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&r+o,stackWeight:a});return t}function km(n){const t={};for(const e of n){const{stack:s,pos:i,stackWeight:r}=e;if(!s||!td.includes(i))continue;const o=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function Sm(n,t){const e=km(n),{vBoxMaxWidth:s,hBoxMaxHeight:i}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,c=e[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*s:l&&t.availableWidth,a.height=i):(a.width=s,a.height=d?d*i:l&&t.availableHeight)}return e}function Em(n){const t=xm(n),e=ns(t.filter(c=>c.box.fullSize),!0),s=ns(es(t,"left"),!0),i=ns(es(t,"right")),r=ns(es(t,"top"),!0),o=ns(es(t,"bottom")),a=al(t,"x"),l=al(t,"y");return{fullSize:e,leftAndTop:s.concat(r),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:es(t,"chartArea"),vertical:s.concat(i).concat(l),horizontal:r.concat(o).concat(a)}}function ll(n,t,e,s){return Math.max(n[e],t[e])+Math.max(n[s],t[s])}function ed(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function Tm(n,t,e,s){const{pos:i,box:r}=e,o=n.maxPadding;if(!lt(i)){e.size&&(n[i]-=e.size);const u=s[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[i]+=e.size}r.getPadding&&ed(o,r.getPadding());const a=Math.max(0,t.outerWidth-ll(o,n,"left","right")),l=Math.max(0,t.outerHeight-ll(o,n,"top","bottom")),c=a!==n.w,d=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function Am(n){const t=n.maxPadding;function e(s){const i=Math.max(t[s]-n[s],0);return n[s]+=i,i}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function Cm(n,t){const e=t.maxPadding;function s(i){const r={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return s(n?["left","right"]:["top","bottom"])}function gs(n,t,e,s){const i=[];let r,o,a,l,c,d;for(r=0,o=n.length,c=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,Cm(a.horizontal,t));const{same:u,other:h}=Tm(t,e,a,s);c|=u&&i.length,d=d||h,l.fullSize||i.push(a)}return c&&gs(i,t,e,s)||d}function fi(n,t,e,s,i){n.top=e,n.left=t,n.right=t+s,n.bottom=e+i,n.width=s,n.height=i}function cl(n,t,e,s){const i=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,c=s[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;Bs(c.start)&&(o=c.start),l.fullSize?fi(l,i.left,o,e.outerWidth-i.right-i.left,h):fi(l,t.left+c.placed,o,u,h),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*d,h=c.size||l.width;Bs(c.start)&&(r=c.start),l.fullSize?fi(l,r,i.top,h,e.outerHeight-i.bottom-i.top):fi(l,r,t.top+c.placed,h,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var Yt={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,s){if(!n)return;const i=Kt(n.options.layout.padding),r=Math.max(t-i.width,0),o=Math.max(e-i.height,0),a=Em(n.boxes),l=a.vertical,c=a.horizontal;mt(n.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:i,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/d,hBoxMaxHeight:o/2}),h=Object.assign({},i);ed(h,Kt(s));const f=Object.assign({maxPadding:h,w:r,h:o,x:i.left,y:i.top},i),g=Sm(l.concat(c),u);gs(a.fullSize,f,u,g),gs(l,f,u,g),gs(c,f,u,g)&&gs(l,f,u,g),Am(f),cl(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,cl(a.rightAndBottom,f,u,g),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},mt(a.chartArea,p=>{const m=p.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class nd{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,i){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):s)}}isAttached(t){return!0}updateConfig(t){}}class Om extends nd{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Ci="$chartjs",Rm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},dl=n=>n===null||n==="";function Im(n,t){const e=n.style,s=n.getAttribute("height"),i=n.getAttribute("width");if(n[Ci]={initial:{height:s,width:i,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",dl(i)){const r=qa(n,"width");r!==void 0&&(n.width=r)}if(dl(s))if(n.style.height==="")n.height=n.width/(t||2);else{const r=qa(n,"height");r!==void 0&&(n.height=r)}return n}const sd=Mp?{passive:!0}:!1;function Mm(n,t,e){n&&n.addEventListener(t,e,sd)}function Pm(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,sd)}function Lm(n,t){const e=Rm[n.type]||n.type,{x:s,y:i}=hn(n,t);return{type:e,chart:t,native:n,x:s!==void 0?s:null,y:i!==void 0?i:null}}function Ui(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function Dm(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Ui(a.addedNodes,s),o=o&&!Ui(a.removedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}function $m(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Ui(a.removedNodes,s),o=o&&!Ui(a.addedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}const Fs=new Map;let ul=0;function id(){const n=window.devicePixelRatio;n!==ul&&(ul=n,Fs.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function Bm(n,t){Fs.size||window.addEventListener("resize",id),Fs.set(n,t)}function Nm(n){Fs.delete(n),Fs.size||window.removeEventListener("resize",id)}function jm(n,t,e){const s=n.canvas,i=s&&Oo(s);if(!i)return;const r=Pc((a,l)=>{const c=i.clientWidth;e(a,l),c<i.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||r(c,d)});return o.observe(i),Bm(n,r),o}function Sr(n,t,e){e&&e.disconnect(),t==="resize"&&Nm(n)}function Fm(n,t,e){const s=n.canvas,i=Pc(r=>{n.ctx!==null&&e(Lm(r,n))},n);return Mm(s,t,i),i}class Um extends nd{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(Im(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[Ci])return!1;const s=e[Ci].initial;["height","width"].forEach(r=>{const o=s[r];ot(o)?e.removeAttribute(r):e.setAttribute(r,o)});const i=s.style||{};return Object.keys(i).forEach(r=>{e.style[r]=i[r]}),e.width=e.width,delete e[Ci],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),o={attach:Dm,detach:$m,resize:jm}[e]||Fm;i[e]=o(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),i=s[e];if(!i)return;({attach:Sr,detach:Sr,resize:Sr}[e]||Pm)(t,e,i),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,i){return Ip(t,e,s,i)}isAttached(t){const e=t&&Oo(t);return!!(e&&e.isConnected)}}function zm(n){return!Co()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Om:Um}class we{constructor(){F(this,"x");F(this,"y");F(this,"active",!1);F(this,"options");F(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return Vn(this.x)&&Vn(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const i={};return t.forEach(r=>{i[r]=s[r]&&s[r].active()?s[r]._to:this[r]}),i}}F(we,"defaults",{}),F(we,"defaultRoutes");function Hm(n,t){const e=n.options.ticks,s=Wm(n),i=Math.min(e.maxTicksLimit||s,s),r=e.major.enabled?Gm(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>i)return qm(t,c,r,o/i),c;const d=Vm(r,t,i);if(o>0){let u,h;const f=o>1?Math.round((l-a)/(o-1)):null;for(gi(t,c,d,ot(f)?0:a-f,a),u=0,h=o-1;u<h;u++)gi(t,c,d,r[u],r[u+1]);return gi(t,c,d,l,ot(f)?t.length:l+f),c}return gi(t,c,d),c}function Wm(n){const t=n.options.offset,e=n._tickSize(),s=n._length/e+(t?0:1),i=n._maxLength/e;return Math.floor(Math.min(s,i))}function Vm(n,t,e){const s=Ym(n),i=t.length/e;if(!s)return Math.max(i,1);const r=Lg(s);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>i)return l}return Math.max(i,1)}function Gm(n){const t=[];let e,s;for(e=0,s=n.length;e<s;e++)n[e].major&&t.push(e);return t}function qm(n,t,e,s){let i=0,r=e[0],o;for(s=Math.ceil(s),o=0;o<n.length;o++)o===r&&(t.push(n[o]),i++,r=e[i*s])}function gi(n,t,e,s,i){const r=Z(s,0),o=Math.min(Z(i,n.length),n.length);let a=0,l,c,d;for(e=Math.ceil(e),i&&(l=i-s,e=l/Math.floor(l/e)),d=r;d<0;)a++,d=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===d&&(t.push(n[c]),a++,d=Math.round(r+a*e))}function Ym(n){const t=n.length;let e,s;if(t<2)return!1;for(s=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==s)return!1;return s}const Km=n=>n==="left"?"right":n==="right"?"left":n,hl=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,fl=(n,t)=>Math.min(t||n,n);function gl(n,t){const e=[],s=n.length/t,i=n.length;let r=0;for(;r<i;r+=s)e.push(n[Math.floor(r)]);return e}function Jm(n,t,e){const s=n.ticks.length,i=Math.min(t,s-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(i),c;if(!(e&&(s===1?c=Math.max(l-r,o-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(i-1))/2,l+=i<t?c:-c,l<r-a||l>o+a)))return l}function Xm(n,t){mt(n,e=>{const s=e.gc,i=s.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[s[r]];s.splice(0,i)}})}function ss(n){return n.drawTicks?n.tickLength:0}function pl(n,t){if(!n.display)return 0;const e=jt(n.font,t),s=Kt(n.padding);return(Tt(n.text)?n.text.length:1)*e.lineHeight+s.height}function Qm(n,t){return tn(n,{scale:t,type:"scale"})}function Zm(n,t,e){return tn(n,{tick:e,index:t,type:"tick"})}function ty(n,t,e){let s=xo(n);return(e&&t!=="right"||!e&&t==="right")&&(s=Km(s)),s}function ey(n,t,e,s){const{top:i,left:r,bottom:o,right:a,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=o-i,m=a-r;if(n.isHorizontal()){if(f=Gt(s,r,a),lt(e)){const b=Object.keys(e)[0],v=e[b];g=d[b].getPixelForValue(v)+p-t}else e==="center"?g=(c.bottom+c.top)/2+p-t:g=hl(n,e,t);h=a-r}else{if(lt(e)){const b=Object.keys(e)[0],v=e[b];f=d[b].getPixelForValue(v)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=hl(n,e,t);g=Gt(s,o,i),u=e==="left"?-Mt:Mt}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class Sn extends we{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:i}=this;return t=le(t,Number.POSITIVE_INFINITY),e=le(e,Number.NEGATIVE_INFINITY),s=le(s,Number.POSITIVE_INFINITY),i=le(i,Number.NEGATIVE_INFINITY),{min:le(t,s),max:le(e,i),minDefined:Ot(t),maxDefined:Ot(e)}}getMinMax(t){let{min:e,max:s,minDefined:i,maxDefined:r}=this.getUserBounds(),o;if(i&&r)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),i||(e=Math.min(e,o.min)),r||(s=Math.max(s,o.max));return e=r&&e>s?s:e,s=i&&e>s?e:s,{min:le(e,le(s,e)),max:le(s,le(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){bt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:i,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=cp(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?gl(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=Hm(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){bt(this.options.afterUpdate,[this])}beforeSetDimensions(){bt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){bt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),bt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){bt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,i,r;for(s=0,i=t.length;s<i;s++)r=t[s],r.label=bt(e.callback,[r.value,s,t],this)}afterTickToLabelConversion(){bt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){bt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=fl(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let o=i,a,l,c;if(!this._isVisible()||!e.display||i>=r||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=Ft(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/s:f/(s-1),u+6>a&&(a=f/(s-(t.offset?.5:1)),l=this.maxHeight-ss(t.grid)-e.padding-pl(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),o=vo(Math.min(Math.asin(Ft((d.highest.height+6)/a,-1,1)),Math.asin(Ft(l/c,-1,1))-Math.asin(Ft(h/c,-1,1)))),o=Math.max(i,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){bt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){bt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:i,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=pl(i,e.options.font);if(a?(t.width=this.maxWidth,t.height=ss(r)+l):(t.height=this.maxHeight,t.width=ss(r)+l),s.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=s.padding*2,g=_e(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=s.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=s.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,i){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=i*t.width,f=s*e.height):(h=s*t.height,f=i*e.width):r==="start"?f=e.width:r==="end"?h=t.width:r!=="inner"&&(h=t.width/2,f=e.width/2),this.paddingLeft=Math.max((h-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;r==="start"?(d=0,u=t.height):r==="end"&&(d=e.height,u=0),this.paddingTop=d+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){bt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)ot(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=gl(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:i,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/fl(e,s));let c=0,d=0,u,h,f,g,p,m,b,v,w,k,A;for(u=0;u<e;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),i.font=m=p.string,b=r[m]=r[m]||{data:{},gc:[]},v=p.lineHeight,w=k=0,!ot(g)&&!Tt(g))w=ji(i,b.data,b.gc,w,g),k=v;else if(Tt(g))for(h=0,f=g.length;h<f;++h)A=g[h],!ot(A)&&!Tt(A)&&(w=ji(i,b.data,b.gc,w,A),k+=v);o.push(w),a.push(k),c=Math.max(w,c),d=Math.max(k,d)}Xm(r,e);const C=o.indexOf(c),E=a.indexOf(d),y=_=>({width:o[_]||0,height:a[_]||0});return{first:y(0),last:y(e-1),widest:y(C),highest:y(E),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Ng(this._alignToPixels?ln(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=Zm(this.getContext(),t,s))}return this.$context||(this.$context=Qm(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=_e(this.labelRotation),s=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*s>a*i?a/s:l/i:l*i<a*s?l/s:a/i}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,i=this.options,{grid:r,position:o,border:a}=i,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=ss(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(R){return ln(s,R,p)};let v,w,k,A,C,E,y,_,S,T,P,B;if(o==="top")v=b(this.bottom),E=this.bottom-h,_=v-m,T=b(t.top)+m,B=t.bottom;else if(o==="bottom")v=b(this.top),T=t.top,B=b(t.bottom)-m,E=v+m,_=this.top+h;else if(o==="left")v=b(this.right),C=this.right-h,y=v-m,S=b(t.left)+m,P=t.right;else if(o==="right")v=b(this.left),S=t.left,P=b(t.right)-m,C=v+m,y=this.left+h;else if(e==="x"){if(o==="center")v=b((t.top+t.bottom)/2+.5);else if(lt(o)){const R=Object.keys(o)[0],I=o[R];v=b(this.chart.scales[R].getPixelForValue(I))}T=t.top,B=t.bottom,E=v+m,_=E+h}else if(e==="y"){if(o==="center")v=b((t.left+t.right)/2);else if(lt(o)){const R=Object.keys(o)[0],I=o[R];v=b(this.chart.scales[R].getPixelForValue(I))}C=v-m,y=C-h,S=t.left,P=t.right}const N=Z(i.ticks.maxTicksLimit,u),O=Math.max(1,Math.ceil(u/N));for(w=0;w<u;w+=O){const R=this.getContext(w),I=r.setContext(R),L=a.setContext(R),M=I.lineWidth,z=I.color,D=L.dash||[],H=L.dashOffset,$=I.tickWidth,Q=I.tickColor,W=I.tickBorderDash||[],st=I.tickBorderDashOffset;k=Jm(this,w,l),k!==void 0&&(A=ln(s,k,M),c?C=y=S=P=A:E=_=T=B=A,f.push({tx1:C,ty1:E,tx2:y,ty2:_,x1:S,y1:T,x2:P,y2:B,width:M,color:z,borderDash:D,borderDashOffset:H,tickWidth:$,tickColor:Q,tickBorderDash:W,tickBorderDashOffset:st}))}return this._ticksLength=u,this._borderValue=v,f}_computeLabelItems(t){const e=this.axis,s=this.options,{position:i,ticks:r}=s,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=r,h=ss(s.grid),f=h+d,g=u?-d:f,p=-_e(this.labelRotation),m=[];let b,v,w,k,A,C,E,y,_,S,T,P,B="middle";if(i==="top")C=this.bottom-g,E=this._getXAxisLabelAlignment();else if(i==="bottom")C=this.top+g,E=this._getXAxisLabelAlignment();else if(i==="left"){const O=this._getYAxisLabelAlignment(h);E=O.textAlign,A=O.x}else if(i==="right"){const O=this._getYAxisLabelAlignment(h);E=O.textAlign,A=O.x}else if(e==="x"){if(i==="center")C=(t.top+t.bottom)/2+f;else if(lt(i)){const O=Object.keys(i)[0],R=i[O];C=this.chart.scales[O].getPixelForValue(R)+f}E=this._getXAxisLabelAlignment()}else if(e==="y"){if(i==="center")A=(t.left+t.right)/2-f;else if(lt(i)){const O=Object.keys(i)[0],R=i[O];A=this.chart.scales[O].getPixelForValue(R)}E=this._getYAxisLabelAlignment(h).textAlign}e==="y"&&(l==="start"?B="top":l==="end"&&(B="bottom"));const N=this._getLabelSizes();for(b=0,v=a.length;b<v;++b){w=a[b],k=w.label;const O=r.setContext(this.getContext(b));y=this.getPixelForTick(b)+r.labelOffset,_=this._resolveTickFontOptions(b),S=_.lineHeight,T=Tt(k)?k.length:1;const R=T/2,I=O.color,L=O.textStrokeColor,M=O.textStrokeWidth;let z=E;o?(A=y,E==="inner"&&(b===v-1?z=this.options.reverse?"left":"right":b===0?z=this.options.reverse?"right":"left":z="center"),i==="top"?c==="near"||p!==0?P=-T*S+S/2:c==="center"?P=-N.highest.height/2-R*S+S:P=-N.highest.height+S/2:c==="near"||p!==0?P=S/2:c==="center"?P=N.highest.height/2-R*S:P=N.highest.height-T*S,u&&(P*=-1),p!==0&&!O.showLabelBackdrop&&(A+=S/2*Math.sin(p))):(C=y,P=(1-T)*S/2);let D;if(O.showLabelBackdrop){const H=Kt(O.backdropPadding),$=N.heights[b],Q=N.widths[b];let W=P-H.top,st=0-H.left;switch(B){case"middle":W-=$/2;break;case"bottom":W-=$;break}switch(E){case"center":st-=Q/2;break;case"right":st-=Q;break;case"inner":b===v-1?st-=Q:b>0&&(st-=Q/2);break}D={left:st,top:W,width:Q+H.width,height:$+H.height,color:O.backdropColor}}m.push({label:k,font:_,textOffset:P,options:{rotation:p,color:I,strokeColor:L,strokeWidth:M,textAlign:z,textBaseline:B,translation:[A,C],backdrop:D}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-_e(this.labelRotation))return t==="top"?"left":"right";let i="center";return e.align==="start"?i="left":e.align==="end"?i="right":e.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:i,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,d;return e==="left"?i?(d=this.right+r,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?i?(d=this.left+r,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:i,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,i,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex(r=>r.value===t);return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,d)=>{!d.width||!d.color||(s.save(),s.lineWidth=d.width,s.strokeStyle=d.color,s.setLineDash(d.borderDash||[]),s.lineDashOffset=d.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(e.display)for(r=0,o=i.length;r<o;++r){const l=i[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:i}}=this,r=s.setContext(this.getContext()),o=s.display?r.width:0;if(!o)return;const a=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=ln(t,this.left,o)-o/2,d=ln(t,this.right,a)+a/2,u=h=l):(u=ln(t,this.top,o)-o/2,h=ln(t,this.bottom,a)+a/2,c=d=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&Ki(s,i);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,d=o.textOffset;kn(s,c,0,d,l,a)}i&&Ji(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:i}}=this;if(!s.display)return;const r=jt(s.font),o=Kt(s.padding),a=s.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||lt(e)?(l+=o.bottom,Tt(s.text)&&(l+=r.lineHeight*(s.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=ey(this,l,e,a);kn(t,s.text,0,0,r,{color:s.color,maxWidth:u,rotation:h,textAlign:ty(a,e,i),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=Z(t.grid&&t.grid.z,-1),i=Z(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Sn.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:s,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[s]===this.id&&(!t||a.type===t)&&i.push(a)}return i}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return jt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class pi{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;iy(e)&&(s=this.register(e));const i=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,ny(t,o,s),this.override&&At.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,i=this.scope;s in e&&delete e[s],i&&s in At[i]&&(delete At[i][s],this.override&&delete xn[s])}}function ny(n,t,e){const s=$s(Object.create(null),[e?At.get(e):{},At.get(t),n.defaults]);At.set(t,s),n.defaultRoutes&&sy(t,n.defaultRoutes),n.descriptors&&At.describe(t,n.descriptors)}function sy(n,t){Object.keys(t).forEach(e=>{const s=e.split("."),i=s.pop(),r=[n].concat(s).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");At.route(r,i,l,a)})}function iy(n){return"id"in n&&"defaults"in n}class ry{constructor(){this.controllers=new pi(ve,"datasets",!0),this.elements=new pi(we,"elements"),this.plugins=new pi(Object,"plugins"),this.scales=new pi(Sn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(i=>{const r=s||this._getRegistryForType(i);s||r.isForType(i)||r===this.plugins&&i.id?this._exec(t,r,i):mt(i,o=>{const a=s||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,s){const i=_o(t);bt(s["before"+i],[],s),e[t](s),bt(s["after"+i],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const i=e.get(t);if(i===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return i}}var Ae=new ry;class oy{constructor(){this._init=void 0}notify(t,e,s,i){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=i?this._descriptors(t).filter(i):this._descriptors(t),o=this._notify(r,t,e,s);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,s,i){i=i||{};for(const r of t){const o=r.plugin,a=o[s],l=[e,i,r.options];if(bt(a,l,o)===!1&&i.cancelable)return!1}return!0}invalidate(){ot(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,i=Z(s.options&&s.options.plugins,{}),r=ay(s);return i===!1&&!e?[]:cy(t,r,i,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,i=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(i(e,s),t,"stop"),this._notify(i(s,e),t,"start")}}function ay(n){const t={},e=[],s=Object.keys(Ae.plugins.items);for(let r=0;r<s.length;r++)e.push(Ae.getPlugin(s[r]));const i=n.plugins||[];for(let r=0;r<i.length;r++){const o=i[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function ly(n,t){return!t&&n===!1?null:n===!0?{}:n}function cy(n,{plugins:t,localIds:e},s,i){const r=[],o=n.getContext();for(const a of t){const l=a.id,c=ly(s[l],i);c!==null&&r.push({plugin:a,options:dy(n.config,{plugin:a,local:e[l]},c,o)})}return r}function dy(n,{plugin:t,local:e},s,i){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(s,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Xr(n,t){const e=At.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function uy(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function hy(n,t){return n===t?"_index_":"_value_"}function ml(n){if(n==="x"||n==="y"||n==="r")return n}function fy(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Qr(n,...t){if(ml(n))return n;for(const e of t){const s=e.axis||fy(e.position)||n.length>1&&ml(n[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function yl(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function gy(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===n||s.yAxisID===n);if(e.length)return yl(n,"x",e[0])||yl(n,"y",e[0])}return{}}function py(n,t){const e=xn[n.type]||{scales:{}},s=t.scales||{},i=Xr(n.type,t),r=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!lt(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Qr(o,a,gy(o,n),At.scales[a.type]),c=hy(l,i),d=e.scales||{};r[o]=xs(Object.create(null),[{axis:l},a,d[l],d[c]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||Xr(a,t),d=(xn[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=uy(u,l),f=o[h+"AxisID"]||h;r[f]=r[f]||Object.create(null),xs(r[f],[{axis:h},s[f],d[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];xs(a,[At.scales[a.type],At.scale])}),r}function rd(n){const t=n.options||(n.options={});t.plugins=Z(t.plugins,{}),t.scales=py(n,t)}function od(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function my(n){return n=n||{},n.data=od(n.data),rd(n),n}const bl=new Map,ad=new Set;function mi(n,t){let e=bl.get(n);return e||(e=t(),bl.set(n,e),ad.add(e)),e}const is=(n,t,e)=>{const s=Qe(t,e);s!==void 0&&n.add(s)};class yy{constructor(t){this._config=my(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=od(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),rd(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return mi(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return mi(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return mi(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return mi(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let i=s.get(t);return(!i||e)&&(i=new Map,s.set(t,i)),i}getOptionScopes(t,e,s){const{options:i,type:r}=this,o=this._cachedScopes(t,s),a=o.get(e);if(a)return a;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>is(l,t,u))),d.forEach(u=>is(l,i,u)),d.forEach(u=>is(l,xn[r]||{},u)),d.forEach(u=>is(l,At,u)),d.forEach(u=>is(l,Yr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),ad.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,xn[e]||{},At.datasets[e]||{},{type:e},At,Yr]}resolveNamedOptions(t,e,s,i=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=_l(this._resolverCache,t,i);let l=o;if(_y(o,e)){r.$shared=!1,s=Ze(s)?s():s;const c=this.createResolver(t,s,a);l=Gn(o,s,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,s=[""],i){const{resolver:r}=_l(this._resolverCache,t,s);return lt(e)?Gn(r,e,void 0,i):r}}function _l(n,t,e){let s=n.get(t);s||(s=new Map,n.set(t,s));const i=e.join();let r=s.get(i);return r||(r={resolver:Eo(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},s.set(i,r)),r}const by=n=>lt(n)&&Object.getOwnPropertyNames(n).some(t=>Ze(n[t]));function _y(n,t){const{isScriptable:e,isIndexable:s}=jc(n);for(const i of t){const r=e(i),o=s(i),a=(o||r)&&n[i];if(r&&(Ze(a)||by(a))||o&&Tt(a))return!0}return!1}var vy="4.5.1";const wy=["top","bottom","left","right","chartArea"];function vl(n,t){return n==="top"||n==="bottom"||wy.indexOf(n)===-1&&t==="x"}function wl(n,t){return function(e,s){return e[n]===s[n]?e[t]-s[t]:e[n]-s[n]}}function xl(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),bt(e&&e.onComplete,[n],t)}function xy(n){const t=n.chart,e=t.options.animation;bt(e&&e.onProgress,[n],t)}function ld(n){return Co()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Oi={},kl=n=>{const t=ld(n);return Object.values(Oi).filter(e=>e.canvas===t).pop()};function ky(n,t,e){const s=Object.keys(n);for(const i of s){const r=+i;if(r>=t){const o=n[i];delete n[i],(e>0||r>t)&&(n[r+e]=o)}}}function Sy(n,t,e,s){return!e||n.type==="mouseout"?null:s?t:n}class ce{static register(...t){Ae.add(...t),Sl()}static unregister(...t){Ae.remove(...t),Sl()}constructor(t,e){const s=this.config=new yy(e),i=ld(t),r=kl(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||zm(i)),this.platform.updateConfig(s);const a=this.platform.acquireContext(i,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Eg(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new oy,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=zg(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],Oi[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Le.listen(this,"complete",xl),Le.listen(this,"progress",xy),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:i,_aspectRatio:r}=this;return ot(t)?e&&r?r:i?s/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Ae}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ga(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ha(this.canvas,this.ctx),this}stop(){return Le.stop(this),this}resize(t,e){Le.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,i=this.canvas,r=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,t,e,r),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Ga(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),bt(s.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};mt(e,(s,i)=>{s.id=i})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,i=Object.keys(s).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Qr(o,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),mt(r,o=>{const a=o.options,l=a.id,c=Qr(l,a),d=Z(a.type,o.dtype);(a.position===void 0||vl(a.position,c)!==vl(o.dposition))&&(a.position=o.dposition),i[l]=!0;let u=null;if(l in s&&s[l].type===d)u=s[l];else{const h=Ae.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),s[u.id]=u}u.init(a,t)}),mt(i,(o,a)=>{o||delete s[a]}),mt(s,o=>{Yt.configure(this,o,o.options),Yt.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((i,r)=>i.index-r.index),s>e){for(let i=e;i<s;++i)this._destroyDatasetMeta(i);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(wl("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,i)=>{e.filter(r=>r===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=e.length;s<i;s++){const r=e[s];let o=this.getDatasetMeta(s);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=a,o.indexAxis=r.indexAxis||Xr(a,this.options),o.order=r.order||0,o.index=s,o.label=""+r.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const l=Ae.getController(a),{datasetElementType:c,dataElementType:d}=At.datasets[a];Object.assign(l,{dataElementType:Ae.getElement(d),datasetElementType:c&&Ae.getElement(c)}),o.controller=new l(this,s),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){mt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!i&&r.indexOf(u)===-1;u.buildOrUpdateElements(h),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),i||mt(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(wl("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){mt(this.scales,t=>{Yt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!La(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:r}of e){const o=s==="_removeElements"?-r:r;ky(t,i,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),i=s(0);for(let r=1;r<e;r++)if(!La(i,s(r)))return;return Array.from(i).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Yt.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],mt(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,r)=>{i._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,Ze(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),i={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Le.has(this)?this.attached&&!Le.running(this)&&Le.start(this):(this.draw(),xl({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let i,r;for(i=0,r=e.length;i<r;++i){const o=e[i];(!t||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s={meta:t,index:t.index,cancelable:!0},i=Jc(this,t);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&Ki(e,i),t.controller.draw(),i&&Ji(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return Fe(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,i){const r=wm.modes[e];return typeof r=="function"?r(this,t,s,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let i=s.filter(r=>r&&r._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=tn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const i=s?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,i);Bs(e)?(r.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),o.update(r,{visible:s}),this.update(a=>a.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Le.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Ha(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Oi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},i=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};mt(this.options.events,r=>s(r,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},i=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{i("attach",a),this.attached=!0,this.resize(),s("resize",r),s("detach",o)};o=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),s("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){mt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},mt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const i=s?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!$i(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const i=this.options.hover,r=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),o=r(e,t),a=s?t:r(t,e);o.length&&this.updateHoverStyle(o,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const r=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(r||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:i=[],options:r}=this,o=e,a=this._getActiveElements(t,i,s,o),l=Ig(t),c=Sy(t,this._lastEvent,s,l);s&&(this._lastEvent=null,bt(r.onHover,[t,a,this],this),l&&bt(r.onClick,[t,a,this],this));const d=!$i(a,i);return(d||e)&&(this._active=a,this._updateHoverStyles(a,i,e)),this._lastEvent=c,d}_getActiveElements(t,e,s,i){if(t.type==="mouseout")return[];if(!s)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}F(ce,"defaults",At),F(ce,"instances",Oi),F(ce,"overrides",xn),F(ce,"registry",Ae),F(ce,"version",vy),F(ce,"getChart",kl);function Sl(){return mt(ce.instances,n=>n._plugins.invalidate())}function Ey(n,t,e){const{startAngle:s,x:i,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/o,qt(s-e));if(n.beginPath(),n.arc(i,r,o-c/2,s+u/2,e-u/2),a>0){const h=Math.min(c/a,qt(s-e));n.arc(i,r,a+c/2,e-h/2,s+h/2,!0)}else{const h=Math.min(c/2,o*qt(s-e));if(d==="round")n.arc(i,r,h,e-ut/2,s+ut/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(e+ut/2)+i,p=-f*Math.sin(e+ut/2)+r,m=f*Math.cos(s+ut/2)+i,b=f*Math.sin(s+ut/2)+r;n.lineTo(g,p),n.lineTo(m,b)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function Ty(n,t,e){const{startAngle:s,pixelMargin:i,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=i/a;n.beginPath(),n.arc(r,o,a,s-c,e+c),l>i?(c=i/l,n.arc(r,o,l,e+c,s-c,!0)):n.arc(r,o,i,e+Mt,s-Mt),n.closePath(),n.clip()}function Ay(n){return So(n,["outerStart","outerEnd","innerStart","innerEnd"])}function Cy(n,t,e,s){const i=Ay(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,s*t/2),a=l=>{const c=(e-Math.min(r,l))*s/2;return Ft(l,0,Math.min(r,c))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:Ft(i.innerStart,0,o),innerEnd:Ft(i.innerEnd,0,o)}}function Nn(n,t,e,s){return{x:e+n*Math.cos(t),y:s+n*Math.sin(t)}}function zi(n,t,e,s,i,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+s+e-c,0),h=d>0?d+s+e+c:0;let f=0;const g=i-l;if(s){const O=d>0?d-s:0,R=u>0?u-s:0,I=(O+R)/2,L=I!==0?g*I/(I+s):g;f=(g-L)/2}const p=Math.max(.001,g*u-e/ut)/u,m=(g-p)/2,b=l+m+f,v=i-m-f,{outerStart:w,outerEnd:k,innerStart:A,innerEnd:C}=Cy(t,h,u,v-b),E=u-w,y=u-k,_=b+w/E,S=v-k/y,T=h+A,P=h+C,B=b+A/T,N=v-C/P;if(n.beginPath(),r){const O=(_+S)/2;if(n.arc(o,a,u,_,O),n.arc(o,a,u,O,S),k>0){const M=Nn(y,S,o,a);n.arc(M.x,M.y,k,S,v+Mt)}const R=Nn(P,v,o,a);if(n.lineTo(R.x,R.y),C>0){const M=Nn(P,N,o,a);n.arc(M.x,M.y,C,v+Mt,N+Math.PI)}const I=(v-C/h+(b+A/h))/2;if(n.arc(o,a,h,v-C/h,I,!0),n.arc(o,a,h,I,b+A/h,!0),A>0){const M=Nn(T,B,o,a);n.arc(M.x,M.y,A,B+Math.PI,b-Mt)}const L=Nn(E,b,o,a);if(n.lineTo(L.x,L.y),w>0){const M=Nn(E,_,o,a);n.arc(M.x,M.y,w,b-Mt,_)}}else{n.moveTo(o,a);const O=Math.cos(_)*u+o,R=Math.sin(_)*u+a;n.lineTo(O,R);const I=Math.cos(S)*u+o,L=Math.sin(S)*u+a;n.lineTo(I,L)}n.closePath()}function Oy(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){zi(n,t,e,s,l,i);for(let c=0;c<r;++c)n.fill();isNaN(a)||(l=o+(a%wt||wt))}return zi(n,t,e,s,l,i),n.fill(),l}function Ry(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=h,g?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let p=t.endAngle;if(r){zi(n,t,e,s,p,i);for(let m=0;m<r;++m)n.stroke();isNaN(a)||(p=o+(a%wt||wt))}g&&Ty(n,t,p),l.selfJoin&&p-o>=ut&&f===0&&d!=="miter"&&Ey(n,t,p),r||(zi(n,t,e,s,p,i),n.stroke())}class ps extends we{constructor(e){super();F(this,"circumference");F(this,"endAngle");F(this,"fullCircles");F(this,"innerRadius");F(this,"outerRadius");F(this,"pixelMargin");F(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.getProps(["x","y"],i),{angle:o,distance:a}=Oc(r,{x:e,y:s}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),f=(this.options.spacing+this.options.borderWidth)/2,g=Z(h,c-l),p=Ns(o,l,c)&&l!==c,m=g>=wt||p,b=Ne(a,d+f,u+f);return m&&b}getCenterPoint(e){const{x:s,y:i,startAngle:r,endAngle:o,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(r+o)/2,h=(a+l+d+c)/2;return{x:s+Math.cos(u)*h,y:i+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:i}=this,r=(s.offset||0)/4,o=(s.spacing||0)/2,a=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=i>wt?Math.floor(i/wt):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*r,Math.sin(l)*r);const c=1-Math.sin(Math.min(ut,i||0)),d=r*c;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,Oy(e,this,d,o,a),Ry(e,this,d,o,a),e.restore()}}F(ps,"id","arc"),F(ps,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),F(ps,"defaultRoutes",{backgroundColor:"backgroundColor"}),F(ps,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function cd(n,t,e=t){n.lineCap=Z(e.borderCapStyle,t.borderCapStyle),n.setLineDash(Z(e.borderDash,t.borderDash)),n.lineDashOffset=Z(e.borderDashOffset,t.borderDashOffset),n.lineJoin=Z(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=Z(e.borderWidth,t.borderWidth),n.strokeStyle=Z(e.borderColor,t.borderColor)}function Iy(n,t,e){n.lineTo(e.x,e.y)}function My(n){return n.stepped?tp:n.tension||n.cubicInterpolationMode==="monotone"?ep:Iy}function dd(n,t,e={}){const s=n.length,{start:i=0,end:r=s-1}=e,{start:o,end:a}=t,l=Math.max(i,o),c=Math.min(r,a),d=i<o&&r<o||i>a&&r>a;return{count:s,start:l,loop:t.loop,ilen:c<l&&!d?s+c-l:c-l}}function Py(n,t,e,s){const{points:i,options:r}=t,{count:o,start:a,loop:l,ilen:c}=dd(i,e,s),d=My(r);let{move:u=!0,reverse:h}=s||{},f,g,p;for(f=0;f<=c;++f)g=i[(a+(h?c-f:f))%o],!g.skip&&(u?(n.moveTo(g.x,g.y),u=!1):d(n,p,g,h,r.stepped),p=g);return l&&(g=i[(a+(h?c:0))%o],d(n,p,g,h,r.stepped)),!!l}function Ly(n,t,e,s){const i=t.points,{count:r,start:o,ilen:a}=dd(i,e,s),{move:l=!0,reverse:c}=s||{};let d=0,u=0,h,f,g,p,m,b;const v=k=>(o+(c?a-k:k))%r,w=()=>{p!==m&&(n.lineTo(d,m),n.lineTo(d,p),n.lineTo(d,b))};for(l&&(f=i[v(0)],n.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=i[v(h)],f.skip)continue;const k=f.x,A=f.y,C=k|0;C===g?(A<p?p=A:A>m&&(m=A),d=(u*d+k)/++u):(w(),n.lineTo(k,A),g=C,u=0,p=m=A),b=A}w()}function Zr(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Ly:Py}function Dy(n){return n.stepped?Pp:n.tension||n.cubicInterpolationMode==="monotone"?Lp:fn}function $y(n,t,e,s){let i=t._path;i||(i=t._path=new Path2D,t.path(i,e,s)&&i.closePath()),cd(n,t.options),n.stroke(i)}function By(n,t,e,s){const{segments:i,options:r}=t,o=Zr(t);for(const a of i)cd(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+s-1})&&n.closePath(),n.stroke()}const Ny=typeof Path2D=="function";function jy(n,t,e,s){Ny&&!t.options.segment?$y(n,t,e,s):By(n,t,e,s)}class Ye extends we{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;Ep(this._points,s,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Fp(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,i=t[e],r=this.points,o=Kc(this,{property:e,start:i,end:i});if(!o.length)return;const a=[],l=Dy(s);let c,d;for(c=0,d=o.length;c<d;++c){const{start:u,end:h}=o[c],f=r[u],g=r[h];if(f===g){a.push(f);continue}const p=Math.abs((i-f[e])/(g[e]-f[e])),m=l(f,g,p,s.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,s){return Zr(this)(t,this,e,s)}path(t,e,s){const i=this.segments,r=Zr(this);let o=this._loop;e=e||0,s=s||this.points.length-e;for(const a of i)o&=r(t,this,a,{start:e,end:e+s-1});return!!o}draw(t,e,s,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),jy(t,this,s,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}F(Ye,"id","line"),F(Ye,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),F(Ye,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),F(Ye,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function El(n,t,e,s){const i=n.options,{[e]:r}=n.getProps([e],s);return Math.abs(t-r)<i.radius+i.hitRadius}class Ri extends we{constructor(e){super();F(this,"parsed");F(this,"skip");F(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],i);return Math.pow(e-o,2)+Math.pow(s-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,s){return El(this,e,"x",s)}inYRange(e,s){return El(this,e,"y",s)}getCenterPoint(e){const{x:s,y:i}=this.getProps(["x","y"],e);return{x:s,y:i}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const i=s&&e.borderWidth||0;return(s+i)*2}draw(e,s){const i=this.options;this.skip||i.radius<.1||!Fe(this,s,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Kr(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}F(Ri,"id","point"),F(Ri,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),F(Ri,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function ud(n,t){const{x:e,y:s,base:i,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return n.horizontal?(u=o/2,a=Math.min(e,i),l=Math.max(e,i),c=s-u,d=s+u):(u=r/2,a=e-u,l=e+u,c=Math.min(s,i),d=Math.max(s,i)),{left:a,top:c,right:l,bottom:d}}function Ke(n,t,e,s){return n?0:Ft(t,e,s)}function Fy(n,t,e){const s=n.options.borderWidth,i=n.borderSkipped,r=Nc(s);return{t:Ke(i.top,r.top,0,e),r:Ke(i.right,r.right,0,t),b:Ke(i.bottom,r.bottom,0,e),l:Ke(i.left,r.left,0,t)}}function Uy(n,t,e){const{enableBorderRadius:s}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,r=_n(i),o=Math.min(t,e),a=n.borderSkipped,l=s||lt(i);return{topLeft:Ke(!l||a.top||a.left,r.topLeft,0,o),topRight:Ke(!l||a.top||a.right,r.topRight,0,o),bottomLeft:Ke(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Ke(!l||a.bottom||a.right,r.bottomRight,0,o)}}function zy(n){const t=ud(n),e=t.right-t.left,s=t.bottom-t.top,i=Fy(n,e/2,s/2),r=Uy(n,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:r},inner:{x:t.left+i.l,y:t.top+i.t,w:e-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,r.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(i.b,i.r))}}}}function Er(n,t,e,s){const i=t===null,r=e===null,a=n&&!(i&&r)&&ud(n,s);return a&&(i||Ne(t,a.left,a.right))&&(r||Ne(e,a.top,a.bottom))}function Hy(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function Wy(n,t){n.rect(t.x,t.y,t.w,t.h)}function Tr(n,t,e={}){const s=n.x!==e.x?-t:0,i=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-s,o=(n.y+n.h!==e.y+e.h?t:0)-i;return{x:n.x+s,y:n.y+i,w:n.w+r,h:n.h+o,radius:n.radius}}class Ii extends we{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:i}}=this,{inner:r,outer:o}=zy(this),a=Hy(o.radius)?js:Wy;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Tr(o,e,r)),t.clip(),a(t,Tr(r,-e,o)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,Tr(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,s){return Er(this,t,e,s)}inXRange(t,e){return Er(this,t,null,e)}inYRange(t,e){return Er(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?s:(s+i)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}F(Ii,"id","bar"),F(Ii,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),F(Ii,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Vy=Object.freeze({__proto__:null,ArcElement:ps,BarElement:Ii,LineElement:Ye,PointElement:Ri});const to=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Tl=to.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function hd(n){return to[n%to.length]}function fd(n){return Tl[n%Tl.length]}function Gy(n,t){return n.borderColor=hd(t),n.backgroundColor=fd(t),++t}function qy(n,t){return n.backgroundColor=n.data.map(()=>hd(t++)),t}function Yy(n,t){return n.backgroundColor=n.data.map(()=>fd(t++)),t}function Ky(n){let t=0;return(e,s)=>{const i=n.getDatasetMeta(s).controller;i instanceof yn?t=qy(e,t):i instanceof Ts?t=Yy(e,t):i&&(t=Gy(e,t))}}function Al(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function Jy(n){return n&&(n.borderColor||n.backgroundColor)}function Xy(){return At.borderColor!=="rgba(0,0,0,0.1)"||At.backgroundColor!=="rgba(0,0,0,0.1)"}var Qy={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:s},options:i}=n.config,{elements:r}=i,o=Al(s)||Jy(i)||r&&Al(r)||Xy();if(!e.forceOverride&&o)return;const a=Ky(n);s.forEach(a)}};function Zy(n,t,e,s,i){const r=i.samples||s;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let d=t,u,h,f,g,p;for(o[l++]=n[d],u=0;u<r-2;u++){let m=0,b=0,v;const w=Math.floor((u+1)*a)+1+t,k=Math.min(Math.floor((u+2)*a)+1,e)+t,A=k-w;for(v=w;v<k;v++)m+=n[v].x,b+=n[v].y;m/=A,b/=A;const C=Math.floor(u*a)+1+t,E=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:y,y:_}=n[d];for(f=g=-1,v=C;v<E;v++)g=.5*Math.abs((y-m)*(n[v].y-_)-(y-n[v].x)*(b-_)),g>f&&(f=g,h=n[v],p=v);o[l++]=h,d=p}return o[l++]=n[c],o}function tb(n,t,e,s){let i=0,r=0,o,a,l,c,d,u,h,f,g,p;const m=[],b=t+e-1,v=n[t].x,k=n[b].x-v;for(o=t;o<t+e;++o){a=n[o],l=(a.x-v)/k*s,c=a.y;const A=l|0;if(A===d)c<g?(g=c,u=o):c>p&&(p=c,h=o),i=(r*i+a.x)/++r;else{const C=o-1;if(!ot(u)&&!ot(h)){const E=Math.min(u,h),y=Math.max(u,h);E!==f&&E!==C&&m.push({...n[E],x:i}),y!==f&&y!==C&&m.push({...n[y],x:i})}o>0&&C!==f&&m.push(n[C]),m.push(a),d=A,r=0,g=p=c,u=h=f=o}}return m}function gd(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Cl(n){n.data.datasets.forEach(t=>{gd(t)})}function eb(n,t){const e=t.length;let s=0,i;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(s=Ft(je(t,r.axis,o).lo,0,e-1)),c?i=Ft(je(t,r.axis,a).hi+1,s,e)-s:i=e-s,{start:s,count:i}}var nb={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){Cl(n);return}const s=n.width;n.data.datasets.forEach((i,r)=>{const{_data:o,indexAxis:a}=i,l=n.getDatasetMeta(r),c=o||i.data;if(fs([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:h}=eb(l,c);const f=e.threshold||4*s;if(h<=f){gd(i);return}ot(o)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=Zy(c,u,h,s,e);break;case"min-max":g=tb(c,u,h,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}i._decimated=g})},destroy(n){Cl(n)}};function sb(n,t,e){const s=n.segments,i=n.points,r=t.points,o=[];for(const a of s){let{start:l,end:c}=a;c=Zi(l,c,i);const d=eo(e,i[l],i[c],a.loop);if(!t.segments){o.push({source:a,target:d,start:i[l],end:i[c]});continue}const u=Kc(t,d);for(const h of u){const f=eo(e,r[h.start],r[h.end],h.loop),g=Yc(a,i,f);for(const p of g)o.push({source:p,target:h,start:{[e]:Ol(d,f,"start",Math.max)},end:{[e]:Ol(d,f,"end",Math.min)}})}}return o}function eo(n,t,e,s){if(s)return;let i=t[n],r=e[n];return n==="angle"&&(i=qt(i),r=qt(r)),{property:n,start:i,end:r}}function ib(n,t){const{x:e=null,y:s=null}=n||{},i=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Zi(o,a,i);const l=i[o],c=i[a];s!==null?(r.push({x:l.x,y:s}),r.push({x:c.x,y:s})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Zi(n,t,e){for(;t>n;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function Ol(n,t,e,s){return n&&t?s(n[e],t[e]):n?n[e]:t?t[e]:0}function pd(n,t){let e=[],s=!1;return Tt(n)?(s=!0,e=n):e=ib(n,t),e.length?new Ye({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function Rl(n){return n&&n.fill!==!1}function rb(n,t,e){let i=n[t].fill;const r=[t];let o;if(!e)return i;for(;i!==!1&&r.indexOf(i)===-1;){if(!Ot(i))return i;if(o=n[i],!o)return!1;if(o.visible)return i;r.push(i),i=o.fill}return!1}function ob(n,t,e){const s=db(n);if(lt(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return Ot(i)&&Math.floor(i)===i?ab(s[0],t,i,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function ab(n,t,e,s){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function lb(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:lt(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function cb(n,t,e){let s;return n==="start"?s=e:n==="end"?s=t.options.reverse?t.min:t.max:lt(n)?s=n.value:s=t.getBaseValue(),s}function db(n){const t=n.options,e=t.fill;let s=Z(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function ub(n){const{scale:t,index:e,line:s}=n,i=[],r=s.segments,o=s.points,a=hb(t,e);a.push(pd({x:null,y:t.bottom},s));for(let l=0;l<r.length;l++){const c=r[l];for(let d=c.start;d<=c.end;d++)fb(i,o[d],a)}return new Ye({points:i,options:{}})}function hb(n,t){const e=[],s=n.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const r=s[i];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function fb(n,t,e){const s=[];for(let i=0;i<e.length;i++){const r=e[i],{first:o,last:a,point:l}=gb(r,t,"x");if(!(!l||o&&a)){if(o)s.unshift(l);else if(n.push(l),!a)break}}n.push(...s)}function gb(n,t,e){const s=n.interpolate(t,e);if(!s)return{};const i=s[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const d=r[c],u=o[d.start][e],h=o[d.end][e];if(Ne(i,u,h)){a=i===u,l=i===h;break}}return{first:a,last:l,point:s}}class md{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:i,y:r,radius:o}=this;return e=e||{start:0,end:wt},t.arc(i,r,o,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:s+Math.sin(r)*i,angle:r}}}function pb(n){const{chart:t,fill:e,line:s}=n;if(Ot(e))return mb(t,e);if(e==="stack")return ub(n);if(e==="shape")return!0;const i=yb(n);return i instanceof md?i:pd(i,s)}function mb(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function yb(n){return(n.scale||{}).getPointPositionForValue?_b(n):bb(n)}function bb(n){const{scale:t={},fill:e}=n,s=lb(e,t);if(Ot(s)){const i=t.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function _b(n){const{scale:t,fill:e}=n,s=t.options,i=t.getLabels().length,r=s.reverse?t.max:t.min,o=cb(e,t,r),a=[];if(s.grid.circular){const l=t.getPointPositionForValue(0,r);return new md({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<i;++l)a.push(t.getPointPositionForValue(l,o));return a}function Ar(n,t,e){const s=pb(t),{chart:i,index:r,line:o,scale:a,axis:l}=t,c=o.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=i.getDatasetMeta(r),p=Jc(i,g);s&&o.points.length&&(Ki(n,e),vb(n,{line:o,target:s,above:h,below:f,area:e,scale:a,axis:l,clip:p}),Ji(n))}function vb(n,t){const{line:e,target:s,above:i,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=r;r!==i&&(c==="x"?(Il(n,s,o.top),Cr(n,{line:e,target:s,color:i,scale:a,property:c,clip:l}),n.restore(),n.save(),Il(n,s,o.bottom)):c==="y"&&(Ml(n,s,o.left),Cr(n,{line:e,target:s,color:r,scale:a,property:c,clip:l}),n.restore(),n.save(),Ml(n,s,o.right),d=i)),Cr(n,{line:e,target:s,color:d,scale:a,property:c,clip:l}),n.restore()}function Il(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,d=i[l],u=i[Zi(l,c,i)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function Ml(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,d=i[l],u=i[Zi(l,c,i)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function Cr(n,t){const{line:e,target:s,property:i,color:r,scale:o,clip:a}=t,l=sb(e,s,i);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=r}={}}=c,g=s!==!0;n.save(),n.fillStyle=f,wb(n,o,a,g&&eo(i,u,h)),n.beginPath();const p=!!e.pathSegment(n,c);let m;if(g){p?n.closePath():Pl(n,s,h,i);const b=!!s.pathSegment(n,d,{move:p,reverse:!0});m=p&&b,m||Pl(n,s,u,i)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function wb(n,t,e,s){const i=t.chart.chartArea,{property:r,start:o,end:a}=s||{};if(r==="x"||r==="y"){let l,c,d,u;r==="x"?(l=o,c=i.top,d=a,u=i.bottom):(l=i.left,c=o,d=i.right,u=a),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function Pl(n,t,e,s){const i=t.interpolate(e,s);i&&n.lineTo(i.x,i.y)}var xb={id:"filler",afterDatasetsUpdate(n,t,e){const s=(n.data.datasets||[]).length,i=[];let r,o,a,l;for(o=0;o<s;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof Ye&&(l={visible:n.isDatasetVisible(o),index:o,fill:ob(a,o,s),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,i.push(l);for(o=0;o<s;++o)l=i[o],!(!l||l.fill===!1)&&(l.fill=rb(i,o,e.propagate))},beforeDraw(n,t,e){const s=e.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),s&&a.fill&&Ar(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=n.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const r=s[i].$filler;Rl(r)&&Ar(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const s=t.meta.$filler;!Rl(s)||e.drawTime!=="beforeDatasetDraw"||Ar(n.ctx,s,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Ll=(n,t)=>{let{boxHeight:e=t,boxWidth:s=t}=n;return n.usePointStyle&&(e=Math.min(e,t),s=n.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},kb=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Dl extends we{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=bt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,i)=>t.sort(s,i,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,i=jt(s.font),r=i.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Ll(s,r);let c,d;e.font=i.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,r,a,l)+10):(d=this.maxHeight,c=this._fitCols(o,i,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,i){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=i+a;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=s+e/2+r.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>o)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:i},c[c.length-1]+=m+a}),u}_fitCols(t,e,s,i){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:v,itemHeight:w}=Sb(s,e,r,m,i);b>0&&f+w+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:v,height:w},h=Math.max(h,v),f+=w+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:i},rtl:r}}=this,o=Wn(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=Gt(s,this.left+i,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=Gt(s,this.left+i,this.right-this.lineWidths[a])),c.top+=this.top+t+i,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+i}else{let a=0,l=Gt(s,this.top+t+i,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=Gt(s,this.top+t+i,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+i,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Ki(t,this),this._draw(),Ji(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:i}=this,{align:r,labels:o}=t,a=At.color,l=Wn(t.rtl,this.left,this.width),c=jt(o.font),{padding:d}=o,u=c.size,h=u/2;let f;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=Ll(o,u),b=function(C,E,y){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;i.save();const _=Z(y.lineWidth,1);if(i.fillStyle=Z(y.fillStyle,a),i.lineCap=Z(y.lineCap,"butt"),i.lineDashOffset=Z(y.lineDashOffset,0),i.lineJoin=Z(y.lineJoin,"miter"),i.lineWidth=_,i.strokeStyle=Z(y.strokeStyle,a),i.setLineDash(Z(y.lineDash,[])),o.usePointStyle){const S={radius:p*Math.SQRT2/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:_},T=l.xPlus(C,g/2),P=E+h;Bc(i,S,T,P,o.pointStyleWidth&&g)}else{const S=E+Math.max((u-p)/2,0),T=l.leftForLtr(C,g),P=_n(y.borderRadius);i.beginPath(),Object.values(P).some(B=>B!==0)?js(i,{x:T,y:S,w:g,h:p,radius:P}):i.rect(T,S,g,p),i.fill(),_!==0&&i.stroke()}i.restore()},v=function(C,E,y){kn(i,y.text,C,E+m/2,c,{strikethrough:y.hidden,textAlign:l.textAlign(y.textAlign)})},w=this.isHorizontal(),k=this._computeTitleHeight();w?f={x:Gt(r,this.left+d,this.right-s[0]),y:this.top+d+k,line:0}:f={x:this.left+d,y:Gt(r,this.top+k+d,this.bottom-e[0].height),line:0},Vc(this.ctx,t.textDirection);const A=m+d;this.legendItems.forEach((C,E)=>{i.strokeStyle=C.fontColor,i.fillStyle=C.fontColor;const y=i.measureText(C.text).width,_=l.textAlign(C.textAlign||(C.textAlign=o.textAlign)),S=g+h+y;let T=f.x,P=f.y;l.setWidth(this.width),w?E>0&&T+S+d>this.right&&(P=f.y+=A,f.line++,T=f.x=Gt(r,this.left+d,this.right-s[f.line])):E>0&&P+A>this.bottom&&(T=f.x=T+e[f.line].width+d,f.line++,P=f.y=Gt(r,this.top+k+d,this.bottom-e[f.line].height));const B=l.x(T);if(b(B,P,C),T=Hg(_,T+g+h,w?T+S:this.right,t.rtl),v(l.x(T),P,C),w)f.x+=S+d;else if(typeof C.text!="string"){const N=c.lineHeight;f.y+=yd(C,N)+d}else f.y+=A}),Gc(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=jt(e.font),i=Kt(e.padding);if(!e.display)return;const r=Wn(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=s.size/2,c=i.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=Gt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+Gt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=Gt(a,u,u+h);o.textAlign=r.textAlign(xo(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=s.string,kn(o,e.text,f,d,s)}_computeTitleHeight(){const t=this.options.title,e=jt(t.font),s=Kt(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,i,r;if(Ne(t,this.left,this.right)&&Ne(e,this.top,this.bottom)){for(r=this.legendHitBoxes,s=0;s<r.length;++s)if(i=r[s],Ne(t,i.left,i.left+i.width)&&Ne(e,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!Ab(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const i=this._hoveredItem,r=kb(i,s);i&&!r&&bt(e.onLeave,[t,i,this],this),this._hoveredItem=s,s&&!r&&bt(e.onHover,[t,s,this],this)}else s&&bt(e.onClick,[t,s,this],this)}}function Sb(n,t,e,s,i){const r=Eb(s,n,t,e),o=Tb(i,s,t.lineHeight);return{itemWidth:r,itemHeight:o}}function Eb(n,t,e,s){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+s.measureText(i).width}function Tb(n,t,e){let s=n;return typeof t.text!="string"&&(s=yd(t,e)),s}function yd(n,t){const e=n.text?n.text.length:0;return t*e}function Ab(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var Cb={id:"legend",_element:Dl,start(n,t,e){const s=n.legend=new Dl({ctx:n.ctx,options:e,chart:n});Yt.configure(n,s,e),Yt.addBox(n,s)},stop(n){Yt.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const s=n.legend;Yt.configure(n,s,e),s.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const s=t.datasetIndex,i=e.chart;i.isDatasetVisible(s)?(i.hide(s),t.hidden=!0):(i.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=Kt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:i||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Io extends we{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const i=Tt(s.text)?s.text.length:1;this._padding=Kt(s.padding);const r=i*jt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:i,right:r,options:o}=this,a=o.align;let l=0,c,d,u;return this.isHorizontal()?(d=Gt(a,s,r),u=e+t,c=r-s):(o.position==="left"?(d=s+t,u=Gt(a,i,e),l=ut*-.5):(d=r-t,u=Gt(a,e,i),l=ut*.5),c=i-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=jt(e.font),r=s.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);kn(t,e.text,0,0,s,{color:e.color,maxWidth:l,rotation:c,textAlign:xo(e.align),textBaseline:"middle",translation:[o,a]})}}function Ob(n,t){const e=new Io({ctx:n.ctx,options:t,chart:n});Yt.configure(n,e,t),Yt.addBox(n,e),n.titleBlock=e}var Rb={id:"title",_element:Io,start(n,t,e){Ob(n,e)},stop(n){const t=n.titleBlock;Yt.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const s=n.titleBlock;Yt.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const yi=new WeakMap;var Ib={id:"subtitle",start(n,t,e){const s=new Io({ctx:n.ctx,options:e,chart:n});Yt.configure(n,s,e),Yt.addBox(n,s),yi.set(n,s)},stop(n){Yt.removeBox(n,yi.get(n)),yi.delete(n)},beforeUpdate(n,t,e){const s=yi.get(n);Yt.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ms={average(n){if(!n.length)return!1;let t,e,s=new Set,i=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();s.add(l.x),i+=l.y,++r}}return r===0||s.size===0?!1:{x:[...s].reduce((a,l)=>a+l)/s.size,y:i/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,s=t.y,i=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=qr(t,c);d<i&&(i=d,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,s=l.y}return{x:e,y:s}}};function Ee(n,t){return t&&(Tt(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function De(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function Mb(n,t){const{element:e,datasetIndex:s,index:i}=t,r=n.getDatasetMeta(s).controller,{label:o,value:a}=r.getLabelAndValue(i);return{chart:n,label:o,parsed:r.getParsed(i),raw:n.data.datasets[s].data[i],formattedValue:a,dataset:r.getDataset(),dataIndex:i,datasetIndex:s,element:e}}function $l(n,t){const e=n.chart.ctx,{body:s,footer:i,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=jt(t.bodyFont),c=jt(t.titleFont),d=jt(t.footerFont),u=r.length,h=i.length,f=s.length,g=Kt(t.padding);let p=g.height,m=0,b=s.reduce((k,A)=>k+A.before.length+A.lines.length+A.after.length,0);if(b+=n.beforeBody.length+n.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const k=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*k+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let v=0;const w=function(k){m=Math.max(m,e.measureText(k).width+v)};return e.save(),e.font=c.string,mt(n.title,w),e.font=l.string,mt(n.beforeBody.concat(n.afterBody),w),v=t.displayColors?o+2+t.boxPadding:0,mt(s,k=>{mt(k.before,w),mt(k.lines,w),mt(k.after,w)}),v=0,e.font=d.string,mt(n.footer,w),e.restore(),m+=g.width,{width:m,height:p}}function Pb(n,t){const{y:e,height:s}=t;return e<s/2?"top":e>n.height-s/2?"bottom":"center"}function Lb(n,t,e,s){const{x:i,width:r}=s,o=e.caretSize+e.caretPadding;if(n==="left"&&i+r+o>t.width||n==="right"&&i-r-o<0)return!0}function Db(n,t,e,s){const{x:i,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let c="center";return s==="center"?c=i<=(a+l)/2?"left":"right":i<=r/2?c="left":i>=o-r/2&&(c="right"),Lb(c,n,t,e)&&(c="center"),c}function Bl(n,t,e){const s=e.yAlign||t.yAlign||Pb(n,e);return{xAlign:e.xAlign||t.xAlign||Db(n,t,e,s),yAlign:s}}function $b(n,t){let{x:e,width:s}=n;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function Bb(n,t,e){let{y:s,height:i}=n;return t==="top"?s+=e:t==="bottom"?s-=i+e:s-=i/2,s}function Nl(n,t,e,s){const{caretSize:i,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,c=i+r,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=_n(o);let g=$b(t,a);const p=Bb(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+i:a==="right"&&(g+=Math.max(u,f)+i),{x:Ft(g,0,s.width-t.width),y:Ft(p,0,s.height-t.height)}}function bi(n,t,e){const s=Kt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-s.right:n.x+s.left}function jl(n){return Ee([],De(n))}function Nb(n,t,e){return tn(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function Fl(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const bd={beforeTitle:Pe,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Pe,beforeBody:Pe,beforeLabel:Pe,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return ot(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Pe,afterBody:Pe,beforeFooter:Pe,footer:Pe,afterFooter:Pe};function ne(n,t,e,s){const i=n[t].call(e,s);return typeof i>"u"?bd[t].call(e,s):i}class no extends we{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&e.options.animation&&s.animations,r=new Xc(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=Nb(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,i=ne(s,"beforeTitle",this,t),r=ne(s,"title",this,t),o=ne(s,"afterTitle",this,t);let a=[];return a=Ee(a,De(i)),a=Ee(a,De(r)),a=Ee(a,De(o)),a}getBeforeBody(t,e){return jl(ne(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,i=[];return mt(t,r=>{const o={before:[],lines:[],after:[]},a=Fl(s,r);Ee(o.before,De(ne(a,"beforeLabel",this,r))),Ee(o.lines,ne(a,"label",this,r)),Ee(o.after,De(ne(a,"afterLabel",this,r))),i.push(o)}),i}getAfterBody(t,e){return jl(ne(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,i=ne(s,"beforeFooter",this,t),r=ne(s,"footer",this,t),o=ne(s,"afterFooter",this,t);let a=[];return a=Ee(a,De(i)),a=Ee(a,De(r)),a=Ee(a,De(o)),a}_createItems(t){const e=this._active,s=this.chart.data,i=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(Mb(this.chart,e[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,s))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,s))),mt(a,d=>{const u=Fl(t.callbacks,d);i.push(ne(u,"labelColor",this,d)),r.push(ne(u,"labelPointStyle",this,d)),o.push(ne(u,"labelTextColor",this,d))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const s=this.options.setContext(this.getContext()),i=this._active;let r,o=[];if(!i.length)this.opacity!==0&&(r={opacity:0});else{const a=ms[s.position].call(this,i,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const l=this._size=$l(this,s),c=Object.assign({},a,l),d=Bl(this.chart,s,c),u=Nl(s,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,i){const r=this.getCaretPosition(t,s,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,s){const{xAlign:i,yAlign:r}=this,{caretSize:o,cornerRadius:a}=s,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=_n(a),{x:h,y:f}=t,{width:g,height:p}=e;let m,b,v,w,k,A;return r==="center"?(k=f+p/2,i==="left"?(m=h,b=m-o,w=k+o,A=k-o):(m=h+g,b=m+o,w=k-o,A=k+o),v=m):(i==="left"?b=h+Math.max(l,d)+o:i==="right"?b=h+g-Math.max(c,u)-o:b=this.caretX,r==="top"?(w=f,k=w-o,m=b-o,v=b+o):(w=f+p,k=w+o,m=b+o,v=b-o),A=w),{x1:m,x2:b,x3:v,y1:w,y2:k,y3:A}}drawTitle(t,e,s){const i=this.title,r=i.length;let o,a,l;if(r){const c=Wn(s.rtl,this.x,this.width);for(t.x=bi(this,s.titleAlign,s),e.textAlign=c.textAlign(s.titleAlign),e.textBaseline="middle",o=jt(s.titleFont),a=s.titleSpacing,e.fillStyle=s.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(i[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=s.titleMarginBottom-a)}}_drawColorBox(t,e,s,i,r){const o=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:l,boxWidth:c}=r,d=jt(r.bodyFont),u=bi(this,"left",r),h=i.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=e.y+f;if(r.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=i.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Kr(t,p,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Kr(t,p,m,b)}else{t.lineWidth=lt(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const p=i.leftForLtr(h,c),m=i.leftForLtr(i.xPlus(h,1),c-2),b=_n(o.borderRadius);Object.values(b).some(v=>v!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,js(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),js(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:i}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=s,u=jt(s.bodyFont);let h=u.lineHeight,f=0;const g=Wn(s.rtl,this.x,this.width),p=function(y){e.fillText(y,g.x(t.x+f),t.y+h/2),t.y+=h+r},m=g.textAlign(o);let b,v,w,k,A,C,E;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=bi(this,m,s),e.fillStyle=s.bodyColor,mt(this.beforeBody,p),f=a&&m!=="right"?o==="center"?c/2+d:c+2+d:0,k=0,C=i.length;k<C;++k){for(b=i[k],v=this.labelTextColors[k],e.fillStyle=v,mt(b.before,p),w=b.lines,a&&w.length&&(this._drawColorBox(e,t,k,g,s),h=Math.max(u.lineHeight,l)),A=0,E=w.length;A<E;++A)p(w[A]),h=u.lineHeight;mt(b.after,p)}f=0,h=u.lineHeight,mt(this.afterBody,p),t.y-=r}drawFooter(t,e,s){const i=this.footer,r=i.length;let o,a;if(r){const l=Wn(s.rtl,this.x,this.width);for(t.x=bi(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=l.textAlign(s.footerAlign),e.textBaseline="middle",o=jt(s.footerFont),e.fillStyle=s.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(i[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+s.footerSpacing}}drawBackground(t,e,s,i){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:d}=s,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=_n(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,s,i),e.lineTo(a+c-h,l),e.quadraticCurveTo(a+c,l,a+c,l+h),o==="center"&&r==="right"&&this.drawCaret(t,e,s,i),e.lineTo(a+c,l+d-g),e.quadraticCurveTo(a+c,l+d,a+c-g,l+d),o==="bottom"&&this.drawCaret(t,e,s,i),e.lineTo(a+f,l+d),e.quadraticCurveTo(a,l+d,a,l+d-f),o==="center"&&r==="left"&&this.drawCaret(t,e,s,i),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,i=s&&s.x,r=s&&s.y;if(i||r){const o=ms[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=$l(this,t),l=Object.assign({},o,this._size),c=Bl(e,t,l),d=Nl(t,l,c,e);(i._to!==d.x||r._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=Kt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=s,this.drawBackground(r,t,i,e),Vc(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),Gc(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,i=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!$i(s,i),o=this._positionChanged(i,e);(r||o)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,s),a=this._positionChanged(o,t),l=e||!$i(o,r)||a;return l&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,s,i){const r=this.options;if(t.type==="mouseout")return[];if(!i)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,s);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:s,caretY:i,options:r}=this,o=ms[r.position].call(this,t,e);return o!==!1&&(s!==o.x||i!==o.y)}}F(no,"positioners",ms);var jb={id:"tooltip",_element:no,positioners:ms,afterInit(n,t,e){e&&(n.tooltip=new no({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:bd},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Fb=Object.freeze({__proto__:null,Colors:Qy,Decimation:nb,Filler:xb,Legend:Cb,SubTitle:Ib,Title:Rb,Tooltip:jb});const Ub=(n,t,e,s)=>(typeof t=="string"?(e=n.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function zb(n,t,e,s){const i=n.indexOf(t);if(i===-1)return Ub(n,t,e,s);const r=n.lastIndexOf(t);return i!==r?e:i}const Hb=(n,t)=>n===null?null:Ft(Math.round(n),0,t);function Ul(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class so extends Sn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:i,label:r}of e)s[i]===r&&s.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(ot(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:zb(s,t,Z(e,t),this._addedLabels),Hb(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,i=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=t;o<=e;o++)i.push({value:o});return i}getLabelForValue(t){return Ul.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}F(so,"id","category"),F(so,"defaults",{ticks:{callback:Ul}});function Wb(n,t){const e=[],{bounds:i,step:r,min:o,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=n,f=r||1,g=d-1,{min:p,max:m}=t,b=!ot(o),v=!ot(a),w=!ot(c),k=(m-p)/(u+1);let A=$a((m-p)/g/f)*f,C,E,y,_;if(A<1e-14&&!b&&!v)return[{value:p},{value:m}];_=Math.ceil(m/A)-Math.floor(p/A),_>g&&(A=$a(_*A/g/f)*f),ot(l)||(C=Math.pow(10,l),A=Math.ceil(A*C)/C),i==="ticks"?(E=Math.floor(p/A)*A,y=Math.ceil(m/A)*A):(E=p,y=m),b&&v&&r&&$g((a-o)/r,A/1e3)?(_=Math.round(Math.min((a-o)/A,d)),A=(a-o)/_,E=o,y=a):w?(E=b?o:E,y=v?a:y,_=c-1,A=(y-E)/_):(_=(y-E)/A,ks(_,Math.round(_),A/1e3)?_=Math.round(_):_=Math.ceil(_));const S=Math.max(Ba(A),Ba(E));C=Math.pow(10,ot(l)?S:l),E=Math.round(E*C)/C,y=Math.round(y*C)/C;let T=0;for(b&&(h&&E!==o?(e.push({value:o}),E<o&&T++,ks(Math.round((E+T*A)*C)/C,o,zl(o,k,n))&&T++):E<o&&T++);T<_;++T){const P=Math.round((E+T*A)*C)/C;if(v&&P>a)break;e.push({value:P})}return v&&h&&y!==a?e.length&&ks(e[e.length-1].value,a,zl(a,k,n))?e[e.length-1].value=a:e.push({value:a}):(!v||y===a)&&e.push({value:y}),e}function zl(n,t,{horizontal:e,minRotation:s}){const i=_e(s),r=(e?Math.sin(i):Math.cos(i))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class Hi extends Sn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return ot(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:i,max:r}=this;const o=l=>i=e?i:l,a=l=>r=s?r:l;if(t){const l=Ce(i),c=Ce(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(i===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(i-l)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),e=e||11),e&&(i=Math.min(e,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=Wb(i,r);return t.bounds==="ticks"&&Cc(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const i=(s-e)/Math.max(t.length-1,1)/2;e-=i,s+=i}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return Vs(t,this.chart.options.locale,this.options.ticks.format)}}class io extends Hi{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Ot(t)?t:0,this.max=Ot(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=_e(this.options.ticks.minRotation),i=(t?Math.sin(s):Math.cos(s))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}F(io,"id","linear"),F(io,"defaults",{ticks:{callback:Yi.formatters.numeric}});const Us=n=>Math.floor(Ge(n)),dn=(n,t)=>Math.pow(10,Us(n)+t);function Hl(n){return n/Math.pow(10,Us(n))===1}function Wl(n,t,e){const s=Math.pow(10,e),i=Math.floor(n/s);return Math.ceil(t/s)-i}function Vb(n,t){const e=t-n;let s=Us(e);for(;Wl(n,t,s)>10;)s++;for(;Wl(n,t,s)<10;)s--;return Math.min(s,Us(n))}function Gb(n,{min:t,max:e}){t=le(n.min,t);const s=[],i=Us(t);let r=Vb(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=i>r?Math.pow(10,i):0,c=Math.round((t-l)*o)/o,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,r)),h=le(n.min,Math.round((l+d+u*Math.pow(10,r))*o)/o);for(;h<e;)s.push({value:h,major:Hl(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),h=Math.round((l+d+u*Math.pow(10,r))*o)/o;const f=le(n.max,h);return s.push({value:f,major:Hl(f),significand:u}),s}class ro extends Sn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=Hi.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return Ot(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Ot(t)?Math.max(0,t):null,this.max=Ot(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Ot(this._userMin)&&(this.min=t===dn(this.min,0)?dn(this.min,-1):dn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,i=this.max;const r=a=>s=t?s:a,o=a=>i=e?i:a;s===i&&(s<=0?(r(1),o(10)):(r(dn(s,-1)),o(dn(i,1)))),s<=0&&r(dn(i,-1)),i<=0&&o(dn(s,1)),this.min=s,this.max=i}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Gb(e,this);return t.bounds==="ticks"&&Cc(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":Vs(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Ge(t),this._valueRange=Ge(this.max)-Ge(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Ge(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}F(ro,"id","logarithmic"),F(ro,"defaults",{ticks:{callback:Yi.formatters.logarithmic,major:{enabled:!0}}});function oo(n){const t=n.ticks;if(t.display&&n.display){const e=Kt(t.backdropPadding);return Z(t.font&&t.font.size,At.font.size)+e.height}return 0}function qb(n,t,e){return e=Tt(e)?e:[e],{w:Zg(n,t.string,e),h:e.length*t.lineHeight}}function Vl(n,t,e,s,i){return n===s||n===i?{start:t-e/2,end:t+e/2}:n<s||n>i?{start:t-e,end:t}:{start:t,end:t+e}}function Yb(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),s=[],i=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?ut/r:0;for(let l=0;l<r;l++){const c=o.setContext(n.getPointLabelContext(l));i[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+i[l],a),u=jt(c.font),h=qb(n.ctx,u,n._pointLabels[l]);s[l]=h;const f=qt(n.getIndexAngle(l)+a),g=Math.round(vo(f)),p=Vl(g,d.x,h.w,0,180),m=Vl(g,d.y,h.h,90,270);Kb(e,t,f,p,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=Qb(n,s,i)}function Kb(n,t,e,s,i){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;s.start<t.l?(a=(t.l-s.start)/r,n.l=Math.min(n.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),i.start<t.t?(l=(t.t-i.start)/o,n.t=Math.min(n.t,t.t-l)):i.end>t.b&&(l=(i.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function Jb(n,t,e){const s=n.drawingArea,{extra:i,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,s+i+o,r),c=Math.round(vo(qt(l.angle+Mt))),d=e_(l.y,a.h,c),u=Zb(c),h=t_(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function Xb(n,t){if(!t)return!0;const{left:e,top:s,right:i,bottom:r}=n;return!(Fe({x:e,y:s},t)||Fe({x:e,y:r},t)||Fe({x:i,y:s},t)||Fe({x:i,y:r},t))}function Qb(n,t,e){const s=[],i=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:oo(r)/2,additionalAngle:o?ut/i:0};let c;for(let d=0;d<i;d++){l.padding=e[d],l.size=t[d];const u=Jb(n,d,l);s.push(u),a==="auto"&&(u.visible=Xb(u,c),u.visible&&(c=u))}return s}function Zb(n){return n===0||n===180?"center":n<180?"left":"right"}function t_(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function e_(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function n_(n,t,e){const{left:s,top:i,right:r,bottom:o}=e,{backdropColor:a}=t;if(!ot(a)){const l=_n(t.borderRadius),c=Kt(t.backdropPadding);n.fillStyle=a;const d=s-c.left,u=i-c.top,h=r-s+c.width,f=o-i+c.height;Object.values(l).some(g=>g!==0)?(n.beginPath(),js(n,{x:d,y:u,w:h,h:f,radius:l}),n.fill()):n.fillRect(d,u,h,f)}}function s_(n,t){const{ctx:e,options:{pointLabels:s}}=n;for(let i=t-1;i>=0;i--){const r=n._pointLabelItems[i];if(!r.visible)continue;const o=s.setContext(n.getPointLabelContext(i));n_(e,o,r);const a=jt(o.font),{x:l,y:c,textAlign:d}=r;kn(e,n._pointLabels[i],l,c+a.lineHeight/2,a,{color:o.color,textAlign:d,textBaseline:"middle"})}}function _d(n,t,e,s){const{ctx:i}=n;if(e)i.arc(n.xCenter,n.yCenter,t,0,wt);else{let r=n.getPointPosition(0,t);i.moveTo(r.x,r.y);for(let o=1;o<s;o++)r=n.getPointPosition(o,t),i.lineTo(r.x,r.y)}}function i_(n,t,e,s,i){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!s||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(i.dash||[]),r.lineDashOffset=i.dashOffset,r.beginPath(),_d(n,e,o,s),r.closePath(),r.stroke(),r.restore())}function r_(n,t,e){return tn(n,{label:e,index:t,type:"pointLabel"})}class ys extends Hi{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Kt(oo(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Ot(t)&&!isNaN(t)?t:0,this.max=Ot(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/oo(this.options))}generateTickLabels(t){Hi.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const i=bt(this.options.pointLabels.callback,[e,s],this);return i||i===0?i:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Yb(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,i))}getIndexAngle(t){const e=wt/(this._pointLabels.length||1),s=this.options.startAngle||0;return qt(t*e+_e(s))}getDistanceFromCenterForValue(t){if(ot(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(ot(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return r_(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const i=this.getIndexAngle(t)-Mt+s;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:s,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),_d(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:i,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&s_(this,o),i.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=i.setContext(h),g=r.setContext(h);i_(this,f,l,o,g)}}),s.display){for(t.save(),a=o-1;a>=0;a--){const d=s.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=s.setContext(this.getContext(l)),d=jt(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=Kt(c.backdropPadding);t.fillRect(-o/2-u.left,-r-d.size/2-u.top,o+u.width,d.size+u.height)}kn(t,a.label,0,-r,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}F(ys,"id","radialLinear"),F(ys,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Yi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),F(ys,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),F(ys,"descriptors",{angleLines:{_fallback:"grid"}});const tr={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},se=Object.keys(tr);function Gl(n,t){return n-t}function ql(n,t){if(ot(t))return null;const e=n._adapter,{parser:s,round:i,isoWeekday:r}=n._parseOpts;let o=t;return typeof s=="function"&&(o=s(o)),Ot(o)||(o=typeof s=="string"?e.parse(o,s):e.parse(o)),o===null?null:(i&&(o=i==="week"&&(Vn(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,i)),+o)}function Yl(n,t,e,s){const i=se.length;for(let r=se.indexOf(n);r<i-1;++r){const o=tr[se[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=s)return se[r]}return se[i-1]}function o_(n,t,e,s,i){for(let r=se.length-1;r>=se.indexOf(e);r--){const o=se[r];if(tr[o].common&&n._adapter.diff(i,s,o)>=t-1)return o}return se[e?se.indexOf(e):0]}function a_(n){for(let t=se.indexOf(n)+1,e=se.length;t<e;++t)if(tr[se[t]].common)return se[t]}function Kl(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:s,hi:i}=wo(e,t),r=e[s]>=t?e[s]:e[i];n[r]=!0}}function l_(n,t,e,s){const i=n._adapter,r=+i.startOf(t[0].value,s),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+i.add(a,1,s))l=e[a],l>=0&&(t[l].major=!0);return t}function Jl(n,t,e){const s=[],i={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],i[a]=o,s.push({value:a,major:!1});return r===0||!e?s:l_(n,s,i,e)}class zs extends Sn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),i=this._adapter=new mm._date(t.adapters.date);i.init(e),xs(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:ql(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:i,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(i=Math.min(i,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=Ot(i)&&!isNaN(i)?i:+e.startOf(Date.now(),s),r=Ot(r)&&!isNaN(r)?r:+e.endOf(Date.now(),s)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,o=this.max,a=Fg(i,r,o);return this._unit=e.unit||(s.autoSkip?Yl(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):o_(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:a_(this._unit),this.initOffsets(i),t.reverse&&a.reverse(),Jl(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,i,r;this.options.offset&&t.length&&(i=this.getDecimalForValue(t[0]),t.length===1?e=1-i:e=(this.getDecimalForValue(t[1])-i)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?s=r:s=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Ft(e,0,o),s=Ft(s,0,o),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,i=this.options,r=i.time,o=r.unit||Yl(r.minUnit,e,s,this._getLabelCapacity(e)),a=Z(i.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=Vn(l)||l===!0,d={};let u=e,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(s,e,o)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+o);const g=i.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<s;h=+t.add(h,a,o),f++)Kl(d,h,g);return(h===s||i.bounds==="ticks"||f===1)&&Kl(d,h,g),Object.keys(d).sort(Gl).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,r=this._unit,o=e||i[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,s,i){const r=this.options,o=r.ticks.callback;if(o)return bt(o,[t,e,s],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=s[e],f=c&&u&&h&&h.major;return this._adapter.format(t,i||(f?u:d))}generateTickLabels(t){let e,s,i;for(e=0,s=t.length;e<s;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,i=_e(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),o=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:s*r+a*o,h:s*o+a*r}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,i=s[e.unit]||s.millisecond,r=this._tickFormatFunction(t,0,Jl(this,[t],this._majorUnit),i),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,s=i.length;e<s;++e)t=t.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const i=this.getLabels();for(e=0,s=i.length;e<s;++e)t.push(ql(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Ic(t.sort(Gl))}}F(zs,"id","time"),F(zs,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function _i(n,t,e){let s=0,i=n.length-1,r,o,a,l;e?(t>=n[s].pos&&t<=n[i].pos&&({lo:s,hi:i}=je(n,"pos",t)),{pos:r,time:a}=n[s],{pos:o,time:l}=n[i]):(t>=n[s].time&&t<=n[i].time&&({lo:s,hi:i}=je(n,"time",t)),{time:r,pos:a}=n[s],{time:o,pos:l}=n[i]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class ao extends zs{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=_i(e,this.min),this._tableRange=_i(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,i=[],r=[];let o,a,l,c,d;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=s&&i.push(c);if(i.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(o=0,a=i.length;o<a;++o)d=i[o+1],l=i[o-1],c=i[o],Math.round((d+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((i,r)=>i-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(_i(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return _i(this._table,s*this._tableRange+this._minPos,!0)}}F(ao,"id","timeseries"),F(ao,"defaults",zs.defaults);var c_=Object.freeze({__proto__:null,CategoryScale:so,LinearScale:io,LogarithmicScale:ro,RadialLinearScale:ys,TimeScale:zs,TimeSeriesScale:ao});const d_=[pm,Vy,Fb,c_];ce.register(...d_);var Mo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var wd={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(Mo,function(){var e=1e3,s=6e4,i=36e5,r="millisecond",o="second",a="minute",l="hour",c="day",d="week",u="month",h="quarter",f="year",g="date",p="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(N){var O=["th","st","nd","rd"],R=N%100;return"["+N+(O[(R-20)%10]||O[R]||O[0])+"]"}},w=function(N,O,R){var I=String(N);return!I||I.length>=O?N:""+Array(O+1-I.length).join(R)+N},k={s:w,z:function(N){var O=-N.utcOffset(),R=Math.abs(O),I=Math.floor(R/60),L=R%60;return(O<=0?"+":"-")+w(I,2,"0")+":"+w(L,2,"0")},m:function N(O,R){if(O.date()<R.date())return-N(R,O);var I=12*(R.year()-O.year())+(R.month()-O.month()),L=O.clone().add(I,u),M=R-L<0,z=O.clone().add(I+(M?-1:1),u);return+(-(I+(R-L)/(M?L-z:z-L))||0)},a:function(N){return N<0?Math.ceil(N)||0:Math.floor(N)},p:function(N){return{M:u,y:f,w:d,d:c,D:g,h:l,m:a,s:o,ms:r,Q:h}[N]||String(N||"").toLowerCase().replace(/s$/,"")},u:function(N){return N===void 0}},A="en",C={};C[A]=v;var E="$isDayjsObject",y=function(N){return N instanceof P||!(!N||!N[E])},_=function N(O,R,I){var L;if(!O)return A;if(typeof O=="string"){var M=O.toLowerCase();C[M]&&(L=M),R&&(C[M]=R,L=M);var z=O.split("-");if(!L&&z.length>1)return N(z[0])}else{var D=O.name;C[D]=O,L=D}return!I&&L&&(A=L),L||!I&&A},S=function(N,O){if(y(N))return N.clone();var R=typeof O=="object"?O:{};return R.date=N,R.args=arguments,new P(R)},T=k;T.l=_,T.i=y,T.w=function(N,O){return S(N,{locale:O.$L,utc:O.$u,x:O.$x,$offset:O.$offset})};var P=function(){function N(R){this.$L=_(R.locale,null,!0),this.parse(R),this.$x=this.$x||R.x||{},this[E]=!0}var O=N.prototype;return O.parse=function(R){this.$d=function(I){var L=I.date,M=I.utc;if(L===null)return new Date(NaN);if(T.u(L))return new Date;if(L instanceof Date)return new Date(L);if(typeof L=="string"&&!/Z$/i.test(L)){var z=L.match(m);if(z){var D=z[2]-1||0,H=(z[7]||"0").substring(0,3);return M?new Date(Date.UTC(z[1],D,z[3]||1,z[4]||0,z[5]||0,z[6]||0,H)):new Date(z[1],D,z[3]||1,z[4]||0,z[5]||0,z[6]||0,H)}}return new Date(L)}(R),this.init()},O.init=function(){var R=this.$d;this.$y=R.getFullYear(),this.$M=R.getMonth(),this.$D=R.getDate(),this.$W=R.getDay(),this.$H=R.getHours(),this.$m=R.getMinutes(),this.$s=R.getSeconds(),this.$ms=R.getMilliseconds()},O.$utils=function(){return T},O.isValid=function(){return this.$d.toString()!==p},O.isSame=function(R,I){var L=S(R);return this.startOf(I)<=L&&L<=this.endOf(I)},O.isAfter=function(R,I){return S(R)<this.startOf(I)},O.isBefore=function(R,I){return this.endOf(I)<S(R)},O.$g=function(R,I,L){return T.u(R)?this[I]:this.set(L,R)},O.unix=function(){return Math.floor(this.valueOf()/1e3)},O.valueOf=function(){return this.$d.getTime()},O.startOf=function(R,I){var L=this,M=!!T.u(I)||I,z=T.p(R),D=function(tt,et){var K=T.w(L.$u?Date.UTC(L.$y,et,tt):new Date(L.$y,et,tt),L);return M?K:K.endOf(c)},H=function(tt,et){return T.w(L.toDate()[tt].apply(L.toDate("s"),(M?[0,0,0,0]:[23,59,59,999]).slice(et)),L)},$=this.$W,Q=this.$M,W=this.$D,st="set"+(this.$u?"UTC":"");switch(z){case f:return M?D(1,0):D(31,11);case u:return M?D(1,Q):D(0,Q+1);case d:var kt=this.$locale().weekStart||0,X=($<kt?$+7:$)-kt;return D(M?W-X:W+(6-X),Q);case c:case g:return H(st+"Hours",0);case l:return H(st+"Minutes",1);case a:return H(st+"Seconds",2);case o:return H(st+"Milliseconds",3);default:return this.clone()}},O.endOf=function(R){return this.startOf(R,!1)},O.$set=function(R,I){var L,M=T.p(R),z="set"+(this.$u?"UTC":""),D=(L={},L[c]=z+"Date",L[g]=z+"Date",L[u]=z+"Month",L[f]=z+"FullYear",L[l]=z+"Hours",L[a]=z+"Minutes",L[o]=z+"Seconds",L[r]=z+"Milliseconds",L)[M],H=M===c?this.$D+(I-this.$W):I;if(M===u||M===f){var $=this.clone().set(g,1);$.$d[D](H),$.init(),this.$d=$.set(g,Math.min(this.$D,$.daysInMonth())).$d}else D&&this.$d[D](H);return this.init(),this},O.set=function(R,I){return this.clone().$set(R,I)},O.get=function(R){return this[T.p(R)]()},O.add=function(R,I){var L,M=this;R=Number(R);var z=T.p(I),D=function(Q){var W=S(M);return T.w(W.date(W.date()+Math.round(Q*R)),M)};if(z===u)return this.set(u,this.$M+R);if(z===f)return this.set(f,this.$y+R);if(z===c)return D(1);if(z===d)return D(7);var H=(L={},L[a]=s,L[l]=i,L[o]=e,L)[z]||1,$=this.$d.getTime()+R*H;return T.w($,this)},O.subtract=function(R,I){return this.add(-1*R,I)},O.format=function(R){var I=this,L=this.$locale();if(!this.isValid())return L.invalidDate||p;var M=R||"YYYY-MM-DDTHH:mm:ssZ",z=T.z(this),D=this.$H,H=this.$m,$=this.$M,Q=L.weekdays,W=L.months,st=L.meridiem,kt=function(et,K,dt,ht){return et&&(et[K]||et(I,M))||dt[K].slice(0,ht)},X=function(et){return T.s(D%12||12,et,"0")},tt=st||function(et,K,dt){var ht=et<12?"AM":"PM";return dt?ht.toLowerCase():ht};return M.replace(b,function(et,K){return K||function(dt){switch(dt){case"YY":return String(I.$y).slice(-2);case"YYYY":return T.s(I.$y,4,"0");case"M":return $+1;case"MM":return T.s($+1,2,"0");case"MMM":return kt(L.monthsShort,$,W,3);case"MMMM":return kt(W,$);case"D":return I.$D;case"DD":return T.s(I.$D,2,"0");case"d":return String(I.$W);case"dd":return kt(L.weekdaysMin,I.$W,Q,2);case"ddd":return kt(L.weekdaysShort,I.$W,Q,3);case"dddd":return Q[I.$W];case"H":return String(D);case"HH":return T.s(D,2,"0");case"h":return X(1);case"hh":return X(2);case"a":return tt(D,H,!0);case"A":return tt(D,H,!1);case"m":return String(H);case"mm":return T.s(H,2,"0");case"s":return String(I.$s);case"ss":return T.s(I.$s,2,"0");case"SSS":return T.s(I.$ms,3,"0");case"Z":return z}return null}(et)||z.replace(":","")})},O.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},O.diff=function(R,I,L){var M,z=this,D=T.p(I),H=S(R),$=(H.utcOffset()-this.utcOffset())*s,Q=this-H,W=function(){return T.m(z,H)};switch(D){case f:M=W()/12;break;case u:M=W();break;case h:M=W()/3;break;case d:M=(Q-$)/6048e5;break;case c:M=(Q-$)/864e5;break;case l:M=Q/i;break;case a:M=Q/s;break;case o:M=Q/e;break;default:M=Q}return L?M:T.a(M)},O.daysInMonth=function(){return this.endOf(u).$D},O.$locale=function(){return C[this.$L]},O.locale=function(R,I){if(!R)return this.$L;var L=this.clone(),M=_(R,I,!0);return M&&(L.$L=M),L},O.clone=function(){return T.w(this.$d,this)},O.toDate=function(){return new Date(this.valueOf())},O.toJSON=function(){return this.isValid()?this.toISOString():null},O.toISOString=function(){return this.$d.toISOString()},O.toString=function(){return this.$d.toUTCString()},N}(),B=P.prototype;return S.prototype=B,[["$ms",r],["$s",o],["$m",a],["$H",l],["$W",c],["$M",u],["$y",f],["$D",g]].forEach(function(N){B[N[1]]=function(O){return this.$g(O,N[0],N[1])}}),S.extend=function(N,O){return N.$i||(N(O,P,S),N.$i=!0),S},S.locale=_,S.isDayjs=y,S.unix=function(N){return S(1e3*N)},S.en=C[A],S.Ls=C,S.p={},S})})(wd);var u_=wd.exports;const ct=vd(u_);var xd={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(Mo,function(){return function(e,s,i){s.prototype.isBetween=function(r,o,a,l){var c=i(r),d=i(o),u=(l=l||"()")[0]==="(",h=l[1]===")";return(u?this.isAfter(c,a):!this.isBefore(c,a))&&(h?this.isBefore(d,a):!this.isAfter(d,a))||(u?this.isBefore(c,a):!this.isAfter(c,a))&&(h?this.isAfter(d,a):!this.isBefore(d,a))}}})})(xd);var h_=xd.exports;const f_=vd(h_);/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:kd,setPrototypeOf:Xl,isFrozen:g_,getPrototypeOf:p_,getOwnPropertyDescriptor:m_}=Object;let{freeze:Xt,seal:he,create:lo}=Object,{apply:co,construct:uo}=typeof Reflect<"u"&&Reflect;Xt||(Xt=function(t){return t});he||(he=function(t){return t});co||(co=function(t,e){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return t.apply(e,i)});uo||(uo=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return new t(...s)});const vi=Qt(Array.prototype.forEach),y_=Qt(Array.prototype.lastIndexOf),Ql=Qt(Array.prototype.pop),rs=Qt(Array.prototype.push),b_=Qt(Array.prototype.splice),Mi=Qt(String.prototype.toLowerCase),Or=Qt(String.prototype.toString),Rr=Qt(String.prototype.match),os=Qt(String.prototype.replace),__=Qt(String.prototype.indexOf),v_=Qt(String.prototype.trim),pe=Qt(Object.prototype.hasOwnProperty),Jt=Qt(RegExp.prototype.test),as=w_(TypeError);function Qt(n){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return co(n,t,s)}}function w_(n){return function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return uo(n,e)}}function it(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Mi;Xl&&Xl(n,null);let s=t.length;for(;s--;){let i=t[s];if(typeof i=="string"){const r=e(i);r!==i&&(g_(t)||(t[s]=r),i=r)}n[i]=!0}return n}function x_(n){for(let t=0;t<n.length;t++)pe(n,t)||(n[t]=null);return n}function Te(n){const t=lo(null);for(const[e,s]of kd(n))pe(n,e)&&(Array.isArray(s)?t[e]=x_(s):s&&typeof s=="object"&&s.constructor===Object?t[e]=Te(s):t[e]=s);return t}function ls(n,t){for(;n!==null;){const s=m_(n,t);if(s){if(s.get)return Qt(s.get);if(typeof s.value=="function")return Qt(s.value)}n=p_(n)}function e(){return null}return e}const Zl=Xt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ir=Xt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Mr=Xt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),k_=Xt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Pr=Xt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),S_=Xt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),tc=Xt(["#text"]),ec=Xt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Lr=Xt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),nc=Xt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),wi=Xt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),E_=he(/\{\{[\w\W]*|[\w\W]*\}\}/gm),T_=he(/<%[\w\W]*|[\w\W]*%>/gm),A_=he(/\$\{[\w\W]*/gm),C_=he(/^data-[\-\w.\u00B7-\uFFFF]+$/),O_=he(/^aria-[\-\w]+$/),Sd=he(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),R_=he(/^(?:\w+script|data):/i),I_=he(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ed=he(/^html$/i),M_=he(/^[a-z][.\w]*(-[.\w]+)+$/i);var sc=Object.freeze({__proto__:null,ARIA_ATTR:O_,ATTR_WHITESPACE:I_,CUSTOM_ELEMENT:M_,DATA_ATTR:C_,DOCTYPE_NAME:Ed,ERB_EXPR:T_,IS_ALLOWED_URI:Sd,IS_SCRIPT_OR_DATA:R_,MUSTACHE_EXPR:E_,TMPLIT_EXPR:A_});const cs={element:1,text:3,progressingInstruction:7,comment:8,document:9},P_=function(){return typeof window>"u"?null:window},L_=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(s=e.getAttribute(i));const r="dompurify"+(s?"#"+s:"");try{return t.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},ic=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Td(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P_();const t=q=>Td(q);if(t.version="3.3.1",t.removed=[],!n||!n.document||n.document.nodeType!==cs.document||!n.Element)return t.isSupported=!1,t;let{document:e}=n;const s=e,i=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:u,DOMParser:h,trustedTypes:f}=n,g=l.prototype,p=ls(g,"cloneNode"),m=ls(g,"remove"),b=ls(g,"nextSibling"),v=ls(g,"childNodes"),w=ls(g,"parentNode");if(typeof o=="function"){const q=e.createElement("template");q.content&&q.content.ownerDocument&&(e=q.content.ownerDocument)}let k,A="";const{implementation:C,createNodeIterator:E,createDocumentFragment:y,getElementsByTagName:_}=e,{importNode:S}=s;let T=ic();t.isSupported=typeof kd=="function"&&typeof w=="function"&&C&&C.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:P,ERB_EXPR:B,TMPLIT_EXPR:N,DATA_ATTR:O,ARIA_ATTR:R,IS_SCRIPT_OR_DATA:I,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:M}=sc;let{IS_ALLOWED_URI:z}=sc,D=null;const H=it({},[...Zl,...Ir,...Mr,...Pr,...tc]);let $=null;const Q=it({},[...ec,...Lr,...nc,...wi]);let W=Object.seal(lo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),st=null,kt=null;const X=Object.seal(lo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let tt=!0,et=!0,K=!1,dt=!0,ht=!1,ft=!0,at=!1,nt=!1,Pt=!1,rt=!1,gt=!1,St=!1,Oe=!0,ie=!1;const en="user-content-";let Lt=!0,Wt=!1,_t={},vt=null;const re=it({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let An=null;const Xn=it({},["audio","video","img","source","image","track"]);let xe=null;const oe=it({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ke="http://www.w3.org/1998/Math/MathML",nn="http://www.w3.org/2000/svg",Re="http://www.w3.org/1999/xhtml";let Cn=Re,sr=!1,ir=null;const yu=it({},[ke,nn,Re],Or);let Qs=it({},["mi","mo","mn","ms","mtext"]),Zs=it({},["annotation-xml"]);const bu=it({},["title","style","font","a","script"]);let Qn=null;const _u=["application/xhtml+xml","text/html"],vu="text/html";let Bt=null,On=null;const wu=e.createElement("form"),qo=function(x){return x instanceof RegExp||x instanceof Function},rr=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(On&&On===x)){if((!x||typeof x!="object")&&(x={}),x=Te(x),Qn=_u.indexOf(x.PARSER_MEDIA_TYPE)===-1?vu:x.PARSER_MEDIA_TYPE,Bt=Qn==="application/xhtml+xml"?Or:Mi,D=pe(x,"ALLOWED_TAGS")?it({},x.ALLOWED_TAGS,Bt):H,$=pe(x,"ALLOWED_ATTR")?it({},x.ALLOWED_ATTR,Bt):Q,ir=pe(x,"ALLOWED_NAMESPACES")?it({},x.ALLOWED_NAMESPACES,Or):yu,xe=pe(x,"ADD_URI_SAFE_ATTR")?it(Te(oe),x.ADD_URI_SAFE_ATTR,Bt):oe,An=pe(x,"ADD_DATA_URI_TAGS")?it(Te(Xn),x.ADD_DATA_URI_TAGS,Bt):Xn,vt=pe(x,"FORBID_CONTENTS")?it({},x.FORBID_CONTENTS,Bt):re,st=pe(x,"FORBID_TAGS")?it({},x.FORBID_TAGS,Bt):Te({}),kt=pe(x,"FORBID_ATTR")?it({},x.FORBID_ATTR,Bt):Te({}),_t=pe(x,"USE_PROFILES")?x.USE_PROFILES:!1,tt=x.ALLOW_ARIA_ATTR!==!1,et=x.ALLOW_DATA_ATTR!==!1,K=x.ALLOW_UNKNOWN_PROTOCOLS||!1,dt=x.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ht=x.SAFE_FOR_TEMPLATES||!1,ft=x.SAFE_FOR_XML!==!1,at=x.WHOLE_DOCUMENT||!1,rt=x.RETURN_DOM||!1,gt=x.RETURN_DOM_FRAGMENT||!1,St=x.RETURN_TRUSTED_TYPE||!1,Pt=x.FORCE_BODY||!1,Oe=x.SANITIZE_DOM!==!1,ie=x.SANITIZE_NAMED_PROPS||!1,Lt=x.KEEP_CONTENT!==!1,Wt=x.IN_PLACE||!1,z=x.ALLOWED_URI_REGEXP||Sd,Cn=x.NAMESPACE||Re,Qs=x.MATHML_TEXT_INTEGRATION_POINTS||Qs,Zs=x.HTML_INTEGRATION_POINTS||Zs,W=x.CUSTOM_ELEMENT_HANDLING||{},x.CUSTOM_ELEMENT_HANDLING&&qo(x.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=x.CUSTOM_ELEMENT_HANDLING.tagNameCheck),x.CUSTOM_ELEMENT_HANDLING&&qo(x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=x.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),x.CUSTOM_ELEMENT_HANDLING&&typeof x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(W.allowCustomizedBuiltInElements=x.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ht&&(et=!1),gt&&(rt=!0),_t&&(D=it({},tc),$=[],_t.html===!0&&(it(D,Zl),it($,ec)),_t.svg===!0&&(it(D,Ir),it($,Lr),it($,wi)),_t.svgFilters===!0&&(it(D,Mr),it($,Lr),it($,wi)),_t.mathMl===!0&&(it(D,Pr),it($,nc),it($,wi))),x.ADD_TAGS&&(typeof x.ADD_TAGS=="function"?X.tagCheck=x.ADD_TAGS:(D===H&&(D=Te(D)),it(D,x.ADD_TAGS,Bt))),x.ADD_ATTR&&(typeof x.ADD_ATTR=="function"?X.attributeCheck=x.ADD_ATTR:($===Q&&($=Te($)),it($,x.ADD_ATTR,Bt))),x.ADD_URI_SAFE_ATTR&&it(xe,x.ADD_URI_SAFE_ATTR,Bt),x.FORBID_CONTENTS&&(vt===re&&(vt=Te(vt)),it(vt,x.FORBID_CONTENTS,Bt)),x.ADD_FORBID_CONTENTS&&(vt===re&&(vt=Te(vt)),it(vt,x.ADD_FORBID_CONTENTS,Bt)),Lt&&(D["#text"]=!0),at&&it(D,["html","head","body"]),D.table&&(it(D,["tbody"]),delete st.tbody),x.TRUSTED_TYPES_POLICY){if(typeof x.TRUSTED_TYPES_POLICY.createHTML!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof x.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');k=x.TRUSTED_TYPES_POLICY,A=k.createHTML("")}else k===void 0&&(k=L_(f,i)),k!==null&&typeof A=="string"&&(A=k.createHTML(""));Xt&&Xt(x),On=x}},Yo=it({},[...Ir,...Mr,...k_]),Ko=it({},[...Pr,...S_]),xu=function(x){let j=w(x);(!j||!j.tagName)&&(j={namespaceURI:Cn,tagName:"template"});const V=Mi(x.tagName),Et=Mi(j.tagName);return ir[x.namespaceURI]?x.namespaceURI===nn?j.namespaceURI===Re?V==="svg":j.namespaceURI===ke?V==="svg"&&(Et==="annotation-xml"||Qs[Et]):!!Yo[V]:x.namespaceURI===ke?j.namespaceURI===Re?V==="math":j.namespaceURI===nn?V==="math"&&Zs[Et]:!!Ko[V]:x.namespaceURI===Re?j.namespaceURI===nn&&!Zs[Et]||j.namespaceURI===ke&&!Qs[Et]?!1:!Ko[V]&&(bu[V]||!Yo[V]):!!(Qn==="application/xhtml+xml"&&ir[x.namespaceURI]):!1},Se=function(x){rs(t.removed,{element:x});try{w(x).removeChild(x)}catch{m(x)}},sn=function(x,j){try{rs(t.removed,{attribute:j.getAttributeNode(x),from:j})}catch{rs(t.removed,{attribute:null,from:j})}if(j.removeAttribute(x),x==="is")if(rt||gt)try{Se(j)}catch{}else try{j.setAttribute(x,"")}catch{}},Jo=function(x){let j=null,V=null;if(Pt)x="<remove></remove>"+x;else{const Dt=Rr(x,/^[\r\n\t ]+/);V=Dt&&Dt[0]}Qn==="application/xhtml+xml"&&Cn===Re&&(x='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+x+"</body></html>");const Et=k?k.createHTML(x):x;if(Cn===Re)try{j=new h().parseFromString(Et,Qn)}catch{}if(!j||!j.documentElement){j=C.createDocument(Cn,"template",null);try{j.documentElement.innerHTML=sr?A:Et}catch{}}const Vt=j.body||j.documentElement;return x&&V&&Vt.insertBefore(e.createTextNode(V),Vt.childNodes[0]||null),Cn===Re?_.call(j,at?"html":"body")[0]:at?j.documentElement:Vt},Xo=function(x){return E.call(x.ownerDocument||x,x,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},or=function(x){return x instanceof u&&(typeof x.nodeName!="string"||typeof x.textContent!="string"||typeof x.removeChild!="function"||!(x.attributes instanceof d)||typeof x.removeAttribute!="function"||typeof x.setAttribute!="function"||typeof x.namespaceURI!="string"||typeof x.insertBefore!="function"||typeof x.hasChildNodes!="function")},Qo=function(x){return typeof a=="function"&&x instanceof a};function Ie(q,x,j){vi(q,V=>{V.call(t,x,j,On)})}const Zo=function(x){let j=null;if(Ie(T.beforeSanitizeElements,x,null),or(x))return Se(x),!0;const V=Bt(x.nodeName);if(Ie(T.uponSanitizeElement,x,{tagName:V,allowedTags:D}),ft&&x.hasChildNodes()&&!Qo(x.firstElementChild)&&Jt(/<[/\w!]/g,x.innerHTML)&&Jt(/<[/\w!]/g,x.textContent)||x.nodeType===cs.progressingInstruction||ft&&x.nodeType===cs.comment&&Jt(/<[/\w]/g,x.data))return Se(x),!0;if(!(X.tagCheck instanceof Function&&X.tagCheck(V))&&(!D[V]||st[V])){if(!st[V]&&ea(V)&&(W.tagNameCheck instanceof RegExp&&Jt(W.tagNameCheck,V)||W.tagNameCheck instanceof Function&&W.tagNameCheck(V)))return!1;if(Lt&&!vt[V]){const Et=w(x)||x.parentNode,Vt=v(x)||x.childNodes;if(Vt&&Et){const Dt=Vt.length;for(let ee=Dt-1;ee>=0;--ee){const Me=p(Vt[ee],!0);Me.__removalCount=(x.__removalCount||0)+1,Et.insertBefore(Me,b(x))}}}return Se(x),!0}return x instanceof l&&!xu(x)||(V==="noscript"||V==="noembed"||V==="noframes")&&Jt(/<\/no(script|embed|frames)/i,x.innerHTML)?(Se(x),!0):(ht&&x.nodeType===cs.text&&(j=x.textContent,vi([P,B,N],Et=>{j=os(j,Et," ")}),x.textContent!==j&&(rs(t.removed,{element:x.cloneNode()}),x.textContent=j)),Ie(T.afterSanitizeElements,x,null),!1)},ta=function(x,j,V){if(Oe&&(j==="id"||j==="name")&&(V in e||V in wu))return!1;if(!(et&&!kt[j]&&Jt(O,j))){if(!(tt&&Jt(R,j))){if(!(X.attributeCheck instanceof Function&&X.attributeCheck(j,x))){if(!$[j]||kt[j]){if(!(ea(x)&&(W.tagNameCheck instanceof RegExp&&Jt(W.tagNameCheck,x)||W.tagNameCheck instanceof Function&&W.tagNameCheck(x))&&(W.attributeNameCheck instanceof RegExp&&Jt(W.attributeNameCheck,j)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(j,x))||j==="is"&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&Jt(W.tagNameCheck,V)||W.tagNameCheck instanceof Function&&W.tagNameCheck(V))))return!1}else if(!xe[j]){if(!Jt(z,os(V,L,""))){if(!((j==="src"||j==="xlink:href"||j==="href")&&x!=="script"&&__(V,"data:")===0&&An[x])){if(!(K&&!Jt(I,os(V,L,"")))){if(V)return!1}}}}}}}return!0},ea=function(x){return x!=="annotation-xml"&&Rr(x,M)},na=function(x){Ie(T.beforeSanitizeAttributes,x,null);const{attributes:j}=x;if(!j||or(x))return;const V={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$,forceKeepAttr:void 0};let Et=j.length;for(;Et--;){const Vt=j[Et],{name:Dt,namespaceURI:ee,value:Me}=Vt,Rn=Bt(Dt),ar=Me;let Ut=Dt==="value"?ar:v_(ar);if(V.attrName=Rn,V.attrValue=Ut,V.keepAttr=!0,V.forceKeepAttr=void 0,Ie(T.uponSanitizeAttribute,x,V),Ut=V.attrValue,ie&&(Rn==="id"||Rn==="name")&&(sn(Dt,x),Ut=en+Ut),ft&&Jt(/((--!?|])>)|<\/(style|title|textarea)/i,Ut)){sn(Dt,x);continue}if(Rn==="attributename"&&Rr(Ut,"href")){sn(Dt,x);continue}if(V.forceKeepAttr)continue;if(!V.keepAttr){sn(Dt,x);continue}if(!dt&&Jt(/\/>/i,Ut)){sn(Dt,x);continue}ht&&vi([P,B,N],ia=>{Ut=os(Ut,ia," ")});const sa=Bt(x.nodeName);if(!ta(sa,Rn,Ut)){sn(Dt,x);continue}if(k&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!ee)switch(f.getAttributeType(sa,Rn)){case"TrustedHTML":{Ut=k.createHTML(Ut);break}case"TrustedScriptURL":{Ut=k.createScriptURL(Ut);break}}if(Ut!==ar)try{ee?x.setAttributeNS(ee,Dt,Ut):x.setAttribute(Dt,Ut),or(x)?Se(x):Ql(t.removed)}catch{sn(Dt,x)}}Ie(T.afterSanitizeAttributes,x,null)},ku=function q(x){let j=null;const V=Xo(x);for(Ie(T.beforeSanitizeShadowDOM,x,null);j=V.nextNode();)Ie(T.uponSanitizeShadowNode,j,null),Zo(j),na(j),j.content instanceof r&&q(j.content);Ie(T.afterSanitizeShadowDOM,x,null)};return t.sanitize=function(q){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=null,V=null,Et=null,Vt=null;if(sr=!q,sr&&(q="<!-->"),typeof q!="string"&&!Qo(q))if(typeof q.toString=="function"){if(q=q.toString(),typeof q!="string")throw as("dirty is not a string, aborting")}else throw as("toString is not a function");if(!t.isSupported)return q;if(nt||rr(x),t.removed=[],typeof q=="string"&&(Wt=!1),Wt){if(q.nodeName){const Me=Bt(q.nodeName);if(!D[Me]||st[Me])throw as("root node is forbidden and cannot be sanitized in-place")}}else if(q instanceof a)j=Jo("<!---->"),V=j.ownerDocument.importNode(q,!0),V.nodeType===cs.element&&V.nodeName==="BODY"||V.nodeName==="HTML"?j=V:j.appendChild(V);else{if(!rt&&!ht&&!at&&q.indexOf("<")===-1)return k&&St?k.createHTML(q):q;if(j=Jo(q),!j)return rt?null:St?A:""}j&&Pt&&Se(j.firstChild);const Dt=Xo(Wt?q:j);for(;Et=Dt.nextNode();)Zo(Et),na(Et),Et.content instanceof r&&ku(Et.content);if(Wt)return q;if(rt){if(gt)for(Vt=y.call(j.ownerDocument);j.firstChild;)Vt.appendChild(j.firstChild);else Vt=j;return($.shadowroot||$.shadowrootmode)&&(Vt=S.call(s,Vt,!0)),Vt}let ee=at?j.outerHTML:j.innerHTML;return at&&D["!doctype"]&&j.ownerDocument&&j.ownerDocument.doctype&&j.ownerDocument.doctype.name&&Jt(Ed,j.ownerDocument.doctype.name)&&(ee="<!DOCTYPE "+j.ownerDocument.doctype.name+`>
`+ee),ht&&vi([P,B,N],Me=>{ee=os(ee,Me," ")}),k&&St?k.createHTML(ee):ee},t.setConfig=function(){let q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rr(q),nt=!0},t.clearConfig=function(){On=null,nt=!1},t.isValidAttribute=function(q,x,j){On||rr({});const V=Bt(q),Et=Bt(x);return ta(V,Et,j)},t.addHook=function(q,x){typeof x=="function"&&rs(T[q],x)},t.removeHook=function(q,x){if(x!==void 0){const j=y_(T[q],x);return j===-1?void 0:b_(T[q],j,1)[0]}return Ql(T[q])},t.removeHooks=function(q){T[q]=[]},t.removeAllHooks=function(){T=ic()},t}var D_=Td();function xt(n){return Math.round(n).toLocaleString()}function $_(n,t){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>n(...s),t)}}function Zt(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}function Po(n){return D_.sanitize(n,{ALLOWED_TAGS:["p","br","strong","em","b","i","ul","ol","li","h1","h2","h3","h4","code","pre","blockquote","a","span","div"],ALLOWED_ATTR:["href","target","class"],ALLOW_DATA_ATTR:!1})}function te(n,t="info",e=3e3){const s=document.getElementById("toastContainer"),i=document.createElement("div");i.className=`toast ${t}`;const r={success:"?",error:"?",info:"i"};i.innerHTML=`
        <span>${r[t]||r.info}</span>
        <span>${Zt(n)}</span>
    `,s.appendChild(i),setTimeout(()=>{i.classList.add("toast-exit"),setTimeout(()=>i.remove(),300)},e)}function B_(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/flow/sw.js").then(n=>console.log("[PWA] Service worker registered")).catch(n=>console.log("[PWA] Service worker registration failed:",n))})}let bs;function N_(){window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),bs=n,localStorage.getItem("pwa_install_dismissed")||setTimeout(()=>{document.getElementById("installBanner").style.display="flex"},3e3)})}function j_(){bs&&(bs.prompt(),bs.userChoice.then(n=>{n.outcome==="accepted"&&console.log("[PWA] User accepted install"),bs=null,document.getElementById("installBanner").style.display="none"}))}function F_(){document.getElementById("installBanner").style.display="none",localStorage.setItem("pwa_install_dismissed","true")}function U_(){const n=localStorage.getItem("fact_dark_mode"),t=document.getElementById("themeToggle");n==="true"?(document.body.classList.add("dark-mode"),t.classList.add("dark")):n==="false"?(document.body.classList.remove("dark-mode"),t.classList.remove("dark")):window.matchMedia("(prefers-color-scheme: dark)").matches&&t.classList.add("dark")}function z_(){const n=document.body,t=document.getElementById("themeToggle");n.classList.contains("dark-mode")?(n.classList.remove("dark-mode"),t.classList.remove("dark"),localStorage.setItem("fact_dark_mode","false")):(n.classList.add("dark-mode"),t.classList.add("dark"),localStorage.setItem("fact_dark_mode","true"))}const Ad=[{id:"qnb",name:"QNB (Qatar National Bank)",icon:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>',supported:!0},{id:"other",name:"Other banks",icon:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>',supported:!1}];let Xe=0;const ho=["welcome","bank","key","shortcut","test","done"];async function H_(n){try{const{data:t}=await n.auth.getSession();if(!(t!=null&&t.session))return;const e=t.session.user.id,[s,i]=await Promise.all([n.from("raw_ledger").select("id",{count:"exact",head:!0}).eq("user_id",e),n.from("user_keys").select("id",{count:"exact",head:!0}).eq("user_id",e).is("revoked_at",null)]),r=(s.count||0)>0,o=(i.count||0)>0;!r&&!o&&Cd()}catch{}}function Cd(){Xe=0,Lo(),document.getElementById("onboardingModal").classList.remove("hidden")}function Od(){document.getElementById("onboardingModal").classList.add("hidden")}function W_(){if(Xe===ho.length-1){Od();return}Xe++,Lo()}function V_(){Xe>0&&(Xe--,Lo())}function Lo(n){const t=ho[Xe],e=document.getElementById("onboardingContent"),s=document.getElementById("onboardingProgress"),i=document.getElementById("onboardingBack"),r=document.getElementById("onboardingNext"),o=(Xe+1)/ho.length*100;s.style.width=o+"%",i.classList.toggle("hidden",Xe===0);const a="",l="";t==="welcome"?(r.textContent="Get Started",e.innerHTML=`
            <div class="flex-1 flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center bg-[#0a0a0a]">
                    <img src="icon-512.png" alt="FACT/Flow" class="w-12 h-12 object-contain">
                </div>
                <h2 class="font-display font-bold text-xl">Welcome to FACT/Flow</h2>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted max-w-xs">
                    Let's set up automatic transaction tracking. Your bank SMS messages will be securely parsed and categorized.
                </p>
                <div class="flex items-center gap-2 text-xs text-fact-green">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                    <span>End-to-end encrypted. Your data stays yours.</span>
                </div>
            </div>`):t==="bank"?(r.textContent="Next",e.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Select Your Bank</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">Choose the bank whose SMS alerts you want to track.</p>
            <div class="space-y-3 flex-1">
                ${Ad.map(c=>`
                    <button onclick="selectOnboardingBank('${c.id}')" id="bankOpt_${c.id}"
                        class="w-full flex items-center gap-3 p-4 border-2 rounded-xl transition text-left
                            ${c.id==="qnb"?"border-fact-yellow bg-fact-yellow/5":"border-fact-border dark:border-fact-dark-border"}
                            ${c.supported?"hover:border-fact-yellow cursor-pointer":"opacity-50"}">
                        <div class="w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center flex-shrink-0">
                            ${c.icon}
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-sm">${c.name}</div>
                            ${c.supported?'<div class="text-xs text-fact-green">Supported</div>':'<div class="text-xs text-fact-muted">Coming soon</div>'}
                        </div>
                        ${c.id==="qnb"?'<svg class="w-5 h-5 text-fact-yellow flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>':""}
                    </button>
                `).join("")}
            </div>`):t==="key"?(r.textContent="Next",e.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Generate Your API Key</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">This key connects your iOS Shortcut to FACT/Flow securely.</p>
            <div class="flex-1 space-y-4">
                <button onclick="onboardingGenerateKey()" id="onboardingGenKeyBtn"
                    class="w-full px-4 py-3 text-sm bg-fact-ink dark:bg-white text-white dark:text-fact-ink rounded-xl font-medium hover:opacity-90 transition min-h-[48px]">
                    Generate API Key
                </button>
                <div id="onboardingKeyResult" class="hidden space-y-3">
                    <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl">
                        <label class="block text-xs font-medium text-fact-muted dark:text-fact-dark-muted mb-1">Your API Key</label>
                        <div class="flex items-center gap-2">
                            <input type="text" id="onboardingKeyValue" readonly
                                class="flex-1 text-xs font-mono bg-transparent border-none focus:outline-none select-all">
                            <button onclick="copyOnboardingKey()" class="px-3 py-1.5 text-xs bg-fact-yellow text-fact-ink rounded-lg font-medium hover:opacity-80 transition">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="flex items-start gap-2 text-xs text-fact-muted dark:text-fact-dark-muted">
                        <svg class="w-4 h-4 text-fact-yellow flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>Save this key somewhere safe. You'll paste it into the iOS Shortcut in the next step.</span>
                    </div>
                </div>
                <p id="onboardingKeyStatus" class="text-xs text-fact-muted dark:text-fact-dark-muted"></p>
            </div>`):t==="shortcut"?(r.textContent="Next",e.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Install the iOS Shortcut</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">The Shortcut sends your bank SMS messages to FACT/Flow automatically.</p>
            <div class="flex-1 space-y-4">
                <ol class="space-y-3 text-sm">
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">1</span>
                        <span>Tap the button below to open the Shortcut template on your iPhone.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">2</span>
                        <span>Tap <strong>"Add Shortcut"</strong> when prompted.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">3</span>
                        <span>Edit the Shortcut and paste your <strong>API Key</strong> and <strong>Supabase URL</strong> into the text fields.</span>
                    </li>
                </ol>
                <a href="${l}" target="_blank"
                    class="inline-flex items-center justify-center w-full px-4 py-3 text-sm bg-fact-ink dark:bg-white text-white dark:text-fact-ink rounded-xl font-medium hover:opacity-90 transition min-h-[48px]">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Get Shortcut Template
                </a>
                <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl">
                    <label class="block text-xs font-medium text-fact-muted dark:text-fact-dark-muted mb-1">Supabase URL (paste into Shortcut)</label>
                    <div class="flex items-center gap-2">
                        <input type="text" value="${a}/flow-sms" readonly
                            class="flex-1 text-xs font-mono bg-transparent border-none focus:outline-none select-all">
                        <button onclick="navigator.clipboard.writeText('${a}/flow-sms')" class="px-3 py-1.5 text-xs bg-fact-yellow text-fact-ink rounded-lg font-medium hover:opacity-80 transition">
                            Copy
                        </button>
                    </div>
                </div>
            </div>`):t==="test"?(r.textContent="Next",e.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Test Your Setup</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">Send a test to make sure everything is connected.</p>
            <div class="flex-1 space-y-4">
                <ol class="space-y-3 text-sm">
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">1</span>
                        <span>Open your <strong>Messages</strong> app on iPhone.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">2</span>
                        <span>Find a recent QNB bank SMS (purchase or transfer alert).</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">3</span>
                        <span>Long-press the message, tap <strong>Share</strong>, and choose the <strong>FACT/Flow</strong> Shortcut.</span>
                    </li>
                </ol>
                <div class="p-4 bg-fact-yellow/10 rounded-xl text-center">
                    <p class="text-sm font-medium">After sharing, refresh this page to see the transaction appear.</p>
                    <p class="text-xs text-fact-muted mt-1">You can skip this and test later.</p>
                </div>
            </div>`):t==="done"&&(r.textContent="Start Using FACT/Flow",e.innerHTML=`
            <div class="flex-1 flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-16 h-16 rounded-full bg-fact-green/20 flex items-center justify-center">
                    <svg class="w-8 h-8 text-fact-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <h2 class="font-display font-bold text-xl">You're All Set!</h2>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted max-w-xs">
                    Transactions will be tracked automatically whenever you share a bank SMS via the Shortcut.
                </p>
                <div class="space-y-2 text-xs text-fact-muted dark:text-fact-dark-muted">
                    <p>You can always access setup again from <strong>Settings</strong>.</p>
                </div>
            </div>`)}function G_(n){Ad.forEach(t=>{const e=document.getElementById("bankOpt_"+t.id);e&&(e.classList.toggle("border-fact-yellow",t.id===n),e.classList.toggle("bg-fact-yellow/5",t.id===n),e.classList.toggle("border-fact-border",t.id!==n),e.classList.toggle("dark:border-fact-dark-border",t.id!==n))})}async function q_(n,t){var i;const e=document.getElementById("onboardingGenKeyBtn"),s=document.getElementById("onboardingKeyStatus");e.textContent="Generating...",e.disabled=!0;try{const{data:r}=await n.auth.getSession(),o=(i=r==null?void 0:r.session)==null?void 0:i.access_token;if(!o)throw new Error("Not authenticated");const l=await(await fetch(`${t.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({action:"create"})})).json();if(l.error)throw new Error(l.error);localStorage.setItem("fact_shortcut_key_id",l.keyId||""),document.getElementById("onboardingKeyValue").value=l.key,document.getElementById("onboardingKeyResult").classList.remove("hidden"),e.classList.add("hidden"),s.textContent=""}catch(r){s.textContent="Error: "+r.message,e.textContent="Generate API Key",e.disabled=!1}}function Y_(){const n=document.getElementById("onboardingKeyValue");navigator.clipboard.writeText(n.value);const t=n.parentElement.querySelector("button");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},1500)}var K_={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,t){((e,s)=>{n.exports=s()})(Mo,function e(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},i,r=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,a={},l=0,c={};function d(y){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(_){var S=A(_);S.chunkSize=parseInt(S.chunkSize),_.step||_.chunk||(S.chunkSize=null),this._handle=new p(S),(this._handle.streamer=this)._config=S}).call(this,y),this.parseChunk=function(_,S){var T=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<T){let B=this._config.newline;B||(P=this._config.quoteChar||'"',B=this._handle.guessLineEndings(_,P)),_=[..._.split(B).slice(T)].join(B)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&(P=this._config.beforeFirstChunk(_))!==void 0&&(_=P),this.isFirstChunk=!1,this._halted=!1;var T=this._partialLine+_,P=(this._partialLine="",this._handle.parse(T,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(_=P.meta.cursor,T=(this._finished||(this._partialLine=T.substring(_-this._baseIndex),this._baseIndex=_),P&&P.data&&(this._rowCount+=P.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:P,workerId:c.WORKER_ID,finished:T});else if(E(this._config.chunk)&&!S){if(this._config.chunk(P,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=P=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(P.data),this._completeResults.errors=this._completeResults.errors.concat(P.errors),this._completeResults.meta=P.meta),this._completed||!T||!E(this._config.complete)||P&&P.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),T||P&&P.meta.paused||this._nextChunk(),P}this._halted=!0},this._sendError=function(_){E(this._config.error)?this._config.error(_):o&&this._config.error&&s.postMessage({workerId:c.WORKER_ID,error:_,finished:!1})}}function u(y){var _;(y=y||{}).chunkSize||(y.chunkSize=c.RemoteChunkSize),d.call(this,y),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(S){this._input=S,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(_=new XMLHttpRequest,this._config.withCredentials&&(_.withCredentials=this._config.withCredentials),r||(_.onload=C(this._chunkLoaded,this),_.onerror=C(this._chunkError,this)),_.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var S,T=this._config.downloadRequestHeaders;for(S in T)_.setRequestHeader(S,T[S])}var P;this._config.chunkSize&&(P=this._start+this._config.chunkSize-1,_.setRequestHeader("Range","bytes="+this._start+"-"+P));try{_.send(this._config.downloadRequestBody)}catch(B){this._chunkError(B.message)}r&&_.status===0&&this._chunkError()}},this._chunkLoaded=function(){_.readyState===4&&(_.status<200||400<=_.status?this._chunkError():(this._start+=this._config.chunkSize||_.responseText.length,this._finished=!this._config.chunkSize||this._start>=(S=>(S=S.getResponseHeader("Content-Range"))!==null?parseInt(S.substring(S.lastIndexOf("/")+1)):-1)(_),this.parseChunk(_.responseText)))},this._chunkError=function(S){S=_.statusText||S,this._sendError(new Error(S))}}function h(y){(y=y||{}).chunkSize||(y.chunkSize=c.LocalChunkSize),d.call(this,y);var _,S,T=typeof FileReader<"u";this.stream=function(P){this._input=P,S=P.slice||P.webkitSlice||P.mozSlice,T?((_=new FileReader).onload=C(this._chunkLoaded,this),_.onerror=C(this._chunkError,this)):_=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var P=this._input,B=(this._config.chunkSize&&(B=Math.min(this._start+this._config.chunkSize,this._input.size),P=S.call(P,this._start,B)),_.readAsText(P,this._config.encoding));T||this._chunkLoaded({target:{result:B}})},this._chunkLoaded=function(P){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(P.target.result)},this._chunkError=function(){this._sendError(_.error)}}function f(y){var _;d.call(this,y=y||{}),this.stream=function(S){return _=S,this._nextChunk()},this._nextChunk=function(){var S,T;if(!this._finished)return S=this._config.chunkSize,_=S?(T=_.substring(0,S),_.substring(S)):(T=_,""),this._finished=!_,this.parseChunk(T)}}function g(y){d.call(this,y=y||{});var _=[],S=!0,T=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(P){this._input=P,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){T&&_.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),_.length?this.parseChunk(_.shift()):S=!0},this._streamData=C(function(P){try{_.push(typeof P=="string"?P:P.toString(this._config.encoding)),S&&(S=!1,this._checkIsFinished(),this.parseChunk(_.shift()))}catch(B){this._streamError(B)}},this),this._streamError=C(function(P){this._streamCleanUp(),this._sendError(P)},this),this._streamEnd=C(function(){this._streamCleanUp(),T=!0,this._streamData("")},this),this._streamCleanUp=C(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function p(y){var _,S,T,P,B=Math.pow(2,53),N=-B,O=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,R=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,I=this,L=0,M=0,z=!1,D=!1,H=[],$={data:[],errors:[],meta:{}};function Q(X){return y.skipEmptyLines==="greedy"?X.join("").trim()==="":X.length===1&&X[0].length===0}function W(){if($&&T&&(kt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),T=!1),y.skipEmptyLines&&($.data=$.data.filter(function(dt){return!Q(dt)})),st()){let dt=function(ht,ft){E(y.transformHeader)&&(ht=y.transformHeader(ht,ft)),H.push(ht)};var K=dt;if($)if(Array.isArray($.data[0])){for(var X=0;st()&&X<$.data.length;X++)$.data[X].forEach(dt);$.data.splice(0,1)}else $.data.forEach(dt)}function tt(dt,ht){for(var ft=y.header?{}:[],at=0;at<dt.length;at++){var nt=at,Pt=dt[at],Pt=((rt,gt)=>(St=>(y.dynamicTypingFunction&&y.dynamicTyping[St]===void 0&&(y.dynamicTyping[St]=y.dynamicTypingFunction(St)),(y.dynamicTyping[St]||y.dynamicTyping)===!0))(rt)?gt==="true"||gt==="TRUE"||gt!=="false"&&gt!=="FALSE"&&((St=>{if(O.test(St)&&(St=parseFloat(St),N<St&&St<B))return 1})(gt)?parseFloat(gt):R.test(gt)?new Date(gt):gt===""?null:gt):gt)(nt=y.header?at>=H.length?"__parsed_extra":H[at]:nt,Pt=y.transform?y.transform(Pt,nt):Pt);nt==="__parsed_extra"?(ft[nt]=ft[nt]||[],ft[nt].push(Pt)):ft[nt]=Pt}return y.header&&(at>H.length?kt("FieldMismatch","TooManyFields","Too many fields: expected "+H.length+" fields but parsed "+at,M+ht):at<H.length&&kt("FieldMismatch","TooFewFields","Too few fields: expected "+H.length+" fields but parsed "+at,M+ht)),ft}var et;$&&(y.header||y.dynamicTyping||y.transform)&&(et=1,!$.data.length||Array.isArray($.data[0])?($.data=$.data.map(tt),et=$.data.length):$.data=tt($.data,0),y.header&&$.meta&&($.meta.fields=H),M+=et)}function st(){return y.header&&H.length===0}function kt(X,tt,et,K){X={type:X,code:tt,message:et},K!==void 0&&(X.row=K),$.errors.push(X)}E(y.step)&&(P=y.step,y.step=function(X){$=X,st()?W():(W(),$.data.length!==0&&(L+=X.data.length,y.preview&&L>y.preview?S.abort():($.data=$.data[0],P($,I))))}),this.parse=function(X,tt,et){var K=y.quoteChar||'"',K=(y.newline||(y.newline=this.guessLineEndings(X,K)),T=!1,y.delimiter?E(y.delimiter)&&(y.delimiter=y.delimiter(X),$.meta.delimiter=y.delimiter):((K=((dt,ht,ft,at,nt)=>{var Pt,rt,gt,St;nt=nt||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Oe=0;Oe<nt.length;Oe++){for(var ie,en=nt[Oe],Lt=0,Wt=0,_t=0,vt=(gt=void 0,new b({comments:at,delimiter:en,newline:ht,preview:10}).parse(dt)),re=0;re<vt.data.length;re++)ft&&Q(vt.data[re])?_t++:(ie=vt.data[re].length,Wt+=ie,gt===void 0?gt=ie:0<ie&&(Lt+=Math.abs(ie-gt),gt=ie));0<vt.data.length&&(Wt/=vt.data.length-_t),(rt===void 0||Lt<=rt)&&(St===void 0||St<Wt)&&1.99<Wt&&(rt=Lt,Pt=en,St=Wt)}return{successful:!!(y.delimiter=Pt),bestDelimiter:Pt}})(X,y.newline,y.skipEmptyLines,y.comments,y.delimitersToGuess)).successful?y.delimiter=K.bestDelimiter:(T=!0,y.delimiter=c.DefaultDelimiter),$.meta.delimiter=y.delimiter),A(y));return y.preview&&y.header&&K.preview++,_=X,S=new b(K),$=S.parse(_,tt,et),W(),z?{meta:{paused:!0}}:$||{meta:{paused:!1}}},this.paused=function(){return z},this.pause=function(){z=!0,S.abort(),_=E(y.chunk)?"":_.substring(S.getCharIndex())},this.resume=function(){I.streamer._halted?(z=!1,I.streamer.parseChunk(_,!0)):setTimeout(I.resume,3)},this.aborted=function(){return D},this.abort=function(){D=!0,S.abort(),$.meta.aborted=!0,E(y.complete)&&y.complete($),_=""},this.guessLineEndings=function(dt,K){dt=dt.substring(0,1048576);var K=new RegExp(m(K)+"([^]*?)"+m(K),"gm"),et=(dt=dt.replace(K,"")).split("\r"),K=dt.split(`
`),dt=1<K.length&&K[0].length<et[0].length;if(et.length===1||dt)return`
`;for(var ht=0,ft=0;ft<et.length;ft++)et[ft][0]===`
`&&ht++;return ht>=et.length/2?`\r
`:"\r"}}function m(y){return y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(y){var _=(y=y||{}).delimiter,S=y.newline,T=y.comments,P=y.step,B=y.preview,N=y.fastMode,O=null,R=!1,I=y.quoteChar==null?'"':y.quoteChar,L=I;if(y.escapeChar!==void 0&&(L=y.escapeChar),(typeof _!="string"||-1<c.BAD_DELIMITERS.indexOf(_))&&(_=","),T===_)throw new Error("Comment character same as delimiter");T===!0?T="#":(typeof T!="string"||-1<c.BAD_DELIMITERS.indexOf(T))&&(T=!1),S!==`
`&&S!=="\r"&&S!==`\r
`&&(S=`
`);var M=0,z=!1;this.parse=function(D,H,$){if(typeof D!="string")throw new Error("Input must be a string");var Q=D.length,W=_.length,st=S.length,kt=T.length,X=E(P),tt=[],et=[],K=[],dt=M=0;if(!D)return Lt();if(N||N!==!1&&D.indexOf(I)===-1){for(var ht=D.split(S),ft=0;ft<ht.length;ft++){if(K=ht[ft],M+=K.length,ft!==ht.length-1)M+=S.length;else if($)return Lt();if(!T||K.substring(0,kt)!==T){if(X){if(tt=[],St(K.split(_)),Wt(),z)return Lt()}else St(K.split(_));if(B&&B<=ft)return tt=tt.slice(0,B),Lt(!0)}}return Lt()}for(var at=D.indexOf(_,M),nt=D.indexOf(S,M),Pt=new RegExp(m(L)+m(I),"g"),rt=D.indexOf(I,M);;)if(D[M]===I)for(rt=M,M++;;){if((rt=D.indexOf(I,rt+1))===-1)return $||et.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:tt.length,index:M}),ie();if(rt===Q-1)return ie(D.substring(M,rt).replace(Pt,I));if(I===L&&D[rt+1]===L)rt++;else if(I===L||rt===0||D[rt-1]!==L){at!==-1&&at<rt+1&&(at=D.indexOf(_,rt+1));var gt=Oe((nt=nt!==-1&&nt<rt+1?D.indexOf(S,rt+1):nt)===-1?at:Math.min(at,nt));if(D.substr(rt+1+gt,W)===_){K.push(D.substring(M,rt).replace(Pt,I)),D[M=rt+1+gt+W]!==I&&(rt=D.indexOf(I,M)),at=D.indexOf(_,M),nt=D.indexOf(S,M);break}if(gt=Oe(nt),D.substring(rt+1+gt,rt+1+gt+st)===S){if(K.push(D.substring(M,rt).replace(Pt,I)),en(rt+1+gt+st),at=D.indexOf(_,M),rt=D.indexOf(I,M),X&&(Wt(),z))return Lt();if(B&&tt.length>=B)return Lt(!0);break}et.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:tt.length,index:M}),rt++}}else if(T&&K.length===0&&D.substring(M,M+kt)===T){if(nt===-1)return Lt();M=nt+st,nt=D.indexOf(S,M),at=D.indexOf(_,M)}else if(at!==-1&&(at<nt||nt===-1))K.push(D.substring(M,at)),M=at+W,at=D.indexOf(_,M);else{if(nt===-1)break;if(K.push(D.substring(M,nt)),en(nt+st),X&&(Wt(),z))return Lt();if(B&&tt.length>=B)return Lt(!0)}return ie();function St(_t){tt.push(_t),dt=M}function Oe(_t){var vt=0;return vt=_t!==-1&&(_t=D.substring(rt+1,_t))&&_t.trim()===""?_t.length:vt}function ie(_t){return $||(_t===void 0&&(_t=D.substring(M)),K.push(_t),M=Q,St(K),X&&Wt()),Lt()}function en(_t){M=_t,St(K),K=[],nt=D.indexOf(S,M)}function Lt(_t){if(y.header&&!H&&tt.length&&!R){var vt=tt[0],re=Object.create(null),An=new Set(vt);let Xn=!1;for(let xe=0;xe<vt.length;xe++){let oe=vt[xe];if(re[oe=E(y.transformHeader)?y.transformHeader(oe,xe):oe]){let ke,nn=re[oe];for(;ke=oe+"_"+nn,nn++,An.has(ke););An.add(ke),vt[xe]=ke,re[oe]++,Xn=!0,(O=O===null?{}:O)[ke]=oe}else re[oe]=1,vt[xe]=oe;An.add(oe)}Xn&&console.warn("Duplicate headers found and renamed."),R=!0}return{data:tt,errors:et,meta:{delimiter:_,linebreak:S,aborted:z,truncated:!!_t,cursor:dt+(H||0),renamedHeaders:O}}}function Wt(){P(Lt()),tt=[],et=[]}},this.abort=function(){z=!0},this.getCharIndex=function(){return M}}function v(y){var _=y.data,S=a[_.workerId],T=!1;if(_.error)S.userError(_.error,_.file);else if(_.results&&_.results.data){var P={abort:function(){T=!0,w(_.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:k,resume:k};if(E(S.userStep)){for(var B=0;B<_.results.data.length&&(S.userStep({data:_.results.data[B],errors:_.results.errors,meta:_.results.meta},P),!T);B++);delete _.results}else E(S.userChunk)&&(S.userChunk(_.results,P,_.file),delete _.results)}_.finished&&!T&&w(_.workerId,_.results)}function w(y,_){var S=a[y];E(S.userComplete)&&S.userComplete(_),S.terminate(),delete a[y]}function k(){throw new Error("Not implemented.")}function A(y){if(typeof y!="object"||y===null)return y;var _,S=Array.isArray(y)?[]:{};for(_ in y)S[_]=A(y[_]);return S}function C(y,_){return function(){y.apply(_,arguments)}}function E(y){return typeof y=="function"}return c.parse=function(y,_){var S=(_=_||{}).dynamicTyping||!1;if(E(S)&&(_.dynamicTypingFunction=S,S={}),_.dynamicTyping=S,_.transform=!!E(_.transform)&&_.transform,!_.worker||!c.WORKERS_SUPPORTED)return S=null,c.NODE_STREAM_INPUT,typeof y=="string"?(y=(T=>T.charCodeAt(0)!==65279?T:T.slice(1))(y),S=new(_.download?u:f)(_)):y.readable===!0&&E(y.read)&&E(y.on)?S=new g(_):(s.File&&y instanceof File||y instanceof Object)&&(S=new h(_)),S.stream(y);(S=(()=>{var T;return!!c.WORKERS_SUPPORTED&&(T=(()=>{var P=s.URL||s.webkitURL||null,B=e.toString();return c.BLOB_URL||(c.BLOB_URL=P.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",B,")();"],{type:"text/javascript"})))})(),(T=new s.Worker(T)).onmessage=v,T.id=l++,a[T.id]=T)})()).userStep=_.step,S.userChunk=_.chunk,S.userComplete=_.complete,S.userError=_.error,_.step=E(_.step),_.chunk=E(_.chunk),_.complete=E(_.complete),_.error=E(_.error),delete _.worker,S.postMessage({input:y,config:_,workerId:S.id})},c.unparse=function(y,_){var S=!1,T=!0,P=",",B=`\r
`,N='"',O=N+N,R=!1,I=null,L=!1,M=((()=>{if(typeof _=="object"){if(typeof _.delimiter!="string"||c.BAD_DELIMITERS.filter(function(H){return _.delimiter.indexOf(H)!==-1}).length||(P=_.delimiter),typeof _.quotes!="boolean"&&typeof _.quotes!="function"&&!Array.isArray(_.quotes)||(S=_.quotes),typeof _.skipEmptyLines!="boolean"&&typeof _.skipEmptyLines!="string"||(R=_.skipEmptyLines),typeof _.newline=="string"&&(B=_.newline),typeof _.quoteChar=="string"&&(N=_.quoteChar),typeof _.header=="boolean"&&(T=_.header),Array.isArray(_.columns)){if(_.columns.length===0)throw new Error("Option columns is empty");I=_.columns}_.escapeChar!==void 0&&(O=_.escapeChar+N),_.escapeFormulae instanceof RegExp?L=_.escapeFormulae:typeof _.escapeFormulae=="boolean"&&_.escapeFormulae&&(L=/^[=+\-@\t\r].*$/)}})(),new RegExp(m(N),"g"));if(typeof y=="string"&&(y=JSON.parse(y)),Array.isArray(y)){if(!y.length||Array.isArray(y[0]))return z(null,y,R);if(typeof y[0]=="object")return z(I||Object.keys(y[0]),y,R)}else if(typeof y=="object")return typeof y.data=="string"&&(y.data=JSON.parse(y.data)),Array.isArray(y.data)&&(y.fields||(y.fields=y.meta&&y.meta.fields||I),y.fields||(y.fields=Array.isArray(y.data[0])?y.fields:typeof y.data[0]=="object"?Object.keys(y.data[0]):[]),Array.isArray(y.data[0])||typeof y.data[0]=="object"||(y.data=[y.data])),z(y.fields||[],y.data||[],R);throw new Error("Unable to serialize unrecognized input");function z(H,$,Q){var W="",st=(typeof H=="string"&&(H=JSON.parse(H)),typeof $=="string"&&($=JSON.parse($)),Array.isArray(H)&&0<H.length),kt=!Array.isArray($[0]);if(st&&T){for(var X=0;X<H.length;X++)0<X&&(W+=P),W+=D(H[X],X);0<$.length&&(W+=B)}for(var tt=0;tt<$.length;tt++){var et=(st?H:$[tt]).length,K=!1,dt=st?Object.keys($[tt]).length===0:$[tt].length===0;if(Q&&!st&&(K=Q==="greedy"?$[tt].join("").trim()==="":$[tt].length===1&&$[tt][0].length===0),Q==="greedy"&&st){for(var ht=[],ft=0;ft<et;ft++){var at=kt?H[ft]:ft;ht.push($[tt][at])}K=ht.join("").trim()===""}if(!K){for(var nt=0;nt<et;nt++){0<nt&&!dt&&(W+=P);var Pt=st&&kt?H[nt]:nt;W+=D($[tt][Pt],nt)}tt<$.length-1&&(!Q||0<et&&!dt)&&(W+=B)}}return W}function D(H,$){var Q,W;return H==null?"":H.constructor===Date?JSON.stringify(H).slice(1,25):(W=!1,L&&typeof H=="string"&&L.test(H)&&(H="'"+H,W=!0),Q=H.toString().replace(M,O),(W=W||S===!0||typeof S=="function"&&S(H,$)||Array.isArray(S)&&S[$]||((st,kt)=>{for(var X=0;X<kt.length;X++)if(-1<st.indexOf(kt[X]))return!0;return!1})(Q,c.BAD_DELIMITERS)||-1<Q.indexOf(P)||Q.charAt(0)===" "||Q.charAt(Q.length-1)===" ")?N+Q+N:Q)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!r&&!!s.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=b,c.ParserHandle=p,c.NetworkStreamer=u,c.FileStreamer=h,c.StringStreamer=f,c.ReadableStreamStreamer=g,s.jQuery&&((i=s.jQuery).fn.parse=function(y){var _=y.config||{},S=[];return this.each(function(B){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var N=0;N<this.files.length;N++)S.push({file:this.files[N],inputElem:this,instanceConfig:i.extend({},_)})}),T(),this;function T(){if(S.length===0)E(y.complete)&&y.complete();else{var B,N,O,R,I=S[0];if(E(y.before)){var L=y.before(I.file,I.inputElem);if(typeof L=="object"){if(L.action==="abort")return B="AbortError",N=I.file,O=I.inputElem,R=L.reason,void(E(y.error)&&y.error({name:B},N,O,R));if(L.action==="skip")return void P();typeof L.config=="object"&&(I.instanceConfig=i.extend(I.instanceConfig,L.config))}else if(L==="skip")return void P()}var M=I.instanceConfig.complete;I.instanceConfig.complete=function(z){E(M)&&M(z,I.file,I.inputElem),P()},c.parse(I.file,I.instanceConfig)}}function P(){S.splice(0,1),T()}}),o&&(s.onmessage=function(y){y=y.data,c.WORKER_ID===void 0&&y&&(c.WORKER_ID=y.workerId),typeof y.input=="string"?s.postMessage({workerId:c.WORKER_ID,results:c.parse(y.input,y.config),finished:!0}):(s.File&&y.input instanceof File||y.input instanceof Object)&&(y=c.parse(y.input,y.config))&&s.postMessage({workerId:c.WORKER_ID,results:y,finished:!0})}),(u.prototype=Object.create(d.prototype)).constructor=u,(h.prototype=Object.create(d.prototype)).constructor=h,(f.prototype=Object.create(f.prototype)).constructor=f,(g.prototype=Object.create(d.prototype)).constructor=g,c})})(K_);function J_(n){const t=pt(n),e=parseFloat(t);if(!isNaN(e)&&e>4e4&&e<6e4){const i=Math.floor(e),r=e-i,o=24*60*60*1e3,l=Date.UTC(1899,11,30)+i*o,c=new Date(l),d=c.getUTCFullYear(),u=c.getUTCMonth(),h=c.getUTCDate(),f=Math.round(r*24*60),g=Math.floor(f/60),p=f%60,m=ct(new Date(d,u,h,g,p));return m.isValid()?m:ct()}const s=ct(t);return s.isValid()?s:ct()}function pt(n){return n?n.toString().replace(/^"|"$/g,"").trim():""}async function Rd(n,t,e,s){var d;const{showToast:i,filterAndRender:r,checkAchievements:o,renderPatternWarnings:a,setSalaryPeriod:l,setPeriod:c}=s;document.getElementById("loadingState").classList.remove("hidden"),document.getElementById("mainContent").classList.add("hidden");try{const{data:u}=await n.auth.getSession(),h=(d=u==null?void 0:u.session)==null?void 0:d.access_token;if(!h)throw new Error("AUTH_REQUIRED");const f=await fetch(`${t.FUNCTIONS_BASE}/flow-data`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({sheets:["RawLedger","MerchantMap","FXRates","UserContext","Recipients","Profile","Goals","Insights","Streaks"]})});if(f.status===401)throw new Error("AUTH_REQUIRED");const g=await f.json();if((g==null?void 0:g.code)==="AUTH_REQUIRED"||(g==null?void 0:g.error)==="AUTH_REQUIRED")throw new Error("AUTH_REQUIRED");if(g!=null&&g.error)throw new Error(g.error);const p=g==null?void 0:g.data;if(!p)throw new Error("No data returned");p.FXRates&&X_(p.FXRates.slice(1),e),p.MerchantMap&&Q_(p.MerchantMap,e,s.updateCatDropdowns),p.UserContext&&Z_(p.UserContext,e),p.Recipients&&tv(p.Recipients,e),p.RawLedger&&nv(p.RawLedger,e,s),p.Profile&&(e.profile=p.Profile,console.log("[Data] Loaded profile:",Object.keys(p.Profile.settings||{}).length,"settings")),p.Goals&&(e.dbGoals=p.Goals,console.log("[Data] Loaded",p.Goals.length,"goals from DB")),p.Insights&&(e.dbInsights=p.Insights,console.log("[Data] Loaded",p.Insights.length,"past insights")),p.Streaks&&(e.dbStreaks=p.Streaks,console.log("[Data] Loaded",p.Streaks.length,"streaks from DB")),document.getElementById("lastSync").textContent=`Synced ${ct().format("HH:mm")}`,document.getElementById("loadingState").classList.add("hidden"),document.getElementById("mainContent").classList.remove("hidden"),e.period==="salary"||!e.hasLoaded?(e.hasLoaded=!0,l()):c(e.period),e.hasLoaded&&typeof i=="function"&&i(`Synced ${e.allTxns.length} transactions`,"success"),typeof o=="function"&&setTimeout(()=>o(),1e3),typeof a=="function"&&setTimeout(()=>a(),3e3)}catch(u){if(console.error("Sync error:",u),String(u.message||u).includes("AUTH_REQUIRED")){await n.auth.signOut(),document.getElementById("loginScreen").classList.remove("hidden"),document.getElementById("mainApp").classList.add("hidden");return}typeof i=="function"?i("Sync failed: "+u.message,"error"):alert("Sync failed. Check your connection.")}}function X_(n,t){n.forEach(e=>{const s=pt(e[0]),i=parseFloat(e[1]);s&&!isNaN(i)&&(t.fxRates[s]=i)})}function Q_(n,t,e){var s;n.length&&((s=n[0][0])!=null&&s.toLowerCase().includes("pattern"))&&n.shift(),t.merchantMap=[],t.categories.clear(),n.forEach(i=>{const r=pt(i[0]).toLowerCase(),o=pt(i[1]),a=pt(i[2])||o,l=pt(i[3]);r&&l&&(t.merchantMap.push({pattern:r,display:o,consolidated:a,category:l}),t.categories.add(l))}),t.categories.add("Uncategorized"),e&&e()}function Z_(n,t){var e;n.length&&((e=n[0][0])!=null&&e.toLowerCase().includes("type"))&&n.shift(),t.userContext=n.map(s=>({type:pt(s[0]),key:pt(s[1]),value:pt(s[2]),details:pt(s[3]),dateAdded:pt(s[4]),source:pt(s[5])})).filter(s=>s.type&&s.value),console.log("[Data] Loaded",t.userContext.length,"user context entries")}function Id(n){if(!n)return"";let t=n.replace(/\D/g,"");return t.startsWith("974")&&t.length>8&&(t=t.slice(3)),t}function tv(n,t){var e;n.length&&((e=n[0][0])!=null&&e.toString().toLowerCase().includes("phone"))&&n.shift(),t.recipients=n.map(s=>({id:pt(s[4])||null,phone:Id(String(s[0]||"")),bankAccount:pt(s[1]),shortName:pt(s[2]),longName:pt(s[3])})).filter(s=>s.shortName||s.longName),console.log("[Data] Loaded",t.recipients.length,"recipients")}function Md(n,t){if(!n||!t.recipients.length)return null;const e=n.toLowerCase(),s=n.replace(/\D/g,"");for(const i of t.recipients){if(i.phone&&s.includes(i.phone))return{...i,matchType:"phone"};if(i.bankAccount){const r=i.bankAccount.toLowerCase(),o=i.bankAccount.slice(-4);if(e.includes(r)||s.includes(o))return{...i,matchType:"account"}}if(i.longName){const r=i.longName.toLowerCase().split(/\s+/).filter(o=>o.length>2);for(const o of r)if(e.includes(o))return{...i,matchType:"name"}}if(i.shortName&&e.includes(i.shortName.toLowerCase()))return{...i,matchType:"shortName"}}return null}function ev(n,t){const e=[];for(const s of t.userContext){const i=s.key.toLowerCase(),r=`${n.raw} ${n.counterparty} ${n.display}`.toLowerCase(),o=`qar ${Math.round(n.amount)}`;(r.includes(i)||o===i.replace(/\s+/g," ").trim()||i.includes("to ")&&n.counterparty.toLowerCase().includes(i.replace("to ","")))&&e.push(s)}return e}function Pd(n,t){const e=ev(n,t);for(const s of e){const i=s.value.toLowerCase();if(i.includes("not a splurge")||i.includes("not splurge")||i.includes("is my")||i.includes("is actually")||i.includes("bill")||i.includes("rent")||i.includes("subscription")||i.includes("regular"))return!0}return!1}function nv(n,t,e){const{MERCHANT_TYPES:s,getSummaryGroup:i,getTimeContext:r,getSizeTier:o,categorize:a,detectPatterns:l,matchRecipient:c}=e,d=n[0]||[],u=d.length>=10&&(pt(d[7])==="Category"||pt(d[8])==="Category"),h=u?{ts:0,amount:1,currency:2,counterparty:3,card:4,direction:5,txnType:6,category:7,subcategory:8,confidence:9,context:10,raw:11}:{ts:0,amount:1,currency:2,counterparty:3,card:4,direction:5,txnType:6,raw:7},f=n.filter(g=>pt(g[1])!=="Amount"&&!isNaN(parseFloat(g[1])));t.allTxns=f.map(g=>{var I;const p=pt(g[h.raw]),m=pt(g[h.counterparty])||"",b=pt(g[h.card])||"",v=pt(g[h.currency])||"QAR",w=parseFloat(g[h.amount]),k=t.fxRates[v]||1,A=v==="QAR"?w:w*k,C=J_(g[h.ts]);let E=null,y=null,_=null;if(u){E=pt(g[h.subcategory])||pt(g[h.category])||null,y=pt(g[h.confidence])||null;try{_=g[h.context]?JSON.parse(pt(g[h.context])):null}catch{_=null}}const S=a(p,E),T=pt(g[h.txnType]),B=`${p} ${m} ${b} ${T}`.toLowerCase().includes("salary"),N={what:S.merchantType,when:r(C),size:o(A),pattern:"Normal"},R=["transfer","fawran","internal transfer"].some(L=>T.toLowerCase().includes(L)||p.toLowerCase().includes(L))?c(m):null;return{date:C,amount:A,currency:v,raw:p,counterparty:m,card:b,display:S.display,consolidated:S.consolidated,merchantType:S.merchantType,summaryGroup:i(S.merchantType),direction:pt(g[h.direction]),txnType:T,confidence:y,aiContext:_,isSalary:B,recipient:R,resolvedName:(R==null?void 0:R.shortName)||null,resolvedLongName:(R==null?void 0:R.longName)||null,dims:N,isWorkHours:N.when.includes("Work Hours"),isLateNight:N.when.includes("Late Night"),isWeekend:N.when.includes("Weekend"),isLarge:N.size==="Large"||N.size==="Major",isEssential:((I=s[S.merchantType])==null?void 0:I.essential)||!1}}).sort((g,p)=>p.date-g.date),l()}function Ld(n,t,e,s){const i=n.toLowerCase();if(e.localMappings[i]){const o=e.localMappings[i];return{display:o.display,consolidated:o.consolidated,merchantType:o.merchantType||o.category||"Other"}}if(t&&s[t])return{display:n,consolidated:n,merchantType:t};const r=e.merchantMap.find(o=>i.includes(o.pattern));if(r){const a={Groceries:"Groceries",Dining:"Dining","Bars & Hotels":"Bars & Nightlife",Delivery:"Delivery",Shopping:"Shopping",Hobbies:"Entertainment",Bills:"Bills",Transport:"Transport",Travel:"Travel",Health:"Health","Family Transfers":"Family",Family:"Family",Transfers:"Transfer",Fees:"Transfer"}[r.category]||r.category||"Other";return{display:r.display,consolidated:r.consolidated,merchantType:a}}return{display:n,consolidated:n,merchantType:"Uncategorized"}}function Dd(n,t){return`${n.STORAGE_KEY}_${t.currentUser}`}function sv(n,t){try{const e=localStorage.getItem(Dd(n,t));if(e){const s=JSON.parse(e);t.localMappings=s.mappings||{}}}catch{}}function iv(n,t){localStorage.setItem(Dd(n,t),JSON.stringify({mappings:t.localMappings}))}function $d(n,t){const e=n.allTxns.filter(o=>o.direction==="OUT"),s={};e.forEach(o=>{const a=o.date.format("YYYY-MM-DD");s[a]||(s[a]=[]),s[a].push(o)}),Object.values(s).forEach(o=>{const a=o.filter(l=>l.isLateNight&&["Bars & Nightlife","Dining","Coffee"].includes(l.merchantType));a.length>=2&&a.forEach(l=>l.dims.pattern="Night Out")}),e.forEach(o=>{o.isWorkHours&&["Dining","Coffee"].includes(o.merchantType)&&o.dims.pattern==="Normal"&&(o.dims.pattern="Work Expense")});const i={};e.forEach(o=>{i[o.merchantType]||(i[o.merchantType]={sum:0,count:0}),i[o.merchantType].sum+=o.amount,i[o.merchantType].count++}),Object.keys(i).forEach(o=>{i[o].avg=i[o].sum/i[o].count}),e.forEach(o=>{var l;const a=((l=i[o.merchantType])==null?void 0:l.avg)||0;a>0&&o.amount>a*3&&o.dims.pattern==="Normal"&&(t(o,n)||(o.dims.pattern="Splurge"))});const r={};e.forEach(o=>{r[o.consolidated]||(r[o.consolidated]=[]),r[o.consolidated].push(o)}),Object.values(r).forEach(o=>{if(o.length<2)return;o.sort((h,f)=>h.date-f.date);const a=[];for(let h=1;h<o.length;h++)a.push(o[h].date.diff(o[h-1].date,"day"));const l=a.reduce((h,f)=>h+f,0)/a.length,c=o.map(h=>h.amount),d=c.reduce((h,f)=>h+f,0)/c.length,u=c.every(h=>Math.abs(h-d)<d*.1);l>=25&&l<=35&&u&&o.forEach(h=>h.dims.pattern="Subscription")})}function Do(n){var a;const t=n.allTxns.filter(l=>l.direction==="IN"&&l.isSalary).sort((l,c)=>c.date-l.date);if(t.length===0)return{salaries:[],avgInterval:30};const e=t.map(l=>Math.round(l.amount/100)*100),s={};e.forEach(l=>s[l]=(s[l]||0)+1);const i=(a=Object.entries(s).sort((l,c)=>c[1]-l[1])[0])==null?void 0:a[0],r=i?t.filter(l=>Math.abs(l.amount-i)/i<.1):t;let o=30;if(r.length>=2){let l=0;for(let c=1;c<Math.min(r.length,6);c++)l+=r[c-1].date.diff(r[c].date,"day");o=Math.round(l/(Math.min(r.length,6)-1))}return{salaries:r,avgInterval:o}}function rv(n){if(!n.userContext||!n.userContext.length)return null;const t=n.userContext.filter(i=>i.type==="income");if(!t.length)return null;const e=t.find(i=>(i.key||"").toLowerCase().includes("salary"))||t[0],s=parseInt(e.value,10);return isNaN(s)?null:Math.min(Math.max(s,1),31)}function ov(n){const{salaries:t,avgInterval:e}=Do(n),s=rv(n);if(s){let r=ct().date(s);r.isBefore(ct(),"day")&&(r=r.add(1,"month"));const o=r.daysInMonth();s>o&&(r=r.date(o));const a=r.day();return a===5&&(r=r.subtract(1,"day")),a===6&&(r=r.subtract(2,"day")),r}if(t.length===0)return ct().add(30,"day");const i=t[0].date;if(t.length>=2){const r=t.slice(0,6).map(l=>l.date.date()),o=Math.round(r.reduce((l,c)=>l+c,0)/r.length);if(r.every(l=>Math.abs(l-o)<=3)){let l=ct().date(o);if(l.isBefore(ct(),"day")&&(l=l.add(1,"month")),o>28){const d=l.daysInMonth();o>d&&(l=l.date(d))}const c=l.day();return c===5&&(l=l.subtract(1,"day")),c===6&&(l=l.subtract(2,"day")),l}}return i.add(e,"day")}function av(n,t,e){const{salaries:s,avgInterval:i}=Do(n);s.length>=2?(n.dateRange={start:s[1].date,end:ct()},n.period="salary"):s.length===1?(n.dateRange={start:s[0].date,end:ct()},n.period="salary"):(n.dateRange={start:ct().subtract(90,"day"),end:ct()},n.period="last90"),document.querySelectorAll(".period-btn").forEach(r=>{r.classList.toggle("active",r.dataset.period===n.period)}),e(),t()}function lv(n){var v;const{salaries:t}=Do(n),e=ov(n),s=ct().startOf("day"),i=e.startOf("day"),r=Math.max(0,i.diff(s,"day")),o=n.filtered.filter(w=>w.direction==="IN").reduce((w,k)=>w+k.amount,0),a=n.filtered.filter(w=>w.direction==="OUT").reduce((w,k)=>w+k.amount,0),l=o-a,c=((v=n.profile)==null?void 0:v.settings)||{},d=c.monthly_budget,u=s.daysInMonth();let h;if(d&&d>0){const w=s.date(),k=n.allTxns.filter(E=>E.direction==="OUT"&&E.date.isAfter(s.startOf("month"))&&E.date.isBefore(s.add(1,"day"))).reduce((E,y)=>E+y.amount,0),A=Math.max(0,d-k),C=u-w+1;h=C>0?A/C:0}else h=r>0?Math.max(0,l/r):0;const f=n.dateRange.end.diff(n.dateRange.start,"day")+1,g=f>0?a/f:0,p=h>=g,b=c.salary_amount||(t.length>0?t[0].amount:0);return{income:o,expenses:a,net:l,daysUntilSalary:r,nextSalaryDate:e,dailyBudget:h,avgDailySpend:g,onTrack:p,lastSalaryAmount:b,monthlyBudget:d||null}}function cv(n,t,e,s){t.period=n;const i=ct();switch(n){case"thisMonth":t.dateRange={start:i.startOf("month"),end:i};break;case"lastMonth":t.dateRange={start:i.subtract(1,"month").startOf("month"),end:i.subtract(1,"month").endOf("month")};break;case"last90":t.dateRange={start:i.subtract(90,"day"),end:i};break;case"thisYear":t.dateRange={start:i.startOf("year"),end:i};break}document.querySelectorAll(".period-btn").forEach(r=>{r.classList.toggle("active",r.dataset.period===n)}),s(),e()}function dv(n){const{start:t,end:e}=n.dateRange,i=t.year()===e.year()?"MMM D":"MMM D, YY";document.getElementById("dateRangeDisplay").textContent=`${t.format(i)} -> ${e.format("MMM D, YYYY")}`}function uv(n){document.getElementById("startDate").value=n.dateRange.start.format("YYYY-MM-DD"),document.getElementById("endDate").value=n.dateRange.end.format("YYYY-MM-DD"),document.getElementById("dateModal").classList.remove("hidden")}function Bd(){document.getElementById("dateModal").classList.add("hidden")}function hv(n,t){const e=ct(document.getElementById("startDate").value),s=ct(document.getElementById("endDate").value);e.isValid()&&s.isValid()&&e.isBefore(s)?(n.period="custom",n.dateRange={start:e,end:s},document.querySelectorAll(".period-btn").forEach(i=>{i.classList.toggle("active",i.dataset.period==="custom")}),Bd(),t()):alert("Please select a valid date range")}function Nd(n,t){const{renderSettingsGoalsList:e,renderRecipientsList:s,loadProfileTab:i}=t;localStorage.setItem("fact_settings_tab",n),["general","goals","contacts","profile"].forEach(l=>{const c=document.getElementById(`tab${l.charAt(0).toUpperCase()+l.slice(1)}`),d=document.getElementById(`panel${l.charAt(0).toUpperCase()+l.slice(1)}`),u=l===n;c&&(c.setAttribute("aria-selected",u),c.classList.toggle("border-fact-yellow",u),c.classList.toggle("border-transparent",!u),c.classList.toggle("text-fact-ink",u),c.classList.toggle("dark:text-fact-dark-ink",u),c.classList.toggle("text-fact-muted",!u)),d&&d.classList.toggle("hidden",!u)});const o=document.getElementById("settingsFooter");o&&o.classList.toggle("hidden",n!=="general");const a=document.getElementById("settingsFooter");a&&a.classList.toggle("hidden",n!=="general"&&n!=="profile"),n==="goals"?e():n==="contacts"?s():n==="profile"&&typeof i=="function"&&i()}function fv(n=null,t){const e=localStorage.getItem("fact_ai_model")||"claude-sonnet";document.getElementById("settingsAiModel").value=e,document.getElementById("settingsCurrentPass").value="",document.getElementById("settingsNewPass").value="",document.getElementById("settingsConfirmPass").value="",document.getElementById("settingsPassError").classList.add("hidden"),document.getElementById("settingsPassSuccess").classList.add("hidden");const s=n||localStorage.getItem("fact_settings_tab")||"general";document.getElementById("settingsModal").classList.remove("hidden"),Nd(s,t)}function jd(){document.getElementById("settingsModal").classList.add("hidden")}function gv(n){const t=document.getElementById("settingsAiModel").value;localStorage.setItem("fact_ai_model",t);const e=document.getElementById("aiModelName");e&&(e.textContent=t),typeof n=="function"&&n("Settings saved","success"),jd()}async function pv(n,t){var s;const e=document.getElementById("shortcutKeyStatus");e.textContent="Generating key...";try{const{data:i}=await n.auth.getSession(),r=(s=i==null?void 0:i.session)==null?void 0:s.access_token;if(!r)throw new Error("Not authenticated");const a=await(await fetch(`${t.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({action:"create"})})).json();if(a.error)throw new Error(a.error);localStorage.setItem("fact_shortcut_key_id",a.keyId||"");const l=document.getElementById("shortcutKeyBox"),c=document.getElementById("shortcutKeyValue");c.value=a.key,l.classList.remove("hidden"),e.textContent="Key generated. Paste it into your Shortcut."}catch(i){e.textContent="Failed to generate key: "+i.message}}async function mv(n,t){var i;const e=document.getElementById("shortcutKeyStatus"),s=localStorage.getItem("fact_shortcut_key_id");if(!s){e.textContent="No active key to revoke.";return}e.textContent="Revoking key...";try{const{data:r}=await n.auth.getSession(),o=(i=r==null?void 0:r.session)==null?void 0:i.access_token;if(!o)throw new Error("Not authenticated");const l=await(await fetch(`${t.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({action:"revoke",keyId:s})})).json();if(l.error)throw new Error(l.error);localStorage.removeItem("fact_shortcut_key_id"),document.getElementById("shortcutKeyBox").classList.add("hidden"),document.getElementById("shortcutKeyValue").value="",e.textContent="Key revoked."}catch(r){e.textContent="Failed to revoke key: "+r.message}}function yv(){document.getElementById("shortcutKeyValue").select(),document.execCommand("copy")}function bv(n){const t=document.getElementById("shortcutTemplateLink");t.href=n.SHORTCUT_TEMPLATE_URL,document.getElementById("shortcutSetupModal").classList.remove("hidden")}function _v(){document.getElementById("shortcutSetupModal").classList.add("hidden")}function vv(){return localStorage.getItem("fact_ai_model")||"claude-sonnet"}async function wv(n,t,e){var r;const s=document.getElementById("backfillBtn"),i=document.getElementById("backfillStatus");if(s){s.disabled=!0,s.textContent="Running...",i&&(i.textContent="Categorizing transactions...");try{const{data:o}=await n.auth.getSession(),a=(r=o==null?void 0:o.session)==null?void 0:r.access_token;if(!a)throw new Error("Not authenticated");const c=await(await fetch(`${t.FUNCTIONS_BASE}/flow-backfill`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({})})).json();if(c.error)throw new Error(c.error);const d=c.message||`Done: ${c.matched} matched, ${c.ai_categorized} AI-categorized`;if(i&&(i.textContent=d),typeof e=="function"&&e(d,"success"),c.total===0||c.matched+c.ai_categorized===c.total){const u=document.getElementById("backfillSection");u&&u.classList.add("hidden")}}catch(o){i&&(i.textContent="Error: "+o.message),typeof e=="function"&&e("Backfill failed: "+o.message,"error")}finally{s.disabled=!1,s.textContent="Run Backfill"}}}function xv(n){var o;const t=((o=n.profile)==null?void 0:o.settings)||{},e=document.getElementById("profileSalaryDay"),s=document.getElementById("profileSalaryAmount"),i=document.getElementById("profileMonthlyBudget"),r=document.getElementById("profileFamilyNames");e&&(e.value=t.salary_day||""),s&&(s.value=t.salary_amount||""),i&&(i.value=t.monthly_budget||""),r&&(r.value=(t.family_patterns||[]).join(", "))}async function kv(n,t,e,s){var d,u,h,f,g,p;const i=parseInt((d=document.getElementById("profileSalaryDay"))==null?void 0:d.value)||null,r=parseFloat((u=document.getElementById("profileSalaryAmount"))==null?void 0:u.value)||null,o=parseFloat((h=document.getElementById("profileMonthlyBudget"))==null?void 0:h.value)||null,l=(((f=document.getElementById("profileFamilyNames"))==null?void 0:f.value)||"").split(",").map(m=>m.trim().toLowerCase()).filter(Boolean),c={...((g=e.profile)==null?void 0:g.settings)||{},salary_day:i,salary_amount:r,monthly_budget:o,family_patterns:l};try{const{data:m}=await n.auth.getSession(),b=(p=m==null?void 0:m.session)==null?void 0:p.access_token;if(!b)throw new Error("Not authenticated");const w=await(await fetch(`${t.FUNCTIONS_BASE}/flow-profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({action:"save",settings:c})})).json();if(w.error)throw new Error(w.error);e.profile={...e.profile,settings:c},typeof s=="function"&&s("Profile saved","success")}catch(m){typeof s=="function"&&s("Failed to save profile: "+m.message,"error")}}async function Sv(n){const t=document.getElementById("settingsNewPass").value,e=document.getElementById("settingsConfirmPass").value,s=document.getElementById("settingsPassError"),i=document.getElementById("settingsPassSuccess");if(s.classList.add("hidden"),i.classList.add("hidden"),!t||!e){s.textContent="Please fill in new password fields",s.classList.remove("hidden");return}if(t!==e){s.textContent="New passwords do not match",s.classList.remove("hidden");return}if(t.length<6){s.textContent="Password must be at least 6 characters",s.classList.remove("hidden");return}try{const{error:r}=await n.auth.updateUser({password:t});if(r){s.textContent=r.message,s.classList.remove("hidden");return}i.textContent="Password updated successfully",i.classList.remove("hidden"),document.getElementById("settingsCurrentPass").value="",document.getElementById("settingsNewPass").value="",document.getElementById("settingsConfirmPass").value=""}catch(r){s.textContent="Connection error: "+r.message,s.classList.remove("hidden")}}function Ev(n,t){const{start:e,end:s}=n.dateRange;n.filtered=n.allTxns.filter(h=>h.date.isBetween(e,s,"day","[]")),n.txnSort=n.txnSort||"date-desc",n.txnFilter=n.txnFilter||"";const{renderBudgetProjection:i,renderDonutChart:r,renderCategoryBreakdown:o,renderRecentTxns:a,renderUncatAlert:l,renderQuickInsights:c,renderTodaySection:d,checkForImpulseBursts:u}=t;i(),r(),o(),a(),l(),c(),d(),u()}function Tv(n,t){const{checkDailyBudget:e,formatNum:s,updateDailyBudgetMeter:i,updateStreak:r,renderStreakBadge:o,renderGenerosityBudget:a,updateFocusHero:l,updateQuickInsight:c,isFocusMode:d}=t;document.getElementById("todayDate").textContent=ct().format("dddd, MMM D");const u=e();document.getElementById("todaySpent").textContent=`QAR ${s(u.spent)}`,document.getElementById("todayBudget").textContent=`QAR ${s(u.budget)}`,i(),r(),o(),typeof a=="function"&&a(),d&&typeof l=="function"&&(l(),c())}function Av(n,t){const{formatNum:e,SUMMARY_GROUPS:s,MERCHANT_TYPES:i}=t,r=n.filtered.filter(a=>a.direction==="OUT"),o=document.getElementById("categoryBreakdown");if(n.viewMode==="parent"){const a={};r.forEach(d=>{a[d.summaryGroup]||(a[d.summaryGroup]={total:0,count:0}),a[d.summaryGroup].total+=d.amount,a[d.summaryGroup].count++});const l=r.reduce((d,u)=>d+u.amount,0),c=Object.entries(a).sort((d,u)=>u[1].total-d[1].total);o.innerHTML=c.map(([d,u])=>{var p,m;const h=l>0?(u.total/l*100).toFixed(0):0,f=((p=s[d])==null?void 0:p.color)||"#999",g=((m=s[d])==null?void 0:m.icon)||"?";return`
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition" onclick="openParentDrilldown('${d}')">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: ${f}20">
                        <span>${g}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium truncate">${d}</span>
                            <span class="text-sm font-bold">${e(u.total)}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <div class="flex-1 h-1.5 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full rounded-full" style="width: ${h}%; background: ${f}"></div>
                            </div>
                            <span class="text-[10px] text-fact-muted">${h}%</span>
                        </div>
                    </div>
                </div>
            `}).join("")}else{const a={};r.forEach(d=>{a[d.merchantType]||(a[d.merchantType]={total:0,count:0}),a[d.merchantType].total+=d.amount,a[d.merchantType].count++});const l=r.reduce((d,u)=>d+u.amount,0),c=Object.entries(a).sort((d,u)=>u[1].total-d[1].total);o.innerHTML=c.slice(0,10).map(([d,u])=>{var p,m;const h=l>0?(u.total/l*100).toFixed(0):0,f=((p=i[d])==null?void 0:p.color)||"#999",g=((m=i[d])==null?void 0:m.icon)||"?";return`
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition" onclick="openDrilldown('${d}')">
                    <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs" style="background: ${f}20">
                        ${g}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-medium truncate">${d}</span>
                            <span class="text-xs font-bold">${e(u.total)}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-0.5">
                            <div class="flex-1 h-1 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full rounded-full" style="width: ${h}%; background: ${f}"></div>
                            </div>
                            <span class="text-[9px] text-fact-muted">${u.count}</span>
                        </div>
                    </div>
                </div>
            `}).join("")}}function Cv(n,t,e){t.txnSort=n,e()}function Ov(n,t,e){t.txnFilter=n.toLowerCase(),e()}function Rv(n,t,e,s){t.viewMode=n;const i=document.getElementById("viewParent"),r=document.getElementById("viewSubcat");n==="parent"?(i.classList.add("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),i.classList.remove("text-fact-muted","dark:text-fact-dark-muted"),r.classList.remove("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),r.classList.add("text-fact-muted","dark:text-fact-dark-muted")):(r.classList.add("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),r.classList.remove("text-fact-muted","dark:text-fact-dark-muted"),i.classList.remove("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),i.classList.add("text-fact-muted","dark:text-fact-dark-muted")),e(),s()}const Dr={};function Iv(n,t){const{formatNum:e,CAT_COLORS:s}=t,i=n.filtered.filter(d=>d.direction==="OUT");let r,o,a;if(n.viewMode==="parent"){const d={};i.forEach(h=>{const f=h.summaryGroup;d[f]=(d[f]||0)+h.amount}),r=["Essentials","Food & Drinks","Shopping & Fun","Family","Other"].filter(h=>d[h]>0),o=r.map(h=>d[h]),a=r.map(h=>s[h]||"#999")}else{const d={};i.forEach(h=>d[h.merchantType]=(d[h.merchantType]||0)+h.amount);const u=Object.entries(d).sort((h,f)=>f[1]-h[1]);r=u.map(h=>h[0]),o=u.map(h=>h[1]),a=r.map(h=>s[h]||"#999")}const l=o.reduce((d,u)=>d+u,0);document.getElementById("donutTotal").textContent=e(l);const c=document.getElementById("donutChart");Dr.donut&&Dr.donut.destroy(),Dr.donut=new ce(c,{type:"doughnut",data:{labels:r,datasets:[{data:o,backgroundColor:a,borderWidth:2,borderColor:document.documentElement.classList.contains("dark")?"#1a1a1a":"#ffffff",hoverOffset:12,hoverBorderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",animation:{animateRotate:!0,duration:600},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(15, 15, 15, 0.95)",titleColor:"#F4C44E",bodyColor:"#ffffff",borderColor:"#F4C44E",borderWidth:1,cornerRadius:8,padding:12,displayColors:!0,boxPadding:6,caretSize:8,caretPadding:10,yAlign:"bottom",callbacks:{title:d=>{var u;return((u=d[0])==null?void 0:u.label)||""},label:d=>{const u=d.raw,h=(u/l*100).toFixed(1);return` QAR ${e(u)} (${h}%)`},afterLabel:()=>"Click to see details ->"}}},onClick:(d,u)=>{if(u.length>0){const h=u[0].index;n.viewMode==="parent"?window.openParentDrilldown(r[h]):window.openDrilldown(r[h])}},onHover:(d,u)=>{d.native.target.style.cursor=u.length>0?"pointer":"default"}}})}function Mv(n,t){const{calculateBudgetProjection:e,formatNum:s}=t,i=e();document.getElementById("daysUntilSalary").textContent=i.daysUntilSalary,document.getElementById("nextSalaryDate").textContent=`~${i.nextSalaryDate.format("MMM D")}`,document.getElementById("projIncome").textContent=s(i.income),document.getElementById("projExpense").textContent=s(i.expenses);const r=document.getElementById("projNet");r.textContent=s(i.net),r.className=`font-display font-bold text-lg ${i.net>=0?"text-fact-green":"text-fact-red"}`,document.getElementById("suggestedDaily").textContent=`${s(i.dailyBudget)}/day`,document.getElementById("avgDailySpend").textContent=s(i.avgDailySpend);const o=document.getElementById("budgetStatus");i.onTrack?(o.textContent="On Track",o.className="text-[10px] px-2 py-0.5 rounded-full bg-fact-green/20 text-fact-green font-medium"):(o.textContent="Over Budget",o.className="text-[10px] px-2 py-0.5 rounded-full bg-fact-red/20 text-fact-red font-medium")}let bn=!1;function Pv(n,t){bn=!bn,localStorage.setItem(`fact_focus_mode_${n.currentUser}`,bn),Fd(),t(bn?"Focus Mode enabled - simplified view":"Full view restored","info")}function Fd(n,t){const e=document.body,s=document.getElementById("focusToggle"),i=document.getElementById("focusHero"),r=document.getElementById("quickInsight");bn?(e.classList.add("focus-mode"),s==null||s.classList.add("active"),i==null||i.classList.remove("hidden"),r==null||r.classList.remove("hidden")):(e.classList.remove("focus-mode"),s==null||s.classList.remove("active"),i==null||i.classList.add("hidden"),r==null||r.classList.add("hidden"))}function Lv(n,t){var h;const{checkDailyBudget:e,formatNum:s,getStreakData:i}=t,r=e(),o=document.getElementById("focusHeroNumber"),a=document.getElementById("focusDaysToSalary"),l=document.getElementById("focusStreak");if(!o)return;const c=Math.max(0,r.remaining);o.textContent=`QAR ${s(c)}`,o.className="focus-hero-number breathe",r.status==="danger"?o.classList.add("danger"):r.status==="warning"?o.classList.add("warning"):o.classList.add("positive");const d=((h=document.getElementById("daysUntilSalary"))==null?void 0:h.textContent)||"--";a&&(a.textContent=d);const u=i();l&&(l.textContent=u.currentStreak||"0")}function Dv(n,t){const{checkDailyBudget:e,formatNum:s,getStreakData:i}=t,r=document.getElementById("quickInsightText"),o=document.getElementById("quickInsightSubtext");if(!r||!o)return;const a=e(),l=i();a.status==="danger"?(r.textContent="Budget alert! Consider pausing spending.",o.textContent=`You've spent ${Math.round(a.spent/a.budget*100)}% of today's budget`):a.status==="warning"?(r.textContent="Halfway through your daily budget",o.textContent=`QAR ${s(a.remaining)} left - spend wisely!`):l.currentStreak>=3?(r.textContent=`${l.currentStreak}-day streak! You're crushing it!`,o.textContent="Keep the momentum going"):(r.textContent="You're doing great today!",o.textContent=`QAR ${s(a.remaining)} left to spend`)}function $v(n){localStorage.getItem(`fact_focus_mode_${n.currentUser}`)==="true"&&(bn=!0,Fd())}function Bv(n){const t=[],e=[...n].sort((s,i)=>s.date.unix()-i.date.unix());for(let s=0;s<e.length;s++){const i=e[s].date,r=[e[s]];for(let o=s+1;o<e.length&&e[o].date.diff(i,"minute")<=30;o++)r.push(e[o]);r.length>=3&&(t.push({time:i,count:r.length,total:r.reduce((o,a)=>o+a.amount,0),transactions:r}),s+=r.length-1)}return t}function Nv(n,t){const e=ct().startOf("day"),i=n.allTxns.filter(l=>l.direction==="OUT"&&l.date.isAfter(e)&&l.date.isBefore(e.add(1,"day"))).reduce((l,c)=>l+c.amount,0),o=t().dailyBudget||300,a=i/o*100;return{spent:i,budget:o,remaining:Math.max(0,o-i),percentage:a,status:a<50?"safe":a<80?"warning":"danger"}}function jv(n,t){const{checkDailyBudget:e,formatNum:s,showToast:i}=t,r=e(),o=document.getElementById("dailyBudgetMeter");if(!o)return;const a=o.querySelector(".budget-meter-fill");a&&(a.style.width=`${Math.min(100,r.percentage)}%`,a.className=`budget-meter-fill ${r.status}`);const l=document.getElementById("dailyBudgetLabel");l&&(l.textContent=`${s(r.remaining)} left today`,l.className=r.status==="danger"?"text-fact-red":"text-fact-muted dark:text-fact-dark-muted"),r.percentage>=80&&r.percentage<100&&!n.dailyWarningShown?(i(`You've used ${r.percentage.toFixed(0)}% of today's budget`,"info"),n.dailyWarningShown=!0):r.percentage>=100&&!n.dailyOverShown&&(i(`Over budget today! Spent ${s(r.spent)} of ${s(r.budget)}`,"error"),n.dailyOverShown=!0)}function Fv(n,t){const e=ct().startOf("day"),s=n.allTxns.filter(r=>r.direction==="OUT"&&r.date.isAfter(e.subtract(1,"day"))),i=Bv(s);if(i.length>0&&!n.impulseBannerDismissed){const r=i[i.length-1];document.getElementById("impulseMessage").textContent=`${r.count} purchases (QAR ${t(r.total)}) in 30 minutes`,document.getElementById("impulseBanner").style.display="block"}}function Uv(n){document.getElementById("impulseBanner").style.display="none",n.impulseBannerDismissed=!0}function $o(n){try{return JSON.parse(localStorage.getItem(`fact_streak_${n.currentUser}`))||{currentStreak:0,longestStreak:0,lastGoodDay:null}}catch{return{currentStreak:0,longestStreak:0,lastGoodDay:null}}}function zv(n,t){localStorage.setItem(`fact_streak_${t.currentUser}`,JSON.stringify(n))}function Hv(n,t){const e=t(),s=$o(n),i=ct().format("YYYY-MM-DD"),r=ct().subtract(1,"day").format("YYYY-MM-DD");return e.status!=="danger"?(s.lastGoodDay===r?s.currentStreak++:s.lastGoodDay!==i&&(s.currentStreak=1),s.lastGoodDay=i,s.longestStreak=Math.max(s.longestStreak,s.currentStreak)):s.lastGoodDay!==i&&s.lastGoodDay!==r&&(s.currentStreak=0),zv(s,n),s}function Wv(n){const t=$o(n),e=document.getElementById("streakContainer");e&&(t.currentStreak>0?e.innerHTML=`
            <div class="streak-badge">
                <span>fire</span>
                <span>${t.currentStreak} day${t.currentStreak>1?"s":""}</span>
            </div>
        `:e.innerHTML=`
            <div class="text-xs text-fact-muted dark:text-fact-dark-muted">
                Stay under budget to start a streak!
            </div>
        `)}function er(n){if(n.dbGoals&&n.dbGoals.length>0)return n.dbGoals.map(t=>({id:t.id,category:t.category,amount:Number(t.monthly_limit)}));try{return JSON.parse(localStorage.getItem(`fact_goals_${n.currentUser}`))||[]}catch{return[]}}function Bo(n,t){localStorage.setItem(`fact_goals_${t.currentUser}`,JSON.stringify(n))}async function Vv(n,t,e){var r;const s=`fact_goals_${n.currentUser}`,i=JSON.parse(localStorage.getItem(s)||"[]");if(!(!i.length||n.dbGoals&&n.dbGoals.length>0))try{const{data:o}=await t.auth.getSession(),a=(r=o==null?void 0:o.session)==null?void 0:r.access_token;if(!a)return;for(const l of i)await fetch(`${e.FUNCTIONS_BASE}/flow-profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({action:"goals.save",goal:{category:l.category,monthly_limit:l.amount}})});localStorage.setItem(`${s}_migrated`,"true"),console.log("[Goals] Migrated",i.length,"goals to DB")}catch(o){console.warn("[Goals] Migration failed:",o.message)}}function Gv(n){n("goals")}function qv(n,t){const{formatNum:e,escapeHtml:s,MERCHANT_TYPES:i}=t,r=er(n),o=document.getElementById("settingsGoalsList");if(!o)return;if(r.length===0){o.innerHTML=`
            <div class="text-center py-8">
                <div class="text-3xl mb-2">target</div>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted">No budget goals set yet</p>
                <p class="text-xs text-fact-muted dark:text-fact-dark-muted mt-1">Set spending limits to track your progress</p>
            </div>
        `;return}const a=ct(),l=a.startOf("month"),c=n.allTxns.filter(g=>g.direction==="OUT"&&g.date.isAfter(l)&&g.date.isBefore(a.add(1,"day"))),d={};c.forEach(g=>{d[g.merchantType]=(d[g.merchantType]||0)+g.amount});const u=a.daysInMonth(),f=a.date()/u*100;o.innerHTML=r.map((g,p)=>{const m=d[g.category]||0,b=Math.min(100,m/g.amount*100),v=Math.max(0,g.amount-m),w=b>100?"#E57373":b>80?"#F4C44E":"#75B876";return`
            <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${(i[g.category]||{}).icon||"?"}</span>
                        <span class="font-medium text-sm">${s(g.category)}</span>
                    </div>
                    <button onclick="deleteGoal(${p})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-fact-red/10 text-fact-muted hover:text-fact-red transition" aria-label="Delete goal">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="flex items-baseline justify-between mb-2">
                    <div class="font-display">
                        <span class="text-xl font-bold">${e(m)}</span>
                        <span class="text-sm text-fact-muted dark:text-fact-dark-muted">/ ${e(g.amount)}</span>
                    </div>
                    <span class="text-xs ${b>100?"text-fact-red":"text-fact-green"}">${e(v)} left</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-bar" style="width: ${b}%; background: ${w}"></div>
                    <div class="goal-progress-marker" style="left: ${f}%" title="Expected pace"></div>
                </div>
                <div class="flex justify-between mt-2 text-[10px] text-fact-muted dark:text-fact-dark-muted">
                    <span>${b.toFixed(0)}% used</span>
                    <span>${b>f?"Ahead of pace":"On track"}</span>
                </div>
            </div>
        `}).join("")}function Yv(n){const t=Object.keys(n).filter(i=>i!=="Uncategorized"),e=document.getElementById("goalCategory");e&&(e.innerHTML=t.map(i=>{var r;return`<option value="${i}">${((r=n[i])==null?void 0:r.icon)||""} ${i}</option>`}).join(""));const s=document.getElementById("goalAmount");s&&(s.value=""),document.getElementById("addGoalModal").classList.remove("hidden")}function Ud(){document.getElementById("addGoalModal").classList.add("hidden")}function Kv(n,t){const{showToast:e,renderSettingsGoalsList:s}=t,i=document.getElementById("goalCategory").value,r=parseFloat(document.getElementById("goalAmount").value);if(!i||!r||r<=0){e("Please select a category and enter a valid amount","error");return}const o=er(n),a=o.findIndex(l=>l.category===i);a>=0?(o[a].amount=r,e(`Updated ${i} goal`,"success")):(o.push({category:i,amount:r}),e(`Added ${i} goal`,"success")),Bo(o,n),Ud(),s()}async function Jv(n,t,e){const{showConfirm:s,showToast:i,formatNum:r,renderSettingsGoalsList:o}=e,a=er(t),l=a[n];await s({title:"Delete Budget Goal",message:`Remove the ${l.category} budget of QAR ${r(l.amount)}?`,confirmText:"Delete",cancelText:"Keep",type:"danger"})&&(a.splice(n,1),Bo(a,t),o(),i(`Removed ${l.category} goal`,"info"))}const Ue={};function Xv(n,t){const{renderTxnRow:e}=t,s=document.getElementById("recentTxns");if(!s)return;let i=[...n.filtered];switch(n.txnFilter&&(i=i.filter(r=>r.display.toLowerCase().includes(n.txnFilter)||r.raw.toLowerCase().includes(n.txnFilter)||r.merchantType.toLowerCase().includes(n.txnFilter))),n.txnSort){case"date-asc":i.sort((r,o)=>r.date-o.date);break;case"amount-desc":i.sort((r,o)=>o.amount-r.amount);break;case"amount-asc":i.sort((r,o)=>r.amount-o.amount);break;case"date-desc":default:i.sort((r,o)=>o.date-r.date)}s.innerHTML=i.slice(0,15).map(r=>e(r)).join("")}function Qv(n,t){var u;const{formatNum:e,escapeHtml:s,getTypeColor:i,MERCHANT_TYPES:r}=t,o=n.direction==="OUT",a=i(n.merchantType),l=((u=r[n.merchantType])==null?void 0:u.icon)||"?",c=btoa(unescape(encodeURIComponent(n.raw))),d=n.resolvedName?`${n.resolvedName}`:n.display;return`
        <div class="txn-row p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800" data-raw="${c}" onclick="openCatModalSafe(this)">
            <div class="flex items-center gap-3 min-w-0">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm flex-shrink-0" style="background:${a}20">${l}</div>
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${s(d)}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted truncate">${n.date.format("MMM D, HH:mm")} - ${s(n.merchantType)}</div>
                </div>
            </div>
            <div class="text-right flex-shrink-0 ml-2">
                <div class="font-display font-semibold text-sm ${o?"":"text-fact-green"}">${o?"":"+"}${e(n.amount)}</div>
                ${n.currency!=="QAR"?`<div class="text-[10px] text-fact-muted">${n.currency}</div>`:""}
            </div>
        </div>
    `}function Zv(n,t){const e=n.dataset.raw;if(e){const s=decodeURIComponent(escape(atob(e)));t(s)}}function t0(n,t){const e=n.filtered.filter(o=>o.merchantType==="Uncategorized"&&o.direction==="OUT"),s=e.length,i=e.reduce((o,a)=>o+a.amount,0),r=document.getElementById("uncatAlert");if(r){r.classList.toggle("hidden",s===0);const o=document.getElementById("uncatCount"),a=document.getElementById("uncatAmount");o&&(o.textContent=s),a&&(a.textContent=t(i))}}const rc={Essentials:{icon:"house",subcategories:["Groceries","Bills","Health","Transport"]},"Food & Drinks":{icon:"food",subcategories:["Dining","Coffee","Delivery","Bars & Nightlife"]},"Shopping & Fun":{icon:"shopping",subcategories:["Shopping","Entertainment","Travel"]},Family:{icon:"family",subcategories:["Family"]},Other:{icon:"other",subcategories:["Transfer","Other","Uncategorized"]}};function e0(n,t,e){var E;const{formatNum:s,escapeHtml:i,CAT_COLORS:r,renderTxnRow:o}=e,a=t.filtered.filter(y=>y.direction==="OUT"&&y.merchantType===n),l=a.reduce((y,_)=>y+_.amount,0),c=t.dateRange.end.diff(t.dateRange.start,"day"),d=t.dateRange.start.subtract(c+1,"day"),u=t.dateRange.start.subtract(1,"day"),f=t.allTxns.filter(y=>y.direction==="OUT"&&y.merchantType===n&&y.date.isBetween(d,u,"day","[]")).reduce((y,_)=>y+_.amount,0),g=f>0?(l-f)/f*100:0;document.getElementById("drilldownTitle").textContent=n,document.getElementById("drilldownSubtitle").textContent=`${a.length} transactions`,document.getElementById("drilldownTotal").textContent=`QAR ${s(l)}`,document.getElementById("drilldownDelta").textContent=(g>=0?"+":"")+g.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${g<=0?"text-fact-green":"text-fact-red"}`;const p={};a.forEach(y=>{const _=y.date.format("YYYY-MM-DD");p[_]=(p[_]||0)+y.amount});const m=[];let b=t.dateRange.start;for(;b.isBefore(t.dateRange.end)||b.isSame(t.dateRange.end,"day");)m.push(b.format("YYYY-MM-DD")),b=b.add(1,"day");const v=document.getElementById("drilldownTimeline");Ue.drilldownTimeline&&Ue.drilldownTimeline.destroy();const w=r[n]||"#999";Ue.drilldownTimeline=new ce(v,{type:"bar",data:{labels:m.map(y=>ct(y).format("D")),datasets:[{data:m.map(y=>p[y]||0),backgroundColor:w,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/m.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}});const k={};a.forEach(y=>{k[y.consolidated]||(k[y.consolidated]={total:0,count:0}),k[y.consolidated].total+=y.amount,k[y.consolidated].count++});const A=Object.entries(k).map(([y,_])=>({name:y,..._})).sort((y,_)=>_.total-y.total).slice(0,5),C=((E=A[0])==null?void 0:E.total)||1;document.getElementById("drilldownMerchants").innerHTML=`
        <p class="text-xs font-medium mb-2">Top Merchants</p>
        ${A.map(y=>`
            <div class="flex items-center gap-2 cursor-pointer hover:opacity-80" onclick="closeDrilldown(); openMerchantDrilldown('${y.name.replace(/'/g,"\\'")}')">
                <div class="flex-1 min-w-0">
                    <div class="flex justify-between text-xs mb-0.5">
                        <span class="truncate">${i(y.name)}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${y.count}x</span>
                            <span class="font-medium">${s(y.total)}</span>
                        </div>
                    </div>
                    <div class="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full rounded-full" style="width:${y.total/C*100}%;background:${w}"></div>
                    </div>
                </div>
            </div>
        `).join("")}
    `,document.getElementById("drilldownTxns").innerHTML=a.slice(0,20).map(y=>o(y)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function n0(){document.getElementById("drilldownModal").classList.add("hidden")}function s0(n,t,e){var S,T,P,B,N;const{formatNum:s,escapeHtml:i,CAT_COLORS:r,getGroupColor:o,renderTxnRow:a,SUMMARY_GROUPS:l}=e,c=((S=rc[n])==null?void 0:S.subcategories)||((T=l[n])==null?void 0:T.types)||[],d=t.filtered.filter(O=>O.direction==="OUT"&&c.includes(O.merchantType)),u=d.reduce((O,R)=>O+R.amount,0),h=t.dateRange.end.diff(t.dateRange.start,"day"),f=t.dateRange.start.subtract(h+1,"day"),g=t.dateRange.start.subtract(1,"day"),m=t.allTxns.filter(O=>O.direction==="OUT"&&c.includes(O.merchantType)&&O.date.isBetween(f,g,"day","[]")).reduce((O,R)=>O+R.amount,0),b=m>0?(u-m)/m*100:0;(P=rc[n])!=null&&P.icon||(B=l[n])!=null&&B.icon,document.getElementById("drilldownTitle").textContent=`${n}`,document.getElementById("drilldownSubtitle").textContent=`${d.length} transactions - ${c.length} subcategories`,document.getElementById("drilldownTotal").textContent=`QAR ${s(u)}`,document.getElementById("drilldownDelta").textContent=(b>=0?"+":"")+b.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${b<=0?"text-fact-green":"text-fact-red"}`;const v=r[n]||o(n),w={};d.forEach(O=>{const R=O.date.format("YYYY-MM-DD");w[R]=(w[R]||0)+O.amount});const k=[];let A=t.dateRange.start;for(;A.isBefore(t.dateRange.end)||A.isSame(t.dateRange.end,"day");)k.push(A.format("YYYY-MM-DD")),A=A.add(1,"day");const C=document.getElementById("drilldownTimeline");Ue.drilldownTimeline&&Ue.drilldownTimeline.destroy(),Ue.drilldownTimeline=new ce(C,{type:"bar",data:{labels:k.map(O=>ct(O).format("D")),datasets:[{data:k.map(O=>w[O]||0),backgroundColor:v,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/k.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}});const E={};d.forEach(O=>{E[O.merchantType]=(E[O.merchantType]||0)+O.amount});const y=Object.entries(E).sort((O,R)=>R[1]-O[1]),_=((N=y[0])==null?void 0:N[1])||1;document.getElementById("drilldownMerchants").innerHTML=`
        <p class="text-xs font-medium mb-2 -mt-2">Subcategories</p>
        ${y.map(([O,R])=>{const I=r[O]||v;return`
                <div class="flex items-center gap-2 cursor-pointer hover:opacity-80" onclick="closeDrilldown(); openDrilldown('${O}')">
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between text-xs mb-0.5">
                            <span class="truncate">${i(O)}</span>
                            <span class="font-medium">${s(R)}</span>
                        </div>
                        <div class="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full" style="width:${R/_*100}%;background:${I}"></div>
                        </div>
                    </div>
                </div>
            `}).join("")}
    `,document.getElementById("drilldownTxns").innerHTML=d.slice(0,20).map(O=>a(O)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function i0(n,t,e){var C;const{formatNum:s,escapeHtml:i,CAT_COLORS:r,renderTxnRow:o}=e,a=t.filtered.filter(E=>E.direction==="OUT"&&E.consolidated===n),l=a.reduce((E,y)=>E+y.amount,0),c=a.length>0?l/a.length:0;document.getElementById("drilldownTitle").textContent=n,document.getElementById("drilldownSubtitle").textContent=`${a.length} transactions - Avg: QAR ${s(c)}`,document.getElementById("drilldownTotal").textContent=`QAR ${s(l)}`;const d=t.dateRange.end.diff(t.dateRange.start,"day"),u=t.dateRange.start.subtract(d+1,"day"),h=t.dateRange.start.subtract(1,"day"),g=t.allTxns.filter(E=>E.direction==="OUT"&&E.consolidated===n&&E.date.isBetween(u,h,"day","[]")).reduce((E,y)=>E+y.amount,0),p=g>0?(l-g)/g*100:0;document.getElementById("drilldownDelta").textContent=(p>=0?"+":"")+p.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${p<=0?"text-fact-green":"text-fact-red"}`;const m=((C=a[0])==null?void 0:C.merchantType)||"Other",b=r[m]||"#999",v={};a.forEach(E=>{const y=E.date.format("YYYY-MM-DD");v[y]=(v[y]||0)+E.amount});const w=[];let k=t.dateRange.start;for(;k.isBefore(t.dateRange.end)||k.isSame(t.dateRange.end,"day");)w.push(k.format("YYYY-MM-DD")),k=k.add(1,"day");const A=document.getElementById("drilldownTimeline");Ue.drilldownTimeline&&Ue.drilldownTimeline.destroy(),Ue.drilldownTimeline=new ce(A,{type:"bar",data:{labels:w.map(E=>ct(E).format("D")),datasets:[{data:w.map(E=>v[E]||0),backgroundColor:b,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/w.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}}),document.getElementById("drilldownMerchants").innerHTML=`
        <div class="grid grid-cols-3 gap-3">
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Transactions</div>
                <div class="font-display font-bold">${a.length}</div>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Average</div>
                <div class="font-display font-bold">${s(c)}</div>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Category</div>
                <div class="font-display font-bold text-sm truncate">${i(m)}</div>
            </div>
        </div>
    `,document.getElementById("drilldownTxns").innerHTML=a.slice(0,30).map(E=>o(E)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function r0(n,t){const{formatNum:e,escapeHtml:s}=t,i=n.filtered.filter(r=>r.merchantType==="Uncategorized"&&r.direction==="OUT");document.getElementById("uncatList").innerHTML=i.map(r=>`
            <div class="p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer" data-raw="${btoa(unescape(encodeURIComponent(r.raw)))}" onclick="closeUncatModal(); openCatModalSafe(this)">
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${s(r.raw)}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${r.date.format("MMM D, HH:mm")}</div>
                </div>
                <div class="font-display font-semibold text-sm">${e(r.amount)}</div>
            </div>
        `).join(""),document.getElementById("uncatModal").classList.remove("hidden")}function o0(){document.getElementById("uncatModal").classList.add("hidden")}function a0(n,t){t.catTarget=n;const e=t.allTxns.find(i=>i.raw.toLowerCase()===n.toLowerCase());t.catTargetPreviousType=(e==null?void 0:e.merchantType)||null,document.getElementById("catModalRaw").textContent=n,document.getElementById("catModalName").value="";const s=document.getElementById("catModalRecipient");if(s&&(e!=null&&e.recipient)){const i=e.recipient;document.getElementById("catModalRecipientName").textContent=i.longName||i.shortName;const r=i.matchType==="phone"?`Phone: ${i.phone}`:i.matchType==="account"?`Account: ...${i.bankAccount.slice(-4)}`:"Name match";document.getElementById("catModalRecipientDetails").textContent=r,s.classList.remove("hidden")}else s&&s.classList.add("hidden");document.getElementById("catModal").classList.remove("hidden")}function zd(){document.getElementById("catModal").classList.add("hidden")}async function l0(n,t,e,s){var c;const{saveLocal:i,filterAndRender:r}=s,o=n.catTarget,a=document.getElementById("catModalName").value||o,l=document.getElementById("catModalCat").value;if(!l){alert("Please select a category");return}n.localMappings[o.toLowerCase()]={display:a,consolidated:a,category:l},i(),n.allTxns.forEach(d=>{d.raw.toLowerCase()===o.toLowerCase()&&(d.display=a,d.consolidated=a,d.merchantType=l)}),zd(),r();try{const{data:d}=await t.auth.getSession(),u=(c=d==null?void 0:d.session)==null?void 0:c.access_token;if(!u)throw new Error("Not authenticated");await fetch(`${e.FUNCTIONS_BASE}/flow-learn`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({counterparty:o,merchantType:l,consolidated:a,previousType:n.catTargetPreviousType||null})}),n.catTargetPreviousType=null}catch(d){console.warn("Failed to sync categorization:",d.message)}}function c0(n,t){const e=Array.from(n.categories).filter(r=>r!=="Uncategorized").sort(),s=document.getElementById("catModalCat");s&&(s.innerHTML=e.map(r=>`<option value="${t(r)}">${t(r)}</option>`).join(""));const i=document.getElementById("txnFilter");i&&(i.innerHTML='<option value="">All Categories</option>'+Array.from(n.categories).sort().map(r=>`<option value="${t(r)}">${t(r)}</option>`).join(""))}function d0(n,t){document.getElementById("txnModalCount").textContent=`${n.filtered.length} transactions`,document.getElementById("txnSearch").value="",document.getElementById("txnFilter").value="",t(n.filtered),document.getElementById("txnModal").classList.remove("hidden")}function u0(){document.getElementById("txnModal").classList.add("hidden")}function h0(n,t){const e=document.getElementById("txnSearch").value.toLowerCase(),s=document.getElementById("txnFilter").value;let i=n.filtered;e&&(i=i.filter(r=>r.display.toLowerCase().includes(e)||r.raw.toLowerCase().includes(e))),s&&(i=i.filter(r=>r.merchantType===s)),document.getElementById("txnModalCount").textContent=`${i.length} transactions`,t(i)}function f0(n,t){document.getElementById("txnModalList").innerHTML=n.slice(0,100).map(e=>t(e)).join("")}const _s=[];function g0(){const n=document.getElementById("aiChatInput");n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>n.focus(),300))}function p0(){}function Hd(n,t){const e=n.filtered.filter(r=>r.direction==="OUT"),s={};e.forEach(r=>{s[r.merchantType]||(s[r.merchantType]={total:0,count:0,txns:[]}),s[r.merchantType].total+=r.amount,s[r.merchantType].count++,s[r.merchantType].txns.push(r)});let i=`Period: ${n.dateRange.start.format("MMM D")} - ${n.dateRange.end.format("MMM D, YYYY")}
`;return i+=`Total Transactions: ${e.length}
`,i+=`Total Spent: QAR ${t(e.reduce((r,o)=>r+o.amount,0))}

`,i+=`By Type:
`,Object.entries(s).sort((r,o)=>o[1].total-r[1].total).forEach(([r,o])=>{i+=`- ${r}: QAR ${t(o.total)} (${o.count} txns)
`}),i+=`
Recent transactions (last 30):
`,e.slice(0,30).forEach(r=>{i+=`${r.date.format("MMM D HH:mm")} | ${r.display} | QAR ${t(r.amount)} | ${r.merchantType} | ${r.dims.when.join(", ")} | ${r.dims.pattern}
`}),i}async function m0(n,t,e,s,i){var g,p,m,b,v,w,k;const{formatNum:r,escapeHtml:o,sanitizeHTML:a,getSelectedAiModel:l,trackAchievement:c}=i,d=n||((p=(g=document.getElementById("aiChatInput"))==null?void 0:g.value)==null?void 0:p.trim());if(!d)return;const u=document.getElementById("aiChatMessages"),h=document.getElementById("aiChatInput");h&&(h.value=""),u&&(u.innerHTML+=`
            <div class="flex justify-end">
                <div class="bg-fact-yellow/20 rounded-lg px-3 py-2 max-w-[85%]">
                    <p class="text-sm">${o(d)}</p>
                </div>
            </div>
        `),_s.push({role:"user",content:d});const f="loading-"+Date.now();u&&(u.innerHTML+=`
            <div id="${f}" class="flex justify-start">
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2">
                    <p class="text-sm text-fact-muted animate-pulse">Thinking...</p>
                </div>
            </div>
        `,u.scrollTop=u.scrollHeight);try{const A=Hd(t,r),C=_s.slice(-6).map(M=>`${M.role==="user"?"User":"Assistant"}: ${M.content}`).join(`
`),E=`Transaction Data:
${A}

Conversation:
${C}`,{data:y}=await e.auth.getSession(),_=(m=y==null?void 0:y.session)==null?void 0:m.access_token;if(!_)throw new Error("Not authenticated");const T=await(await fetch(`${s.FUNCTIONS_BASE}/flow-ai`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},body:JSON.stringify({q:d,data:E,model:l()})})).json();if(T.error)throw new Error(T.error);if(T.remembered){_s.push({role:"assistant",content:T.message});const M=document.getElementById(f);M&&(M.innerHTML=`
                    <div class="bg-fact-green/10 border border-fact-green/30 rounded-lg px-3 py-2 max-w-[85%]">
                        <div class="flex items-center gap-1 text-fact-green text-xs font-medium mb-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            Noted
                        </div>
                        <p class="text-sm">${a(T.message)}</p>
                    </div>
                `);return}const P=T.answer;if(!P||P.trim()==="")throw new Error("No response received from AI. Please try again.");if(_s.push({role:"assistant",content:P}),T.model){const M=document.getElementById("aiModelName");if(M){const z=T.mode==="deep"?' <span class="text-fact-green">o</span>':"",D=T.contextLoaded,$=D&&D.income+D.payees+D.corrections+D.preferences+(D.rules||0)>0?' <span class="text-fact-purple" title="Using your context">*</span>':"";M.innerHTML=o(T.model)+z+$}}const B=T.contextLoaded,N=B&&B.income+B.payees+B.corrections+B.preferences+(B.rules||0)>0,O=T.mode==="deep"?'<div class="text-[9px] text-fact-green font-medium mb-1">DEEP ANALYSIS</div>':"",R=[];B!=null&&B.income&&R.push(`${B.income} income`),B!=null&&B.payees&&R.push(`${B.payees} payees`),B!=null&&B.corrections&&R.push(`${B.corrections} corrections`),B!=null&&B.rules&&R.push(`${B.rules} rules`),B!=null&&B.merchants&&R.push(`${B.merchants} merchants`);const I=N?`<div class="text-[9px] text-fact-purple font-medium mb-1">Using ${R.join(", ")}</div>`:"",L=document.getElementById(f);if(L){const M=window.marked||{parse:D=>D},z=typeof M<"u"&&M.parse?M.parse(P):P.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");L.innerHTML=`
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2 max-w-[85%]">
                    ${O}${I}
                    <div class="text-sm prose prose-sm dark:prose-invert">${a(z)}</div>
                </div>
            `}if(c("fact_asked_ai"),T.mode==="deep")try{await fetch(`${s.FUNCTIONS_BASE}/flow-profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},body:JSON.stringify({action:"insights.save",insight:{type:"deep",insights:`Q: ${d}
A: ${P.slice(0,500)}`,period_start:((v=(b=t.dateRange)==null?void 0:b.start)==null?void 0:v.toISOString())||null,period_end:((k=(w=t.dateRange)==null?void 0:w.end)==null?void 0:k.toISOString())||null,metadata:{model:T.model||"claude-sonnet",query:d}}})})}catch{}}catch(A){const C=document.getElementById(f);C&&(C.innerHTML=`
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2">
                    <p class="text-sm text-fact-red">Error: ${o(A.message)}</p>
                </div>
            `)}u&&(u.scrollTop=u.scrollHeight)}function y0(){_s.length=0;const n=document.getElementById("aiChatMessages");n&&(n.innerHTML=`
            <div class="text-fact-muted dark:text-fact-dark-muted text-xs">Ask me anything about your spending...</div>
        `)}function b0(n,t){const{formatNum:e}=t,s=n.filtered.filter(g=>g.direction==="OUT"),i=[],r=s.filter(g=>g.dims.pattern==="Night Out");if(r.length>0){const g=r.reduce((p,m)=>p+m.amount,0);i.push({icon:"party",text:`${r.length} Night Out transactions totaling QAR ${e(g)}`,filter:"nightOut"})}const o=s.filter(g=>g.dims.pattern==="Work Expense");if(o.length>0){const g=o.reduce((p,m)=>p+m.amount,0);i.push({icon:"work",text:`${o.length} potential work expenses (QAR ${e(g)})`,filter:"workHours"})}const a=s.filter(g=>g.dims.pattern==="Splurge");if(a.length>0){const g=a.reduce((p,m)=>p+m.amount,0);i.push({icon:"money",text:`${a.length} splurge purchases (QAR ${e(g)})`,filter:"splurge"})}const l=s.filter(g=>g.dims.pattern==="Subscription");if(l.length>0){const g=[...new Set(l.map(p=>p.consolidated))];i.push({icon:"calendar",text:`${g.length} detected subscriptions`,filter:"subscription"})}const c=s.filter(g=>g.isLateNight);if(c.length>=3){const g=c.reduce((p,m)=>p+m.amount,0);i.push({icon:"moon",text:`QAR ${e(g)} spent late at night (${c.length} txns)`,filter:"lateNight"})}const d=s.filter(g=>g.isLarge);d.length>0&&i.push({icon:"dots",text:`${d.length} large purchases (500+ QAR each)`,filter:"large"});const u=document.getElementById("insightsTags"),h=document.getElementById("insightsSection"),f=document.getElementById("insightsCount");if(f&&(f.textContent=i.length),!!h)if(i.length===0)h.classList.add("hidden");else{h.classList.remove("hidden");const g={nightOut:"bg-fact-purple/15 text-fact-purple border-fact-purple/30",workHours:"bg-fact-yellow/15 text-fact-ink border-fact-yellow/50",splurge:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800",subscription:"bg-fact-green/15 text-fact-green border-fact-green/30",lateNight:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800",large:"bg-gray-100 dark:bg-gray-800 text-fact-ink dark:text-fact-dark-ink border-fact-border dark:border-fact-dark-border"};u&&(u.innerHTML=i.map(p=>{const m=g[p.filter]||"bg-gray-100 dark:bg-gray-800 text-fact-muted border-fact-border";return`<button onclick="filterByDimension('${p.filter}')"
                    class="inline-flex items-center gap-1.5 px-2.5 py-1 text-[11px] font-medium rounded-full border ${m} hover:scale-105 transition-transform cursor-pointer">
                    <span>${p.icon}</span>
                    <span>${p.text}</span>
                </button>`}).join(""))}}function _0(){const n=document.getElementById("aiInsightsContainer");n&&n.classList.add("hidden")}async function v0(n,t,e,s){var u,h,f,g,p,m;const{formatNum:i,escapeHtml:r,sanitizeHTML:o,prepareTransactionSummary:a}=s,l=document.getElementById("refreshInsightsBtn"),c=document.getElementById("aiInsightsContainer"),d=document.getElementById("aiInsightsList");if(l){l.disabled=!0,l.innerHTML=`
        <svg class="w-3 h-3 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Analyzing...
    `;try{const b=a(n,i),v=n.userContext.length>0?`

User corrections/context: `+n.userContext.map(y=>y.value).join("; "):"",{data:w}=await t.auth.getSession(),k=(u=w==null?void 0:w.session)==null?void 0:u.access_token;if(!k)throw new Error("Not authenticated");const C=await(await fetch(`${e.FUNCTIONS_BASE}/flow-ai`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({q:"Analyse this spending data and return exactly 3-5 bullet points. Each must: (1) cite a specific QAR amount or percentage, (2) name the merchant/category involved, (3) end with one actionable suggestion. Start each bullet with a relevant emoji. One sentence per bullet, no headers."+v,data:b,model:"claude-sonnet"})})).json();if(C.error)throw new Error(C.error);const E=C.answer.split(`
`).filter(y=>y.trim().length>0).map(y=>y.replace(/^[-*]\s*/,"").trim()).filter(y=>y.length>0).slice(0,5);if(E.length>0&&c&&d){c.classList.remove("hidden"),d.innerHTML=E.map(y=>`
                <div class="px-2.5 py-1.5 text-[11px] bg-gradient-to-r from-fact-purple/5 to-fact-yellow/5 border border-fact-purple/20 rounded-lg text-fact-ink dark:text-fact-dark-ink">
                    ${o(y)}
                </div>
            `).join("");try{await fetch(`${e.FUNCTIONS_BASE}/flow-profile`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({action:"insights.save",insight:{type:"manual",insights:C.answer,period_start:((f=(h=n.dateRange)==null?void 0:h.start)==null?void 0:f.toISOString())||null,period_end:((p=(g=n.dateRange)==null?void 0:g.end)==null?void 0:p.toISOString())||null,metadata:{model:C.model||"claude-sonnet",txn_count:((m=n.filtered)==null?void 0:m.length)||0}}})})}catch{}}}catch(b){c&&d&&(c.classList.remove("hidden"),d.innerHTML=`<div class="text-[11px] text-fact-red">Error: ${r(b.message)}</div>`)}finally{l.disabled=!1,l.innerHTML=`
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Refresh
        `}}}function w0(n,t,e){const{showFilteredResults:s}=e;let i=[],r="";const o=t.filtered.filter(a=>a.direction==="OUT");switch(n){case"workHours":i=o.filter(a=>a.isWorkHours),r="Work Hours Spending";break;case"lateNight":i=o.filter(a=>a.isLateNight),r="Late Night Spending";break;case"nightOut":i=o.filter(a=>a.dims.pattern==="Night Out"),r="Night Out Sessions";break;case"splurge":i=o.filter(a=>a.dims.pattern==="Splurge"),r="Splurge Purchases";break;case"large":i=o.filter(a=>a.isLarge),r="Large Purchases (500+ QAR)";break;case"subscription":i=o.filter(a=>a.dims.pattern==="Subscription"),r="Detected Subscriptions";break;case"clear":Wd();return;default:return}s(i,r)}function x0(n,t,e){const{formatNum:s,renderTxnRowEnhanced:i}=e,r=n.reduce((a,l)=>a+l.amount,0),o=n.length>0?r/n.length:0;document.getElementById("filteredTitle").textContent=t,document.getElementById("filteredSubtitle").textContent=`${n.length} transactions`,document.getElementById("filteredTotal").textContent=`QAR ${s(r)}`,document.getElementById("filteredCount").textContent=n.length,document.getElementById("filteredAvg").textContent=`QAR ${s(o)}`,document.getElementById("filteredList").innerHTML=n.map(a=>i(a)).join(""),document.getElementById("filteredModal").classList.remove("hidden")}function Wd(){document.getElementById("filteredModal").classList.add("hidden")}function k0(n,t){var h,f;const{formatNum:e,escapeHtml:s,getTypeColor:i,MERCHANT_TYPES:r,PATTERNS:o}=t,a=n.direction==="OUT",l=i(n.merchantType),c=((h=r[n.merchantType])==null?void 0:h.icon)||"?",d=s(n.dims.pattern),u=n.dims.pattern!=="Normal"?`<span class="text-[10px] px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800">${((f=o[n.dims.pattern])==null?void 0:f.icon)||""} ${d}</span>`:"";return`
        <div class="txn-row p-3 flex items-center justify-between">
            <div class="flex items-center gap-3 min-w-0">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm" style="background:${l}20">${c}</div>
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${s(n.display)}</div>
                    <div class="flex items-center gap-2 text-[10px] text-fact-muted dark:text-fact-dark-muted">
                        <span>${n.date.format("MMM D, HH:mm")}</span>
                        <span>-</span>
                        <span>${s(n.dims.when.join(", "))}</span>
                        ${u}
                    </div>
                </div>
            </div>
            <div class="text-right">
                <div class="font-display font-semibold text-sm ${a?"":"text-fact-green"}">${a?"":"+"}${e(n.amount)}</div>
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${n.dims.size}</div>
            </div>
        </div>
    `}let be=null,As=!1;function Vd(n){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.SpeechRecognition||window.webkitSpeechRecognition;be=new t,be.continuous=!1,be.interimResults=!0,be.lang="en-US",be.onresult=e=>{const s=Array.from(e.results).map(r=>r[0].transcript).join(""),i=document.getElementById("aiChatInput");i&&(i.value=s)},be.onend=()=>{As=!1;const e=document.getElementById("voiceBtn"),s=document.getElementById("voiceStatus");e&&e.classList.remove("listening"),s&&s.classList.add("hidden");const i=document.getElementById("aiChatInput");i&&i.value.trim()&&n()},be.onerror=e=>{console.error("Voice recognition error:",e.error),As=!1;const s=document.getElementById("voiceBtn"),i=document.getElementById("voiceStatus");s&&s.classList.remove("listening"),i&&i.classList.add("hidden")}}}function S0(n,t){if(be||Vd(t),!be){alert("Voice input is not supported in this browser");return}const e=document.getElementById("voiceBtn"),s=document.getElementById("voiceStatus");if(As)be.stop(),As=!1,e&&e.classList.remove("listening"),s&&s.classList.add("hidden");else{be.start(),As=!0,e&&e.classList.add("listening"),s&&s.classList.remove("hidden"),n("fact_used_voice");const i=document.getElementById("aiChatInput");i&&(i.value="")}}function Gd(n,t){var o;const{escapeHtml:e}=t,s=document.getElementById("recipientsList");if(!s)return;const i=(((o=document.getElementById("recipientSearch"))==null?void 0:o.value)||"").toLowerCase();let r=n.recipients||[];if(i&&(r=r.filter(a=>{var l,c,d,u;return((l=a.shortName)==null?void 0:l.toLowerCase().includes(i))||((c=a.longName)==null?void 0:c.toLowerCase().includes(i))||((d=a.phone)==null?void 0:d.includes(i))||((u=a.bankAccount)==null?void 0:u.toLowerCase().includes(i))})),r.length===0){s.innerHTML=`
            <div class="text-center py-8">
                <div class="text-3xl mb-2">people</div>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted">
                    ${i?"No contacts match your search":"No contacts added yet"}
                </p>
                <p class="text-xs text-fact-muted dark:text-fact-dark-muted mt-1">
                    Add contacts to see friendly names on transfers
                </p>
            </div>
        `;return}s.innerHTML=r.map((a,l)=>`
        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl group">
            <div class="flex-1 min-w-0">
                <div class="font-medium text-sm truncate">${e(a.shortName||"Unnamed")}</div>
                ${a.longName?`<div class="text-xs text-fact-muted truncate">${e(a.longName)}</div>`:""}
                <div class="flex gap-3 mt-1 text-[10px] text-fact-muted">
                    ${a.phone?`<span>phone ${e(a.phone)}</span>`:""}
                    ${a.bankAccount?`<span>bank ...${e(a.bankAccount.slice(-4))}</span>`:""}
                </div>
            </div>
            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition">
                <button onclick="editRecipient(${l})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Edit contact">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                </button>
                <button onclick="deleteRecipient(${l})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-fact-red/10 text-fact-muted hover:text-fact-red transition" aria-label="Delete contact">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
    `).join("")}function E0(n,t){Gd(n,t)}function T0(){document.getElementById("recipientModalTitle").textContent="Add Contact",document.getElementById("recipientEditIndex").value="-1",document.getElementById("recipientPhone").value="",document.getElementById("recipientBankAccount").value="",document.getElementById("recipientShortName").value="",document.getElementById("recipientLongName").value="",document.getElementById("recipientModal").classList.remove("hidden"),setTimeout(()=>{var n;return(n=document.getElementById("recipientShortName"))==null?void 0:n.focus()},100)}function A0(n,t){const e=t.recipients[n];e&&(document.getElementById("recipientModalTitle").textContent="Edit Contact",document.getElementById("recipientEditIndex").value=n,document.getElementById("recipientPhone").value=e.phone||"",document.getElementById("recipientBankAccount").value=e.bankAccount||"",document.getElementById("recipientShortName").value=e.shortName||"",document.getElementById("recipientLongName").value=e.longName||"",document.getElementById("recipientModal").classList.remove("hidden"),setTimeout(()=>{var s;return(s=document.getElementById("recipientShortName"))==null?void 0:s.focus()},100))}function qd(){document.getElementById("recipientModal").classList.add("hidden")}async function C0(n,t,e,s){var u,h;const{showToast:i,renderRecipientsList:r}=s,o=parseInt(document.getElementById("recipientEditIndex").value),a=document.getElementById("recipientPhone").value.trim(),l=document.getElementById("recipientBankAccount").value.trim(),c=document.getElementById("recipientShortName").value.trim(),d=document.getElementById("recipientLongName").value.trim();if(!c){i("Short name is required","error"),(u=document.getElementById("recipientShortName"))==null||u.focus();return}if(!a&&!l){i("Phone or bank account is required","error");return}try{const{data:f}=await t.auth.getSession(),g=(h=f==null?void 0:f.session)==null?void 0:h.access_token;if(!g)throw new Error("Not authenticated");const p=o>=0?n.recipients[o]:null,b=await(await fetch(`${e.FUNCTIONS_BASE}/flow-recipients`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({subAction:o>=0?"update":"add",data:{id:(p==null?void 0:p.id)||null,phone:a,bankAccount:l,shortName:c,longName:d}})})).json();if(b.error)throw new Error(b.error);const v={id:(p==null?void 0:p.id)||b.id||null,phone:Id(a),bankAccount:l,shortName:c,longName:d};o>=0?(n.recipients[o]=v,i("Contact updated","success")):(n.recipients.push(v),i("Contact added","success")),qd(),r()}catch(f){console.error("Save recipient error:",f),i("Failed to save: "+f.message,"error")}}async function O0(n,t,e,s,i){var d;const{showToast:r,showConfirm:o,renderRecipientsList:a}=i,l=t.recipients[n];if(!(!l||!await o({title:"Delete Contact",message:`Remove ${l.shortName}?`,confirmText:"Delete",cancelText:"Keep",type:"danger"})))try{const{data:u}=await e.auth.getSession(),h=(d=u==null?void 0:u.session)==null?void 0:d.access_token;if(!h)throw new Error("Not authenticated");const g=await(await fetch(`${s.FUNCTIONS_BASE}/flow-recipients`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({subAction:"delete",data:{id:l.id}})})).json();if(g.error)throw new Error(g.error);t.recipients.splice(n,1),r(`Removed ${l.shortName}`,"info"),a()}catch(u){console.error("Delete recipient error:",u),r("Failed to delete: "+u.message,"error")}}function R0(n,t){const{renderHeatmap:e,trackAchievement:s}=t;e(),document.getElementById("heatmapModal").classList.remove("hidden"),s("fact_viewed_heatmap")}function Yd(){document.getElementById("heatmapModal").classList.add("hidden")}function I0(n,t){const{formatNum:e}=t,s=document.getElementById("heatmapContainer");if(!s)return;const i=n.allTxns.filter(b=>b.direction==="OUT"),r=ct(),o=r.subtract(90,"day"),a={};i.forEach(b=>{if(b.date.isAfter(o)&&b.date.isBefore(r.add(1,"day"))){const v=b.date.format("YYYY-MM-DD");a[v]=(a[v]||0)+b.amount}});const l=Object.values(a),c=Math.max(...l,1),d=l.length>0?l.reduce((b,v)=>b+v,0)/l.length:0,u=[];let h=[],f=o;const g=f.day();for(let b=0;b<g;b++)h.push(null);for(;f.isBefore(r)||f.isSame(r,"day");){const b=f.format("YYYY-MM-DD"),v=a[b]||0;h.push({date:f,amount:v,key:b}),f.day()===6&&(u.push(h),h=[]),f=f.add(1,"day")}h.length>0&&u.push(h);const p=b=>{if(b===0)return"#E5E5E5";const v=b/c;return v<.25?"#C6E48B":v<.5?"#7BC96F":v<.75?"#239A3B":"#196127"},m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];s.innerHTML=`
        <div class="flex gap-1">
            <div class="flex flex-col gap-1 text-[9px] text-fact-muted dark:text-fact-dark-muted mr-1">
                ${m.map((b,v)=>`<div class="h-3 flex items-center">${v%2===1?b:""}</div>`).join("")}
            </div>
            ${u.map(b=>`
                <div class="flex flex-col gap-1">
                    ${[0,1,2,3,4,5,6].map(v=>{const w=b[v];if(!w)return'<div class="heatmap-cell" style="background: transparent"></div>';const k=p(w.amount),A=`${w.date.format("MMM D")}: QAR ${e(w.amount)}`;return`<div class="heatmap-cell" style="background: ${k}" title="${A}" onclick="drilldownDate('${w.key}')"></div>`}).join("")}
                </div>
            `).join("")}
        </div>
        <div class="mt-4 grid grid-cols-3 gap-4 text-center text-xs">
            <div>
                <div class="text-lg font-display font-bold">${e(l.reduce((b,v)=>b+v,0))}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Total (90 days)</div>
            </div>
            <div>
                <div class="text-lg font-display font-bold">${e(d)}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Daily Avg</div>
            </div>
            <div>
                <div class="text-lg font-display font-bold">${e(c)}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Max Day</div>
            </div>
        </div>
    `}function M0(n,t,e){const{showFilteredResults:s}=e,i=ct(n),r=t.allTxns.filter(o=>o.direction==="OUT"&&o.date.format("YYYY-MM-DD")===n);s(r,`${i.format("MMM D, YYYY")}`),Yd()}function P0(n,t){const{showToast:e,trackAchievement:s}=t,i=document.getElementById("exportIcon");i&&i.classList.add("export-spin");try{const r=["Date","Time","Amount","Currency","Merchant","Category","Direction","Pattern"],o=n.filtered.map(u=>[u.date.format("YYYY-MM-DD"),u.date.format("HH:mm"),u.amount.toFixed(2),u.currency,`"${u.display.replace(/"/g,'""')}"`,u.merchantType,u.direction,u.dims.pattern]),a=[r.join(","),...o.map(u=>u.join(","))].join(`
`),l=new Blob([a],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),d=URL.createObjectURL(l);c.setAttribute("href",d),c.setAttribute("download",`fact-flow-${n.dateRange.start.format("YYYY-MM-DD")}-to-${n.dateRange.end.format("YYYY-MM-DD")}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d),e(`Exported ${o.length} transactions`,"success"),s("fact_exported")}catch(r){e("Export failed: "+r.message,"error")}finally{setTimeout(()=>{i&&i.classList.remove("export-spin")},500)}}const fo={"first-login":{icon:"rocket",name:"First Steps",desc:"Opened FACT/Flow for the first time",check:()=>!0},"first-categorize":{icon:"tag",name:"Organizer",desc:"Categorized your first transaction",check:n=>Object.keys(n.localMappings||{}).length>0},"ten-categorize":{icon:"list",name:"Sorting Pro",desc:"Categorized 10 transactions",check:n=>Object.keys(n.localMappings||{}).length>=10},"first-goal":{icon:"target",name:"Goal Setter",desc:"Set your first budget goal",check:(n,t)=>t(n).length>0},"three-goals":{icon:"circus",name:"Triple Threat",desc:"Set 3 budget goals",check:(n,t)=>t(n).length>=3},"streak-3":{icon:"fire",name:"On Fire",desc:"3-day under-budget streak",check:(n,t,e)=>e(n).longestStreak>=3},"streak-7":{icon:"lightning",name:"Week Warrior",desc:"7-day under-budget streak",check:(n,t,e)=>e(n).longestStreak>=7},"ask-ai":{icon:"robot",name:"AI Explorer",desc:"Asked AI for spending advice",check:()=>localStorage.getItem("fact_asked_ai")==="true"},"voice-input":{icon:"mic",name:"Voice Commander",desc:"Used voice input",check:()=>localStorage.getItem("fact_used_voice")==="true"},"dark-mode":{icon:"moon",name:"Night Owl",desc:"Switched to dark mode",check:()=>localStorage.getItem("fact_dark_mode")==="true"},"export-data":{icon:"chart",name:"Data Analyst",desc:"Exported your data to CSV",check:()=>localStorage.getItem("fact_exported")==="true"},"heatmap-view":{icon:"calendar",name:"Pattern Seeker",desc:"Viewed the spending heatmap",check:()=>localStorage.getItem("fact_viewed_heatmap")==="true"},"generosity-set":{icon:"heart",name:"Generous Heart",desc:"Set a generosity budget",check:n=>localStorage.getItem(`fact_generosity_${n.currentUser}`)!==null}};function Kd(n){try{return JSON.parse(localStorage.getItem(`fact_achievements_${n.currentUser}`))||[]}catch{return[]}}function L0(n,t){localStorage.setItem(`fact_achievements_${t.currentUser}`,JSON.stringify(n))}function D0(n,t){const{getGoals:e,getStreakData:s,celebrate:i}=t,r=Kd(n),o=[];return Object.entries(fo).forEach(([a,l])=>{!r.includes(a)&&l.check(n,e,s)&&(r.push(a),o.push({id:a,...l}))}),o.length>0&&(L0(r,n),setTimeout(()=>i(o[0]),500)),r}function $0(n){const t=document.getElementById("celebrationOverlay");if(!t)return;const e=["#F4C44E","#75B876","#B593C6","#E57373","#64B5F6"];let s="";for(let i=0;i<50;i++){const r=e[Math.floor(Math.random()*e.length)],o=Math.random()*100,a=Math.random()*2,l=5+Math.random()*10;s+=`<div class="confetti" style="left: ${o}%; background: ${r}; width: ${l}px; height: ${l}px; animation-delay: ${a}s; border-radius: ${Math.random()>.5?"50%":"0"}"></div>`}t.innerHTML=`
        <div class="celebration-overlay" onclick="closeCelebration()">
            ${s}
            <div class="celebration-box" onclick="event.stopPropagation()">
                <div class="celebration-icon">${n.icon}</div>
                <h2 class="font-display font-bold text-xl text-fact-ink mt-2">Achievement Unlocked!</h2>
                <h3 class="font-display font-semibold text-lg text-fact-ink mt-1">${n.name}</h3>
                <p class="text-sm text-fact-ink/70 mt-2">${n.desc}</p>
                <button onclick="closeCelebration()" class="mt-4 px-6 py-2 bg-fact-ink text-white rounded-full font-medium">
                    Awesome!
                </button>
            </div>
        </div>
    `,t.classList.remove("hidden"),setTimeout(Jd,5e3)}function Jd(){const n=document.getElementById("celebrationOverlay");n&&(n.classList.add("hidden"),n.innerHTML="")}function B0(n,t){const e=Kd(n),s=document.getElementById("achievementsList"),i=document.getElementById("achievementProgress");i&&(i.textContent=`${e.length} of ${Object.keys(fo).length} unlocked`),s&&(s.innerHTML=Object.entries(fo).map(([r,o])=>{const a=e.includes(r);return`
                <div class="achievement-badge ${a?"":"locked"}">
                    <div class="badge-icon">${o.icon}</div>
                    <div class="text-xs font-medium">${o.name}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mt-1">${a?o.desc:"???"}</div>
                </div>
            `}).join("")),document.getElementById("achievementsModal").classList.remove("hidden")}function N0(){document.getElementById("achievementsModal").classList.add("hidden")}function j0(n,t){localStorage.setItem(n,"true"),t&&setTimeout(t,100)}function F0(n,t){return new Promise(e=>{const{title:s,message:i,confirmText:r="Confirm",cancelText:o="Cancel",type:a="warning"}=n,l=document.getElementById("confirmModal");if(!l){e(!1);return}const c={warning:{bg:"bg-fact-yellow",icon:"warning"},danger:{bg:"bg-fact-red",icon:"trash"},info:{bg:"bg-fact-purple",icon:"info"}},d=c[a]||c.warning;l.innerHTML=`
            <div class="confirm-overlay" onclick="event.target === this && confirmResolve(false)">
                <div class="confirm-box">
                    <div class="text-4xl mb-4">${d.icon}</div>
                    <h3 class="font-display font-semibold text-lg mb-2">${t(s)}</h3>
                    <p class="text-sm text-fact-muted dark:text-fact-dark-muted mb-6">${t(i)}</p>
                    <div class="flex gap-3">
                        <button onclick="confirmResolve(false)" class="flex-1 px-4 py-2 text-sm rounded-lg border border-fact-border dark:border-fact-dark-border hover:bg-gray-50 dark:hover:bg-gray-800">${o}</button>
                        <button onclick="confirmResolve(true)" class="flex-1 px-4 py-2 text-sm rounded-lg ${d.bg} text-white font-medium">${r}</button>
                    </div>
                </div>
            </div>
        `,l.classList.remove("hidden"),window.confirmResolve=u=>{l.classList.add("hidden"),l.innerHTML="",e(u)}})}const U0=[{id:"gifts",name:"Gifts & Presents",default:!0},{id:"charity",name:"Charity & Donations",default:!0},{id:"treats",name:"Treating Others (meals, drinks)",default:!0},{id:"social",name:"Social Outings (I paid for everyone)",default:!1},{id:"family",name:"Family Support",default:!1}];function Xd(n){try{const t=localStorage.getItem(`fact_generosity_${n.currentUser}`);if(t)return JSON.parse(t)}catch{}return null}function z0(n,t){const{showToast:e,checkAchievements:s,renderGenerosityBudget:i}=t,r=document.getElementById("generosityBudgetInput"),o=parseFloat(r==null?void 0:r.value)||0,a=[];document.querySelectorAll('#generosityCategories input[type="checkbox"]:checked').forEach(c=>{a.push(c.value)});const l={budget:o,categories:a,enabled:o>0};localStorage.setItem(`fact_generosity_${n.currentUser}`,JSON.stringify(l)),setTimeout(()=>s(),500),Qd(),i(),e("Generosity budget saved!","success")}function H0(n){const t=Xd(n)||{budget:0,categories:["gifts","charity","treats"]},e=document.getElementById("generosityBudgetInput");e&&(e.value=t.budget||"");const s=document.getElementById("generosityCategories");s&&(s.innerHTML=U0.map(i=>{var o;const r=((o=t.categories)==null?void 0:o.includes(i.id))||!t.categories&&i.default;return`
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" value="${i.id}" ${r?"checked":""}
                        class="w-4 h-4 rounded border-fact-border text-fact-purple focus:ring-fact-purple">
                    <span>${i.name}</span>
                </label>
            `}).join("")),document.getElementById("generosityModal").classList.remove("hidden")}function Qd(){document.getElementById("generosityModal").classList.add("hidden")}function W0(n,t){const e=Xd(n),s=document.getElementById("generosityCard");if(!s)return;if(!e||!e.enabled){s.classList.add("hidden");return}s.classList.remove("hidden");const i=ct(),r=i.startOf("month"),l=n.allTxns.filter(p=>p.direction==="OUT"&&p.date.isAfter(r)&&p.date.isBefore(i.add(1,"day"))).filter(p=>p.merchantType==="Family"||p.summaryGroup==="Family").reduce((p,m)=>p+m.amount,0),c=Math.max(0,e.budget-l),d=e.budget>0?Math.min(l/e.budget*100,100):0,u=document.getElementById("generositySpent"),h=document.getElementById("generosityBudget"),f=document.getElementById("generosityMeterFill"),g=document.getElementById("generosityStatus");u&&(u.textContent=`QAR ${t(l)}`),h&&(h.textContent=`QAR ${t(e.budget)}`),f&&(f.style.width=`${d}%`,f.className=`generosity-meter-fill ${l>e.budget?"over":""}`),g&&(l>e.budget?(g.textContent=`Over budget by QAR ${t(l-e.budget)}`,g.className="text-xs text-fact-red"):(g.textContent=`QAR ${t(c)} left to give`,g.className="text-xs text-fact-muted dark:text-fact-dark-muted"))}function V0(n,t){const{checkDailyBudget:e,getStreakData:s,getGoals:i,trackAchievement:r}=t,o=document.getElementById("healthScoreModal");if(!o)return;const a=e(),l=s(n),c=i(n);let d=50;a.status==="safe"?d+=20:a.status==="warning"&&(d+=10),d+=Math.min(20,l.currentStreak*4),d+=Math.min(10,c.length*3);const u=document.getElementById("healthScoreNumber");u&&(u.textContent=d);const h=document.getElementById("healthStatusLabel"),f=document.getElementById("healthStatusDesc");h&&f&&(d>=80?(h.textContent="Excellent!",f.textContent="Your finances are in great shape"):d>=60?(h.textContent="Good",f.textContent="You're on the right track"):(h.textContent="Needs Work",f.textContent="Let's focus on building better habits")),o.classList.remove("hidden"),r("fact_health_score")}function G0(){document.getElementById("healthScoreModal").classList.add("hidden")}function q0(n){const e=ct().hour();(e>=22||e<5)&&!sessionStorage.getItem("fact_nudge_shown")&&(sessionStorage.setItem("fact_nudge_shown","true"),Math.random()>.7&&n("Late night spending? Sleep on it!","info"))}ct.extend(f_);const Rt={STORAGE_KEY:"qnb_tracker_v4",DEFAULT_FX:{USD:3.65,EUR:3.95,GBP:4.6,SAR:.97},SUPABASE_URL:"https://fihxypjmvizgwinozjsf.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpaHh5cGptdml6Z3dpbm96anNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzMwMzgsImV4cCI6MjA4NTc0OTAzOH0.t-7r7VgDHOMhM6hB57-PNm8h-By8VKgiUUtxfs8Z4sE",FUNCTIONS_BASE:"https://fihxypjmvizgwinozjsf.supabase.co/functions/v1",SHORTCUT_TEMPLATE_URL:"YOUR_SHORTCUT_TEMPLATE_URL",AUTH_REDIRECT_URL:"https://www.fact.qa/flow/"},It=eg(Rt.SUPABASE_URL,Rt.SUPABASE_ANON_KEY),fe={Groceries:{color:"#4CAF50",icon:"",essential:!0},Dining:{color:"#E67E22",icon:"",essential:!1},"Bars & Nightlife":{color:"#AB47BC",icon:"",essential:!1},Coffee:{color:"#795548",icon:"",essential:!1},Delivery:{color:"#FFA726",icon:"",essential:!1},Shopping:{color:"#42A5F5",icon:"",essential:!1},Transport:{color:"#26C6DA",icon:"",essential:!0},Health:{color:"#66BB6A",icon:"",essential:!0},Bills:{color:"#78909C",icon:"",essential:!0},Travel:{color:"#FF7043",icon:"",essential:!1},Entertainment:{color:"#EC407A",icon:"",essential:!1},Transfer:{color:"#8D6E63",icon:"",essential:!1},Family:{color:"#E91E63",icon:"",essential:!1},Other:{color:"#95A5A6",icon:"",essential:!1},Uncategorized:{color:"#E74C3C",icon:"",essential:!1}},Y0={Micro:{max:25,color:"#BDC3C7",icon:""},Small:{max:100,color:"#95A5A6",icon:""},Medium:{max:500,color:"#7F8C8D",icon:""},Large:{max:2e3,color:"#34495E",icon:""},Major:{max:1/0,color:"#2C3E50",icon:""}},Zd={Routine:{color:"#3498DB",icon:"",description:"Regular, repeated spending"},"Night Out":{color:"#9B59B6",icon:"",description:"Evening social spending cluster"},Splurge:{color:"#E74C3C",icon:"",description:"Unusually large purchase"},Trip:{color:"#E67E22",icon:"",description:"Travel-related cluster"},Subscription:{color:"#1ABC9C",icon:"",description:"Recurring fixed amount"},"Work Expense":{color:"#3498DB",icon:"",description:"Likely work-related"},Normal:{color:"#95A5A6",icon:"",description:"Standard transaction"}},Kn={Essentials:{color:"#75B876",icon:"",types:["Groceries","Bills","Health","Transport"]},"Food & Drinks":{color:"#F4C44E",icon:"",types:["Dining","Coffee","Delivery","Bars & Nightlife"]},"Shopping & Fun":{color:"#9B8AC4",icon:"",types:["Shopping","Entertainment","Travel"]},Family:{color:"#E8A4B8",icon:"",types:["Family"]},Other:{color:"#A8B5C4",icon:"",types:["Transfer","Other","Uncategorized"]}},En={};Object.entries(fe).forEach(([n,t])=>En[n]=t.color);Object.entries(Kn).forEach(([n,t])=>En[n]=t.color);function tu(n){for(const[t,e]of Object.entries(Kn))if(e.types.includes(n))return t;return"Other"}function eu(n){const t=n.hour(),e=n.day(),s=[];return(e===5||e===6)&&s.push("Weekend"),t>=7&&t<16&&e>=0&&e<=4&&s.push("Work Hours"),t>=17&&t<21&&s.push("Evening"),(t>=21||t<5)&&s.push("Late Night"),t>=5&&t<7&&s.push("Early Morning"),s.length>0?s:["Normal"]}function nu(n){for(const[t,e]of Object.entries(Y0))if(n<=e.max)return t;return"Major"}function su(n){var t;return((t=fe[n])==null?void 0:t.color)||"#95A5A6"}function K0(n){var t;return((t=Kn[n])==null?void 0:t.color)||"#95A5A6"}const U={allTxns:[],filtered:[],merchantMap:[],recipients:[],categories:new Set,fxRates:{...Rt.DEFAULT_FX},localMappings:{},userContext:[],period:"salary",dateRange:{start:ct().subtract(60,"day"),end:ct()},catTarget:null,currentUser:"default",viewMode:"parent",hasLoaded:!1,profile:null,dbGoals:null,dbInsights:null,dbStreaks:null};function Jn(){Ev(U,{renderBudgetProjection:X0,renderDonutChart:ru,renderCategoryBreakdown:iu,renderRecentTxns:nr,renderUncatAlert:lw,renderQuickInsights:uu,renderTodaySection:J0,checkForImpulseBursts:tw})}function J0(){Tv(U,{checkDailyBudget:Tn,formatNum:xt,updateDailyBudgetMeter:Z0,updateStreak:nw,renderStreakBadge:sw,renderGenerosityBudget:Vo,updateFocusHero:ow,updateQuickInsight:aw,isFocusMode:bn})}function iu(){Av(U,{formatNum:xt,SUMMARY_GROUPS:Kn,MERCHANT_TYPES:fe})}function ru(){Iv(U,{formatNum:xt,CAT_COLORS:En})}function X0(){Mv(U,{calculateBudgetProjection:ou,formatNum:xt})}function ou(){return lv(U)}function No(){av(U,Jn,au)}function jo(n){cv(n,U,Jn,au)}function au(){dv(U)}function Q0(){hv(U,Jn)}function Tn(){return Nv(U,ou)}function Z0(){jv(U,{checkDailyBudget:Tn,formatNum:xt,showToast:te})}function tw(){Fv(U,xt)}function ew(){Uv(U)}function Gs(){return $o(U)}function nw(){return Hv(U,Tn)}function sw(){Wv(U)}function Fo(){return er(U)}function iw(n){Bo(n,U)}function rw(){Pv(U,te)}function ow(){Lv(U,{checkDailyBudget:Tn,formatNum:xt,getStreakData:Gs})}function aw(){Dv(U,{checkDailyBudget:Tn,formatNum:xt,getStreakData:Gs})}function nr(){Xv(U,{renderTxnRow:qs})}function qs(n){return Qv(n,{formatNum:xt,escapeHtml:Zt,getTypeColor:su,MERCHANT_TYPES:fe})}function lw(){t0(U,xt)}function cw(n){e0(n,U,{formatNum:xt,escapeHtml:Zt,CAT_COLORS:En,renderTxnRow:qs})}function dw(n){s0(n,U,{formatNum:xt,escapeHtml:Zt,CAT_COLORS:En,getGroupColor:K0,renderTxnRow:qs,SUMMARY_GROUPS:Kn})}function uw(n){i0(n,U,{formatNum:xt,escapeHtml:Zt,CAT_COLORS:En,renderTxnRow:qs})}function hw(){r0(U,{formatNum:xt,escapeHtml:Zt})}function lu(n){a0(n,U)}function fw(n){Zv(n,lu)}async function gw(){await l0(U,It,Rt,{saveLocal:()=>iv(Rt,U),filterAndRender:Jn})}function cu(){c0(U,Zt)}function pw(){d0(U,du)}function du(n){f0(n,qs)}function oc(){h0(U,du)}function mw(n){Rv(n,U,iu,ru)}function yw(n){Cv(n,U,nr)}function bw(n){Ov(n,U,nr)}function uu(){b0(U,{formatNum:xt})}async function Uo(n){await m0(n,U,It,Rt,{formatNum:xt,escapeHtml:Zt,sanitizeHTML:Po,getSelectedAiModel:vv,trackAchievement:Xs})}async function _w(){await v0(U,It,Rt,{formatNum:xt,escapeHtml:Zt,sanitizeHTML:Po,prepareTransactionSummary:hu})}function hu(){return Hd(U,xt)}function vw(n){w0(n,U,{showFilteredResults:zo})}function zo(n,t){x0(n,t,{formatNum:xt,renderTxnRowEnhanced:ww})}function ww(n){return k0(n,{formatNum:xt,escapeHtml:Zt,getTypeColor:su,MERCHANT_TYPES:fe,PATTERNS:Zd})}function xw(){S0(Xs,Uo)}function Ho(){xv(U)}async function kw(){await kv(It,Rt,U,te)}function fu(n=null){fv(n,{renderSettingsGoalsList:Ys,renderRecipientsList:Ks,loadProfileTab:Ho})}function Sw(){gv(te)}function Ys(){qv(U,{formatNum:xt,escapeHtml:Zt,MERCHANT_TYPES:fe})}function Ew(){Yv(fe)}function Tw(){Kv(U,{showToast:te,renderSettingsGoalsList:Ys})}async function Aw(n){await Jv(n,U,{showConfirm:Wo,showToast:te,formatNum:xt,renderSettingsGoalsList:Ys})}function Cw(){Gv(fu)}function Ks(){Gd(U,{escapeHtml:Zt})}function Ow(n){A0(n,U)}async function Rw(){await C0(U,It,Rt,{showToast:te,renderRecipientsList:Ks})}async function Iw(n){await O0(n,U,It,Rt,{showToast:te,showConfirm:Wo,renderRecipientsList:Ks})}function Mw(){R0(U,{renderHeatmap:gu,trackAchievement:Xs})}function gu(){I0(U,{formatNum:xt})}function Pw(n){M0(n,U,{showFilteredResults:zo})}function Lw(){P0(U,{showToast:te,trackAchievement:Xs})}function Js(){return D0(U,{getGoals:Fo,getStreakData:Gs,celebrate:$0})}function Xs(n){j0(n,Js)}function Dw(){B0(U)}function Wo(n){return F0(n,Zt)}function $w(){H0(U)}function Bw(){z0(U,{showToast:te,checkAchievements:Js,renderGenerosityBudget:Vo})}function Vo(){W0(U,xt)}function Nw(){V0(U,{checkDailyBudget:Tn,getStreakData:Gs,getGoals:Fo,trackAchievement:Xs})}function Go(){q0(te)}let xi=!1;function pu(){const n=document.getElementById("authGuardCSS");n&&n.remove()}function ds(){pu(),document.getElementById("loginScreen").classList.remove("hidden"),document.getElementById("mainApp").classList.add("hidden")}document.addEventListener("DOMContentLoaded",async()=>{var r;It.auth.onAuthStateChange((o,a)=>{(o==="SIGNED_IN"||o==="TOKEN_REFRESHED"||o==="INITIAL_SESSION")&&(a!=null&&a.user)&&(xi||(xi=!0,mu(a.user))),o==="SIGNED_OUT"&&(xi=!1,ds())});const n=new URLSearchParams(window.location.search),t=new URLSearchParams(window.location.hash.replace("#","?")),e=n.get("error_description")||t.get("error_description");if(e){history.replaceState(null,"",window.location.pathname),ds(),wn(e==="OAuth callback with invalid state"?"Login link expired. Please try again.":e);return}const s=n.get("code");if(s)try{const{error:o}=await It.auth.exchangeCodeForSession(s);if(o){console.error("PKCE exchange failed:",o.message),history.replaceState(null,"",window.location.pathname),ds(),wn("Login failed. Please try again.");return}history.replaceState(null,"",window.location.pathname);return}catch(o){console.error("PKCE exchange error:",o),history.replaceState(null,"",window.location.pathname),ds(),wn("Login failed. Please try again.");return}const{data:i}=await It.auth.getSession();!((r=i==null?void 0:i.session)!=null&&r.user)&&!xi&&ds()});async function jw(){const n=document.getElementById("loginUsername").value.trim();if(!n)return wn("Please enter your email");const t=document.getElementById("loginBtn");t.textContent="Sending link...",t.disabled=!0;try{const{error:e}=await It.auth.signInWithOtp({email:n,options:{emailRedirectTo:Rt.AUTH_REDIRECT_URL}});if(e)throw e;wn("Magic link sent. Check your email.",!1)}catch(e){wn(e.message||"Login failed")}finally{t.textContent="Send magic link",t.disabled=!1}}async function Fw(){const{error:n}=await It.auth.signInWithOAuth({provider:"google",options:{redirectTo:Rt.AUTH_REDIRECT_URL,skipBrowserRedirect:!1}});n&&wn(n.message)}function wn(n,t=!0){const e=document.getElementById("loginError");e.textContent=n,e.classList.remove("hidden"),e.classList.toggle("text-fact-red",t),e.classList.toggle("text-fact-green",!t),setTimeout(()=>e.classList.add("hidden"),4e3)}async function mu(n){pu(),document.getElementById("loginScreen").classList.add("hidden"),document.getElementById("mainApp").classList.remove("hidden"),U.currentUser=n.email||"user",U.authToken=null;const t=document.getElementById("currentUserDisplay");t.textContent=(n.email||"User").split("@")[0];const e=document.getElementById("aiModelName");e&&(e.textContent=localStorage.getItem("fact_ai_model")||"claude-sonnet"),window.location.hash&&window.location.hash.includes("access_token")&&history.replaceState(null,"",window.location.pathname),sv(Rt,U),await Rd(It,Rt,U,{showToast:te,filterAndRender:Jn,checkAchievements:Js,renderPatternWarnings:Go,setSalaryPeriod:No,setPeriod:jo,updateCatDropdowns:cu,MERCHANT_TYPES:fe,getSummaryGroup:tu,getTimeContext:eu,getSizeTier:nu,categorize:(r,o)=>Ld(r,o,U,fe),detectPatterns:()=>$d(U,r=>Pd(r,U)),matchRecipient:r=>Md(r,U)}),Vv(U,It,Rt).catch(r=>console.warn("Goals migration skipped:",r.message)),H_(It);const s=document.getElementById("txnSearch"),i=document.getElementById("txnFilter");s&&s.addEventListener("input",$_(oc,200)),i&&i.addEventListener("change",oc)}async function Uw(){await It.auth.signOut(),location.reload()}document.addEventListener("DOMContentLoaded",()=>{$v(U),U_(),B_(),N_()});window.attemptLogin=jw;window.loginWithGoogle=Fw;window.logout=Uw;window.showApp=mu;window.syncData=()=>Rd(It,Rt,U,{showToast:te,filterAndRender:Jn,checkAchievements:Js,renderPatternWarnings:Go,setSalaryPeriod:No,setPeriod:jo,updateCatDropdowns:cu,MERCHANT_TYPES:fe,getSummaryGroup:tu,getTimeContext:eu,getSizeTier:nu,categorize:(n,t)=>Ld(n,t,U,fe),detectPatterns:()=>$d(U,n=>Pd(n,U)),matchRecipient:n=>Md(n,U)});window.setPeriod=jo;window.setSalaryPeriod=No;window.openDatePicker=()=>uv(U);window.closeDatePicker=Bd;window.applyCustomDate=Q0;window.openSettings=fu;window.closeSettings=jd;window.saveSettings=Sw;window.switchSettingsTab=n=>Nd(n,{renderSettingsGoalsList:Ys,renderRecipientsList:Ks,loadProfileTab:Ho});window.generateShortcutKey=()=>pv(It,Rt);window.revokeShortcutKey=()=>mv(It,Rt);window.copyShortcutKey=yv;window.openShortcutSetup=()=>bv(Rt);window.closeShortcutSetup=_v;window.changePassword=()=>Sv(It);window.runBackfill=()=>wv(It,Rt,te);window.saveProfile=kw;window.loadProfileTab=Ho;window.setViewMode=mw;window.sortTransactions=yw;window.filterTransactions=bw;window.openOnboarding=Cd;window.closeOnboarding=Od;window.onboardingNext=W_;window.onboardingPrev=V_;window.selectOnboardingBank=G_;window.onboardingGenerateKey=()=>q_(It,Rt);window.copyOnboardingKey=Y_;window.toggleDarkMode=z_;window.toggleFocusMode=rw;window.dismissImpulseBanner=ew;window.installPWA=j_;window.dismissInstall=F_;window.showToast=te;window.formatNum=xt;window.escapeHtml=Zt;window.sanitizeHTML=Po;window.getGoals=Fo;window.saveGoals=iw;window.checkDailyBudget=Tn;window.getStreakData=Gs;window.STATE=U;window.CONFIG=Rt;window.supabaseClient=It;window.dayjs=ct;window.Chart=ce;window.MERCHANT_TYPES=fe;window.SUMMARY_GROUPS=Kn;window.CAT_COLORS=En;window.PATTERNS=Zd;window.openAskAI=g0;window.closeAskAI=p0;window.askAIChat=Uo;window.clearAIChat=y0;window.closeAchievements=N0;window.closeAiInsights=_0;window.closeGenerositySettings=Qd;window.closeHealthScore=G0;window.exportCSV=Lw;window.filterByDimension=vw;window.openGenerositySettings=$w;window.openGoals=Cw;window.openHeatmap=Mw;window.openTxnModal=pw;window.openUncatModal=hw;window.refreshInsights=_w;window.saveGenerositySettings=Bw;window.toggleVoiceInput=xw;window.renderRecentTxns=nr;window.openDrilldown=cw;window.closeDrilldown=n0;window.openParentDrilldown=dw;window.openMerchantDrilldown=uw;window.closeUncatModal=o0;window.openCatModal=lu;window.openCatModalSafe=fw;window.closeCatModal=zd;window.saveCategorization=gw;window.closeTxnModal=u0;window.closeFilteredModal=Wd;window.showFilteredResults=zo;window.closeHeatmap=Yd;window.openAchievements=Dw;window.openHealthScore=Nw;window.renderQuickInsights=uu;window.renderGenerosityBudget=Vo;window.renderPatternWarnings=Go;window.checkAchievements=Js;window.showConfirm=Wo;window.renderSettingsGoalsList=Ys;window.addNewGoal=Ew;window.closeAddGoal=Ud;window.saveGoal=Tw;window.deleteGoal=Aw;window.renderRecipientsList=Ks;window.addNewRecipient=T0;window.editRecipient=Ow;window.closeRecipientModal=qd;window.saveRecipient=Rw;window.deleteRecipient=Iw;window.filterRecipientsList=()=>E0(U,{escapeHtml:Zt});window.renderHeatmap=gu;window.drilldownDate=Pw;window.prepareTransactionSummary=hu;window.initVoiceRecognition=()=>Vd(Uo);window.closeCelebration=Jd;window.confirmResolve=()=>{};
