var ou=Object.defineProperty;var au=(n,t,e)=>t in n?ou(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var F=(n,t,e)=>au(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function Ui(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(e[s[i]]=n[s[i]]);return e}function lu(n,t,e,s){function i(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(d){try{c(s.next(d))}catch(u){o(u)}}function l(d){try{c(s.throw(d))}catch(u){o(u)}}function c(d){d.done?r(d.value):i(d.value).then(a,l)}c((s=s.apply(n,t||[])).next())})}const cu=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class mo extends Error{constructor(t,e="FunctionsError",s){super(t),this.name=e,this.context=s}}class du extends mo{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Xo extends mo{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Qo extends mo{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Dr;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Dr||(Dr={}));class uu{constructor(t,{headers:e={},customFetch:s,region:i=Dr.Any}={}){this.url=t,this.headers=e,this.region=i,this.fetch=cu(s)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return lu(this,arguments,void 0,function*(e,s={}){var i;let r,o;try{const{headers:a,method:l,body:c,signal:d,timeout:u}=s;let h={},{region:f}=s;f||(f=this.region);const g=new URL(`${this.url}/${e}`);f&&f!=="any"&&(h["x-region"]=f,g.searchParams.set("forceFunctionRegion",f));let p;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",p=c):typeof c=="string"?(h["Content-Type"]="text/plain",p=c):typeof FormData<"u"&&c instanceof FormData?p=c:(h["Content-Type"]="application/json",p=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?p=JSON.stringify(c):p=c;let m=d;u&&(o=new AbortController,r=setTimeout(()=>o.abort(),u),d?(m=o.signal,d.addEventListener("abort",()=>o.abort())):m=o.signal);const b=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:p,signal:m}).catch(E=>{throw new du(E)}),_=b.headers.get("x-relay-error");if(_&&_==="true")throw new Xo(b);if(!b.ok)throw new Qo(b);let x=((i=b.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),S;return x==="application/json"?S=yield b.json():x==="application/octet-stream"||x==="application/pdf"?S=yield b.blob():x==="text/event-stream"?S=b:x==="multipart/form-data"?S=yield b.formData():S=yield b.text(),{data:S,error:null,response:b}}catch(a){return{data:null,error:a,response:a instanceof Qo||a instanceof Xo?a.context:void 0}}finally{r&&clearTimeout(r)}})}}var hu=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},fu=class{constructor(n){var t,e,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(e=n.isMaybeSingle)!==null&&e!==void 0?e:!1,this.urlLengthLimit=(s=n.urlLengthLimit)!==null&&s!==void 0?s:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var e=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let o=null,a=null,l=null,c=r.status,d=r.statusText;if(r.ok){var u,h;if(e.method!=="HEAD"){var f;const b=await r.text();b===""||(e.headers.get("Accept")==="text/csv"||e.headers.get("Accept")&&(!((f=e.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=b:a=JSON.parse(b))}const p=(u=e.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(h=r.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");p&&m&&m.length>1&&(l=parseInt(m[1])),e.isMaybeSingle&&e.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var g;const p=await r.text();try{o=JSON.parse(p),Array.isArray(o)&&r.status===404&&(a=[],o=null,c=200,d="OK")}catch{r.status===404&&p===""?(c=204,d="No Content"):o={message:p}}if(o&&e.isMaybeSingle&&(!(o==null||(g=o.details)===null||g===void 0)&&g.includes("0 rows"))&&(o=null,c=200,d="OK"),o&&e.shouldThrowOnError)throw new hu(o)}return{error:o,data:a,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(i=i.catch(r=>{var o;let a="",l="",c="";const d=r==null?void 0:r.cause;if(d){var u,h,f,g;const b=(u=d==null?void 0:d.message)!==null&&u!==void 0?u:"",_=(h=d==null?void 0:d.code)!==null&&h!==void 0?h:"";a=`${(f=r==null?void 0:r.name)!==null&&f!==void 0?f:"FetchError"}: ${r==null?void 0:r.message}`,a+=`

Caused by: ${(g=d==null?void 0:d.name)!==null&&g!==void 0?g:"Error"}: ${b}`,_&&(a+=` (${_})`),d!=null&&d.stack&&(a+=`
${d.stack}`)}else{var p;a=(p=r==null?void 0:r.stack)!==null&&p!==void 0?p:""}const m=this.url.toString().length;return(r==null?void 0:r.name)==="AbortError"||(r==null?void 0:r.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",m>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${m} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((d==null?void 0:d.name)==="HeadersOverflowError"||(d==null?void 0:d.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",m>this.urlLengthLimit&&(l+=`. Your request URL is ${m} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:a,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),i.then(n,t)}returns(){return this}overrideTypes(){return this}},gu=class extends fu{select(n){let t=!1;const e=(n??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",e),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:e,foreignTable:s,referencedTable:i=s}={}){const r=i?`${i}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${n}.${t?"asc":"desc"}${e===void 0?"":e?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:e=t}={}){const s=typeof e>"u"?"limit":`${e}.limit`;return this.url.searchParams.set(s,`${n}`),this}range(n,t,{foreignTable:e,referencedTable:s=e}={}){const i=typeof s>"u"?"offset":`${s}.offset`,r=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(r,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:e=!1,buffers:s=!1,wal:i=!1,format:r="text"}={}){var o;const a=[n?"analyze":null,t?"verbose":null,e?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${l}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const Zo=new RegExp("[,()]");var Un=class extends gu{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const e=Array.from(new Set(t)).map(s=>typeof s=="string"&&Zo.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(n,`in.(${e})`),this}notIn(n,t){const e=Array.from(new Set(t)).map(s=>typeof s=="string"&&Zo.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(n,`not.in.(${e})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:e,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const r=e===void 0?"":`(${e})`;return this.url.searchParams.append(n,`${i}fts${r}.${t}`),this}match(n){return Object.entries(n).forEach(([t,e])=>{this.url.searchParams.append(t,`eq.${e}`)}),this}not(n,t,e){return this.url.searchParams.append(n,`not.${t}.${e}`),this}or(n,{foreignTable:t,referencedTable:e=t}={}){const s=e?`${e}.or`:"or";return this.url.searchParams.append(s,`(${n})`),this}filter(n,t,e){return this.url.searchParams.append(n,`${t}.${e}`),this}},pu=class{constructor(n,{headers:t={},schema:e,fetch:s,urlLengthLimit:i=8e3}){this.url=n,this.headers=new Headers(t),this.schema=e,this.fetch=s,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,t){const{head:e=!1,count:s}=t??{},i=e?"HEAD":"GET";let r=!1;const o=(n??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),s&&l.append("Prefer",`count=${s}`),new Un({method:i,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:t,defaultToNull:e=!0}={}){var s;const i="POST",{url:r,headers:o}=this.cloneRequestState();if(t&&o.append("Prefer",`count=${t}`),e||o.append("Prefer","missing=default"),Array.isArray(n)){const a=n.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);r.searchParams.set("columns",l.join(","))}}return new Un({method:i,url:r,headers:o,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:t,ignoreDuplicates:e=!1,count:s,defaultToNull:i=!0}={}){var r;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${e?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),s&&l.append("Prefer",`count=${s}`),i||l.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);a.searchParams.set("columns",d.join(","))}}return new Un({method:o,url:a,headers:l,schema:this.schema,body:n,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:t}={}){var e;const s="PATCH",{url:i,headers:r}=this.cloneRequestState();return t&&r.append("Prefer",`count=${t}`),new Un({method:s,url:i,headers:r,schema:this.schema,body:n,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var t;const e="DELETE",{url:s,headers:i}=this.cloneRequestState();return n&&i.append("Prefer",`count=${n}`),new Un({method:e,url:s,headers:i,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function As(n){"@babel/helpers - typeof";return As=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},As(n)}function mu(n,t){if(As(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(As(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function yu(n){var t=mu(n,"string");return As(t)=="symbol"?t:t+""}function bu(n,t,e){return(t=yu(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function ta(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function Js(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ta(Object(e),!0).forEach(function(s){bu(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ta(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}var _u=class Zl{constructor(t,{headers:e={},schema:s,fetch:i,timeout:r,urlLengthLimit:o=8e3}={}){this.url=t,this.headers=new Headers(e),this.schemaName=s,this.urlLengthLimit=o;const a=i??globalThis.fetch;r!==void 0&&r>0?this.fetch=(l,c)=>{const d=new AbortController,u=setTimeout(()=>d.abort(),r),h=c==null?void 0:c.signal;if(h){if(h.aborted)return clearTimeout(u),a(l,c);const f=()=>{clearTimeout(u),d.abort()};return h.addEventListener("abort",f,{once:!0}),a(l,Js(Js({},c),{},{signal:d.signal})).finally(()=>{clearTimeout(u),h.removeEventListener("abort",f)})}return a(l,Js(Js({},c),{},{signal:d.signal})).finally(()=>clearTimeout(u))}:this.fetch=a}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new pu(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new Zl(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,e={},{head:s=!1,get:i=!1,count:r}={}){var o;let a;const l=new URL(`${this.url}/rpc/${t}`);let c;const d=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(d)),u=s&&Object.values(e).some(d);u?(a="POST",c=e):s||i?(a=s?"HEAD":"GET",Object.entries(e).filter(([f,g])=>g!==void 0).map(([f,g])=>[f,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([f,g])=>{l.searchParams.append(f,g)})):(a="POST",c=e);const h=new Headers(this.headers);return u?h.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&h.set("Prefer",`count=${r}`),new Un({method:a,url:l,headers:h,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class vu{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const e=globalThis.process;if(e){const s=e.versions;if(s&&s.node){const i=s.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let e=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(e+=`

Suggested solution: ${t.workaround}`),new Error(e)}static createWebSocket(t,e){const s=this.getWebSocketConstructor();return new s(t,e)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const wu="2.94.1",xu=`realtime-js/${wu}`,ku="1.0.0",tc="2.0.0",ea=tc,$r=1e4,Su=1e3,Eu=100;var We;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(We||(We={}));var Bt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Bt||(Bt={}));var be;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(be||(be={}));var Br;(function(n){n.websocket="websocket"})(Br||(Br={}));var yn;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(yn||(yn={}));class Tu{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,e){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return e(this._binaryEncodeUserBroadcastPush(t));let s=[t.join_ref,t.ref,t.topic,t.event,t.payload];return e(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(t){var e;return this._isArrayBuffer((e=t.payload)===null||e===void 0?void 0:e.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var e,s;const i=(s=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(t){var e,s;const i=(s=(e=t.payload)===null||e===void 0?void 0:e.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(t,e,s){var i,r;const o=t.topic,a=(i=t.ref)!==null&&i!==void 0?i:"",l=(r=t.join_ref)!==null&&r!==void 0?r:"",c=t.payload.event,d=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+u.length,f=new ArrayBuffer(this.HEADER_LENGTH+h);let g=new DataView(f),p=0;g.setUint8(p++,this.KINDS.userBroadcastPush),g.setUint8(p++,l.length),g.setUint8(p++,a.length),g.setUint8(p++,o.length),g.setUint8(p++,c.length),g.setUint8(p++,u.length),g.setUint8(p++,e),Array.from(l,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(a,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(o,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(c,b=>g.setUint8(p++,b.charCodeAt(0))),Array.from(u,b=>g.setUint8(p++,b.charCodeAt(0)));var m=new Uint8Array(f.byteLength+s.byteLength);return m.set(new Uint8Array(f),0),m.set(new Uint8Array(s),f.byteLength),m.buffer}decode(t,e){if(this._isArrayBuffer(t)){let s=this._binaryDecode(t);return e(s)}if(typeof t=="string"){const s=JSON.parse(t),[i,r,o,a,l]=s;return e({join_ref:i,ref:r,topic:o,event:a,payload:l})}return e({})}_binaryDecode(t){const e=new DataView(t),s=e.getUint8(0),i=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,e,i)}}_decodeUserBroadcast(t,e,s){const i=e.getUint8(1),r=e.getUint8(2),o=e.getUint8(3),a=e.getUint8(4);let l=this.HEADER_LENGTH+4;const c=s.decode(t.slice(l,l+i));l=l+i;const d=s.decode(t.slice(l,l+r));l=l+r;const u=s.decode(t.slice(l,l+o));l=l+o;const h=t.slice(l,t.byteLength),f=a===this.JSON_ENCODING?JSON.parse(s.decode(h)):h,g={type:this.BROADCAST_EVENT,event:d,payload:f};return o>0&&(g.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)===null||e===void 0?void 0:e.name)==="ArrayBuffer"}_pick(t,e){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([s])=>e.includes(s)))}}class ec{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var bt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(bt||(bt={}));const na=(n,t,e={})=>{var s;const i=(s=e.skipTypes)!==null&&s!==void 0?s:[];return t?Object.keys(t).reduce((r,o)=>(r[o]=Au(o,n,t,i),r),{}):{}},Au=(n,t,e,s)=>{const i=t.find(a=>a.name===n),r=i==null?void 0:i.type,o=e[n];return r&&!s.includes(r)?nc(r,o):Nr(o)},nc=(n,t)=>{if(n.charAt(0)==="_"){const e=n.slice(1,n.length);return Mu(t,e)}switch(n){case bt.bool:return Ou(t);case bt.float4:case bt.float8:case bt.int2:case bt.int4:case bt.int8:case bt.numeric:case bt.oid:return Cu(t);case bt.json:case bt.jsonb:return Ru(t);case bt.timestamp:return Iu(t);case bt.abstime:case bt.date:case bt.daterange:case bt.int4range:case bt.int8range:case bt.money:case bt.reltime:case bt.text:case bt.time:case bt.timestamptz:case bt.timetz:case bt.tsrange:case bt.tstzrange:return Nr(t);default:return Nr(t)}},Nr=n=>n,Ou=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Cu=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Ru=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},Mu=(n,t)=>{if(typeof n!="string")return n;const e=n.length-1,s=n[e];if(n[0]==="{"&&s==="}"){let r;const o=n.slice(1,e);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(a=>nc(t,a))}return n},Iu=n=>typeof n=="string"?n.replace(" ","T"):n,sc=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class or{constructor(t,e,s={},i=$r){this.channel=t,this.event=e,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var s;return this._hasReceived(t)&&e((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(s=>s.status===t).forEach(s=>s.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var sa;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(sa||(sa={}));class _s{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(e==null?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_s.syncState(this.state,i,r,o),this.pendingDiffs.forEach(l=>{this.state=_s.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=_s.syncDiff(this.state,i,r,o),a())}),this.onJoin((i,r,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:o})}),this.onLeave((i,r,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,s,i){const r=this.cloneDeep(t),o=this.transformState(e),a={},l={};return this.map(r,(c,d)=>{o[c]||(l[c]=d)}),this.map(o,(c,d)=>{const u=r[c];if(u){const h=d.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),g=d.filter(m=>f.indexOf(m.presence_ref)<0),p=u.filter(m=>h.indexOf(m.presence_ref)<0);g.length>0&&(a[c]=g),p.length>0&&(l[c]=p)}else a[c]=d}),this.syncDiff(r,{joins:a,leaves:l},s,i)}static syncDiff(t,e,s,i){const{joins:r,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(r,(a,l)=>{var c;const d=(c=t[a])!==null&&c!==void 0?c:[];if(t[a]=this.cloneDeep(l),d.length>0){const u=t[a].map(f=>f.presence_ref),h=d.filter(f=>u.indexOf(f.presence_ref)<0);t[a].unshift(...h)}s(a,d,l)}),this.map(o,(a,l)=>{let c=t[a];if(!c)return;const d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),t[a]=c,i(a,c,l),c.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(s=>e(s,t[s]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,s)=>{const i=t[s];return"metas"in i?e[s]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):e[s]=i,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ia;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(ia||(ia={}));var vs;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(vs||(vs={}));var Be;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Be||(Be={}));class Wn{constructor(t,e={config:{}},s){var i,r;if(this.topic=t,this.params=e,this.socket=s,this.bindings={},this.state=Bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new or(this,be.join,this.params,this.timeout),this.rejoinTimer=new ec(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(be.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new _s(this),this.broadcastEndpointURL=sc(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((r=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||r===void 0)&&r.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,e=this.timeout){var s,i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Bt.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(f=>f.filter))!==null&&i!==void 0?i:[],d=!!this.bindings[vs.PRESENCE]&&this.bindings[vs.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,u={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>t==null?void 0:t(Be.CHANNEL_ERROR,f)),this._onClose(()=>t==null?void 0:t(Be.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){t==null||t(Be.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,m=(g=p==null?void 0:p.length)!==null&&g!==void 0?g:0,b=[];for(let _=0;_<m;_++){const x=p[_],{filter:{event:S,schema:E,table:C,filter:O}}=x,y=f&&f[_];if(y&&y.event===S&&Wn.isFilterValueEqual(y.schema,E)&&Wn.isFilterValueEqual(y.table,C)&&Wn.isFilterValueEqual(y.filter,O))b.push(Object.assign(Object.assign({},x),{id:y.id}));else{this.unsubscribe(),this.state=Bt.errored,t==null||t(Be.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,t&&t(Be.SUBSCRIBED);return}}).receive("error",f=>{this.state=Bt.errored,t==null||t(Be.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Be.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,e={}){return await this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,e,s){return this.state===Bt.joined&&t===vs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,e,s)}async httpSend(t,e,s={}){var i;if(e==null)return Promise.reject("Payload is required for httpSend()");const r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:e,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=s.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(t,e={}){var s,i;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:r,payload:o}=t,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=e.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const c=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),c.receive("ok",()=>r("ok")),c.receive("error",()=>r("error")),c.receive("timeout",()=>r("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bt.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(be.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new or(this,be.leave,{},t),s.receive("ok",()=>{e(),i("ok")}).receive("timeout",()=>{e(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bt.closed,this.bindings={}}async _fetchWithTimeout(t,e,s){const i=new AbortController,r=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(r),o}_push(t,e,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new or(this,t,e,s);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Eu){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(t,e,s){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,s){var i,r;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:c,join:d}=be;if(s&&[a,l,c,d].indexOf(o)>=0&&s!==this._joinRef())return;let h=this._onMessage(o,e,s);if(e&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var g,p,m;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((m=(p=f.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(h,s)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var g,p,m,b,_,x;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const S=f.id,E=(g=f.filter)===null||g===void 0?void 0:g.event;return S&&((p=e.ids)===null||p===void 0?void 0:p.includes(S))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((m=e.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const S=(_=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return S==="*"||S===((x=e==null?void 0:e.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:p,table:m,commit_timestamp:b,type:_,errors:x}=g;h=Object.assign(Object.assign({},{schema:p,table:m,commit_timestamp:b,eventType:_,new:{},old:{},errors:x}),this._getPayloadRecords(g))}f.callback(h,s)})}_isClosed(){return this.state===Bt.closed}_isJoined(){return this.state===Bt.joined}_isJoining(){return this.state===Bt.joining}_isLeaving(){return this.state===Bt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,s){const i=t.toLocaleLowerCase(),r={type:i,filter:e,callback:s};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(t,e){const s=t.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===s&&Wn.isEqual(i.filter,e))})),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}static isFilterValueEqual(t,e){return(t??void 0)===(e??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(be.close,{},t)}_onError(t){this._on(be.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=na(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=na(t.columns,t.old_record)),e}}const ar=()=>{},Xs={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Lu=[1e3,2e3,5e3,1e4],Pu=1e4,Du=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $u{constructor(t,e){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=$r,this.transport=null,this.heartbeatIntervalMs=Xs.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ar,this.ref=0,this.reconnectTimer=null,this.vsn=ea,this.logger=ar,this.conn=null,this.sendBuffer=[],this.serializer=new Tu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...r)=>i(...r):(...r)=>fetch(...r),!(!((s=e==null?void 0:e.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=e.params.apikey,this.endPoint=`${t}/${Br.websocket}`,this.httpEndpoint=sc(t),this._initializeOptions(e),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(e==null?void 0:e.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=vu.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const e=t.message;throw e.includes("Node.js")?new Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,e){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,e??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const e=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){const t=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,e,s){this.logger(t,e,s)}connectionState(){switch(this.conn&&this.conn.readyState){case We.connecting:return yn.Connecting;case We.open:return yn.Open;case We.closing:return yn.Closing;default:return yn.Closed}}isConnected(){return this.connectionState()===yn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,e={config:{}}){const s=`realtime:${t}`,i=this.getChannels().find(r=>r.topic===s);if(i)return i;{const r=new Wn(`realtime:${t}`,e,this);return this.channels.push(r),r}}push(t){const{topic:e,event:s,payload:i,ref:r}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${s} (${r})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Su,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout()},Xs.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(s=>s.topic===t&&(s._isJoined()||s._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,e=>{if(e.topic==="phoenix"&&e.event==="phx_reply"&&e.ref&&e.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(e.payload.status==="ok"?"ok":"error",c)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:i,payload:r,ref:o}=e,a=o?`(${o})`:"",l=r.status||"";this.log("receive",`${l} ${s} ${i} ${a}`.trim(),r),this.channels.filter(c=>c._isMember(s)).forEach(c=>c._trigger(i,r,o)),this._triggerStateCallbacks("message",e)})}_clearTimer(t){var e;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((e=this.reconnectTimer)===null||e===void 0||e.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===We.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===We.open||this.conn.readyState===We.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var e;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(e=this.reconnectTimer)===null||e===void 0||e.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(be.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;const s=t.match(/\?/)?"&":"?",i=new URLSearchParams(e);return`${t}${s}${i}`}_workerObjectUrl(t){let e;if(t)e=t;else{const s=new Blob([Du],{type:"application/javascript"});e=URL.createObjectURL(s)}return e}_setConnectionState(t,e=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=e)}async _performAuth(t=null){let e,s=!1;if(t)e=t,s=!0;else if(this.accessToken)try{e=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),e=this.accessTokenValue}else e=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(i=>{const r={access_token:e,version:xu};e&&i.updateJoinPayload(r),i.joinedOnce&&i._isJoined()&&i._push(be.access_token,{access_token:e})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(e=>{this.log("error",`Error setting auth in ${t}`,e)})}_triggerStateCallbacks(t,e){try{this.stateChangeCallbacks[t].forEach(s=>{try{s(e)}catch(i){this.log("error",`error in ${t} callback`,i)}})}catch(s){this.log("error",`error triggering ${t} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new ec(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Xs.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var e,s,i,r,o,a,l,c,d,u,h,f;switch(this.transport=(e=t==null?void 0:t.transport)!==null&&e!==void 0?e:null,this.timeout=(s=t==null?void 0:t.timeout)!==null&&s!==void 0?s:$r,this.heartbeatIntervalMs=(i=t==null?void 0:t.heartbeatIntervalMs)!==null&&i!==void 0?i:Xs.HEARTBEAT_INTERVAL,this.worker=(r=t==null?void 0:t.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=t==null?void 0:t.heartbeatCallback)!==null&&a!==void 0?a:ar,this.vsn=(l=t==null?void 0:t.vsn)!==null&&l!==void 0?l:ea,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:g=>Lu[g-1]||Pu,this.vsn){case ku:this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(g,p)=>p(JSON.stringify(g)),this.decode=(u=t==null?void 0:t.decode)!==null&&u!==void 0?u:(g,p)=>p(JSON.parse(g));break;case tc:this.encode=(h=t==null?void 0:t.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=t==null?void 0:t.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var Os=class extends Error{constructor(n,t){var e;super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((e=t.icebergType)==null?void 0:e.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Bu(n,t,e){const s=new URL(t,n);if(e)for(const[i,r]of Object.entries(e))r!==void 0&&s.searchParams.set(i,r);return s.toString()}async function Nu(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function ju(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:e,path:s,query:i,body:r,headers:o}){const a=Bu(n.baseUrl,s,i),l=await Nu(n.auth),c=await t(a,{method:e,headers:{...r?{"Content-Type":"application/json"}:{},...l,...o},body:r?JSON.stringify(r):void 0}),d=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),h=u&&d?JSON.parse(d):d;if(!c.ok){const f=u?h:void 0,g=f==null?void 0:f.error;throw new Os((g==null?void 0:g.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:f})}return{status:c.status,headers:c.headers,data:h}}}}function Qs(n){return n.join("")}var Fu=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:Qs(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(n,t){const e={namespace:n.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:e})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Qs(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Qs(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Qs(n.namespace)}`}),!0}catch(t){if(t instanceof Os&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(e){if(e instanceof Os&&e.status===409)return;throw e}}};function Ln(n){return n.join("")}var Uu=class{constructor(n,t="",e){this.client=n,this.prefix=t,this.accessDelegation=e}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables`,body:t,headers:e})).data.metadata}async updateTable(n,t){const e=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":e.data["metadata-location"],metadata:e.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ln(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(e){if(e instanceof Os&&e.status===404)return!1;throw e}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(e){if(e instanceof Os&&e.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw e}}},zu=class{constructor(n){var s;let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const e=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=ju({baseUrl:e,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=(s=n.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new Fu(this.client,t),this.tableOps=new Uu(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},zi=class extends Error{constructor(n,t="storage",e,s){super(n),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=e,this.statusCode=s}};function Hi(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Zs=class extends zi{constructor(n,t,e,s="storage"){super(n,s,t,e),this.name=s==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ic=class extends zi{constructor(n,t,e="storage"){super(n,e),this.name=e==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Hu=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),Wu=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},jr=n=>{if(Array.isArray(n))return n.map(e=>jr(e));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([e,s])=>{const i=e.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));t[i]=jr(s)}),t},Vu=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Cs(n){"@babel/helpers - typeof";return Cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cs(n)}function qu(n,t){if(Cs(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(Cs(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Gu(n){var t=qu(n,"string");return Cs(t)=="symbol"?t:t+""}function Yu(n,t,e){return(t=Gu(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function ra(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function X(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?ra(Object(e),!0).forEach(function(s){Yu(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):ra(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const oa=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},Ku=async(n,t,e,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!(e!=null&&e.noResolveJson)){const i=n,r=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||r+"";t(new Zs(oa(o),r,a,s))}).catch(()=>{if(s==="vectors"){const o=r+"";t(new Zs(i.statusText||`HTTP ${r} error`,r,o,s))}else{const o=r+"";t(new Zs(i.statusText||`HTTP ${r} error`,r,o,s))}});else{const o=r+"";t(new Zs(i.statusText||`HTTP ${r} error`,r,o,s))}}else t(new ic(oa(n),n,s))},Ju=(n,t,e,s)=>{const i={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"||n==="HEAD"||!s?X(X({},i),e):(Wu(s)?(i.headers=X({"Content-Type":"application/json"},t==null?void 0:t.headers),i.body=JSON.stringify(s)):i.body=s,t!=null&&t.duplex&&(i.duplex=t.duplex),X(X({},i),e))};async function Zn(n,t,e,s,i,r,o){return new Promise((a,l)=>{n(e,Ju(t,s,i,r)).then(c=>{if(!c.ok)throw c;if(s!=null&&s.noResolveJson)return c;if(o==="vectors"){const d=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!d||!d.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>Ku(c,l,s,o))})}function rc(n="storage"){return{get:async(t,e,s,i)=>Zn(t,"GET",e,s,i,void 0,n),post:async(t,e,s,i,r)=>Zn(t,"POST",e,i,r,s,n),put:async(t,e,s,i,r)=>Zn(t,"PUT",e,i,r,s,n),head:async(t,e,s,i)=>Zn(t,"HEAD",e,X(X({},s),{},{noResolveJson:!0}),i,void 0,n),remove:async(t,e,s,i,r)=>Zn(t,"DELETE",e,i,r,s,n)}}const Xu=rc("storage"),{get:Rs,post:ye,put:Fr,head:Qu,remove:yo}=Xu,de=rc("vectors");var Jn=class{constructor(n,t={},e,s="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.fetch=Hu(e),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(n){var t=this;try{return{data:await n(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Hi(e))return{data:null,error:e};throw e}}},Zu=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Hi(t))return{data:null,error:t};throw t}}};let oc;oc=Symbol.toStringTag;var th=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[oc]="BlobDownloadBuilder",this.promise=null}asStream(){return new Zu(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Hi(t))return{data:null,error:t};throw t}}};const eh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},aa={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var nh=class extends Jn{constructor(n,t={},e,s){super(n,t,s,"storage"),this.bucketId=e}async uploadOrUpdate(n,t,e,s){var i=this;return i.handleOperation(async()=>{let r;const o=X(X({},aa),s);let a=X(X({},i.headers),n==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&e instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",i.encodeMetadata(l)),r.append("",e)):typeof FormData<"u"&&e instanceof FormData?(r=e,r.has("cacheControl")||r.append("cacheControl",o.cacheControl),l&&!r.has("metadata")&&r.append("metadata",i.encodeMetadata(l))):(r=e,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&r instanceof ReadableStream||r&&typeof r=="object"&&"pipe"in r&&typeof r.pipe=="function")&&!o.duplex&&(o.duplex="half")),s!=null&&s.headers&&(a=X(X({},a),s.headers));const c=i._removeEmptyFolders(t),d=i._getFinalPath(c),u=await(n=="PUT"?Fr:ye)(i.fetch,`${i.url}/object/${d}`,r,X({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:c,id:u.Id,fullPath:u.Key}})}async upload(n,t,e){return this.uploadOrUpdate("POST",n,t,e)}async uploadToSignedUrl(n,t,e,s){var i=this;const r=i._removeEmptyFolders(n),o=i._getFinalPath(r),a=new URL(i.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",t),i.handleOperation(async()=>{let l;const c=X({upsert:aa.upsert},s),d=X(X({},i.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&e instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",e)):typeof FormData<"u"&&e instanceof FormData?(l=e,l.append("cacheControl",c.cacheControl)):(l=e,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType),{path:r,fullPath:(await Fr(i.fetch,a.toString(),l,{headers:d})).Key}})}async createSignedUploadUrl(n,t){var e=this;return e.handleOperation(async()=>{let s=e._getFinalPath(n);const i=X({},e.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=await ye(e.fetch,`${e.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(e.url+r.url),a=o.searchParams.get("token");if(!a)throw new zi("No token returned by API");return{signedUrl:o.toString(),path:n,token:a}})}async update(n,t,e){return this.uploadOrUpdate("PUT",n,t,e)}async move(n,t,e){var s=this;return s.handleOperation(async()=>await ye(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:n,destinationKey:t,destinationBucket:e==null?void 0:e.destinationBucket},{headers:s.headers}))}async copy(n,t,e){var s=this;return s.handleOperation(async()=>({path:(await ye(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:n,destinationKey:t,destinationBucket:e==null?void 0:e.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(n,t,e){var s=this;return s.handleOperation(async()=>{let i=s._getFinalPath(n),r=await ye(s.fetch,`${s.url}/object/sign/${i}`,X({expiresIn:t},e!=null&&e.transform?{transform:e.transform}:{}),{headers:s.headers});const o=e!=null&&e.download?`&download=${e.download===!0?"":e.download}`:"";return{signedUrl:encodeURI(`${s.url}${r.signedURL}${o}`)}})}async createSignedUrls(n,t,e){var s=this;return s.handleOperation(async()=>{const i=await ye(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:n},{headers:s.headers}),r=e!=null&&e.download?`&download=${e.download===!0?"":e.download}`:"";return i.map(o=>X(X({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${r}`):null}))})}download(n,t){const e=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),i=s?`?${s}`:"",r=this._getFinalPath(n),o=()=>Rs(this.fetch,`${this.url}/${e}/${r}${i}`,{headers:this.headers,noResolveJson:!0});return new th(o,this.shouldThrowOnError)}async info(n){var t=this;const e=t._getFinalPath(n);return t.handleOperation(async()=>jr(await Rs(t.fetch,`${t.url}/object/info/${e}`,{headers:t.headers})))}async exists(n){var t=this;const e=t._getFinalPath(n);try{return await Qu(t.fetch,`${t.url}/object/${e}`,{headers:t.headers}),{data:!0,error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Hi(s)&&s instanceof ic){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}}getPublicUrl(n,t){const e=this._getFinalPath(n),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const r=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});o!==""&&s.push(o);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${e}${a}`)}}}async remove(n){var t=this;return t.handleOperation(async()=>await yo(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}))}async list(n,t,e){var s=this;return s.handleOperation(async()=>{const i=X(X(X({},eh),t),{},{prefix:n||""});return await ye(s.fetch,`${s.url}/object/list/${s.bucketId}`,i,{headers:s.headers},e)})}async listV2(n,t){var e=this;return e.handleOperation(async()=>{const s=X({},n);return await ye(e.fetch,`${e.url}/object/list-v2/${e.bucketId}`,s,{headers:e.headers},t)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const sh="2.94.1",Hs={"X-Client-Info":`storage-js/${sh}`};var ih=class extends Jn{constructor(n,t={},e,s){const i=new URL(n);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const r=i.href.replace(/\/$/,""),o=X(X({},Hs),t);super(r,o,e,"storage")}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const e=t.listBucketOptionsToQueryString(n);return await Rs(t.fetch,`${t.url}/bucket${e}`,{headers:t.headers})})}async getBucket(n){var t=this;return t.handleOperation(async()=>await Rs(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}))}async createBucket(n,t={public:!1}){var e=this;return e.handleOperation(async()=>await ye(e.fetch,`${e.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async updateBucket(n,t){var e=this;return e.handleOperation(async()=>await Fr(e.fetch,`${e.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:e.headers}))}async emptyBucket(n){var t=this;return t.handleOperation(async()=>await ye(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await yo(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},rh=class extends Jn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=X(X({},Hs),t);super(s,i,e,"storage")}async createBucket(n){var t=this;return t.handleOperation(async()=>await ye(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}))}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const e=new URLSearchParams;(n==null?void 0:n.limit)!==void 0&&e.set("limit",n.limit.toString()),(n==null?void 0:n.offset)!==void 0&&e.set("offset",n.offset.toString()),n!=null&&n.sortColumn&&e.set("sortColumn",n.sortColumn),n!=null&&n.sortOrder&&e.set("sortOrder",n.sortOrder),n!=null&&n.search&&e.set("search",n.search);const s=e.toString(),i=s?`${t.url}/bucket?${s}`:`${t.url}/bucket`;return await Rs(t.fetch,i,{headers:t.headers})})}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await yo(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}from(n){var t=this;if(!Vu(n))throw new zi("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const e=new zu({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(e,{get(i,r){const o=i[r];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(i,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}},oh=class extends Jn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=X(X({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async createIndex(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{})}async getIndex(n,t){var e=this;return e.handleOperation(async()=>await de.post(e.fetch,`${e.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:e.headers}))}async listIndexes(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}))}async deleteIndex(n,t){var e=this;return e.handleOperation(async()=>await de.post(e.fetch,`${e.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:e.headers})||{})}},ah=class extends Jn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=X(X({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async putVectors(n){var t=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{})}async getVectors(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}))}async listVectors(n){var t=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}))}async queryVectors(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}))}async deleteVectors(n){var t=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{})}},lh=class extends Jn{constructor(n,t={},e){const s=n.replace(/\/$/,""),i=X(X({},Hs),{},{"Content-Type":"application/json"},t);super(s,i,e,"vectors")}async createBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}async getBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}))}async listBuckets(n={}){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await de.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}},ch=class extends lh{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new dh(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,e=this;return t().call(e,n)}async getBucket(n){var t=()=>super.getBucket,e=this;return t().call(e,n)}async listBuckets(n={}){var t=()=>super.listBuckets,e=this;return t().call(e,n)}async deleteBucket(n){var t=()=>super.deleteBucket,e=this;return t().call(e,n)}},dh=class extends oh{constructor(n,t,e,s){super(n,t,s),this.vectorBucketName=e}async createIndex(n){var t=()=>super.createIndex,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,e=this;return t().call(e,e.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,e=this;return t().call(e,e.vectorBucketName,n)}index(n){return new uh(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},uh=class extends ah{constructor(n,t,e,s,i){super(n,t,i),this.vectorBucketName=e,this.indexName=s}async putVectors(n){var t=()=>super.putVectors,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async getVectors(n){var t=()=>super.getVectors,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,e=this;return t().call(e,X(X({},n),{},{vectorBucketName:e.vectorBucketName,indexName:e.indexName}))}},hh=class extends ih{constructor(n,t={},e,s){super(n,t,e,s)}from(n){return new nh(this.url,this.headers,n,this.fetch)}get vectors(){return new ch(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new rh(this.url+"/iceberg",this.headers,this.fetch)}};const ac="2.94.1",zn=30*1e3,Ur=3,lr=Ur*zn,fh="http://localhost:9999",gh="supabase.auth.token",ph={"X-Client-Info":`gotrue-js/${ac}`},zr="X-Supabase-Api-Version",lc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mh=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,yh=10*60*1e3;class Ms extends Error{constructor(t,e,s){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=s}}function q(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class bh extends Ms{constructor(t,e,s){super(t,e,s),this.name="AuthApiError",this.status=e,this.code=s}}function _h(n){return q(n)&&n.name==="AuthApiError"}class bn extends Ms{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}}class He extends Ms{constructor(t,e,s,i){super(t,s,i),this.name=e,this.status=s}}class ae extends He{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function cr(n){return q(n)&&n.name==="AuthSessionMissingError"}class Pn extends He{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ti extends He{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ei extends He{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vh(n){return q(n)&&n.name==="AuthImplicitGrantRedirectError"}class la extends He{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class wh extends He{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Hr extends He{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}}function dr(n){return q(n)&&n.name==="AuthRetryableFetchError"}class ca extends He{constructor(t,e,s){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=s}}class Wr extends He{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Oi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),da=` 	
\r=`.split(""),xh=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<da.length;t+=1)n[da[t].charCodeAt(0)]=-2;for(let t=0;t<Oi.length;t+=1)n[Oi[t].charCodeAt(0)]=t;return n})();function ua(n,t,e){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;e(Oi[s]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const s=t.queue>>t.queuedBits-6&63;e(Oi[s]),t.queuedBits-=6}}function cc(n,t,e){const s=xh[n];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)e(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function ha(n){const t=[],e=o=>{t.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},r=o=>{Eh(o,s,e)};for(let o=0;o<n.length;o+=1)cc(n.charCodeAt(o),i,r);return t.join("")}function kh(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Sh(n,t){for(let e=0;e<n.length;e+=1){let s=n.charCodeAt(e);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(n.charCodeAt(e+1)-56320&65535|i)+65536,e+=1}kh(s,t)}}function Eh(n,t,e){if(t.utf8seq===0){if(n<=127){e(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){t.utf8seq=s;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&e(t.codepoint)}}function Vn(n){const t=[],e={queue:0,queuedBits:0},s=i=>{t.push(i)};for(let i=0;i<n.length;i+=1)cc(n.charCodeAt(i),e,s);return new Uint8Array(t)}function Th(n){const t=[];return Sh(n,e=>t.push(e)),new Uint8Array(t)}function _n(n){const t=[],e={queue:0,queuedBits:0},s=i=>{t.push(i)};return n.forEach(i=>ua(i,e,s)),ua(null,e,s),t.join("")}function Ah(n){return Math.round(Date.now()/1e3)+n}function Oh(){return Symbol("auth-callback")}const Vt=()=>typeof window<"u"&&typeof document<"u",ln={tested:!1,writable:!1},dc=()=>{if(!Vt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ln.tested)return ln.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ln.tested=!0,ln.writable=!0}catch{ln.tested=!0,ln.writable=!1}return ln.writable};function Ch(n){const t={},e=new URL(n);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((i,r)=>{t[r]=i})}catch{}return e.searchParams.forEach((s,i)=>{t[i]=s}),t}const uc=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),Rh=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Hn=async(n,t,e)=>{await n.setItem(t,JSON.stringify(e))},cn=async(n,t)=>{const e=await n.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}},Wt=async(n,t)=>{await n.removeItem(t)};class Wi{constructor(){this.promise=new Wi.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}}Wi.promiseConstructor=Promise;function ni(n){const t=n.split(".");if(t.length!==3)throw new Wr("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!mh.test(t[s]))throw new Wr("JWT not in base64url format");return{header:JSON.parse(ha(t[0])),payload:JSON.parse(ha(t[1])),signature:Vn(t[2]),raw:{header:t[0],payload:t[1]}}}async function Mh(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function Ih(n,t){return new Promise((s,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await n(r);if(!t(r,null,o)){s(o);return}}catch(o){if(!t(r,o)){i(o);return}}})()})}function Lh(n){return("0"+n.toString(16)).substr(-2)}function Ph(){const t=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=e.length;let i="";for(let r=0;r<56;r++)i+=e.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(t),Array.from(t,Lh).join("")}async function Dh(n){const e=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(s);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}async function $h(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=await Dh(n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Dn(n,t,e=!1){const s=Ph();let i=s;e&&(i+="/PASSWORD_RECOVERY"),await Hn(n,`${t}-code-verifier`,i);const r=await $h(s);return[r,s===r?"plain":"s256"]}const Bh=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Nh(n){const t=n.headers.get(zr);if(!t||!t.match(Bh))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function jh(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function Fh(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Uh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $n(n){if(!Uh.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ur(){const n={};return new Proxy(n,{get:(t,e)=>{if(e==="__isUserNotAvailableProxy")return!0;if(typeof e=="symbol"){const s=e.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${e}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,e)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${e}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function zh(n,t){return new Proxy(n,{get:(e,s,i)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)"||r==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(e,s,i)}return!t.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,s,i)}})}function fa(n){return JSON.parse(JSON.stringify(n))}const gn=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Hh=[502,503,504];async function ga(n){var t;if(!Rh(n))throw new Hr(gn(n),0);if(Hh.includes(n.status))throw new Hr(gn(n),n.status);let e;try{e=await n.json()}catch(r){throw new bn(gn(r),r)}let s;const i=Nh(n);if(i&&i.getTime()>=lc["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?s=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(s=e.error_code),s){if(s==="weak_password")throw new ca(gn(e),n.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(s==="session_not_found")throw new ae}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new ca(gn(e),n.status,e.weak_password.reasons);throw new bh(gn(e),n.status||500,s)}const Wh=(n,t,e,s)=>{const i={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),e))};async function K(n,t,e,s){var i;const r=Object.assign({},s==null?void 0:s.headers);r[zr]||(r[zr]=lc["2024-01-01"].name),s!=null&&s.jwt&&(r.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Vh(n,t,e+a,{headers:r,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function Vh(n,t,e,s,i,r){const o=Wh(t,s,i,r);let a;try{a=await n(e,Object.assign({},o))}catch(l){throw console.error(l),new Hr(gn(l),0)}if(a.ok||await ga(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await ga(l)}}function pe(n){var t;let e=null;Yh(n)&&(e=Object.assign({},n),n.expires_at||(e.expires_at=Ah(n.expires_in)));const s=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:e,user:s},error:null}}function pa(n){const t=pe(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((e,s)=>e&&typeof s=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ve(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function qh(n){return{data:n,error:null}}function Gh(n){const{action_link:t,email_otp:e,hashed_token:s,redirect_to:i,verification_type:r}=n,o=Ui(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:s,redirect_to:i,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function ma(n){return n}function Yh(n){return n.access_token&&n.refresh_token&&n.expires_in}const hr=["global","local","others"];class Kh{constructor({url:t="",headers:e={},fetch:s}){this.url=t,this.headers=e,this.fetch=uc(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,e=hr[0]){if(hr.indexOf(e)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${hr.join(", ")}`);try{return await K(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(s){if(q(s))return{data:null,error:s};throw s}}async inviteUserByEmail(t,e={}){try{return await K(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ve})}catch(s){if(q(s))return{data:{user:null},error:s};throw s}}async generateLink(t){try{const{options:e}=t,s=Ui(t,["options"]),i=Object.assign(Object.assign({},s),e);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await K(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Gh,redirectTo:e==null?void 0:e.redirectTo})}catch(e){if(q(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(t){try{return await K(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ve})}catch(e){if(q(e))return{data:{user:null},error:e};throw e}}async listUsers(t){var e,s,i,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await K(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(e=t==null?void 0:t.page)===null||e===void 0?void 0:e.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:ma});if(d.error)throw d.error;const u=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(q(c))return{data:{users:[]},error:c};throw c}}async getUserById(t){$n(t);try{return await K(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ve})}catch(e){if(q(e))return{data:{user:null},error:e};throw e}}async updateUserById(t,e){$n(t);try{return await K(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:Ve})}catch(s){if(q(s))return{data:{user:null},error:s};throw s}}async deleteUser(t,e=!1){$n(t);try{return await K(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ve})}catch(s){if(q(s))return{data:{user:null},error:s};throw s}}async _listFactors(t){$n(t.userId);try{const{data:e,error:s}=await K(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:e,error:s}}catch(e){if(q(e))return{data:null,error:e};throw e}}async _deleteFactor(t){$n(t.userId),$n(t.id);try{return{data:await K(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}}async _listOAuthClients(t){var e,s,i,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},d=await K(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(e=t==null?void 0:t.page)===null||e===void 0?void 0:e.toString())!==null&&s!==void 0?s:"",per_page:(r=(i=t==null?void 0:t.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:ma});if(d.error)throw d.error;const u=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(g.split(";")[1].split("=")[1]);c[`${m}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(q(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(q(e))return{data:null,error:e};throw e}}async _getOAuthClient(t){try{return await K(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(q(e))return{data:null,error:e};throw e}}async _updateOAuthClient(t,e){try{return await K(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:e,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(q(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(t){try{return await K(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(t){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(q(e))return{data:null,error:e};throw e}}}function ya(n={}){return{getItem:t=>n[t]||null,setItem:(t,e)=>{n[t]=e},removeItem:t=>{delete n[t]}}}const Bn={debug:!!(globalThis&&dc()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class hc extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Jh extends hc{}async function Xh(n,t,e){Bn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),Bn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Bn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await e()}finally{Bn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(t===0)throw Bn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Jh(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Bn.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}function Qh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function fc(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function Zh(n){return parseInt(n,16)}function tf(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,s=>s.toString(16).padStart(2,"0")).join("")}function ef(n){var t;const{chainId:e,domain:s,expirationTime:i,issuedAt:r=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:d,uri:u,version:h}=n;{if(!Number.isInteger(e))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${e}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const f=fc(n.address),g=d?`${d}://${s}`:s,p=n.statement?`${n.statement}
`:"",m=`${g} wants you to sign in with your Ethereum account:
${f}

${p}`;let b=`URI: ${u}
Version: ${h}
Chain ID: ${e}${o?`
Nonce: ${o}`:""}
Issued At: ${r.toISOString()}`;if(i&&(b+=`
Expiration Time: ${i.toISOString()}`),a&&(b+=`
Not Before: ${a.toISOString()}`),l&&(b+=`
Request ID: ${l}`),c){let _=`
Resources:`;for(const x of c){if(!x||typeof x!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${x}`);_+=`
- ${x}`}b+=_}return`${m}
${b}`}class Dt extends Error{constructor({message:t,code:e,cause:s,name:i}){var r;super(t,{cause:s}),this.__isWebAuthnError=!0,this.name=(r=i??(s instanceof Error?s.name:void 0))!==null&&r!==void 0?r:"Unknown Error",this.code=e}}class Ci extends Dt{constructor(t,e){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e,message:t}),this.name="WebAuthnUnknownError",this.originalError=e}}function nf({error:n,options:t}){var e,s,i;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Dt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((e=r.authenticatorSelection)===null||e===void 0?void 0:e.requireResidentKey)===!0)return new Dt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((s=r.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Dt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=r.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Dt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Dt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Dt({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return r.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Dt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Dt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const o=window.location.hostname;if(gc(o)){if(r.rp.id!==o)return new Dt({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Dt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new Dt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Dt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Dt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function sf({error:n,options:t}){const{publicKey:e}=t;if(!e)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Dt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Dt({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const s=window.location.hostname;if(gc(s)){if(e.rpId!==s)return new Dt({message:`The RP ID "${e.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Dt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Dt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Dt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class rf{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const of=new rf;function af(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:e,excludeCredentials:s}=n,i=Ui(n,["challenge","user","excludeCredentials"]),r=Vn(t).buffer,o=Object.assign(Object.assign({},e),{id:Vn(e.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:r,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const c=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:Vn(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function lf(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:e}=n,s=Ui(n,["challenge","allowCredentials"]),i=Vn(t).buffer,r=Object.assign(Object.assign({},s),{challenge:i});if(e&&e.length>0){r.allowCredentials=new Array(e.length);for(let o=0;o<e.length;o++){const a=e[o];r.allowCredentials[o]=Object.assign(Object.assign({},a),{id:Vn(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return r}function cf(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const e=n;return{id:n.id,rawId:n.id,response:{attestationObject:_n(new Uint8Array(n.response.attestationObject)),clientDataJSON:_n(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function df(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const e=n,s=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:_n(new Uint8Array(i.authenticatorData)),clientDataJSON:_n(new Uint8Array(i.clientDataJSON)),signature:_n(new Uint8Array(i.signature)),userHandle:i.userHandle?_n(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(t=e.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function gc(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function ba(){var n,t;return!!(Vt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function uf(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ci("Browser returned unexpected credential type",t)}:{data:null,error:new Ci("Empty credential response",t)}}catch(t){return{data:null,error:nf({error:t,options:n})}}}async function hf(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ci("Browser returned unexpected credential type",t)}:{data:null,error:new Ci("Empty credential response",t)}}catch(t){return{data:null,error:sf({error:t,options:n})}}}const ff={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},gf={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ri(...n){const t=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),e=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),s={};for(const i of n)if(i)for(const r in i){const o=i[r];if(o!==void 0)if(Array.isArray(o))s[r]=o;else if(e(o))s[r]=o;else if(t(o)){const a=s[r];t(a)?s[r]=Ri(a,o):s[r]=Ri(o)}else s[r]=o}return s}function pf(n,t){return Ri(ff,n,t||{})}function mf(n,t){return Ri(gf,n,t||{})}class yf{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:e,friendlyName:s,signal:i},r){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:e});if(!a)return{data:null,error:l};const c=i??of.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:d}=a.webauthn.credential_options.publicKey;if(!d.name){const u=s;if(u)d.name=`${d.id}:${u}`;else{const f=(await this.client.getUser()).data.user,g=((o=f==null?void 0:f.user_metadata)===null||o===void 0?void 0:o.name)||(f==null?void 0:f.email)||(f==null?void 0:f.id)||"User";d.name=`${d.id}:${g}`}}d.displayName||(d.displayName=d.name)}switch(a.webauthn.type){case"create":{const d=pf(a.webauthn.credential_options.publicKey,r==null?void 0:r.create),{data:u,error:h}=await uf({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=mf(a.webauthn.credential_options.publicKey,r==null?void 0:r.request),{data:u,error:h}=await hf(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(a){return q(a)?{data:null,error:a}:{data:null,error:new bn("Unexpected error in challenge",a)}}}async _verify({challengeId:t,factorId:e,webauthn:s}){return this.client.mfa.verify({factorId:e,challengeId:t,webauthn:s})}async _authenticate({factorId:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},r){if(!e)return{data:null,error:new Ms("rpId is required for WebAuthn authentication")};try{if(!ba())return{data:null,error:new bn("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:t,webauthn:{rpId:e,rpOrigins:s},signal:i},{request:r});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:l.type,rpId:e,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return q(o)?{data:null,error:o}:{data:null,error:new bn("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,webauthn:{rpId:e=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},r){if(!e)return{data:null,error:new Ms("rpId is required for WebAuthn registration")};try{if(!ba())return{data:null,error:new bn("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(d=>{var u;return(u=d.data)===null||u===void 0?void 0:u.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:e,rpOrigins:s},signal:i},{create:r});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:e,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return q(o)?{data:null,error:o}:{data:null,error:new bn("Unexpected error in register",o)}}}}Qh();const bf={url:fh,storageKey:gh,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ph,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function _a(n,t,e){return await e()}const Nn={};class Is{get jwks(){var t,e;return(e=(t=Nn[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&e!==void 0?e:{keys:[]}}set jwks(t){Nn[this.storageKey]=Object.assign(Object.assign({},Nn[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,e;return(e=(t=Nn[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&e!==void 0?e:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Nn[this.storageKey]=Object.assign(Object.assign({},Nn[this.storageKey]),{cachedAt:t})}constructor(t){var e,s,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const r=Object.assign(Object.assign({},bf),t);if(this.storageKey=r.storageKey,this.instanceID=(e=Is.nextInstanceID[this.storageKey])!==null&&e!==void 0?e:0,Is.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.instanceID>0&&Vt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=r.persistSession,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Kh({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=uc(r.fetch),this.lock=r.lock||_a,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,this.throwOnError=r.throwOnError,this.lockAcquireTimeout=r.lockAcquireTimeout,r.lock?this.lock=r.lock:this.persistSession&&Vt()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Xh:this.lock=_a,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new yf(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:dc()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ya(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=ya(this.memoryStorage)),Vt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ac}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let e={},s="none";if(Vt()&&(e=Ch(window.location.href),this._isImplicitGrantCallback(e)?s="implicit":await this._isPKCECallback(e)&&(s="pkce")),Vt()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:r}=await this._getSessionFromURL(e,s);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),vh(r)){const l=(t=r.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return{error:r}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return q(e)?this._returnResult({error:e}):this._returnResult({error:new bn("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var e,s,i;try{const r=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(e=t==null?void 0:t.options)===null||e===void 0?void 0:e.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.captchaToken}},xform:pe}),{data:o,error:a}=r;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(q(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signUp(t){var e,s,i;try{let r;if("email"in t){const{email:d,password:u,options:h}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Dn(this.storage,this.storageKey)),r=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:u,data:(e=h==null?void 0:h.data)!==null&&e!==void 0?e:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:g},xform:pe})}else if("phone"in t){const{phone:d,password:u,options:h}=t;r=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:pe})}else throw new ti("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return await Wt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(r){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithPassword(t){try{let e;if("email"in t){const{email:r,password:o,options:a}=t;e=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:pa})}else if("phone"in t){const{phone:r,password:o,options:a}=t;e=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:pa})}else throw new ti("You must provide either an email or phone number and a password");const{data:s,error:i}=e;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!s||!s.session||!s.user){const r=new Pn;return this._returnResult({data:{user:null,session:null},error:r})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(e){if(q(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(t){var e,s,i,r;return await this._handleProviderSignIn(t.provider,{redirectTo:(e=t.options)===null||e===void 0?void 0:e.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=t.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=t.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:e}=t;switch(e){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)}}async signInWithEthereum(t){var e,s,i,r,o,a,l,c,d,u,h;let f,g;if("message"in t)f=t.message,g=t.signature;else{const{chain:p,wallet:m,statement:b,options:_}=t;let x;if(Vt())if(typeof m=="object")x=m;else{const v=window;if("ethereum"in v&&typeof v.ethereum=="object"&&"request"in v.ethereum&&typeof v.ethereum.request=="function")x=v.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=m}const S=new URL((e=_==null?void 0:_.url)!==null&&e!==void 0?e:window.location.href),E=await x.request({method:"eth_requestAccounts"}).then(v=>v).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=fc(E[0]);let O=(s=_==null?void 0:_.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!O){const v=await x.request({method:"eth_chainId"});O=Zh(v)}const y={domain:S.host,address:C,statement:b,uri:S.href,version:"1",chainId:O,nonce:(i=_==null?void 0:_.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(r=_==null?void 0:_.signInWithEthereum)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=_==null?void 0:_.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=_==null?void 0:_.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=_==null?void 0:_.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=_==null?void 0:_.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=ef(y),g=await x.request({method:"personal_sign",params:[tf(f),C]})}try{const{data:p,error:m}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:g},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:pe});if(m)throw m;if(!p||!p.session||!p.user){const b=new Pn;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:m})}catch(p){if(q(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(t){var e,s,i,r,o,a,l,c,d,u,h,f;let g,p;if("message"in t)g=t.message,p=t.signature;else{const{chain:m,wallet:b,statement:_,options:x}=t;let S;if(Vt())if(typeof b=="object")S=b;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))S=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=b}const E=new URL((e=x==null?void 0:x.url)!==null&&e!==void 0?e:window.location.href);if("signIn"in S&&S.signIn){const C=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x==null?void 0:x.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),_?{statement:_}:null));let O;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")O=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)O=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in O&&"signature"in O&&(typeof O.signedMessage=="string"||O.signedMessage instanceof Uint8Array)&&O.signature instanceof Uint8Array)g=typeof O.signedMessage=="string"?O.signedMessage:new TextDecoder().decode(O.signedMessage),p=O.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${E.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(i=(s=x==null?void 0:x.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((r=x==null?void 0:x.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((o=x==null?void 0:x.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((a=x==null?void 0:x.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((l=x==null?void 0:x.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((c=x==null?void 0:x.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((u=(d=x==null?void 0:x.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...x.signInWithSolana.resources.map(O=>`- ${O}`)]:[]].join(`
`);const C=await S.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=C}}try{const{data:m,error:b}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:_n(p)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:pe});if(b)throw b;if(!m||!m.session||!m.user){const _=new Pn;return this._returnResult({data:{user:null,session:null},error:_})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:b})}catch(m){if(q(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(t){const e=await cn(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(e??"").split("/");try{if(!s&&this.flowType==="pkce")throw new wh;const{data:r,error:o}=await K(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:pe});if(await Wt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!r||!r.session||!r.user){const a=new Pn;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:o})}catch(r){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(r))return this._returnResult({data:{user:null,session:null,redirectType:null},error:r});throw r}}async signInWithIdToken(t){try{const{options:e,provider:s,token:i,access_token:r,nonce:o}=t,a=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:e==null?void 0:e.captchaToken}},xform:pe}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new Pn;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(e){if(q(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(t){var e,s,i,r,o;try{if("email"in t){const{email:a,options:l}=t;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Dn(this.storage,this.storageKey));const{error:u}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(e=l==null?void 0:l.data)!==null&&e!==void 0?e:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:a,options:l}=t,{data:c,error:d}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:d})}throw new ti("You must provide either an email or phone number.")}catch(a){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(t){var e,s;try{let i,r;"options"in t&&(i=(e=t.options)===null||e===void 0?void 0:e.redirectTo,r=(s=t.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await K(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:pe});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(q(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(t){var e,s,i,r,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Dn(this.storage,this.storageKey));const c=await K(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(s=(e=t.options)===null||e===void 0?void 0:e.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=t==null?void 0:t.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:qh});return!((r=c.data)===null||r===void 0)&&r.url&&Vt()&&!(!((o=t.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:e},error:s}=t;if(s)throw s;if(!e)throw new ae;const{error:i}=await K(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(t){if(q(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const e=`${this.url}/resend`;if("email"in t){const{email:s,type:i,options:r}=t,{error:o}=await K(this.fetch,"POST",e,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in t){const{phone:s,type:i,options:r}=t,{data:o,error:a}=await K(this.fetch,"POST",e,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new ti("You must provide either an email or phone number and a type")}catch(e){if(q(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(t,e){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await e()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=e();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const e=await this.__loadSession();return await t(e)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const e=await cn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",e),e!==null&&(this._isValidSession(e)?t=e:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const s=t.expires_at?t.expires_at*1e3-Date.now()<lr:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){const o=await cn(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=ur()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=zh(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:i,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{session:null},error:r}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const e=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return e.data.user&&(this.suppressGetSessionWarning=!0),e}async _getUser(t){try{return t?await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ve}):await this._useSession(async e=>{var s,i,r;const{data:o,error:a}=e;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ae}:await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:Ve})})}catch(e){if(q(e))return cr(e)&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(t,e={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,e))}async _updateUser(t,e={}){try{return await this._useSession(async s=>{const{data:i,error:r}=s;if(r)throw r;if(!i.session)throw new ae;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&t.email!=null&&([a,l]=await Dn(this.storage,this.storageKey));const{data:c,error:d}=await K(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:e==null?void 0:e.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Ve});if(d)throw d;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new ae;const e=Date.now()/1e3;let s=e,i=!0,r=null;const{payload:o}=ni(t.access_token);if(o.exp&&(s=o.exp,i=s<=e),i){const{data:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});r={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:s-e,expires_at:s},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return this._returnResult({data:{user:r.user,session:r},error:null})}catch(e){if(q(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async e=>{var s;if(!t){const{data:o,error:a}=e;if(a)throw a;t=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(t!=null&&t.refresh_token))throw new ae;const{data:i,error:r}=await this._callRefreshToken(t.refresh_token);return r?this._returnResult({data:{user:null,session:null},error:r}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(q(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(t,e){try{if(!Vt())throw new ei("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ei(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(e){case"implicit":if(this.flowType==="pkce")throw new la("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ei("Not a valid implicit grant flow url.");break;default:}if(e==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new la("No code detected.");const{data:_,error:x}=await this._exchangeCodeForSession(t.code);if(x)throw x;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=t;if(!r||!a||!o||!c)throw new ei("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(a);let h=d+u;l&&(h=parseInt(l));const f=h-d;f*1e3<=zn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=h-u;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,d);const{data:p,error:m}=await this._getUser(r);if(m)throw m;const b={provider_token:s,provider_refresh_token:i,access_token:r,expires_in:u,expires_at:h,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:b,redirectType:t.type},error:null})}catch(s){if(q(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const e=await cn(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&e)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r&&!cr(r))return this._returnResult({error:r});const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(_h(a)&&(a.status===404||a.status===401||a.status===403)||cr(a)))return this._returnResult({error:a})}return t!=="others"&&(await this._removeSession(),await Wt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const e=Oh(),s={id:e,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",e),this.stateChangeEmitters.delete(e)}};return this._debug("#onAuthStateChange()","registered callback with id",e),this.stateChangeEmitters.set(e,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(e)})))(),{data:{subscription:s}}}async _emitInitialSession(t){return await this._useSession(async e=>{var s,i;try{const{data:{session:r},error:o}=e;if(o)throw o;await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",r),console.error(r)}})}async resetPasswordForEmail(t,e={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await Dn(this.storage,this.storageKey,!0));try{return await K(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:e.captchaToken}},headers:this.headers,redirectTo:e.redirectTo})}catch(r){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(r))return this._returnResult({data:null,error:r});throw r}}async getUserIdentities(){var t;try{const{data:e,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(t=e.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var e;try{const{data:s,error:i}=await this._useSession(async r=>{var o,a,l,c,d;const{data:u,error:h}=r;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await K(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return Vt()&&!(!((e=t.options)===null||e===void 0)&&e.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:t.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(q(s))return this._returnResult({data:{provider:t.provider,url:null},error:s});throw s}}async linkIdentityIdToken(t){return await this._useSession(async e=>{var s;try{const{error:i,data:{session:r}}=e;if(i)throw i;const{options:o,provider:a,token:l,access_token:c,nonce:d}=t,u=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=r==null?void 0:r.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:pe}),{data:h,error:f}=u;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Pn}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(i){if(await Wt(this.storage,`${this.storageKey}-code-verifier`),q(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(t){try{return await this._useSession(async e=>{var s,i;const{data:r,error:o}=e;if(o)throw o;return await K(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(i=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(t){const e=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(e,"begin");try{const s=Date.now();return await Ih(async i=>(i>0&&await Mh(200*Math.pow(2,i-1)),this._debug(e,"refreshing attempt",i),await K(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:pe})),(i,r)=>{const o=200*Math.pow(2,i);return r&&dr(r)&&Date.now()+o-s<zn})}catch(s){if(this._debug(e,"error",s),q(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(e,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,e){const s=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:e.redirectTo,scopes:e.scopes,queryParams:e.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",e,"url",s),Vt()&&!e.skipBrowserRedirect&&window.location.assign(s),{data:{provider:t,url:s},error:null}}async _recoverAndRefresh(){var t,e;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await cn(this.storage,this.storageKey);if(i&&this.userStorage){let o=await cn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await Hn(this.userStorage,this.storageKey+"-user",o)),i.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:ur()}else if(i&&!i.user&&!i.user){const o=await cn(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Wt(this.storage,this.storageKey+"-user"),await Hn(this.storage,this.storageKey,i)):i.user=ur()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const r=((e=i.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<lr;if(this._debug(s,`session has${r?"":" not"} expired with margin of ${lr}s`),r){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),dr(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var e,s;if(!t)throw new ae;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Wi;const{data:r,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!r.session)throw new ae;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={data:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(i,"error",r),q(r)){const o={data:null,error:r};return dr(r)||await this._removeSession(),(e=this.refreshingDeferred)===null||e===void 0||e.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(t,e,s=!0){const i=`#_notifyAllSubscribers(${t})`;this._debug(i,"begin",e,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:t,session:e});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,e)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Wt(this.storage,`${this.storageKey}-code-verifier`);const e=Object.assign({},t),s=e.user&&e.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&e.user&&await Hn(this.userStorage,this.storageKey+"-user",{user:e.user});const i=Object.assign({},e);delete i.user;const r=fa(i);await Hn(this.storage,this.storageKey,r)}else{const i=fa(e);await Hn(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Wt(this.storage,this.storageKey),await Wt(this.storage,this.storageKey+"-code-verifier"),await Wt(this.storage,this.storageKey+"-user"),this.userStorage&&await Wt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Vt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),zn);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const e=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const e=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,e&&clearTimeout(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-t)/zn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${zn}ms, refresh threshold is ${Ur} ticks`),i<=Ur&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof hc)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Vt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const e=`#_onVisibilityChanged(${t})`;this._debug(e,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(e,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,e,s){const i=[`provider=${encodeURIComponent(e)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[r,o]=await Dn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const r=new URLSearchParams(s.queryParams);i.push(r.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${t}?${i.join("&")}`}async _unenroll(t){try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;return r?this._returnResult({data:null,error:r}):await K(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(t){try{return await this._useSession(async e=>{var s,i;const{data:r,error:o}=e;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await K(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?cf(t.webauthn.credential_response):df(t.webauthn.credential_response)})}:{code:t.code}),{data:a,error:l}=await K(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async e=>{var s;const{data:i,error:r}=e;if(r)return this._returnResult({data:null,error:r});const o=await K(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:af(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:lf(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(t){const{data:e,error:s}=await this._challenge({factorId:t.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})}async _listFactors(){var t;const{data:{user:e},error:s}=await this.getUser();if(s)return{data:null,error:s};const i={all:[],phone:[],totp:[],webauthn:[]};for(const r of(t=e==null?void 0:e.factors)!==null&&t!==void 0?t:[])i.all.push(r),r.status==="verified"&&i[r.factor_type].push(r);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(t){var e,s,i,r;if(t)try{const{payload:f}=ni(t);let g=null;f.aal&&(g=f.aal);let p=g;const{data:{user:m},error:b}=await this.getUser(t);if(b)return this._returnResult({data:null,error:b});((s=(e=m==null?void 0:m.factors)===null||e===void 0?void 0:e.filter(S=>S.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(p="aal2");const x=f.amr||[];return{data:{currentLevel:g,nextLevel:p,currentAuthenticationMethods:x},error:null}}catch(f){if(q(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=ni(o.access_token);let c=null;l.aal&&(c=l.aal);let d=c;((r=(i=o.user.factors)===null||i===void 0?void 0:i.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(d="aal2");const h=l.amr||[];return{data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async e=>{const{data:{session:s},error:i}=e;return i?this._returnResult({data:null,error:i}):s?await K(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:s.access_token,xform:r=>({data:r,error:null})}):this._returnResult({data:null,error:new ae})})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(t,e){try{return await this._useSession(async s=>{const{data:{session:i},error:r}=s;if(r)return this._returnResult({data:null,error:r});if(!i)return this._returnResult({data:null,error:new ae});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Vt()&&!(e!=null&&e.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(q(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(t,e){try{return await this._useSession(async s=>{const{data:{session:i},error:r}=s;if(r)return this._returnResult({data:null,error:r});if(!i)return this._returnResult({data:null,error:new ae});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Vt()&&!(e!=null&&e.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(q(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:e},error:s}=t;return s?this._returnResult({data:null,error:s}):e?await K(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:e.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new ae})})}catch(t){if(q(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async e=>{const{data:{session:s},error:i}=e;return i?this._returnResult({data:null,error:i}):s?(await K(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new ae})})}catch(e){if(q(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(t,e={keys:[]}){let s=e.keys.find(a=>a.kid===t);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(a=>a.kid===t),s&&this.jwks_cached_at+yh>i)return s;const{data:r,error:o}=await K(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=i,s=r.keys.find(a=>a.kid===t),!s)?null:s}async getClaims(t,e={}){try{let s=t;if(!s){const{data:f,error:g}=await this.getSession();if(g||!f.session)return this._returnResult({data:null,error:g});s=f.session.access_token}const{header:i,payload:r,signature:o,raw:{header:a,payload:l}}=ni(s);e!=null&&e.allowExpired||jh(r.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,e!=null&&e.keys?{keys:e.keys}:e==null?void 0:e.jwks);if(!c){const{error:f}=await this.getUser(s);if(f)throw f;return{data:{claims:r,header:i,signature:o},error:null}}const d=Fh(i.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,o,Th(`${a}.${l}`)))throw new Wr("Invalid JWT signature");return{data:{claims:r,header:i,signature:o},error:null}}catch(s){if(q(s))return this._returnResult({data:null,error:s});throw s}}}Is.nextInstanceID={};const _f=Is,vf="2.94.1";let ds="";typeof Deno<"u"?ds="deno":typeof document<"u"?ds="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ds="react-native":ds="node";const wf={"X-Client-Info":`supabase-js-${ds}/${vf}`},xf={headers:wf},kf={schema:"public"},Sf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ef={};function Ls(n){"@babel/helpers - typeof";return Ls=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ls(n)}function Tf(n,t){if(Ls(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var s=e.call(n,t);if(Ls(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function Af(n){var t=Tf(n,"string");return Ls(t)=="symbol"?t:t+""}function Of(n,t,e){return(t=Af(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function va(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,s)}return e}function Ct(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?va(Object(e),!0).forEach(function(s){Of(n,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):va(Object(e)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(e,s))})}return n}const Cf=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),Rf=()=>Headers,Mf=(n,t,e)=>{const s=Cf(e),i=Rf();return async(r,o)=>{var a;const l=(a=await t())!==null&&a!==void 0?a:n;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),s(r,Ct(Ct({},o),{},{headers:c}))}};function If(n){return n.endsWith("/")?n:n+"/"}function Lf(n,t){var e,s;const{db:i,auth:r,realtime:o,global:a}=n,{db:l,auth:c,realtime:d,global:u}=t,h={db:Ct(Ct({},l),i),auth:Ct(Ct({},c),r),realtime:Ct(Ct({},d),o),storage:{},global:Ct(Ct(Ct({},u),a),{},{headers:Ct(Ct({},(e=u==null?void 0:u.headers)!==null&&e!==void 0?e:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return n.accessToken?h.accessToken=n.accessToken:delete h.accessToken,h}function Pf(n){const t=n==null?void 0:n.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(If(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Df=class extends _f{constructor(n){super(n)}},$f=class{constructor(n,t,e){var s,i;this.supabaseUrl=n,this.supabaseKey=t;const r=Pf(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",r),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",r),this.storageUrl=new URL("storage/v1",r),this.functionsUrl=new URL("functions/v1",r);const o=`sb-${r.hostname.split(".")[0]}-auth-token`,a={db:kf,realtime:Ef,auth:Ct(Ct({},Sf),{},{storageKey:o}),global:xf},l=Lf(e??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=Mf(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Ct({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new _u(new URL("rest/v1",r).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new hh(this.storageUrl.href,this.headers,this.fetch,e==null?void 0:e.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new uu(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},e={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,e)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,e;if(n.accessToken)return await n.accessToken();const{data:s}=await n.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:e,storage:s,userStorage:i,storageKey:r,flowType:o,lock:a,debug:l,throwOnError:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Df({url:this.authUrl.href,headers:Ct(Ct({},h),d),storageKey:r,autoRefreshToken:n,persistSession:t,detectSessionInUrl:e,storage:s,userStorage:i,flowType:o,lock:a,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new $u(this.realtimeUrl.href,Ct(Ct({},n),{},{params:Ct(Ct({},{apikey:this.supabaseKey}),n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(n,t,e){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==e?(this.changedAccessToken=e,this.realtime.setAuth(e)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Bf=(n,t,e)=>new $f(n,t,e);function Nf(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const t=n.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Nf()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Ws(n){return n+.5|0}const qe=(n,t,e)=>Math.max(Math.min(n,e),t);function us(n){return qe(Ws(n*2.55),0,255)}function Xe(n){return qe(Ws(n*255),0,255)}function Ne(n){return qe(Ws(n/2.55)/100,0,1)}function wa(n){return qe(Ws(n*100),0,100)}const ue={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Vr=[..."0123456789ABCDEF"],jf=n=>Vr[n&15],Ff=n=>Vr[(n&240)>>4]+Vr[n&15],si=n=>(n&240)>>4===(n&15),Uf=n=>si(n.r)&&si(n.g)&&si(n.b)&&si(n.a);function zf(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ue[n[1]]*17,g:255&ue[n[2]]*17,b:255&ue[n[3]]*17,a:t===5?ue[n[4]]*17:255}:(t===7||t===9)&&(e={r:ue[n[1]]<<4|ue[n[2]],g:ue[n[3]]<<4|ue[n[4]],b:ue[n[5]]<<4|ue[n[6]],a:t===9?ue[n[7]]<<4|ue[n[8]]:255})),e}const Hf=(n,t)=>n<255?t(n):"";function Wf(n){var t=Uf(n)?jf:Ff;return n?"#"+t(n.r)+t(n.g)+t(n.b)+Hf(n.a,t):void 0}const Vf=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function pc(n,t,e){const s=t*Math.min(e,1-e),i=(r,o=(r+n/30)%12)=>e-s*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function qf(n,t,e){const s=(i,r=(i+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[s(5),s(3),s(1)]}function Gf(n,t,e){const s=pc(n,1,.5);let i;for(t+e>1&&(i=1/(t+e),t*=i,e*=i),i=0;i<3;i++)s[i]*=1-t-e,s[i]+=t;return s}function Yf(n,t,e,s,i){return n===i?(t-e)/s+(t<e?6:0):t===i?(e-n)/s+2:(n-t)/s+4}function bo(n){const e=n.r/255,s=n.g/255,i=n.b/255,r=Math.max(e,s,i),o=Math.min(e,s,i),a=(r+o)/2;let l,c,d;return r!==o&&(d=r-o,c=a>.5?d/(2-r-o):d/(r+o),l=Yf(e,s,i,d,r),l=l*60+.5),[l|0,c||0,a]}function _o(n,t,e,s){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,s)).map(Xe)}function vo(n,t,e){return _o(pc,n,t,e)}function Kf(n,t,e){return _o(Gf,n,t,e)}function Jf(n,t,e){return _o(qf,n,t,e)}function mc(n){return(n%360+360)%360}function Xf(n){const t=Vf.exec(n);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?us(+t[5]):Xe(+t[5]));const i=mc(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?s=Kf(i,r,o):t[1]==="hsv"?s=Jf(i,r,o):s=vo(i,r,o),{r:s[0],g:s[1],b:s[2],a:e}}function Qf(n,t){var e=bo(n);e[0]=mc(e[0]+t),e=vo(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Zf(n){if(!n)return;const t=bo(n),e=t[0],s=wa(t[1]),i=wa(t[2]);return n.a<255?`hsla(${e}, ${s}%, ${i}%, ${Ne(n.a)})`:`hsl(${e}, ${s}%, ${i}%)`}const xa={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ka={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function tg(){const n={},t=Object.keys(ka),e=Object.keys(xa);let s,i,r,o,a;for(s=0;s<t.length;s++){for(o=a=t[s],i=0;i<e.length;i++)r=e[i],a=a.replace(r,xa[r]);r=parseInt(ka[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let ii;function eg(n){ii||(ii=tg(),ii.transparent=[0,0,0,0]);const t=ii[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const ng=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function sg(n){const t=ng.exec(n);let e=255,s,i,r;if(t){if(t[7]!==s){const o=+t[7];e=t[8]?us(o):qe(o*255,0,255)}return s=+t[1],i=+t[3],r=+t[5],s=255&(t[2]?us(s):qe(s,0,255)),i=255&(t[4]?us(i):qe(i,0,255)),r=255&(t[6]?us(r):qe(r,0,255)),{r:s,g:i,b:r,a:e}}}function ig(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Ne(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const fr=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,jn=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function rg(n,t,e){const s=jn(Ne(n.r)),i=jn(Ne(n.g)),r=jn(Ne(n.b));return{r:Xe(fr(s+e*(jn(Ne(t.r))-s))),g:Xe(fr(i+e*(jn(Ne(t.g))-i))),b:Xe(fr(r+e*(jn(Ne(t.b))-r))),a:n.a+e*(t.a-n.a)}}function ri(n,t,e){if(n){let s=bo(n);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=vo(s),n.r=s[0],n.g=s[1],n.b=s[2]}}function yc(n,t){return n&&Object.assign(t||{},n)}function Sa(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Xe(n[3]))):(t=yc(n,{r:0,g:0,b:0,a:1}),t.a=Xe(t.a)),t}function og(n){return n.charAt(0)==="r"?sg(n):Xf(n)}class Ps{constructor(t){if(t instanceof Ps)return t;const e=typeof t;let s;e==="object"?s=Sa(t):e==="string"&&(s=zf(t)||eg(t)||og(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=yc(this._rgb);return t&&(t.a=Ne(t.a)),t}set rgb(t){this._rgb=Sa(t)}rgbString(){return this._valid?ig(this._rgb):void 0}hexString(){return this._valid?Wf(this._rgb):void 0}hslString(){return this._valid?Zf(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,i=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=s.a-i.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,s.r=255&c*s.r+r*i.r+.5,s.g=255&c*s.g+r*i.g+.5,s.b=255&c*s.b+r*i.b+.5,s.a=o*s.a+(1-o)*i.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=rg(this._rgb,t._rgb,e)),this}clone(){return new Ps(this.rgb)}alpha(t){return this._rgb.a=Xe(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Ws(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return ri(this._rgb,2,t),this}darken(t){return ri(this._rgb,2,-t),this}saturate(t){return ri(this._rgb,1,t),this}desaturate(t){return ri(this._rgb,1,-t),this}rotate(t){return Qf(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Pe(){}const ag=(()=>{let n=0;return()=>n++})();function at(n){return n==null}function At(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function ct(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Rt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function le(n,t){return Rt(n)?n:t}function tt(n,t){return typeof n>"u"?t:n}const lg=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,bc=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function _t(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function yt(n,t,e,s){let i,r,o;if(At(n))for(r=n.length,i=0;i<r;i++)t.call(e,n[i],i);else if(ct(n))for(o=Object.keys(n),r=o.length,i=0;i<r;i++)t.call(e,n[o[i]],o[i])}function Mi(n,t){let e,s,i,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,s=n.length;e<s;++e)if(i=n[e],r=t[e],i.datasetIndex!==r.datasetIndex||i.index!==r.index)return!1;return!0}function Ii(n){if(At(n))return n.map(Ii);if(ct(n)){const t=Object.create(null),e=Object.keys(n),s=e.length;let i=0;for(;i<s;++i)t[e[i]]=Ii(n[e[i]]);return t}return n}function _c(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function cg(n,t,e,s){if(!_c(n))return;const i=t[n],r=e[n];ct(i)&&ct(r)?Ds(i,r,s):t[n]=Ii(r)}function Ds(n,t,e){const s=At(t)?t:[t],i=s.length;if(!ct(n))return n;e=e||{};const r=e.merger||cg;let o;for(let a=0;a<i;++a){if(o=s[a],!ct(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)r(l[c],n,o,e)}return n}function ws(n,t){return Ds(n,t,{merger:dg})}function dg(n,t,e){if(!_c(n))return;const s=t[n],i=e[n];ct(s)&&ct(i)?ws(s,i):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Ii(i))}const Ea={"":n=>n,x:n=>n.x,y:n=>n.y};function ug(n){const t=n.split("."),e=[];let s="";for(const i of t)s+=i,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function hg(n){const t=ug(n);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function Ze(n,t){return(Ea[t]||(Ea[t]=hg(t)))(n)}function wo(n){return n.charAt(0).toUpperCase()+n.slice(1)}const $s=n=>typeof n<"u",tn=n=>typeof n=="function",Ta=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function fg(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const ht=Math.PI,kt=2*ht,gg=kt+ht,Li=Number.POSITIVE_INFINITY,pg=ht/180,Mt=ht/2,dn=ht/4,Aa=ht*2/3,Ge=Math.log10,Ce=Math.sign;function xs(n,t,e){return Math.abs(n-t)<e}function Oa(n){const t=Math.round(n);n=xs(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(Ge(n))),s=n/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function mg(n){const t=[],e=Math.sqrt(n);let s;for(s=1;s<e;s++)n%s===0&&(t.push(s),t.push(n/s));return e===(e|0)&&t.push(e),t.sort((i,r)=>i-r).pop(),t}function yg(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Gn(n){return!yg(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function bg(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function vc(n,t,e){let s,i,r;for(s=0,i=n.length;s<i;s++)r=n[s][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function ve(n){return n*(ht/180)}function xo(n){return n*(180/ht)}function Ca(n){if(!Rt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function wc(n,t){const e=t.x-n.x,s=t.y-n.y,i=Math.sqrt(e*e+s*s);let r=Math.atan2(s,e);return r<-.5*ht&&(r+=kt),{angle:r,distance:i}}function qr(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function _g(n,t){return(n-t+gg)%kt-ht}function Kt(n){return(n%kt+kt)%kt}function Bs(n,t,e,s){const i=Kt(n),r=Kt(t),o=Kt(e),a=Kt(r-i),l=Kt(o-i),c=Kt(i-r),d=Kt(i-o);return i===r||i===o||s&&r===o||a>l&&c<d}function Ft(n,t,e){return Math.max(t,Math.min(e,n))}function vg(n){return Ft(n,-32768,32767)}function je(n,t,e,s=1e-6){return n>=Math.min(t,e)-s&&n<=Math.max(t,e)+s}function ko(n,t,e){e=e||(o=>n[o]<t);let s=n.length-1,i=0,r;for(;s-i>1;)r=i+s>>1,e(r)?i=r:s=r;return{lo:i,hi:s}}const Fe=(n,t,e,s)=>ko(n,e,s?i=>{const r=n[i][t];return r<e||r===e&&n[i+1][t]===e}:i=>n[i][t]<e),wg=(n,t,e)=>ko(n,e,s=>n[s][t]>=e);function xg(n,t,e){let s=0,i=n.length;for(;s<i&&n[s]<t;)s++;for(;i>s&&n[i-1]>e;)i--;return s>0||i<n.length?n.slice(s,i):n}const xc=["push","pop","shift","splice","unshift"];function kg(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),xc.forEach(e=>{const s="_onData"+wo(e),i=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=i.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...r)}),o}})})}function Ra(n,t){const e=n._chartjs;if(!e)return;const s=e.listeners,i=s.indexOf(t);i!==-1&&s.splice(i,1),!(s.length>0)&&(xc.forEach(r=>{delete n[r]}),delete n._chartjs)}function kc(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Sc=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Ec(n,t){let e=[],s=!1;return function(...i){e=i,s||(s=!0,Sc.call(window,()=>{s=!1,n.apply(t,e)}))}}function Sg(n,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(n,t,s)):n.apply(this,s),t}}const So=n=>n==="start"?"left":n==="end"?"right":"center",Yt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,Eg=(n,t,e,s)=>n===(s?"left":"right")?e:n==="center"?(t+e)/2:t;function Tc(n,t,e){const s=t.length;let i=0,r=s;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=o.axis,{min:u,max:h,minDefined:f,maxDefined:g}=o.getUserBounds();if(f){if(i=Math.min(Fe(l,d,u).lo,e?s:Fe(t,d,o.getPixelForValue(u)).lo),c){const p=l.slice(0,i+1).reverse().findIndex(m=>!at(m[a.axis]));i-=Math.max(0,p)}i=Ft(i,0,s-1)}if(g){let p=Math.max(Fe(l,o.axis,h,!0).hi+1,e?0:Fe(t,d,o.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!at(b[a.axis]));p+=Math.max(0,m)}r=Ft(p,i,s)-i}else r=s-i}return{start:i,count:r}}function Ac(n){const{xScale:t,yScale:e,_scaleRanges:s}=n,i={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return n._scaleRanges=i,!0;const r=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,i),r}const oi=n=>n===0||n===1,Ma=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*kt/e)),Ia=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*kt/e)+1,ks={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Mt)+1,easeOutSine:n=>Math.sin(n*Mt),easeInOutSine:n=>-.5*(Math.cos(ht*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>oi(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>oi(n)?n:Ma(n,.075,.3),easeOutElastic:n=>oi(n)?n:Ia(n,.075,.3),easeInOutElastic(n){return oi(n)?n:n<.5?.5*Ma(n*2,.1125,.45):.5+.5*Ia(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-ks.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?ks.easeInBounce(n*2)*.5:ks.easeOutBounce(n*2-1)*.5+.5};function Eo(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function La(n){return Eo(n)?n:new Ps(n)}function gr(n){return Eo(n)?n:new Ps(n).saturate(.5).darken(.1).hexString()}const Tg=["x","y","borderWidth","radius","tension"],Ag=["color","borderColor","backgroundColor"];function Og(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:Ag},numbers:{type:"number",properties:Tg}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Cg(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Pa=new Map;function Rg(n,t){t=t||{};const e=n+JSON.stringify(t);let s=Pa.get(e);return s||(s=new Intl.NumberFormat(n,t),Pa.set(e,s)),s}function Vs(n,t,e){return Rg(t,e).format(n)}const Oc={values(n){return At(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const s=this.chart.options.locale;let i,r=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(i="scientific"),r=Mg(n,e)}const o=Ge(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:i,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Vs(n,s,l)},logarithmic(n,t,e){if(n===0)return"0";const s=e[t].significand||n/Math.pow(10,Math.floor(Ge(n)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?Oc.numeric.call(this,n,t,e):""}};function Mg(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Vi={formatters:Oc};function Ig(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Vi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Sn=Object.create(null),Gr=Object.create(null);function Ss(n,t){if(!t)return n;const e=t.split(".");for(let s=0,i=e.length;s<i;++s){const r=e[s];n=n[r]||(n[r]=Object.create(null))}return n}function pr(n,t,e){return typeof t=="string"?Ds(Ss(n,t),e):Ds(Ss(n,""),t)}class Lg{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,i)=>gr(i.backgroundColor),this.hoverBorderColor=(s,i)=>gr(i.borderColor),this.hoverColor=(s,i)=>gr(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return pr(this,t,e)}get(t){return Ss(this,t)}describe(t,e){return pr(Gr,t,e)}override(t,e){return pr(Sn,t,e)}route(t,e,s,i){const r=Ss(this,t),o=Ss(this,s),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[i];return ct(l)?Object.assign({},c,l):tt(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var Ot=new Lg({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Og,Cg,Ig]);function Pg(n){return!n||at(n.size)||at(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Pi(n,t,e,s,i){let r=t[i];return r||(r=t[i]=n.measureText(i).width,e.push(i)),r>s&&(s=r),s}function Dg(n,t,e,s){s=s||{};let i=s.data=s.data||{},r=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(i=s.data={},r=s.garbageCollect=[],s.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=e[l],u!=null&&!At(u))o=Pi(n,i,r,o,u);else if(At(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!At(h)&&(o=Pi(n,i,r,o,h));n.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete i[r[l]];r.splice(0,f)}return o}function un(n,t,e){const s=n.currentDevicePixelRatio,i=e!==0?Math.max(e/2,.5):0;return Math.round((t-i)*s)/s+i}function Da(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Yr(n,t,e,s){Cc(n,t,e,s,null)}function Cc(n,t,e,s,i){let r,o,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*pg;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,s),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(p)||p<=0)){switch(n.beginPath(),f){default:i?n.ellipse(e,s,i/2,p,0,0,kt):n.arc(e,s,p,0,kt),n.closePath();break;case"triangle":d=i?i/2:p,n.moveTo(e+Math.sin(m)*d,s-Math.cos(m)*p),m+=Aa,n.lineTo(e+Math.sin(m)*d,s-Math.cos(m)*p),m+=Aa,n.lineTo(e+Math.sin(m)*d,s-Math.cos(m)*p),n.closePath();break;case"rectRounded":c=p*.516,l=p-c,o=Math.cos(m+dn)*l,u=Math.cos(m+dn)*(i?i/2-c:l),a=Math.sin(m+dn)*l,h=Math.sin(m+dn)*(i?i/2-c:l),n.arc(e-u,s-a,c,m-ht,m-Mt),n.arc(e+h,s-o,c,m-Mt,m),n.arc(e+u,s+a,c,m,m+Mt),n.arc(e-h,s+o,c,m+Mt,m+ht),n.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=i?i/2:l,n.rect(e-d,s-l,2*d,2*l);break}m+=dn;case"rectRot":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+h,s-o),n.lineTo(e+u,s+a),n.lineTo(e-h,s+o),n.closePath();break;case"crossRot":m+=dn;case"cross":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o);break;case"star":u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o),m+=dn,u=Math.cos(m)*(i?i/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(i?i/2:p),n.moveTo(e-u,s-a),n.lineTo(e+u,s+a),n.moveTo(e+h,s-o),n.lineTo(e-h,s+o);break;case"line":o=i?i/2:Math.cos(m)*p,a=Math.sin(m)*p,n.moveTo(e-o,s-a),n.lineTo(e+o,s+a);break;case"dash":n.moveTo(e,s),n.lineTo(e+Math.cos(m)*(i?i/2:p),s+Math.sin(m)*p);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Ue(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function qi(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Gi(n){n.restore()}function $g(n,t,e,s,i){if(!t)return n.lineTo(e.x,e.y);if(i==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else i==="after"!=!!s?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function Bg(n,t,e,s){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function Ng(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),at(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function jg(n,t,e,s,i){if(i.strikethrough||i.underline){const r=n.measureText(s),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,d=i.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=i.decorationWidth||2,n.moveTo(o,d),n.lineTo(a,d),n.stroke()}}function Fg(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function En(n,t,e,s,i,r={}){const o=At(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(n.save(),n.font=i.string,Ng(n,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&Fg(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),at(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(c,e,s,r.maxWidth)),n.fillText(c,e,s,r.maxWidth),jg(n,e,s,c,r),s+=Number(i.lineHeight);n.restore()}function Ns(n,t){const{x:e,y:s,w:i,h:r,radius:o}=t;n.arc(e+o.topLeft,s+o.topLeft,o.topLeft,1.5*ht,ht,!0),n.lineTo(e,s+r-o.bottomLeft),n.arc(e+o.bottomLeft,s+r-o.bottomLeft,o.bottomLeft,ht,Mt,!0),n.lineTo(e+i-o.bottomRight,s+r),n.arc(e+i-o.bottomRight,s+r-o.bottomRight,o.bottomRight,Mt,0,!0),n.lineTo(e+i,s+o.topRight),n.arc(e+i-o.topRight,s+o.topRight,o.topRight,0,-Mt,!0),n.lineTo(e+o.topLeft,s)}const Ug=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,zg=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Hg(n,t){const e=(""+n).match(Ug);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const Wg=n=>+n||0;function To(n,t){const e={},s=ct(t),i=s?Object.keys(t):t,r=ct(n)?s?o=>tt(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of i)e[o]=Wg(r(o));return e}function Rc(n){return To(n,{top:"y",right:"x",bottom:"y",left:"x"})}function xn(n){return To(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Xt(n){const t=Rc(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Nt(n,t){n=n||{},t=t||Ot.font;let e=tt(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=tt(n.style,t.style);s&&!(""+s).match(zg)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const i={family:tt(n.family,t.family),lineHeight:Hg(tt(n.lineHeight,t.lineHeight),e),size:e,style:s,weight:tt(n.weight,t.weight),string:""};return i.string=Pg(i),i}function hs(n,t,e,s){let i,r,o;for(i=0,r=n.length;i<r;++i)if(o=n[i],o!==void 0&&o!==void 0)return o}function Vg(n,t,e){const{min:s,max:i}=n,r=bc(t,(i-s)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(s,-Math.abs(r)),max:o(i,r)}}function sn(n,t){return Object.assign(Object.create(n),t)}function Ao(n,t=[""],e,s,i=()=>n[0]){const r=e||n;typeof s>"u"&&(s=Pc("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:s,_getTarget:i,override:a=>Ao([a,...n],t,r,s)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return Ic(a,l,()=>Zg(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Ba(a).includes(l)},ownKeys(a){return Ba(a)},set(a,l,c){const d=a._storage||(a._storage=i());return a[l]=d[l]=c,delete a._keys,!0}})}function Yn(n,t,e,s){const i={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Mc(n,s),setContext:r=>Yn(n,r,e,s),override:r=>Yn(n.override(r),t,e,s)};return new Proxy(i,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return Ic(r,o,()=>Gg(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function Mc(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:i=t.allKeys}=n;return{allKeys:i,scriptable:e,indexable:s,isScriptable:tn(e)?e:()=>e,isIndexable:tn(s)?s:()=>s}}const qg=(n,t)=>n?n+wo(t):t,Oo=(n,t)=>ct(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Ic(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const s=e();return n[t]=s,s}function Gg(n,t,e){const{_proxy:s,_context:i,_subProxy:r,_descriptors:o}=n;let a=s[t];return tn(a)&&o.isScriptable(t)&&(a=Yg(t,a,n,e)),At(a)&&a.length&&(a=Kg(t,a,n,o.isIndexable)),Oo(t,a)&&(a=Yn(a,i,r&&r[t],o)),a}function Yg(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||s);return a.delete(n),Oo(n,l)&&(l=Co(i._scopes,i,n,l)),l}function Kg(n,t,e,s){const{_proxy:i,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&s(n))return t[r.index%t.length];if(ct(t[0])){const l=t,c=i._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=Co(c,i,n,d);t.push(Yn(u,r,o&&o[n],a))}}return t}function Lc(n,t,e){return tn(n)?n(t,e):n}const Jg=(n,t)=>n===!0?t:typeof n=="string"?Ze(t,n):void 0;function Xg(n,t,e,s,i){for(const r of t){const o=Jg(e,r);if(o){n.add(o);const a=Lc(o._fallback,e,i);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(o===!1&&typeof s<"u"&&e!==s)return null}return!1}function Co(n,t,e,s){const i=t._rootScopes,r=Lc(t._fallback,e,s),o=[...n,...i],a=new Set;a.add(s);let l=$a(a,o,e,r||e,s);return l===null||typeof r<"u"&&r!==e&&(l=$a(a,o,r,l,s),l===null)?!1:Ao(Array.from(a),[""],i,r,()=>Qg(t,e,s))}function $a(n,t,e,s,i){for(;e;)e=Xg(n,t,e,s,i);return e}function Qg(n,t,e){const s=n._getTarget();t in s||(s[t]={});const i=s[t];return At(i)&&ct(e)?e:i||{}}function Zg(n,t,e,s){let i;for(const r of t)if(i=Pc(qg(r,n),e),typeof i<"u")return Oo(n,i)?Co(e,s,n,i):i}function Pc(n,t){for(const e of t){if(!e)continue;const s=e[n];if(typeof s<"u")return s}}function Ba(n){let t=n._keys;return t||(t=n._keys=tp(n._scopes)),t}function tp(n){const t=new Set;for(const e of n)for(const s of Object.keys(e).filter(i=>!i.startsWith("_")))t.add(s);return Array.from(t)}function Dc(n,t,e,s){const{iScale:i}=n,{key:r="r"}=this._parsing,o=new Array(s);let a,l,c,d;for(a=0,l=s;a<l;++a)c=a+e,d=t[c],o[a]={r:i.parse(Ze(d,r),c)};return o}const ep=Number.EPSILON||1e-14,Kn=(n,t)=>t<n.length&&!n[t].skip&&n[t],$c=n=>n==="x"?"y":"x";function np(n,t,e,s){const i=n.skip?t:n,r=t,o=e.skip?t:e,a=qr(r,i),l=qr(o,r);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=s*c,h=s*d;return{previous:{x:r.x-u*(o.x-i.x),y:r.y-u*(o.y-i.y)},next:{x:r.x+h*(o.x-i.x),y:r.y+h*(o.y-i.y)}}}function sp(n,t,e){const s=n.length;let i,r,o,a,l,c=Kn(n,0);for(let d=0;d<s-1;++d)if(l=c,c=Kn(n,d+1),!(!l||!c)){if(xs(t[d],0,ep)){e[d]=e[d+1]=0;continue}i=e[d]/t[d],r=e[d+1]/t[d],a=Math.pow(i,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[d]=i*o*t[d],e[d+1]=r*o*t[d])}}function ip(n,t,e="x"){const s=$c(e),i=n.length;let r,o,a,l=Kn(n,0);for(let c=0;c<i;++c){if(o=a,a=l,l=Kn(n,c+1),!a)continue;const d=a[e],u=a[s];o&&(r=(d-o[e])/3,a[`cp1${e}`]=d-r,a[`cp1${s}`]=u-r*t[c]),l&&(r=(l[e]-d)/3,a[`cp2${e}`]=d+r,a[`cp2${s}`]=u+r*t[c])}}function rp(n,t="x"){const e=$c(t),s=n.length,i=Array(s).fill(0),r=Array(s);let o,a,l,c=Kn(n,0);for(o=0;o<s;++o)if(a=l,l=c,c=Kn(n,o+1),!!l){if(c){const d=c[t]-l[t];i[o]=d!==0?(c[e]-l[e])/d:0}r[o]=a?c?Ce(i[o-1])!==Ce(i[o])?0:(i[o-1]+i[o])/2:i[o-1]:i[o]}sp(n,i,r),ip(n,r,t)}function ai(n,t,e){return Math.max(Math.min(n,e),t)}function op(n,t){let e,s,i,r,o,a=Ue(n[0],t);for(e=0,s=n.length;e<s;++e)o=r,r=a,a=e<s-1&&Ue(n[e+1],t),r&&(i=n[e],o&&(i.cp1x=ai(i.cp1x,t.left,t.right),i.cp1y=ai(i.cp1y,t.top,t.bottom)),a&&(i.cp2x=ai(i.cp2x,t.left,t.right),i.cp2y=ai(i.cp2y,t.top,t.bottom)))}function ap(n,t,e,s,i){let r,o,a,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")rp(n,i);else{let c=s?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=np(c,a,n[Math.min(r+1,o-(s?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&op(n,e)}function Ro(){return typeof window<"u"&&typeof document<"u"}function Mo(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Di(n,t,e){let s;return typeof n=="string"?(s=parseInt(n,10),n.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=n,s}const Yi=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function lp(n,t){return Yi(n).getPropertyValue(t)}const cp=["top","right","bottom","left"];function kn(n,t,e){const s={};e=e?"-"+e:"";for(let i=0;i<4;i++){const r=cp[i];s[r]=parseFloat(n[t+"-"+r+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const dp=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function up(n,t){const e=n.touches,s=e&&e.length?e[0]:n,{offsetX:i,offsetY:r}=s;let o=!1,a,l;if(dp(i,r,n.target))a=i,l=r;else{const c=t.getBoundingClientRect();a=s.clientX-c.left,l=s.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function pn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:s}=t,i=Yi(e),r=i.boxSizing==="border-box",o=kn(i,"padding"),a=kn(i,"border","width"),{x:l,y:c,box:d}=up(n,e),u=o.left+(d&&a.left),h=o.top+(d&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((l-u)/f*e.width/s),y:Math.round((c-h)/g*e.height/s)}}function hp(n,t,e){let s,i;if(t===void 0||e===void 0){const r=n&&Mo(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Yi(r),l=kn(a,"border","width"),c=kn(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,s=Di(a.maxWidth,r,"clientWidth"),i=Di(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:s||Li,maxHeight:i||Li}}const Ye=n=>Math.round(n*10)/10;function fp(n,t,e,s){const i=Yi(n),r=kn(i,"margin"),o=Di(i.maxWidth,n,"clientWidth")||Li,a=Di(i.maxHeight,n,"clientHeight")||Li,l=hp(n,t,e);let{width:c,height:d}=l;if(i.boxSizing==="content-box"){const h=kn(i,"border","width"),f=kn(i,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-r.width),d=Math.max(0,s?c/s:d-r.height),c=Ye(Math.min(c,o,l.maxWidth)),d=Ye(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Ye(c/2)),(t!==void 0||e!==void 0)&&s&&l.height&&d>l.height&&(d=l.height,c=Ye(Math.floor(d*s))),{width:c,height:d}}function Na(n,t,e){const s=t||1,i=Ye(n.height*s),r=Ye(n.width*s);n.height=Ye(n.height),n.width=Ye(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==s||o.height!==i||o.width!==r?(n.currentDevicePixelRatio=s,o.height=i,o.width=r,n.ctx.setTransform(s,0,0,s,0,0),!0):!1}const gp=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Ro()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function ja(n,t){const e=lp(n,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function mn(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function pp(n,t,e,s){return{x:n.x+e*(t.x-n.x),y:s==="middle"?e<.5?n.y:t.y:s==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function mp(n,t,e,s){const i={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=mn(n,i,e),a=mn(i,r,e),l=mn(r,t,e),c=mn(o,a,e),d=mn(a,l,e);return mn(c,d,e)}const yp=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},bp=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function qn(n,t,e){return n?yp(t,e):bp()}function Bc(n,t){let e,s;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=s)}function Nc(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function jc(n){return n==="angle"?{between:Bs,compare:_g,normalize:Kt}:{between:je,compare:(t,e)=>t-e,normalize:t=>t}}function Fa({start:n,end:t,count:e,loop:s,style:i}){return{start:n%e,end:t%e,loop:s&&(t-n+1)%e===0,style:i}}function _p(n,t,e){const{property:s,start:i,end:r}=e,{between:o,normalize:a}=jc(s),l=t.length;let{start:c,end:d,loop:u}=n,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&o(a(t[c%l][s]),i,r);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function Fc(n,t,e){if(!e)return[n];const{property:s,start:i,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=jc(s),{start:d,end:u,loop:h,style:f}=_p(n,t,e),g=[];let p=!1,m=null,b,_,x;const S=()=>l(i,x,b)&&a(i,x)!==0,E=()=>a(r,b)===0||l(r,x,b),C=()=>p||S(),O=()=>!p||E();for(let y=d,v=d;y<=u;++y)_=t[y%o],!_.skip&&(b=c(_[s]),b!==x&&(p=l(b,i,r),m===null&&C()&&(m=a(b,i)===0?y:v),m!==null&&O()&&(g.push(Fa({start:m,end:y,loop:h,count:o,style:f})),m=null),v=y,x=b));return m!==null&&g.push(Fa({start:m,end:u,loop:h,count:o,style:f})),g}function Uc(n,t){const e=[],s=n.segments;for(let i=0;i<s.length;i++){const r=Fc(s[i],n.points,t);r.length&&e.push(...r)}return e}function vp(n,t,e,s){let i=0,r=t-1;if(e&&!s)for(;i<t&&!n[i].skip;)i++;for(;i<t&&n[i].skip;)i++;for(i%=t,e&&(r+=i);r>i&&n[r%t].skip;)r--;return r%=t,{start:i,end:r}}function wp(n,t,e,s){const i=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%i];c.skip||c.stop?a.skip||(s=!1,r.push({start:t%i,end:(l-1)%i,loop:s}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%i,end:o%i,loop:s}),r}function xp(n,t){const e=n.points,s=n.options.spanGaps,i=e.length;if(!i)return[];const r=!!n._loop,{start:o,end:a}=vp(e,i,r,s);if(s===!0)return Ua(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+i:a,c=!!n._fullLoop&&o===0&&a===i-1;return Ua(n,wp(e,o,l,c),e,t)}function Ua(n,t,e,s){return!s||!s.setContext||!e?t:kp(n,t,e,s)}function kp(n,t,e,s){const i=n._chart.getContext(),r=za(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,c=[];let d=r,u=t[0].start,h=u;function f(g,p,m,b){const _=a?-1:1;if(g!==p){for(g+=l;e[g%l].skip;)g-=_;for(;e[p%l].skip;)p+=_;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=e[u%l],m;for(h=u+1;h<=g.end;h++){const b=e[h%l];m=za(s.setContext(sn(i,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:o}))),Sp(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function za(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function Sp(n,t){if(!t)return!1;const e=[],s=function(i,r){return Eo(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,s)!==JSON.stringify(t,s)}function li(n,t,e){return n.options.clip?n[e]:t[e]}function Ep(n,t){const{xScale:e,yScale:s}=n;return e&&s?{left:li(e,t,"left"),right:li(e,t,"right"),top:li(s,t,"top"),bottom:li(s,t,"bottom")}:t}function zc(n,t){const e=t._clip;if(e.disabled)return!1;const s=Ep(t,n.chartArea);return{left:e.left===!1?0:s.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:s.right+(e.right===!0?0:e.right),top:e.top===!1?0:s.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:s.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Tp{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,i){const r=e.listeners[i],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(s-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Sc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,i)=>{if(!s.running||!s.items.length)return;const r=s.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(i.draw(),this._notify(i,s,t,"progress")),r.length||(s.running=!1,this._notify(i,s,t,"complete"),s.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,i)=>Math.max(s,i._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let i=s.length-1;for(;i>=0;--i)s[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var De=new Tp;const Ha="transparent",Ap={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const s=La(n||Ha),i=s.valid&&La(t||Ha);return i&&i.valid?i.mix(s,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class Op{constructor(t,e,s,i){const r=e[s];i=hs([t.to,i,r,t.from]);const o=hs([t.from,r,i]);this._active=!0,this._fn=t.fn||Ap[t.type||typeof o],this._easing=ks[t.easing]||ks.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=o,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const i=this._target[this._prop],r=s-this._start,o=this._duration-r;this._start=s,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=hs([t.to,e,i,t.from]),this._from=hs([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,i=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<s),!this._active){this._target[i]=a,this._notify(!0);return}if(e<0){this._target[i]=r;return}l=e/s%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let i=0;i<s.length;i++)s[i][e]()}}class Hc{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!ct(t))return;const e=Object.keys(Ot.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(i=>{const r=t[i];if(!ct(r))return;const o={};for(const a of e)o[a]=r[a];(At(r.properties)&&r.properties||[i]).forEach(a=>{(a===i||!s.has(a))&&s.set(a,o)})})}_animateOptions(t,e){const s=e.options,i=Rp(t,s);if(!i)return[];const r=this._createAnimations(i,s);return s.$shared&&Cp(t.options.$animations,s).then(()=>{t.options=s},()=>{}),r}_createAnimations(t,e){const s=this._properties,i=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){i.push(...this._animateOptions(t,e));continue}const d=e[c];let u=r[c];const h=s.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}r[c]=u=new Op(h,t,c,d),i.push(u)}return i}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return De.add(this._chart,s),!0}}function Cp(n,t){const e=[],s=Object.keys(t);for(let i=0;i<s.length;i++){const r=n[s[i]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function Rp(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Wa(n,t){const e=n&&n.options||{},s=e.reverse,i=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:s?r:i,end:s?i:r}}function Mp(n,t,e){if(e===!1)return!1;const s=Wa(n,e),i=Wa(t,e);return{top:i.end,right:s.end,bottom:i.start,left:s.start}}function Ip(n){let t,e,s,i;return ct(n)?(t=n.top,e=n.right,s=n.bottom,i=n.left):t=e=s=i=n,{top:t,right:e,bottom:s,left:i,disabled:n===!1}}function Wc(n,t){const e=[],s=n._getSortedDatasetMetas(t);let i,r;for(i=0,r=s.length;i<r;++i)e.push(s[i].index);return e}function Va(n,t,e,s={}){const i=n.keys,r=s.mode==="single";let o,a,l,c;if(t===null)return;let d=!1;for(o=0,a=i.length;o<a;++o){if(l=+i[o],l===e){if(d=!0,s.all)continue;break}c=n.values[l],Rt(c)&&(r||t===0||Ce(t)===Ce(c))&&(t+=c)}return!d&&!s.all?0:t}function Lp(n,t){const{iScale:e,vScale:s}=t,i=e.axis==="x"?"x":"y",r=s.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],a[l]={[i]:d,[r]:n[d]};return a}function mr(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function Pp(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function Dp(n){const{min:t,max:e,minDefined:s,maxDefined:i}=n.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:i?e:Number.POSITIVE_INFINITY}}function $p(n,t,e){const s=n[t]||(n[t]={});return s[e]||(s[e]={})}function qa(n,t,e,s){for(const i of t.getMatchingVisibleMetas(s).reverse()){const r=n[i.index];if(e&&r>0||!e&&r<0)return i.index}return null}function Ga(n,t){const{chart:e,_cachedMeta:s}=n,i=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=s,l=r.axis,c=o.axis,d=Pp(r,o,s),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=$p(i,d,p),h[a]=m,h._top=qa(h,o,!0,s.type),h._bottom=qa(h,o,!1,s.type);const _=h._visualValues||(h._visualValues={});_[a]=m}}function yr(n,t){const e=n.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function Bp(n,t){return sn(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Np(n,t,e){return sn(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function ts(n,t){const e=n.controller.index,s=n.vScale&&n.vScale.axis;if(s){t=t||n._parsed;for(const i of t){const r=i._stacks;if(!r||r[s]===void 0||r[s][e]===void 0)return;delete r[s][e],r[s]._visualValues!==void 0&&r[s]._visualValues[e]!==void 0&&delete r[s]._visualValues[e]}}}const br=n=>n==="reset"||n==="none",Ya=(n,t)=>t?n:Object.assign({},n),jp=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:Wc(e,!0),values:null};class we{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=mr(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&ts(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),i=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,r=e.xAxisID=tt(s.xAxisID,yr(t,"x")),o=e.yAxisID=tt(s.yAxisID,yr(t,"y")),a=e.rAxisID=tt(s.rAxisID,yr(t,"r")),l=e.indexAxis,c=e.iAxisID=i(l,r,o,a),d=e.vAxisID=i(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Ra(this._data,this),t._stacked&&ts(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(ct(e)){const i=this._cachedMeta;this._data=Lp(e,i)}else if(s!==e){if(s){Ra(s,this);const i=this._cachedMeta;ts(i),i._parsed=[]}e&&Object.isExtensible(e)&&kg(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let i=!1;this._dataCheck();const r=e._stacked;e._stacked=mr(e.vScale,e),e.stack!==s.stack&&(i=!0,ts(e),e.stack=s.stack),this._resyncElements(t),(i||r!==e._stacked)&&(Ga(this,e._parsed),e._stacked=mr(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:i}=this,{iScale:r,_stacked:o}=s,a=r.axis;let l=t===0&&e===i.length?!0:s._sorted,c=t>0&&s._parsed[t-1],d,u,h;if(this._parsing===!1)s._parsed=i,s._sorted=!0,h=i;else{At(i[t])?h=this.parseArrayData(s,i,t,e):ct(i[t])?h=this.parseObjectData(s,i,t,e):h=this.parsePrimitiveData(s,i,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<e;++d)s._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);s._sorted=l}o&&Ga(this,h)}parsePrimitiveData(t,e,s,i){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),d=r===o,u=new Array(i);let h,f,g;for(h=0,f=i;h<f;++h)g=h+s,u[h]={[a]:d||r.parse(c[g],g),[l]:o.parse(e[g],g)};return u}parseArrayData(t,e,s,i){const{xScale:r,yScale:o}=t,a=new Array(i);let l,c,d,u;for(l=0,c=i;l<c;++l)d=l+s,u=e[d],a[l]={x:r.parse(u[0],d),y:o.parse(u[1],d)};return a}parseObjectData(t,e,s,i){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(i);let d,u,h,f;for(d=0,u=i;d<u;++d)h=d+s,f=e[h],c[d]={x:r.parse(Ze(f,a),h),y:o.parse(Ze(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const i=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:Wc(i,!0),values:e._stacks[t.axis]._visualValues};return Va(a,o,r.index,{mode:s})}updateRangeFromParsed(t,e,s,i){const r=s[e.axis];let o=r===null?NaN:r;const a=i&&s._stacks[e.axis];i&&a&&(i.values=a,o=Va(i,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const s=this._cachedMeta,i=s._parsed,r=s._sorted&&t===s.iScale,o=i.length,a=this._getOtherScale(t),l=jp(e,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=Dp(a);let h,f;function g(){f=i[h];const p=f[a.axis];return!Rt(f[t.axis])||d>p||u<p}for(h=0;h<o&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),r));++h);if(r){for(h=o-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let i,r,o;for(i=0,r=e.length;i<r;++i)o=e[i][t.axis],Rt(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,i=e.vScale,r=this.getParsed(t);return{label:s?""+s.getLabelForValue(r[s.axis]):"",value:i?""+i.getLabelForValue(r[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Ip(tt(this.options.clip,Mp(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,i=s.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||i.length-a,c=this.options.drawActiveElementsOnTop;let d;for(s.dataset&&s.dataset.draw(t,r,a,l),d=a;d<a+l;++d){const u=i[d];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(d=0;d<o.length;++d)o[d].draw(t,r)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const i=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=Np(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=i.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=Bp(this.chart.getContext(),this.index)),r.dataset=i,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=s,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const i=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&$s(s);if(a)return Ya(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=i?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(Ot.elements[t]),g=()=>this.getContext(s,i,e),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,r[o]=Object.freeze(Ya(p,l))),p}_resolveAnimations(t,e,s){const i=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(i.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,s,e))}const c=new Hc(i,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||br(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),i=this._sharedOptions,r=this.getSharedOptions(s),o=this.includeOptions(e,r)||r!==i;return this.updateSharedOptions(r,e,s),{sharedOptions:r,includeOptions:o}}updateElement(t,e,s,i){br(i)?Object.assign(t,s):this._resolveAnimations(e,i).update(t,s)}updateSharedOptions(t,e,s){t&&!br(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,i){t.active=i;const r=this.getStyle(e,i);this._resolveAnimations(e,s,i).update(t,{options:!i&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const i=s.length,r=e.length,o=Math.min(r,i);o&&this.parse(0,o),r>i?this._insertElements(i,r-i,t):r<i&&this._removeElements(r,i-r)}_insertElements(t,e,s=!0){const i=this._cachedMeta,r=i.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(t,e),s&&this.updateElements(r,t,e,"reset")}updateElements(t,e,s,i){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const i=s._parsed.splice(t,e);s._stacked&&ts(s,i)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,i]=t;this[e](s,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}F(we,"defaults",{}),F(we,"datasetElementType",null),F(we,"dataElementType",null);function Fp(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let s=[];for(let i=0,r=e.length;i<r;i++)s=s.concat(e[i].controller.getAllParsedValues(n));n._cache.$bar=kc(s.sort((i,r)=>i-r))}return n._cache.$bar}function Up(n){const t=n.iScale,e=Fp(t,n.type);let s=t._length,i,r,o,a;const l=()=>{o===32767||o===-32768||($s(a)&&(s=Math.min(s,Math.abs(o-a)||s)),a=o)};for(i=0,r=e.length;i<r;++i)o=t.getPixelForValue(e[i]),l();for(a=void 0,i=0,r=t.ticks.length;i<r;++i)o=t.getPixelForTick(i),l();return s}function zp(n,t,e,s){const i=e.barThickness;let r,o;return at(i)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=i*s,o=1),{chunk:r/s,ratio:o,start:t.pixels[n]-r/2}}function Hp(n,t,e,s){const i=t.pixels,r=i[n];let o=n>0?i[n-1]:null,a=n<i.length-1?i[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/s,ratio:e.barPercentage,start:c}}function Wp(n,t,e,s){const i=e.parse(n[0],s),r=e.parse(n[1],s),o=Math.min(i,r),a=Math.max(i,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:i,end:r,min:o,max:a}}function Vc(n,t,e,s){return At(n)?Wp(n,t,e,s):t[e.axis]=e.parse(n,s),t}function Ka(n,t,e,s){const i=n.iScale,r=n.vScale,o=i.getLabels(),a=i===r,l=[];let c,d,u,h;for(c=e,d=e+s;c<d;++c)h=t[c],u={},u[i.axis]=a||i.parse(o[c],c),l.push(Vc(h,u,r,c));return l}function _r(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function Vp(n,t,e){return n!==0?Ce(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function qp(n){let t,e,s,i,r;return n.horizontal?(t=n.base>n.x,e="left",s="right"):(t=n.base<n.y,e="bottom",s="top"),t?(i="end",r="start"):(i="start",r="end"),{start:e,end:s,reverse:t,top:i,bottom:r}}function Gp(n,t,e,s){let i=t.borderSkipped;const r={};if(!i){n.borderSkipped=r;return}if(i===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:d}=qp(n);i==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===s?i=c:(e._bottom||0)===s?i=d:(r[Ja(d,o,a,l)]=!0,i=c)),r[Ja(i,o,a,l)]=!0,n.borderSkipped=r}function Ja(n,t,e,s){return s?(n=Yp(n,t,e),n=Xa(n,e,t)):n=Xa(n,t,e),n}function Yp(n,t,e){return n===t?e:n===e?t:n}function Xa(n,t,e){return n==="start"?t:n==="end"?e:n}function Kp(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class bi extends we{parsePrimitiveData(t,e,s,i){return Ka(t,e,s,i)}parseArrayData(t,e,s,i){return Ka(t,e,s,i)}parseObjectData(t,e,s,i){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,d=o.axis==="x"?a:l,u=[];let h,f,g,p;for(h=s,f=s+i;h<f;++h)p=e[h],g={},g[r.axis]=r.parse(Ze(p,c),h),u.push(Vc(Ze(p,d),g,o,h));return u}updateRangeFromParsed(t,e,s,i){super.updateRangeFromParsed(t,e,s,i);const r=s._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:i}=e,r=this.getParsed(t),o=r._custom,a=_r(o)?"["+o.start+", "+o.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+s.getLabelForValue(r[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,i){const r=i==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,i);for(let f=e;f<e+s;f++){const g=this.getParsed(f),p=r||at(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],_={horizontal:c,base:p.base,enableBorderRadius:!b||_r(g._custom)||o===b._top||o===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(_.options=u||this.resolveDataElementOptions(f,t[f].active?"active":i));const x=_.options||t[f].options;Gp(_,x,b,o),Kp(_,x,d.ratio),this.updateElement(t[f],f,_,i)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,i=s.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),r=s.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[s.axis],c=d=>{const u=d._parsed.find(f=>f[s.axis]===l),h=u&&u[d.vScale.axis];if(at(h)||isNaN(h))return!0};for(const d of i)if(!(e!==void 0&&c(d))&&((r===!1||o.indexOf(d.stack)===-1||r===void 0&&d.stack===void 0)&&o.push(d.stack),d.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(s=>t[s].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)t[tt(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,s){const i=this._getStacks(t,s),r=e!==void 0?i.indexOf(e):-1;return r===-1?i.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,i=[];let r,o;for(r=0,o=e.data.length;r<o;++r)i.push(s.getPixelForValue(this.getParsed(r)[s.axis],r));const a=t.barThickness;return{min:a||Up(e),pixels:i,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:i},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,d=_r(c);let u=l[e.axis],h=0,f=s?this.applyStack(e,l,s):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Ce(u)!==Ce(c.barEnd)&&(h=0),h+=u);const m=!at(r)&&!d?r:h;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<o){p=Vp(p,e,a)*o,u===a&&(b-=p/2);const _=e.getPixelForDecimal(0),x=e.getPixelForDecimal(1),S=Math.min(_,x),E=Math.max(_,x);b=Math.max(Math.min(b,E),S),g=b+p,s&&!d&&(l._stacks[e.axis]._visualValues[i]=e.getValueForPixel(g)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const _=Ce(p)*e.getLineWidthForValue(a)/2;b+=_,p-=_}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const s=e.scale,i=this.options,r=i.skipNull,o=tt(i.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const d=r?this._getStackCount(t):e.stackCount,u=i.barThickness==="flex"?Hp(t,e,i,d*c):zp(t,e,i,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(tt(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,i=s.length;let r=0;for(;r<i;++r)this.getParsed(r)[e.axis]!==null&&!s[r].hidden&&s[r].draw(this._ctx)}}F(bi,"id","bar"),F(bi,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),F(bi,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class _i extends we{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,i){const r=super.parsePrimitiveData(t,e,s,i);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+s).radius;return r}parseArrayData(t,e,s,i){const r=super.parseArrayData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=tt(a[2],this.resolveDataElementOptions(o+s).radius)}return r}parseObjectData(t,e,s,i){const r=super.parseObjectData(t,e,s,i);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=tt(a&&a.r&&+a.r,this.resolveDataElementOptions(o+s).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:s[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,i),d=o.axis,u=a.axis;for(let h=e;h<e+s;h++){const f=t[h],g=!r&&this.getParsed(h),p={},m=p[d]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[d]),b=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":i),r&&(p.options.radius=0)),this.updateElement(f,h,p,i)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const r=i.radius;return e!=="active"&&(i.radius=0),i.radius+=tt(s&&s._custom,r),i}}F(_i,"id","bubble"),F(_i,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),F(_i,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Jp(n,t,e){let s=1,i=1,r=0,o=0;if(t<kt){const a=n,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(x,S,E)=>Bs(x,a,l,!0)?1:Math.max(S,S*e,E,E*e),g=(x,S,E)=>Bs(x,a,l,!0)?-1:Math.min(S,S*e,E,E*e),p=f(0,c,u),m=f(Mt,d,h),b=g(ht,c,u),_=g(ht+Mt,d,h);s=(p-b)/2,i=(m-_)/2,r=-(p+b)/2,o=-(m+_)/2}return{ratioX:s,ratioY:i,offsetX:r,offsetY:o}}class vn extends we{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,i=this._cachedMeta;if(this._parsing===!1)i._parsed=s;else{let r=l=>+s[l];if(ct(s[t])){const{key:l="value"}=this._parsing;r=c=>+Ze(s[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)i._parsed[o]=r(o)}}_getRotation(){return ve(this.options.rotation-90)}_getCircumference(){return ve(this.options.circumference)}_getRotationExtents(){let t=kt,e=-kt;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const i=this.chart.getDatasetMeta(s).controller,r=i._getRotation(),o=i._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,i=this._cachedMeta,r=i.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-o)/2,0),l=Math.min(lg(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Jp(u,d,l),m=(s.width-o)/h,b=(s.height-o)/f,_=Math.max(Math.min(m,b)/2,0),x=bc(this.options.radius,_),S=Math.max(x*l,0),E=(x-S)/this._getVisibleDatasetWeightTotal();this.offsetX=g*x,this.offsetY=p*x,i.total=this.calculateTotal(),this.outerRadius=x-E*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-E*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const s=this.options,i=this._cachedMeta,r=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||i._parsed[t]===null||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*r/kt)}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=r&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,i);let b=this._getRotation(),_;for(_=0;_<e;++_)b+=this._circumference(_,r);for(_=e;_<e+s;++_){const x=this._circumference(_,r),S=t[_],E={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+x,circumference:x,outerRadius:g,innerRadius:f};m&&(E.options=p||this.resolveDataElementOptions(_,S.active?"active":i)),b+=x,this.updateElement(S,_,E,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,i;for(i=0;i<e.length;i++){const r=t._parsed[i];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(i)&&!e[i].hidden&&(s+=Math.abs(r))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?kt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=Vs(e._parsed[t],s.options.locale);return{label:i[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const s=this.chart;let i,r,o,a,l;if(!t){for(i=0,r=s.data.datasets.length;i<r;++i)if(s.isDatasetVisible(i)){o=s.getDatasetMeta(i),t=o.data,a=o.controller;break}}if(!t)return 0;for(i=0,r=t.length;i<r;++i)l=a.resolveDataElementOptions(i),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,i=t.length;s<i;++s){const r=this.resolveDataElementOptions(s);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(tt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}F(vn,"id","doughnut"),F(vn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),F(vn,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),F(vn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:i,pointStyle:s,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}}});class vi extends we{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:i=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Tc(e,i,o);this._drawStart=a,this._drawCount=l,Ac(e)&&(a=0,l=i.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=i;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:c},t),this.updateElements(i,a,l,t)}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,i),h=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Gn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||i==="none",_=e+s,x=t.length;let S=e>0&&this.getParsed(e-1);for(let E=0;E<x;++E){const C=t[E],O=b?C:{};if(E<e||E>=_){O.skip=!0;continue}const y=this.getParsed(E),v=at(y[f]),k=O[h]=o.getPixelForValue(y[h],E),A=O[f]=r||v?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,y,l):y[f],E);O.skip=isNaN(k)||isNaN(A)||v,O.stop=E>0&&Math.abs(y[h]-S[h])>m,p&&(O.parsed=y,O.raw=c.data[E]),u&&(O.options=d||this.resolveDataElementOptions(E,C.active?"active":i)),b||this.updateElement(C,E,O,i),S=y}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return s;const r=i[0].size(this.resolveDataElementOptions(0)),o=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(s,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}F(vi,"id","line"),F(vi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),F(vi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Es extends we{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,i=s.data.labels||[],r=Vs(e._parsed[t].r,s.options.locale);return{label:i[t]||"",value:r}}parseObjectData(t,e,s,i){return Dc.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,i)=>{const r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(i/2,0),o=Math.max(s.cutoutPercentage?r/100*s.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,i){const r=i==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*ht;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,i,p);for(g=e;g<e+s;g++){const m=t[g];let b=f,_=f+this._computeAngle(g,i,p),x=o.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=_,r&&(l.animateScale&&(x=0),l.animateRotate&&(b=_=h));const S={x:d,y:u,innerRadius:0,outerRadius:x,startAngle:b,endAngle:_,options:this.resolveDataElementOptions(g,m.active?"active":i)};this.updateElement(m,g,S,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?ve(this.resolveDataElementOptions(t,e).angle||s):0}}F(Es,"id","polarArea"),F(Es,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),F(Es,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:s,color:i}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:i,lineWidth:l.borderWidth,pointStyle:s,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,s){s.chart.toggleDataVisibility(e.index),s.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Kr extends vn{}F(Kr,"id","pie"),F(Kr,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class wi extends we{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,i){return Dc.bind(this)(t,e,s,i)}update(t){const e=this._cachedMeta,s=e.dataset,i=e.data||[],r=e.iScale.getLabels();if(s.points=i,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===i.length,options:o};this.updateElement(s,void 0,a,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,s,i){const r=this._cachedMeta.rScale,o=i==="reset";for(let a=e;a<e+s;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":i),d=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:d.x,h=o?r.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,i)}}}F(wi,"id","radar"),F(wi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),F(wi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class xi extends we{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:i,yScale:r}=e,o=this.getParsed(t),a=i.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:s[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,i=this.chart._animationsDisabled;let{start:r,count:o}=Tc(e,s,i);if(this._drawStart=r,this._drawCount=o,Ac(e)&&(r=0,o=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=s;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!i,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,i){const r=i==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,i),u=this.getSharedOptions(d),h=this.includeOptions(i,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=Gn(p)?p:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||r||i==="none";let x=e>0&&this.getParsed(e-1);for(let S=e;S<e+s;++S){const E=t[S],C=this.getParsed(S),O=_?E:{},y=at(C[g]),v=O[f]=o.getPixelForValue(C[f],S),k=O[g]=r||y?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,C,l):C[g],S);O.skip=isNaN(v)||isNaN(k)||y,O.stop=S>0&&Math.abs(C[f]-x[f])>b,m&&(O.parsed=C,O.raw=c.data[S]),h&&(O.options=u||this.resolveDataElementOptions(S,E.active?"active":i)),_||this.updateElement(E,S,O,i),x=C}this.updateSharedOptions(u,i,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const s=t.dataset,i=s.options&&s.options.borderWidth||0;if(!e.length)return i;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,r,o)/2}}F(xi,"id","scatter"),F(xi,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),F(xi,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Xp=Object.freeze({__proto__:null,BarController:bi,BubbleController:_i,DoughnutController:vn,LineController:vi,PieController:Kr,PolarAreaController:Es,RadarController:wi,ScatterController:xi});function hn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Io{constructor(t){F(this,"options");this.options=t||{}}static override(t){Object.assign(Io.prototype,t)}init(){}formats(){return hn()}parse(){return hn()}format(){return hn()}add(){return hn()}diff(){return hn()}startOf(){return hn()}endOf(){return hn()}}var Qp={_date:Io};function Zp(n,t,e,s){const{controller:i,data:r,_sorted:o}=n,a=i._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?wg:Fe;if(s){if(i._sharedOptions){const d=r[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(r,t,e-u),f=c(r,t,e+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(r,t,e);if(l){const{vScale:u}=i._cachedMeta,{_parsed:h}=n,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!at(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!at(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:r.length-1}}function Ki(n,t,e,s,i){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:d}=r[a],{lo:u,hi:h}=Zp(r[a],t,o,i);for(let f=u;f<=h;++f){const g=d[f];g.skip||s(g,c,f)}}}function tm(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(s,i){const r=t?Math.abs(s.x-i.x):0,o=e?Math.abs(s.y-i.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function vr(n,t,e,s,i){const r=[];return!i&&!n.isPointInArea(t)||Ki(n,e,t,function(a,l,c){!i&&!Ue(a,n.chartArea,0)||a.inRange(t.x,t.y,s)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function em(n,t,e,s){let i=[];function r(o,a,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],s),{angle:u}=wc(o,{x:t.x,y:t.y});Bs(u,c,d)&&i.push({element:o,datasetIndex:a,index:l})}return Ki(n,e,t,r),i}function nm(n,t,e,s,i,r){let o=[];const a=tm(e);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,i);if(s&&!f)return;const g=d.getCenterPoint(i);if(!(!!r||n.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(o=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&o.push({element:d,datasetIndex:u,index:h})}return Ki(n,e,t,c),o}function wr(n,t,e,s,i,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!s?em(n,t,e,i):nm(n,t,e,s,i,r)}function Qa(n,t,e,s,i){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Ki(n,e,t,(l,c,d)=>{l[o]&&l[o](t[e],i)&&(r.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,i))}),s&&!a?[]:r}var sm={modes:{index(n,t,e,s){const i=pn(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?vr(n,i,r,s,o):wr(n,i,r,!1,s,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,s){const i=pn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?vr(n,i,r,s,o):wr(n,i,r,!1,s,o);if(a.length>0){const l=a[0].datasetIndex,c=n.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(n,t,e,s){const i=pn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return vr(n,i,r,s,o)},nearest(n,t,e,s){const i=pn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return wr(n,i,r,e.intersect,s,o)},x(n,t,e,s){const i=pn(t,n);return Qa(n,i,"x",e.intersect,s)},y(n,t,e,s){const i=pn(t,n);return Qa(n,i,"y",e.intersect,s)}}};const qc=["left","top","right","bottom"];function es(n,t){return n.filter(e=>e.pos===t)}function Za(n,t){return n.filter(e=>qc.indexOf(e.pos)===-1&&e.box.axis===t)}function ns(n,t){return n.sort((e,s)=>{const i=t?s:e,r=t?e:s;return i.weight===r.weight?i.index-r.index:i.weight-r.weight})}function im(n){const t=[];let e,s,i,r,o,a;for(e=0,s=(n||[]).length;e<s;++e)i=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=i,t.push({index:e,box:i,pos:r,horizontal:i.isHorizontal(),weight:i.weight,stack:o&&r+o,stackWeight:a});return t}function rm(n){const t={};for(const e of n){const{stack:s,pos:i,stackWeight:r}=e;if(!s||!qc.includes(i))continue;const o=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function om(n,t){const e=rm(n),{vBoxMaxWidth:s,hBoxMaxHeight:i}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,c=e[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*s:l&&t.availableWidth,a.height=i):(a.width=s,a.height=d?d*i:l&&t.availableHeight)}return e}function am(n){const t=im(n),e=ns(t.filter(c=>c.box.fullSize),!0),s=ns(es(t,"left"),!0),i=ns(es(t,"right")),r=ns(es(t,"top"),!0),o=ns(es(t,"bottom")),a=Za(t,"x"),l=Za(t,"y");return{fullSize:e,leftAndTop:s.concat(r),rightAndBottom:i.concat(l).concat(o).concat(a),chartArea:es(t,"chartArea"),vertical:s.concat(i).concat(l),horizontal:r.concat(o).concat(a)}}function tl(n,t,e,s){return Math.max(n[e],t[e])+Math.max(n[s],t[s])}function Gc(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function lm(n,t,e,s){const{pos:i,box:r}=e,o=n.maxPadding;if(!ct(i)){e.size&&(n[i]-=e.size);const u=s[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[i]+=e.size}r.getPadding&&Gc(o,r.getPadding());const a=Math.max(0,t.outerWidth-tl(o,n,"left","right")),l=Math.max(0,t.outerHeight-tl(o,n,"top","bottom")),c=a!==n.w,d=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function cm(n){const t=n.maxPadding;function e(s){const i=Math.max(t[s]-n[s],0);return n[s]+=i,i}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function dm(n,t){const e=t.maxPadding;function s(i){const r={left:0,top:0,right:0,bottom:0};return i.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return s(n?["left","right"]:["top","bottom"])}function fs(n,t,e,s){const i=[];let r,o,a,l,c,d;for(r=0,o=n.length,c=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,dm(a.horizontal,t));const{same:u,other:h}=lm(t,e,a,s);c|=u&&i.length,d=d||h,l.fullSize||i.push(a)}return c&&fs(i,t,e,s)||d}function ci(n,t,e,s,i){n.top=e,n.left=t,n.right=t+s,n.bottom=e+i,n.width=s,n.height=i}function el(n,t,e,s){const i=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,c=s[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;$s(c.start)&&(o=c.start),l.fullSize?ci(l,i.left,o,e.outerWidth-i.right-i.left,h):ci(l,t.left+c.placed,o,u,h),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*d,h=c.size||l.width;$s(c.start)&&(r=c.start),l.fullSize?ci(l,r,i.top,h,e.outerHeight-i.bottom-i.top):ci(l,r,t.top+c.placed,h,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var Jt={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,s){if(!n)return;const i=Xt(n.options.layout.padding),r=Math.max(t-i.width,0),o=Math.max(e-i.height,0),a=am(n.boxes),l=a.vertical,c=a.horizontal;yt(n.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:i,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/d,hBoxMaxHeight:o/2}),h=Object.assign({},i);Gc(h,Xt(s));const f=Object.assign({maxPadding:h,w:r,h:o,x:i.left,y:i.top},i),g=om(l.concat(c),u);fs(a.fullSize,f,u,g),fs(l,f,u,g),fs(c,f,u,g)&&fs(l,f,u,g),cm(f),el(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,el(a.rightAndBottom,f,u,g),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},yt(a.chartArea,p=>{const m=p.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Yc{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,i){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):s)}}isAttached(t){return!0}updateConfig(t){}}class um extends Yc{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ki="$chartjs",hm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},nl=n=>n===null||n==="";function fm(n,t){const e=n.style,s=n.getAttribute("height"),i=n.getAttribute("width");if(n[ki]={initial:{height:s,width:i,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",nl(i)){const r=ja(n,"width");r!==void 0&&(n.width=r)}if(nl(s))if(n.style.height==="")n.height=n.width/(t||2);else{const r=ja(n,"height");r!==void 0&&(n.height=r)}return n}const Kc=gp?{passive:!0}:!1;function gm(n,t,e){n&&n.addEventListener(t,e,Kc)}function pm(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,Kc)}function mm(n,t){const e=hm[n.type]||n.type,{x:s,y:i}=pn(n,t);return{type:e,chart:t,native:n,x:s!==void 0?s:null,y:i!==void 0?i:null}}function $i(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function ym(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||$i(a.addedNodes,s),o=o&&!$i(a.removedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}function bm(n,t,e){const s=n.canvas,i=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||$i(a.removedNodes,s),o=o&&!$i(a.addedNodes,s);o&&e()});return i.observe(document,{childList:!0,subtree:!0}),i}const js=new Map;let sl=0;function Jc(){const n=window.devicePixelRatio;n!==sl&&(sl=n,js.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function _m(n,t){js.size||window.addEventListener("resize",Jc),js.set(n,t)}function vm(n){js.delete(n),js.size||window.removeEventListener("resize",Jc)}function wm(n,t,e){const s=n.canvas,i=s&&Mo(s);if(!i)return;const r=Ec((a,l)=>{const c=i.clientWidth;e(a,l),c<i.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||r(c,d)});return o.observe(i),_m(n,r),o}function xr(n,t,e){e&&e.disconnect(),t==="resize"&&vm(n)}function xm(n,t,e){const s=n.canvas,i=Ec(r=>{n.ctx!==null&&e(mm(r,n))},n);return gm(s,t,i),i}class km extends Yc{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(fm(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[ki])return!1;const s=e[ki].initial;["height","width"].forEach(r=>{const o=s[r];at(o)?e.removeAttribute(r):e.setAttribute(r,o)});const i=s.style||{};return Object.keys(i).forEach(r=>{e.style[r]=i[r]}),e.width=e.width,delete e[ki],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),o={attach:ym,detach:bm,resize:wm}[e]||xm;i[e]=o(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),i=s[e];if(!i)return;({attach:xr,detach:xr,resize:xr}[e]||pm)(t,e,i),s[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,i){return fp(t,e,s,i)}isAttached(t){const e=t&&Mo(t);return!!(e&&e.isConnected)}}function Sm(n){return!Ro()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?um:km}class xe{constructor(){F(this,"x");F(this,"y");F(this,"active",!1);F(this,"options");F(this,"$animations")}tooltipPosition(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}hasValue(){return Gn(this.x)&&Gn(this.y)}getProps(t,e){const s=this.$animations;if(!e||!s)return this;const i={};return t.forEach(r=>{i[r]=s[r]&&s[r].active()?s[r]._to:this[r]}),i}}F(xe,"defaults",{}),F(xe,"defaultRoutes");function Em(n,t){const e=n.options.ticks,s=Tm(n),i=Math.min(e.maxTicksLimit||s,s),r=e.major.enabled?Om(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>i)return Cm(t,c,r,o/i),c;const d=Am(r,t,i);if(o>0){let u,h;const f=o>1?Math.round((l-a)/(o-1)):null;for(di(t,c,d,at(f)?0:a-f,a),u=0,h=o-1;u<h;u++)di(t,c,d,r[u],r[u+1]);return di(t,c,d,l,at(f)?t.length:l+f),c}return di(t,c,d),c}function Tm(n){const t=n.options.offset,e=n._tickSize(),s=n._length/e+(t?0:1),i=n._maxLength/e;return Math.floor(Math.min(s,i))}function Am(n,t,e){const s=Rm(n),i=t.length/e;if(!s)return Math.max(i,1);const r=mg(s);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>i)return l}return Math.max(i,1)}function Om(n){const t=[];let e,s;for(e=0,s=n.length;e<s;e++)n[e].major&&t.push(e);return t}function Cm(n,t,e,s){let i=0,r=e[0],o;for(s=Math.ceil(s),o=0;o<n.length;o++)o===r&&(t.push(n[o]),i++,r=e[i*s])}function di(n,t,e,s,i){const r=tt(s,0),o=Math.min(tt(i,n.length),n.length);let a=0,l,c,d;for(e=Math.ceil(e),i&&(l=i-s,e=l/Math.floor(l/e)),d=r;d<0;)a++,d=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===d&&(t.push(n[c]),a++,d=Math.round(r+a*e))}function Rm(n){const t=n.length;let e,s;if(t<2)return!1;for(s=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==s)return!1;return s}const Mm=n=>n==="left"?"right":n==="right"?"left":n,il=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,rl=(n,t)=>Math.min(t||n,n);function ol(n,t){const e=[],s=n.length/t,i=n.length;let r=0;for(;r<i;r+=s)e.push(n[Math.floor(r)]);return e}function Im(n,t,e){const s=n.ticks.length,i=Math.min(t,s-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(i),c;if(!(e&&(s===1?c=Math.max(l-r,o-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(i-1))/2,l+=i<t?c:-c,l<r-a||l>o+a)))return l}function Lm(n,t){yt(n,e=>{const s=e.gc,i=s.length/2;let r;if(i>t){for(r=0;r<i;++r)delete e.data[s[r]];s.splice(0,i)}})}function ss(n){return n.drawTicks?n.tickLength:0}function al(n,t){if(!n.display)return 0;const e=Nt(n.font,t),s=Xt(n.padding);return(At(n.text)?n.text.length:1)*e.lineHeight+s.height}function Pm(n,t){return sn(n,{scale:t,type:"scale"})}function Dm(n,t,e){return sn(n,{tick:e,index:t,type:"tick"})}function $m(n,t,e){let s=So(n);return(e&&t!=="right"||!e&&t==="right")&&(s=Mm(s)),s}function Bm(n,t,e,s){const{top:i,left:r,bottom:o,right:a,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=o-i,m=a-r;if(n.isHorizontal()){if(f=Yt(s,r,a),ct(e)){const b=Object.keys(e)[0],_=e[b];g=d[b].getPixelForValue(_)+p-t}else e==="center"?g=(c.bottom+c.top)/2+p-t:g=il(n,e,t);h=a-r}else{if(ct(e)){const b=Object.keys(e)[0],_=e[b];f=d[b].getPixelForValue(_)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=il(n,e,t);g=Yt(s,o,i),u=e==="left"?-Mt:Mt}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class An extends xe{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:i}=this;return t=le(t,Number.POSITIVE_INFINITY),e=le(e,Number.NEGATIVE_INFINITY),s=le(s,Number.POSITIVE_INFINITY),i=le(i,Number.NEGATIVE_INFINITY),{min:le(t,s),max:le(e,i),minDefined:Rt(t),maxDefined:Rt(e)}}getMinMax(t){let{min:e,max:s,minDefined:i,maxDefined:r}=this.getUserBounds(),o;if(i&&r)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),i||(e=Math.min(e,o.min)),r||(s=Math.max(s,o.max));return e=r&&e>s?s:e,s=i&&e>s?e:s,{min:le(e,le(s,e)),max:le(s,le(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){_t(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:i,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Vg(this,r,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?ol(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=Em(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){_t(this.options.afterUpdate,[this])}beforeSetDimensions(){_t(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){_t(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),_t(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){_t(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,i,r;for(s=0,i=t.length;s<i;s++)r=t[s],r.label=_t(e.callback,[r.value,s,t],this)}afterTickToLabelConversion(){_t(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){_t(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=rl(this.ticks.length,t.ticks.maxTicksLimit),i=e.minRotation||0,r=e.maxRotation;let o=i,a,l,c;if(!this._isVisible()||!e.display||i>=r||s<=1||!this.isHorizontal()){this.labelRotation=i;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=Ft(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/s:f/(s-1),u+6>a&&(a=f/(s-(t.offset?.5:1)),l=this.maxHeight-ss(t.grid)-e.padding-al(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),o=xo(Math.min(Math.asin(Ft((d.highest.height+6)/a,-1,1)),Math.asin(Ft(l/c,-1,1))-Math.asin(Ft(h/c,-1,1)))),o=Math.max(i,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){_t(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){_t(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:i,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=al(i,e.options.font);if(a?(t.width=this.maxWidth,t.height=ss(r)+l):(t.height=this.maxHeight,t.width=ss(r)+l),s.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=s.padding*2,g=ve(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=s.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=s.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,i){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=i*t.width,f=s*e.height):(h=s*t.height,f=i*e.width):r==="start"?f=e.width:r==="end"?h=t.width:r!=="inner"&&(h=t.width/2,f=e.width/2),this.paddingLeft=Math.max((h-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;r==="start"?(d=0,u=t.height):r==="end"&&(d=e.height,u=0),this.paddingTop=d+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){_t(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)at(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=ol(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:i,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/rl(e,s));let c=0,d=0,u,h,f,g,p,m,b,_,x,S,E;for(u=0;u<e;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),i.font=m=p.string,b=r[m]=r[m]||{data:{},gc:[]},_=p.lineHeight,x=S=0,!at(g)&&!At(g))x=Pi(i,b.data,b.gc,x,g),S=_;else if(At(g))for(h=0,f=g.length;h<f;++h)E=g[h],!at(E)&&!At(E)&&(x=Pi(i,b.data,b.gc,x,E),S+=_);o.push(x),a.push(S),c=Math.max(x,c),d=Math.max(S,d)}Lm(r,e);const C=o.indexOf(c),O=a.indexOf(d),y=v=>({width:o[v]||0,height:a[v]||0});return{first:y(0),last:y(e-1),widest:y(C),highest:y(O),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return vg(this._alignToPixels?un(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=Dm(this.getContext(),t,s))}return this.$context||(this.$context=Pm(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=ve(this.labelRotation),s=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*s>a*i?a/s:l/i:l*i<a*s?l/s:a/i}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,i=this.options,{grid:r,position:o,border:a}=i,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=ss(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(M){return un(s,M,p)};let _,x,S,E,C,O,y,v,k,A,L,H;if(o==="top")_=b(this.bottom),O=this.bottom-h,v=_-m,A=b(t.top)+m,H=t.bottom;else if(o==="bottom")_=b(this.top),A=t.top,H=b(t.bottom)-m,O=_+m,v=this.top+h;else if(o==="left")_=b(this.right),C=this.right-h,y=_-m,k=b(t.left)+m,L=t.right;else if(o==="right")_=b(this.left),k=t.left,L=b(t.right)-m,C=_+m,y=this.left+h;else if(e==="x"){if(o==="center")_=b((t.top+t.bottom)/2+.5);else if(ct(o)){const M=Object.keys(o)[0],R=o[M];_=b(this.chart.scales[M].getPixelForValue(R))}A=t.top,H=t.bottom,O=_+m,v=O+h}else if(e==="y"){if(o==="center")_=b((t.left+t.right)/2);else if(ct(o)){const M=Object.keys(o)[0],R=o[M];_=b(this.chart.scales[M].getPixelForValue(R))}C=_-m,y=C-h,k=t.left,L=t.right}const j=tt(i.ticks.maxTicksLimit,u),I=Math.max(1,Math.ceil(u/j));for(x=0;x<u;x+=I){const M=this.getContext(x),R=r.setContext(M),D=a.setContext(M),P=R.lineWidth,U=R.color,B=D.dash||[],z=D.dashOffset,$=R.tickWidth,Z=R.tickColor,W=R.tickBorderDash||[],it=R.tickBorderDashOffset;S=Im(this,x,l),S!==void 0&&(E=un(s,S,P),c?C=y=k=L=E:O=v=A=H=E,f.push({tx1:C,ty1:O,tx2:y,ty2:v,x1:k,y1:A,x2:L,y2:H,width:P,color:U,borderDash:B,borderDashOffset:z,tickWidth:$,tickColor:Z,tickBorderDash:W,tickBorderDashOffset:it}))}return this._ticksLength=u,this._borderValue=_,f}_computeLabelItems(t){const e=this.axis,s=this.options,{position:i,ticks:r}=s,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=r,h=ss(s.grid),f=h+d,g=u?-d:f,p=-ve(this.labelRotation),m=[];let b,_,x,S,E,C,O,y,v,k,A,L,H="middle";if(i==="top")C=this.bottom-g,O=this._getXAxisLabelAlignment();else if(i==="bottom")C=this.top+g,O=this._getXAxisLabelAlignment();else if(i==="left"){const I=this._getYAxisLabelAlignment(h);O=I.textAlign,E=I.x}else if(i==="right"){const I=this._getYAxisLabelAlignment(h);O=I.textAlign,E=I.x}else if(e==="x"){if(i==="center")C=(t.top+t.bottom)/2+f;else if(ct(i)){const I=Object.keys(i)[0],M=i[I];C=this.chart.scales[I].getPixelForValue(M)+f}O=this._getXAxisLabelAlignment()}else if(e==="y"){if(i==="center")E=(t.left+t.right)/2-f;else if(ct(i)){const I=Object.keys(i)[0],M=i[I];E=this.chart.scales[I].getPixelForValue(M)}O=this._getYAxisLabelAlignment(h).textAlign}e==="y"&&(l==="start"?H="top":l==="end"&&(H="bottom"));const j=this._getLabelSizes();for(b=0,_=a.length;b<_;++b){x=a[b],S=x.label;const I=r.setContext(this.getContext(b));y=this.getPixelForTick(b)+r.labelOffset,v=this._resolveTickFontOptions(b),k=v.lineHeight,A=At(S)?S.length:1;const M=A/2,R=I.color,D=I.textStrokeColor,P=I.textStrokeWidth;let U=O;o?(E=y,O==="inner"&&(b===_-1?U=this.options.reverse?"left":"right":b===0?U=this.options.reverse?"right":"left":U="center"),i==="top"?c==="near"||p!==0?L=-A*k+k/2:c==="center"?L=-j.highest.height/2-M*k+k:L=-j.highest.height+k/2:c==="near"||p!==0?L=k/2:c==="center"?L=j.highest.height/2-M*k:L=j.highest.height-A*k,u&&(L*=-1),p!==0&&!I.showLabelBackdrop&&(E+=k/2*Math.sin(p))):(C=y,L=(1-A)*k/2);let B;if(I.showLabelBackdrop){const z=Xt(I.backdropPadding),$=j.heights[b],Z=j.widths[b];let W=L-z.top,it=0-z.left;switch(H){case"middle":W-=$/2;break;case"bottom":W-=$;break}switch(O){case"center":it-=Z/2;break;case"right":it-=Z;break;case"inner":b===_-1?it-=Z:b>0&&(it-=Z/2);break}B={left:it,top:W,width:Z+z.width,height:$+z.height,color:I.backdropColor}}m.push({label:S,font:v,textOffset:L,options:{rotation:p,color:R,strokeColor:D,strokeWidth:P,textAlign:U,textBaseline:H,translation:[E,C],backdrop:B}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-ve(this.labelRotation))return t==="top"?"left":"right";let i="center";return e.align==="start"?i="left":e.align==="end"?i="right":e.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:i,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,d;return e==="left"?i?(d=this.right+r,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?i?(d=this.left+r,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:i,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,i,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex(r=>r.value===t);return i>=0?e.setContext(this.getContext(i)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,d)=>{!d.width||!d.color||(s.save(),s.lineWidth=d.width,s.strokeStyle=d.color,s.setLineDash(d.borderDash||[]),s.lineDashOffset=d.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(e.display)for(r=0,o=i.length;r<o;++r){const l=i[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:i}}=this,r=s.setContext(this.getContext()),o=s.display?r.width:0;if(!o)return;const a=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=un(t,this.left,o)-o/2,d=un(t,this.right,a)+a/2,u=h=l):(u=un(t,this.top,o)-o/2,h=un(t,this.bottom,a)+a/2,c=d=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const s=this.ctx,i=this._computeLabelArea();i&&qi(s,i);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,d=o.textOffset;En(s,c,0,d,l,a)}i&&Gi(s)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:i}}=this;if(!s.display)return;const r=Nt(s.font),o=Xt(s.padding),a=s.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||ct(e)?(l+=o.bottom,At(s.text)&&(l+=r.lineHeight*(s.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=Bm(this,l,e,a);En(t,s.text,0,0,r,{color:s.color,maxWidth:u,rotation:h,textAlign:$m(a,e,i),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=tt(t.grid&&t.grid.z,-1),i=tt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==An.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:s,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",i=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[s]===this.id&&(!t||a.type===t)&&i.push(a)}return i}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Nt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ui{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;Fm(e)&&(s=this.register(e));const i=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in i||(i[r]=t,Nm(t,o,s),this.override&&Ot.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,i=this.scope;s in e&&delete e[s],i&&s in Ot[i]&&(delete Ot[i][s],this.override&&delete Sn[s])}}function Nm(n,t,e){const s=Ds(Object.create(null),[e?Ot.get(e):{},Ot.get(t),n.defaults]);Ot.set(t,s),n.defaultRoutes&&jm(t,n.defaultRoutes),n.descriptors&&Ot.describe(t,n.descriptors)}function jm(n,t){Object.keys(t).forEach(e=>{const s=e.split("."),i=s.pop(),r=[n].concat(s).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");Ot.route(r,i,l,a)})}function Fm(n){return"id"in n&&"defaults"in n}class Um{constructor(){this.controllers=new ui(we,"datasets",!0),this.elements=new ui(xe,"elements"),this.plugins=new ui(Object,"plugins"),this.scales=new ui(An,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(i=>{const r=s||this._getRegistryForType(i);s||r.isForType(i)||r===this.plugins&&i.id?this._exec(t,r,i):yt(i,o=>{const a=s||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,s){const i=wo(t);_t(s["before"+i],[],s),e[t](s),_t(s["after"+i],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const i=e.get(t);if(i===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return i}}var Oe=new Um;class zm{constructor(){this._init=void 0}notify(t,e,s,i){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=i?this._descriptors(t).filter(i):this._descriptors(t),o=this._notify(r,t,e,s);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,s,i){i=i||{};for(const r of t){const o=r.plugin,a=o[s],l=[e,i,r.options];if(_t(a,l,o)===!1&&i.cancelable)return!1}return!0}invalidate(){at(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,i=tt(s.options&&s.options.plugins,{}),r=Hm(s);return i===!1&&!e?[]:Vm(t,r,i,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,i=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(i(e,s),t,"stop"),this._notify(i(s,e),t,"start")}}function Hm(n){const t={},e=[],s=Object.keys(Oe.plugins.items);for(let r=0;r<s.length;r++)e.push(Oe.getPlugin(s[r]));const i=n.plugins||[];for(let r=0;r<i.length;r++){const o=i[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function Wm(n,t){return!t&&n===!1?null:n===!0?{}:n}function Vm(n,{plugins:t,localIds:e},s,i){const r=[],o=n.getContext();for(const a of t){const l=a.id,c=Wm(s[l],i);c!==null&&r.push({plugin:a,options:qm(n.config,{plugin:a,local:e[l]},c,o)})}return r}function qm(n,{plugin:t,local:e},s,i){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(s,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Jr(n,t){const e=Ot.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Gm(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function Ym(n,t){return n===t?"_index_":"_value_"}function ll(n){if(n==="x"||n==="y"||n==="r")return n}function Km(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Xr(n,...t){if(ll(n))return n;for(const e of t){const s=e.axis||Km(e.position)||n.length>1&&ll(n[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function cl(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function Jm(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===n||s.yAxisID===n);if(e.length)return cl(n,"x",e[0])||cl(n,"y",e[0])}return{}}function Xm(n,t){const e=Sn[n.type]||{scales:{}},s=t.scales||{},i=Jr(n.type,t),r=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!ct(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Xr(o,a,Jm(o,n),Ot.scales[a.type]),c=Ym(l,i),d=e.scales||{};r[o]=ws(Object.create(null),[{axis:l},a,d[l],d[c]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||Jr(a,t),d=(Sn[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=Gm(u,l),f=o[h+"AxisID"]||h;r[f]=r[f]||Object.create(null),ws(r[f],[{axis:h},s[f],d[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];ws(a,[Ot.scales[a.type],Ot.scale])}),r}function Xc(n){const t=n.options||(n.options={});t.plugins=tt(t.plugins,{}),t.scales=Xm(n,t)}function Qc(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Qm(n){return n=n||{},n.data=Qc(n.data),Xc(n),n}const dl=new Map,Zc=new Set;function hi(n,t){let e=dl.get(n);return e||(e=t(),dl.set(n,e),Zc.add(e)),e}const is=(n,t,e)=>{const s=Ze(t,e);s!==void 0&&n.add(s)};class Zm{constructor(t){this._config=Qm(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Qc(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Xc(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return hi(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return hi(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return hi(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return hi(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let i=s.get(t);return(!i||e)&&(i=new Map,s.set(t,i)),i}getOptionScopes(t,e,s){const{options:i,type:r}=this,o=this._cachedScopes(t,s),a=o.get(e);if(a)return a;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>is(l,t,u))),d.forEach(u=>is(l,i,u)),d.forEach(u=>is(l,Sn[r]||{},u)),d.forEach(u=>is(l,Ot,u)),d.forEach(u=>is(l,Gr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Zc.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,Sn[e]||{},Ot.datasets[e]||{},{type:e},Ot,Gr]}resolveNamedOptions(t,e,s,i=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=ul(this._resolverCache,t,i);let l=o;if(ey(o,e)){r.$shared=!1,s=tn(s)?s():s;const c=this.createResolver(t,s,a);l=Yn(o,s,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,s=[""],i){const{resolver:r}=ul(this._resolverCache,t,s);return ct(e)?Yn(r,e,void 0,i):r}}function ul(n,t,e){let s=n.get(t);s||(s=new Map,n.set(t,s));const i=e.join();let r=s.get(i);return r||(r={resolver:Ao(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},s.set(i,r)),r}const ty=n=>ct(n)&&Object.getOwnPropertyNames(n).some(t=>tn(n[t]));function ey(n,t){const{isScriptable:e,isIndexable:s}=Mc(n);for(const i of t){const r=e(i),o=s(i),a=(o||r)&&n[i];if(r&&(tn(a)||ty(a))||o&&At(a))return!0}return!1}var ny="4.5.1";const sy=["top","bottom","left","right","chartArea"];function hl(n,t){return n==="top"||n==="bottom"||sy.indexOf(n)===-1&&t==="x"}function fl(n,t){return function(e,s){return e[n]===s[n]?e[t]-s[t]:e[n]-s[n]}}function gl(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),_t(e&&e.onComplete,[n],t)}function iy(n){const t=n.chart,e=t.options.animation;_t(e&&e.onProgress,[n],t)}function td(n){return Ro()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Si={},pl=n=>{const t=td(n);return Object.values(Si).filter(e=>e.canvas===t).pop()};function ry(n,t,e){const s=Object.keys(n);for(const i of s){const r=+i;if(r>=t){const o=n[i];delete n[i],(e>0||r>t)&&(n[r+e]=o)}}}function oy(n,t,e,s){return!e||n.type==="mouseout"?null:s?t:n}class ce{static register(...t){Oe.add(...t),ml()}static unregister(...t){Oe.remove(...t),ml()}constructor(t,e){const s=this.config=new Zm(e),i=td(t),r=pl(i);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||Sm(i)),this.platform.updateConfig(s);const a=this.platform.acquireContext(i,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=ag(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new zm,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Sg(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],Si[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}De.listen(this,"complete",gl),De.listen(this,"progress",iy),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:i,_aspectRatio:r}=this;return at(t)?e&&r?r:i?s/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Oe}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Na(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Da(this.canvas,this.ctx),this}stop(){return De.stop(this),this}resize(t,e){De.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const s=this.options,i=this.canvas,r=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(i,t,e,r),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Na(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),_t(s.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};yt(e,(s,i)=>{s.id=i})}buildOrUpdateScales(){const t=this.options,e=t.scales,s=this.scales,i=Object.keys(s).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Xr(o,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),yt(r,o=>{const a=o.options,l=a.id,c=Xr(l,a),d=tt(a.type,o.dtype);(a.position===void 0||hl(a.position,c)!==hl(o.dposition))&&(a.position=o.dposition),i[l]=!0;let u=null;if(l in s&&s[l].type===d)u=s[l];else{const h=Oe.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),s[u.id]=u}u.init(a,t)}),yt(i,(o,a)=>{o||delete s[a]}),yt(s,o=>{Jt.configure(this,o,o.options),Jt.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,s=t.length;if(t.sort((i,r)=>i.index-r.index),s>e){for(let i=e;i<s;++i)this._destroyDatasetMeta(i);t.splice(e,s-e)}this._sortedMetasets=t.slice(0).sort(fl("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((s,i)=>{e.filter(r=>r===s._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let s,i;for(this._removeUnreferencedMetasets(),s=0,i=e.length;s<i;s++){const r=e[s];let o=this.getDatasetMeta(s);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=a,o.indexAxis=r.indexAxis||Jr(a,this.options),o.order=r.order||0,o.index=s,o.label=""+r.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const l=Oe.getController(a),{datasetElementType:c,dataElementType:d}=Ot.datasets[a];Object.assign(l,{dataElementType:Oe.getElement(d),datasetElementType:c&&Oe.getElement(c)}),o.controller=new l(this,s),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){yt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const s=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!i&&r.indexOf(u)===-1;u.buildOrUpdateElements(h),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),i||yt(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(fl("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){yt(this.scales,t=>{Jt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),s=new Set(t.events);(!Ta(e,s)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:s,start:i,count:r}of e){const o=s==="_removeElements"?-r:r;ry(t,i,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,s=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),i=s(0);for(let r=1;r<e;r++)if(!Ta(i,s(r)))return;return Array.from(i).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Jt.update(this,this.width,this.height,t);const e=this.chartArea,s=e.width<=0||e.height<=0;this._layers=[],yt(this.boxes,i=>{s&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,r)=>{i._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,s=this.data.datasets.length;e<s;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,s=this.data.datasets.length;e<s;++e)this._updateDataset(e,tn(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const s=this.getDatasetMeta(t),i={meta:s,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(s.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(De.has(this)?this.attached&&!De.running(this)&&De.start(this):(this.draw(),gl({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:s,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,s=[];let i,r;for(i=0,r=e.length;i<r;++i){const o=e[i];(!t||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,s={meta:t,index:t.index,cancelable:!0},i=zc(this,t);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(i&&qi(e,i),t.controller.draw(),i&&Gi(e),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(t){return Ue(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,s,i){const r=sm.modes[e];return typeof r=="function"?r(this,t,s,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],s=this._metasets;let i=s.filter(r=>r&&r._dataset===e).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},s.push(i)),i}getContext(){return this.$context||(this.$context=sn(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const s=this.getDatasetMeta(t);return typeof s.hidden=="boolean"?!s.hidden:!e.hidden}setDatasetVisibility(t,e){const s=this.getDatasetMeta(t);s.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,s){const i=s?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,i);$s(e)?(r.data[e].hidden=!s,this.update()):(this.setDatasetVisibility(t,s),o.update(r,{visible:s}),this.update(a=>a.datasetIndex===t?i:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),De.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Da(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Si[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,s=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},i=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};yt(this.options.events,r=>s(r,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,s=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},i=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{i("attach",a),this.attached=!0,this.resize(),s("resize",r),s("detach",o)};o=()=>{this.attached=!1,i("resize",r),this._stop(),this._resize(0,0),s("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){yt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},yt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,s){const i=s?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+i+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[i+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],s=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!Mi(s,e)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,e))}notifyPlugins(t,e,s){return this._plugins.notify(this,t,e,s)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,s){const i=this.options.hover,r=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),o=r(e,t),a=s?t:r(t,e);o.length&&this.updateHoverStyle(o,i.mode,!1),a.length&&i.mode&&this.updateHoverStyle(a,i.mode,!0)}_eventHandler(t,e){const s={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",s,i)===!1)return;const r=this._handleEvent(t,e,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,i),(r||s.changed)&&this.render(),this}_handleEvent(t,e,s){const{_active:i=[],options:r}=this,o=e,a=this._getActiveElements(t,i,s,o),l=fg(t),c=oy(t,this._lastEvent,s,l);s&&(this._lastEvent=null,_t(r.onHover,[t,a,this],this),l&&_t(r.onClick,[t,a,this],this));const d=!Mi(a,i);return(d||e)&&(this._active=a,this._updateHoverStyles(a,i,e)),this._lastEvent=c,d}_getActiveElements(t,e,s,i){if(t.type==="mouseout")return[];if(!s)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,i)}}F(ce,"defaults",Ot),F(ce,"instances",Si),F(ce,"overrides",Sn),F(ce,"registry",Oe),F(ce,"version",ny),F(ce,"getChart",pl);function ml(){return yt(ce.instances,n=>n._plugins.invalidate())}function ay(n,t,e){const{startAngle:s,x:i,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/o,Kt(s-e));if(n.beginPath(),n.arc(i,r,o-c/2,s+u/2,e-u/2),a>0){const h=Math.min(c/a,Kt(s-e));n.arc(i,r,a+c/2,e-h/2,s+h/2,!0)}else{const h=Math.min(c/2,o*Kt(s-e));if(d==="round")n.arc(i,r,h,e-ht/2,s+ht/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(e+ht/2)+i,p=-f*Math.sin(e+ht/2)+r,m=f*Math.cos(s+ht/2)+i,b=f*Math.sin(s+ht/2)+r;n.lineTo(g,p),n.lineTo(m,b)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function ly(n,t,e){const{startAngle:s,pixelMargin:i,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=i/a;n.beginPath(),n.arc(r,o,a,s-c,e+c),l>i?(c=i/l,n.arc(r,o,l,e+c,s-c,!0)):n.arc(r,o,i,e+Mt,s-Mt),n.closePath(),n.clip()}function cy(n){return To(n,["outerStart","outerEnd","innerStart","innerEnd"])}function dy(n,t,e,s){const i=cy(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,s*t/2),a=l=>{const c=(e-Math.min(r,l))*s/2;return Ft(l,0,Math.min(r,c))};return{outerStart:a(i.outerStart),outerEnd:a(i.outerEnd),innerStart:Ft(i.innerStart,0,o),innerEnd:Ft(i.innerEnd,0,o)}}function Fn(n,t,e,s){return{x:e+n*Math.cos(t),y:s+n*Math.sin(t)}}function Bi(n,t,e,s,i,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+s+e-c,0),h=d>0?d+s+e+c:0;let f=0;const g=i-l;if(s){const I=d>0?d-s:0,M=u>0?u-s:0,R=(I+M)/2,D=R!==0?g*R/(R+s):g;f=(g-D)/2}const p=Math.max(.001,g*u-e/ht)/u,m=(g-p)/2,b=l+m+f,_=i-m-f,{outerStart:x,outerEnd:S,innerStart:E,innerEnd:C}=dy(t,h,u,_-b),O=u-x,y=u-S,v=b+x/O,k=_-S/y,A=h+E,L=h+C,H=b+E/A,j=_-C/L;if(n.beginPath(),r){const I=(v+k)/2;if(n.arc(o,a,u,v,I),n.arc(o,a,u,I,k),S>0){const P=Fn(y,k,o,a);n.arc(P.x,P.y,S,k,_+Mt)}const M=Fn(L,_,o,a);if(n.lineTo(M.x,M.y),C>0){const P=Fn(L,j,o,a);n.arc(P.x,P.y,C,_+Mt,j+Math.PI)}const R=(_-C/h+(b+E/h))/2;if(n.arc(o,a,h,_-C/h,R,!0),n.arc(o,a,h,R,b+E/h,!0),E>0){const P=Fn(A,H,o,a);n.arc(P.x,P.y,E,H+Math.PI,b-Mt)}const D=Fn(O,b,o,a);if(n.lineTo(D.x,D.y),x>0){const P=Fn(O,v,o,a);n.arc(P.x,P.y,x,b-Mt,v)}}else{n.moveTo(o,a);const I=Math.cos(v)*u+o,M=Math.sin(v)*u+a;n.lineTo(I,M);const R=Math.cos(k)*u+o,D=Math.sin(k)*u+a;n.lineTo(R,D)}n.closePath()}function uy(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){Bi(n,t,e,s,l,i);for(let c=0;c<r;++c)n.fill();isNaN(a)||(l=o+(a%kt||kt))}return Bi(n,t,e,s,l,i),n.fill(),l}function hy(n,t,e,s,i){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=h,g?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let p=t.endAngle;if(r){Bi(n,t,e,s,p,i);for(let m=0;m<r;++m)n.stroke();isNaN(a)||(p=o+(a%kt||kt))}g&&ly(n,t,p),l.selfJoin&&p-o>=ht&&f===0&&d!=="miter"&&ay(n,t,p),r||(Bi(n,t,e,s,p,i),n.stroke())}class gs extends xe{constructor(e){super();F(this,"circumference");F(this,"endAngle");F(this,"fullCircles");F(this,"innerRadius");F(this,"outerRadius");F(this,"pixelMargin");F(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.getProps(["x","y"],i),{angle:o,distance:a}=wc(r,{x:e,y:s}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),f=(this.options.spacing+this.options.borderWidth)/2,g=tt(h,c-l),p=Bs(o,l,c)&&l!==c,m=g>=kt||p,b=je(a,d+f,u+f);return m&&b}getCenterPoint(e){const{x:s,y:i,startAngle:r,endAngle:o,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(r+o)/2,h=(a+l+d+c)/2;return{x:s+Math.cos(u)*h,y:i+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:s,circumference:i}=this,r=(s.offset||0)/4,o=(s.spacing||0)/2,a=s.circular;if(this.pixelMargin=s.borderAlign==="inner"?.33:0,this.fullCircles=i>kt?Math.floor(i/kt):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*r,Math.sin(l)*r);const c=1-Math.sin(Math.min(ht,i||0)),d=r*c;e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,uy(e,this,d,o,a),hy(e,this,d,o,a),e.restore()}}F(gs,"id","arc"),F(gs,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),F(gs,"defaultRoutes",{backgroundColor:"backgroundColor"}),F(gs,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function ed(n,t,e=t){n.lineCap=tt(e.borderCapStyle,t.borderCapStyle),n.setLineDash(tt(e.borderDash,t.borderDash)),n.lineDashOffset=tt(e.borderDashOffset,t.borderDashOffset),n.lineJoin=tt(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=tt(e.borderWidth,t.borderWidth),n.strokeStyle=tt(e.borderColor,t.borderColor)}function fy(n,t,e){n.lineTo(e.x,e.y)}function gy(n){return n.stepped?$g:n.tension||n.cubicInterpolationMode==="monotone"?Bg:fy}function nd(n,t,e={}){const s=n.length,{start:i=0,end:r=s-1}=e,{start:o,end:a}=t,l=Math.max(i,o),c=Math.min(r,a),d=i<o&&r<o||i>a&&r>a;return{count:s,start:l,loop:t.loop,ilen:c<l&&!d?s+c-l:c-l}}function py(n,t,e,s){const{points:i,options:r}=t,{count:o,start:a,loop:l,ilen:c}=nd(i,e,s),d=gy(r);let{move:u=!0,reverse:h}=s||{},f,g,p;for(f=0;f<=c;++f)g=i[(a+(h?c-f:f))%o],!g.skip&&(u?(n.moveTo(g.x,g.y),u=!1):d(n,p,g,h,r.stepped),p=g);return l&&(g=i[(a+(h?c:0))%o],d(n,p,g,h,r.stepped)),!!l}function my(n,t,e,s){const i=t.points,{count:r,start:o,ilen:a}=nd(i,e,s),{move:l=!0,reverse:c}=s||{};let d=0,u=0,h,f,g,p,m,b;const _=S=>(o+(c?a-S:S))%r,x=()=>{p!==m&&(n.lineTo(d,m),n.lineTo(d,p),n.lineTo(d,b))};for(l&&(f=i[_(0)],n.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=i[_(h)],f.skip)continue;const S=f.x,E=f.y,C=S|0;C===g?(E<p?p=E:E>m&&(m=E),d=(u*d+S)/++u):(x(),n.lineTo(S,E),g=C,u=0,p=m=E),b=E}x()}function Qr(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?my:py}function yy(n){return n.stepped?pp:n.tension||n.cubicInterpolationMode==="monotone"?mp:mn}function by(n,t,e,s){let i=t._path;i||(i=t._path=new Path2D,t.path(i,e,s)&&i.closePath()),ed(n,t.options),n.stroke(i)}function _y(n,t,e,s){const{segments:i,options:r}=t,o=Qr(t);for(const a of i)ed(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+s-1})&&n.closePath(),n.stroke()}const vy=typeof Path2D=="function";function wy(n,t,e,s){vy&&!t.options.segment?by(n,t,e,s):_y(n,t,e,s)}class Ke extends xe{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const i=s.spanGaps?this._loop:this._fullLoop;ap(this._points,s,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=xp(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,i=t[e],r=this.points,o=Uc(this,{property:e,start:i,end:i});if(!o.length)return;const a=[],l=yy(s);let c,d;for(c=0,d=o.length;c<d;++c){const{start:u,end:h}=o[c],f=r[u],g=r[h];if(f===g){a.push(f);continue}const p=Math.abs((i-f[e])/(g[e]-f[e])),m=l(f,g,p,s.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,s){return Qr(this)(t,this,e,s)}path(t,e,s){const i=this.segments,r=Qr(this);let o=this._loop;e=e||0,s=s||this.points.length-e;for(const a of i)o&=r(t,this,a,{start:e,end:e+s-1});return!!o}draw(t,e,s,i){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),wy(t,this,s,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}F(Ke,"id","line"),F(Ke,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),F(Ke,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),F(Ke,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function yl(n,t,e,s){const i=n.options,{[e]:r}=n.getProps([e],s);return Math.abs(t-r)<i.radius+i.hitRadius}class Ei extends xe{constructor(e){super();F(this,"parsed");F(this,"skip");F(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,i){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],i);return Math.pow(e-o,2)+Math.pow(s-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,s){return yl(this,e,"x",s)}inYRange(e,s){return yl(this,e,"y",s)}getCenterPoint(e){const{x:s,y:i}=this.getProps(["x","y"],e);return{x:s,y:i}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const i=s&&e.borderWidth||0;return(s+i)*2}draw(e,s){const i=this.options;this.skip||i.radius<.1||!Ue(this,s,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Yr(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}F(Ei,"id","point"),F(Ei,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),F(Ei,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function sd(n,t){const{x:e,y:s,base:i,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return n.horizontal?(u=o/2,a=Math.min(e,i),l=Math.max(e,i),c=s-u,d=s+u):(u=r/2,a=e-u,l=e+u,c=Math.min(s,i),d=Math.max(s,i)),{left:a,top:c,right:l,bottom:d}}function Je(n,t,e,s){return n?0:Ft(t,e,s)}function xy(n,t,e){const s=n.options.borderWidth,i=n.borderSkipped,r=Rc(s);return{t:Je(i.top,r.top,0,e),r:Je(i.right,r.right,0,t),b:Je(i.bottom,r.bottom,0,e),l:Je(i.left,r.left,0,t)}}function ky(n,t,e){const{enableBorderRadius:s}=n.getProps(["enableBorderRadius"]),i=n.options.borderRadius,r=xn(i),o=Math.min(t,e),a=n.borderSkipped,l=s||ct(i);return{topLeft:Je(!l||a.top||a.left,r.topLeft,0,o),topRight:Je(!l||a.top||a.right,r.topRight,0,o),bottomLeft:Je(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Je(!l||a.bottom||a.right,r.bottomRight,0,o)}}function Sy(n){const t=sd(n),e=t.right-t.left,s=t.bottom-t.top,i=xy(n,e/2,s/2),r=ky(n,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:r},inner:{x:t.left+i.l,y:t.top+i.t,w:e-i.l-i.r,h:s-i.t-i.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(i.t,i.l)),topRight:Math.max(0,r.topRight-Math.max(i.t,i.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(i.b,i.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(i.b,i.r))}}}}function kr(n,t,e,s){const i=t===null,r=e===null,a=n&&!(i&&r)&&sd(n,s);return a&&(i||je(t,a.left,a.right))&&(r||je(e,a.top,a.bottom))}function Ey(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function Ty(n,t){n.rect(t.x,t.y,t.w,t.h)}function Sr(n,t,e={}){const s=n.x!==e.x?-t:0,i=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-s,o=(n.y+n.h!==e.y+e.h?t:0)-i;return{x:n.x+s,y:n.y+i,w:n.w+r,h:n.h+o,radius:n.radius}}class Ti extends xe{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:i}}=this,{inner:r,outer:o}=Sy(this),a=Ey(o.radius)?Ns:Ty;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Sr(o,e,r)),t.clip(),a(t,Sr(r,-e,o)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,Sr(r,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,s){return kr(this,t,e,s)}inXRange(t,e){return kr(this,t,null,e)}inYRange(t,e){return kr(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:i,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+i)/2:e,y:r?s:(s+i)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}F(Ti,"id","bar"),F(Ti,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),F(Ti,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var Ay=Object.freeze({__proto__:null,ArcElement:gs,BarElement:Ti,LineElement:Ke,PointElement:Ei});const Zr=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],bl=Zr.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function id(n){return Zr[n%Zr.length]}function rd(n){return bl[n%bl.length]}function Oy(n,t){return n.borderColor=id(t),n.backgroundColor=rd(t),++t}function Cy(n,t){return n.backgroundColor=n.data.map(()=>id(t++)),t}function Ry(n,t){return n.backgroundColor=n.data.map(()=>rd(t++)),t}function My(n){let t=0;return(e,s)=>{const i=n.getDatasetMeta(s).controller;i instanceof vn?t=Cy(e,t):i instanceof Es?t=Ry(e,t):i&&(t=Oy(e,t))}}function _l(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function Iy(n){return n&&(n.borderColor||n.backgroundColor)}function Ly(){return Ot.borderColor!=="rgba(0,0,0,0.1)"||Ot.backgroundColor!=="rgba(0,0,0,0.1)"}var Py={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:s},options:i}=n.config,{elements:r}=i,o=_l(s)||Iy(i)||r&&_l(r)||Ly();if(!e.forceOverride&&o)return;const a=My(n);s.forEach(a)}};function Dy(n,t,e,s,i){const r=i.samples||s;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let d=t,u,h,f,g,p;for(o[l++]=n[d],u=0;u<r-2;u++){let m=0,b=0,_;const x=Math.floor((u+1)*a)+1+t,S=Math.min(Math.floor((u+2)*a)+1,e)+t,E=S-x;for(_=x;_<S;_++)m+=n[_].x,b+=n[_].y;m/=E,b/=E;const C=Math.floor(u*a)+1+t,O=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:y,y:v}=n[d];for(f=g=-1,_=C;_<O;_++)g=.5*Math.abs((y-m)*(n[_].y-v)-(y-n[_].x)*(b-v)),g>f&&(f=g,h=n[_],p=_);o[l++]=h,d=p}return o[l++]=n[c],o}function $y(n,t,e,s){let i=0,r=0,o,a,l,c,d,u,h,f,g,p;const m=[],b=t+e-1,_=n[t].x,S=n[b].x-_;for(o=t;o<t+e;++o){a=n[o],l=(a.x-_)/S*s,c=a.y;const E=l|0;if(E===d)c<g?(g=c,u=o):c>p&&(p=c,h=o),i=(r*i+a.x)/++r;else{const C=o-1;if(!at(u)&&!at(h)){const O=Math.min(u,h),y=Math.max(u,h);O!==f&&O!==C&&m.push({...n[O],x:i}),y!==f&&y!==C&&m.push({...n[y],x:i})}o>0&&C!==f&&m.push(n[C]),m.push(a),d=E,r=0,g=p=c,u=h=f=o}}return m}function od(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function vl(n){n.data.datasets.forEach(t=>{od(t)})}function By(n,t){const e=t.length;let s=0,i;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(s=Ft(Fe(t,r.axis,o).lo,0,e-1)),c?i=Ft(Fe(t,r.axis,a).hi+1,s,e)-s:i=e-s,{start:s,count:i}}var Ny={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){vl(n);return}const s=n.width;n.data.datasets.forEach((i,r)=>{const{_data:o,indexAxis:a}=i,l=n.getDatasetMeta(r),c=o||i.data;if(hs([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:h}=By(l,c);const f=e.threshold||4*s;if(h<=f){od(i);return}at(o)&&(i._data=c,delete i.data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=Dy(c,u,h,s,e);break;case"min-max":g=$y(c,u,h,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}i._decimated=g})},destroy(n){vl(n)}};function jy(n,t,e){const s=n.segments,i=n.points,r=t.points,o=[];for(const a of s){let{start:l,end:c}=a;c=Ji(l,c,i);const d=to(e,i[l],i[c],a.loop);if(!t.segments){o.push({source:a,target:d,start:i[l],end:i[c]});continue}const u=Uc(t,d);for(const h of u){const f=to(e,r[h.start],r[h.end],h.loop),g=Fc(a,i,f);for(const p of g)o.push({source:p,target:h,start:{[e]:wl(d,f,"start",Math.max)},end:{[e]:wl(d,f,"end",Math.min)}})}}return o}function to(n,t,e,s){if(s)return;let i=t[n],r=e[n];return n==="angle"&&(i=Kt(i),r=Kt(r)),{property:n,start:i,end:r}}function Fy(n,t){const{x:e=null,y:s=null}=n||{},i=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Ji(o,a,i);const l=i[o],c=i[a];s!==null?(r.push({x:l.x,y:s}),r.push({x:c.x,y:s})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Ji(n,t,e){for(;t>n;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function wl(n,t,e,s){return n&&t?s(n[e],t[e]):n?n[e]:t?t[e]:0}function ad(n,t){let e=[],s=!1;return At(n)?(s=!0,e=n):e=Fy(n,t),e.length?new Ke({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function xl(n){return n&&n.fill!==!1}function Uy(n,t,e){let i=n[t].fill;const r=[t];let o;if(!e)return i;for(;i!==!1&&r.indexOf(i)===-1;){if(!Rt(i))return i;if(o=n[i],!o)return!1;if(o.visible)return i;r.push(i),i=o.fill}return!1}function zy(n,t,e){const s=qy(n);if(ct(s))return isNaN(s.value)?!1:s;let i=parseFloat(s);return Rt(i)&&Math.floor(i)===i?Hy(s[0],t,i,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function Hy(n,t,e,s){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function Wy(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:ct(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function Vy(n,t,e){let s;return n==="start"?s=e:n==="end"?s=t.options.reverse?t.min:t.max:ct(n)?s=n.value:s=t.getBaseValue(),s}function qy(n){const t=n.options,e=t.fill;let s=tt(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function Gy(n){const{scale:t,index:e,line:s}=n,i=[],r=s.segments,o=s.points,a=Yy(t,e);a.push(ad({x:null,y:t.bottom},s));for(let l=0;l<r.length;l++){const c=r[l];for(let d=c.start;d<=c.end;d++)Ky(i,o[d],a)}return new Ke({points:i,options:{}})}function Yy(n,t){const e=[],s=n.getMatchingVisibleMetas("line");for(let i=0;i<s.length;i++){const r=s[i];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function Ky(n,t,e){const s=[];for(let i=0;i<e.length;i++){const r=e[i],{first:o,last:a,point:l}=Jy(r,t,"x");if(!(!l||o&&a)){if(o)s.unshift(l);else if(n.push(l),!a)break}}n.push(...s)}function Jy(n,t,e){const s=n.interpolate(t,e);if(!s)return{};const i=s[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const d=r[c],u=o[d.start][e],h=o[d.end][e];if(je(i,u,h)){a=i===u,l=i===h;break}}return{first:a,last:l,point:s}}class ld{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:i,y:r,radius:o}=this;return e=e||{start:0,end:kt},t.arc(i,r,o,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:i}=this,r=t.angle;return{x:e+Math.cos(r)*i,y:s+Math.sin(r)*i,angle:r}}}function Xy(n){const{chart:t,fill:e,line:s}=n;if(Rt(e))return Qy(t,e);if(e==="stack")return Gy(n);if(e==="shape")return!0;const i=Zy(n);return i instanceof ld?i:ad(i,s)}function Qy(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function Zy(n){return(n.scale||{}).getPointPositionForValue?eb(n):tb(n)}function tb(n){const{scale:t={},fill:e}=n,s=Wy(e,t);if(Rt(s)){const i=t.isHorizontal();return{x:i?s:null,y:i?null:s}}return null}function eb(n){const{scale:t,fill:e}=n,s=t.options,i=t.getLabels().length,r=s.reverse?t.max:t.min,o=Vy(e,t,r),a=[];if(s.grid.circular){const l=t.getPointPositionForValue(0,r);return new ld({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<i;++l)a.push(t.getPointPositionForValue(l,o));return a}function Er(n,t,e){const s=Xy(t),{chart:i,index:r,line:o,scale:a,axis:l}=t,c=o.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=i.getDatasetMeta(r),p=zc(i,g);s&&o.points.length&&(qi(n,e),nb(n,{line:o,target:s,above:h,below:f,area:e,scale:a,axis:l,clip:p}),Gi(n))}function nb(n,t){const{line:e,target:s,above:i,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=r;r!==i&&(c==="x"?(kl(n,s,o.top),Tr(n,{line:e,target:s,color:i,scale:a,property:c,clip:l}),n.restore(),n.save(),kl(n,s,o.bottom)):c==="y"&&(Sl(n,s,o.left),Tr(n,{line:e,target:s,color:r,scale:a,property:c,clip:l}),n.restore(),n.save(),Sl(n,s,o.right),d=i)),Tr(n,{line:e,target:s,color:d,scale:a,property:c,clip:l}),n.restore()}function kl(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,d=i[l],u=i[Ji(l,c,i)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function Sl(n,t,e){const{segments:s,points:i}=t;let r=!0,o=!1;n.beginPath();for(const a of s){const{start:l,end:c}=a,d=i[l],u=i[Ji(l,c,i)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function Tr(n,t){const{line:e,target:s,property:i,color:r,scale:o,clip:a}=t,l=jy(e,s,i);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=r}={}}=c,g=s!==!0;n.save(),n.fillStyle=f,sb(n,o,a,g&&to(i,u,h)),n.beginPath();const p=!!e.pathSegment(n,c);let m;if(g){p?n.closePath():El(n,s,h,i);const b=!!s.pathSegment(n,d,{move:p,reverse:!0});m=p&&b,m||El(n,s,u,i)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function sb(n,t,e,s){const i=t.chart.chartArea,{property:r,start:o,end:a}=s||{};if(r==="x"||r==="y"){let l,c,d,u;r==="x"?(l=o,c=i.top,d=a,u=i.bottom):(l=i.left,c=o,d=i.right,u=a),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function El(n,t,e,s){const i=t.interpolate(e,s);i&&n.lineTo(i.x,i.y)}var ib={id:"filler",afterDatasetsUpdate(n,t,e){const s=(n.data.datasets||[]).length,i=[];let r,o,a,l;for(o=0;o<s;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof Ke&&(l={visible:n.isDatasetVisible(o),index:o,fill:zy(a,o,s),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,i.push(l);for(o=0;o<s;++o)l=i[o],!(!l||l.fill===!1)&&(l.fill=Uy(i,o,e.propagate))},beforeDraw(n,t,e){const s=e.drawTime==="beforeDraw",i=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=i.length-1;o>=0;--o){const a=i[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),s&&a.fill&&Er(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=n.getSortedVisibleDatasetMetas();for(let i=s.length-1;i>=0;--i){const r=s[i].$filler;xl(r)&&Er(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const s=t.meta.$filler;!xl(s)||e.drawTime!=="beforeDatasetDraw"||Er(n.ctx,s,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Tl=(n,t)=>{let{boxHeight:e=t,boxWidth:s=t}=n;return n.usePointStyle&&(e=Math.min(e,t),s=n.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},rb=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Al extends xe{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=_t(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,i)=>t.sort(s,i,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,i=Nt(s.font),r=i.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Tl(s,r);let c,d;e.font=i.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,r,a,l)+10):(d=this.maxHeight,c=this._fitCols(o,i,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,i){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=i+a;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=s+e/2+r.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>o)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:i},c[c.length-1]+=m+a}),u}_fitCols(t,e,s,i){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:_,itemHeight:x}=ob(s,e,r,m,i);b>0&&f+x+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:_,height:x},h=Math.max(h,_),f+=x+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:i},rtl:r}}=this,o=qn(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=Yt(s,this.left+i,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=Yt(s,this.left+i,this.right-this.lineWidths[a])),c.top+=this.top+t+i,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+i}else{let a=0,l=Yt(s,this.top+t+i,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=Yt(s,this.top+t+i,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+i,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;qi(t,this),this._draw(),Gi(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:i}=this,{align:r,labels:o}=t,a=Ot.color,l=qn(t.rtl,this.left,this.width),c=Nt(o.font),{padding:d}=o,u=c.size,h=u/2;let f;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=Tl(o,u),b=function(C,O,y){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;i.save();const v=tt(y.lineWidth,1);if(i.fillStyle=tt(y.fillStyle,a),i.lineCap=tt(y.lineCap,"butt"),i.lineDashOffset=tt(y.lineDashOffset,0),i.lineJoin=tt(y.lineJoin,"miter"),i.lineWidth=v,i.strokeStyle=tt(y.strokeStyle,a),i.setLineDash(tt(y.lineDash,[])),o.usePointStyle){const k={radius:p*Math.SQRT2/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:v},A=l.xPlus(C,g/2),L=O+h;Cc(i,k,A,L,o.pointStyleWidth&&g)}else{const k=O+Math.max((u-p)/2,0),A=l.leftForLtr(C,g),L=xn(y.borderRadius);i.beginPath(),Object.values(L).some(H=>H!==0)?Ns(i,{x:A,y:k,w:g,h:p,radius:L}):i.rect(A,k,g,p),i.fill(),v!==0&&i.stroke()}i.restore()},_=function(C,O,y){En(i,y.text,C,O+m/2,c,{strikethrough:y.hidden,textAlign:l.textAlign(y.textAlign)})},x=this.isHorizontal(),S=this._computeTitleHeight();x?f={x:Yt(r,this.left+d,this.right-s[0]),y:this.top+d+S,line:0}:f={x:this.left+d,y:Yt(r,this.top+S+d,this.bottom-e[0].height),line:0},Bc(this.ctx,t.textDirection);const E=m+d;this.legendItems.forEach((C,O)=>{i.strokeStyle=C.fontColor,i.fillStyle=C.fontColor;const y=i.measureText(C.text).width,v=l.textAlign(C.textAlign||(C.textAlign=o.textAlign)),k=g+h+y;let A=f.x,L=f.y;l.setWidth(this.width),x?O>0&&A+k+d>this.right&&(L=f.y+=E,f.line++,A=f.x=Yt(r,this.left+d,this.right-s[f.line])):O>0&&L+E>this.bottom&&(A=f.x=A+e[f.line].width+d,f.line++,L=f.y=Yt(r,this.top+S+d,this.bottom-e[f.line].height));const H=l.x(A);if(b(H,L,C),A=Eg(v,A+g+h,x?A+k:this.right,t.rtl),_(l.x(A),L,C),x)f.x+=k+d;else if(typeof C.text!="string"){const j=c.lineHeight;f.y+=cd(C,j)+d}else f.y+=E}),Nc(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=Nt(e.font),i=Xt(e.padding);if(!e.display)return;const r=qn(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=s.size/2,c=i.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=Yt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+Yt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=Yt(a,u,u+h);o.textAlign=r.textAlign(So(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=s.string,En(o,e.text,f,d,s)}_computeTitleHeight(){const t=this.options.title,e=Nt(t.font),s=Xt(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,i,r;if(je(t,this.left,this.right)&&je(e,this.top,this.bottom)){for(r=this.legendHitBoxes,s=0;s<r.length;++s)if(i=r[s],je(t,i.left,i.left+i.width)&&je(e,i.top,i.top+i.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!cb(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const i=this._hoveredItem,r=rb(i,s);i&&!r&&_t(e.onLeave,[t,i,this],this),this._hoveredItem=s,s&&!r&&_t(e.onHover,[t,s,this],this)}else s&&_t(e.onClick,[t,s,this],this)}}function ob(n,t,e,s,i){const r=ab(s,n,t,e),o=lb(i,s,t.lineHeight);return{itemWidth:r,itemHeight:o}}function ab(n,t,e,s){let i=n.text;return i&&typeof i!="string"&&(i=i.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+s.measureText(i).width}function lb(n,t,e){let s=n;return typeof t.text!="string"&&(s=cd(t,e)),s}function cd(n,t){const e=n.text?n.text.length:0;return t*e}function cb(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var db={id:"legend",_element:Al,start(n,t,e){const s=n.legend=new Al({ctx:n.ctx,options:e,chart:n});Jt.configure(n,s,e),Jt.addBox(n,s)},stop(n){Jt.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const s=n.legend;Jt.configure(n,s,e),s.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const s=t.datasetIndex,i=e.chart;i.isDatasetVisible(s)?(i.hide(s),t.hidden=!0):(i.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:i,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=Xt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:i||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Lo extends xe{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const i=At(s.text)?s.text.length:1;this._padding=Xt(s.padding);const r=i*Nt(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:i,right:r,options:o}=this,a=o.align;let l=0,c,d,u;return this.isHorizontal()?(d=Yt(a,s,r),u=e+t,c=r-s):(o.position==="left"?(d=s+t,u=Yt(a,i,e),l=ht*-.5):(d=r-t,u=Yt(a,e,i),l=ht*.5),c=i-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=Nt(e.font),r=s.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);En(t,e.text,0,0,s,{color:e.color,maxWidth:l,rotation:c,textAlign:So(e.align),textBaseline:"middle",translation:[o,a]})}}function ub(n,t){const e=new Lo({ctx:n.ctx,options:t,chart:n});Jt.configure(n,e,t),Jt.addBox(n,e),n.titleBlock=e}var hb={id:"title",_element:Lo,start(n,t,e){ub(n,e)},stop(n){const t=n.titleBlock;Jt.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const s=n.titleBlock;Jt.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const fi=new WeakMap;var fb={id:"subtitle",start(n,t,e){const s=new Lo({ctx:n.ctx,options:e,chart:n});Jt.configure(n,s,e),Jt.addBox(n,s),fi.set(n,s)},stop(n){Jt.removeBox(n,fi.get(n)),fi.delete(n)},beforeUpdate(n,t,e){const s=fi.get(n);Jt.configure(n,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ps={average(n){if(!n.length)return!1;let t,e,s=new Set,i=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();s.add(l.x),i+=l.y,++r}}return r===0||s.size===0?!1:{x:[...s].reduce((a,l)=>a+l)/s.size,y:i/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,s=t.y,i=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=qr(t,c);d<i&&(i=d,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,s=l.y}return{x:e,y:s}}};function Te(n,t){return t&&(At(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function $e(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function gb(n,t){const{element:e,datasetIndex:s,index:i}=t,r=n.getDatasetMeta(s).controller,{label:o,value:a}=r.getLabelAndValue(i);return{chart:n,label:o,parsed:r.getParsed(i),raw:n.data.datasets[s].data[i],formattedValue:a,dataset:r.getDataset(),dataIndex:i,datasetIndex:s,element:e}}function Ol(n,t){const e=n.chart.ctx,{body:s,footer:i,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=Nt(t.bodyFont),c=Nt(t.titleFont),d=Nt(t.footerFont),u=r.length,h=i.length,f=s.length,g=Xt(t.padding);let p=g.height,m=0,b=s.reduce((S,E)=>S+E.before.length+E.lines.length+E.after.length,0);if(b+=n.beforeBody.length+n.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const S=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*S+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let _=0;const x=function(S){m=Math.max(m,e.measureText(S).width+_)};return e.save(),e.font=c.string,yt(n.title,x),e.font=l.string,yt(n.beforeBody.concat(n.afterBody),x),_=t.displayColors?o+2+t.boxPadding:0,yt(s,S=>{yt(S.before,x),yt(S.lines,x),yt(S.after,x)}),_=0,e.font=d.string,yt(n.footer,x),e.restore(),m+=g.width,{width:m,height:p}}function pb(n,t){const{y:e,height:s}=t;return e<s/2?"top":e>n.height-s/2?"bottom":"center"}function mb(n,t,e,s){const{x:i,width:r}=s,o=e.caretSize+e.caretPadding;if(n==="left"&&i+r+o>t.width||n==="right"&&i-r-o<0)return!0}function yb(n,t,e,s){const{x:i,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let c="center";return s==="center"?c=i<=(a+l)/2?"left":"right":i<=r/2?c="left":i>=o-r/2&&(c="right"),mb(c,n,t,e)&&(c="center"),c}function Cl(n,t,e){const s=e.yAlign||t.yAlign||pb(n,e);return{xAlign:e.xAlign||t.xAlign||yb(n,t,e,s),yAlign:s}}function bb(n,t){let{x:e,width:s}=n;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function _b(n,t,e){let{y:s,height:i}=n;return t==="top"?s+=e:t==="bottom"?s-=i+e:s-=i/2,s}function Rl(n,t,e,s){const{caretSize:i,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,c=i+r,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=xn(o);let g=bb(t,a);const p=_b(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+i:a==="right"&&(g+=Math.max(u,f)+i),{x:Ft(g,0,s.width-t.width),y:Ft(p,0,s.height-t.height)}}function gi(n,t,e){const s=Xt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-s.right:n.x+s.left}function Ml(n){return Te([],$e(n))}function vb(n,t,e){return sn(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function Il(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const dd={beforeTitle:Pe,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:Pe,beforeBody:Pe,beforeLabel:Pe,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return at(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Pe,afterBody:Pe,beforeFooter:Pe,footer:Pe,afterFooter:Pe};function ne(n,t,e,s){const i=n[t].call(e,s);return typeof i>"u"?dd[t].call(e,s):i}class eo extends xe{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,s=this.options.setContext(this.getContext()),i=s.enabled&&e.options.animation&&s.animations,r=new Hc(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=vb(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:s}=e,i=ne(s,"beforeTitle",this,t),r=ne(s,"title",this,t),o=ne(s,"afterTitle",this,t);let a=[];return a=Te(a,$e(i)),a=Te(a,$e(r)),a=Te(a,$e(o)),a}getBeforeBody(t,e){return Ml(ne(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:s}=e,i=[];return yt(t,r=>{const o={before:[],lines:[],after:[]},a=Il(s,r);Te(o.before,$e(ne(a,"beforeLabel",this,r))),Te(o.lines,ne(a,"label",this,r)),Te(o.after,$e(ne(a,"afterLabel",this,r))),i.push(o)}),i}getAfterBody(t,e){return Ml(ne(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:s}=e,i=ne(s,"beforeFooter",this,t),r=ne(s,"footer",this,t),o=ne(s,"afterFooter",this,t);let a=[];return a=Te(a,$e(i)),a=Te(a,$e(r)),a=Te(a,$e(o)),a}_createItems(t){const e=this._active,s=this.chart.data,i=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(gb(this.chart,e[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,s))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,s))),yt(a,d=>{const u=Il(t.callbacks,d);i.push(ne(u,"labelColor",this,d)),r.push(ne(u,"labelPointStyle",this,d)),o.push(ne(u,"labelTextColor",this,d))}),this.labelColors=i,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const s=this.options.setContext(this.getContext()),i=this._active;let r,o=[];if(!i.length)this.opacity!==0&&(r={opacity:0});else{const a=ps[s.position].call(this,i,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const l=this._size=Ol(this,s),c=Object.assign({},a,l),d=Cl(this.chart,s,c),u=Rl(s,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,s,i){const r=this.getCaretPosition(t,s,i);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,s){const{xAlign:i,yAlign:r}=this,{caretSize:o,cornerRadius:a}=s,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=xn(a),{x:h,y:f}=t,{width:g,height:p}=e;let m,b,_,x,S,E;return r==="center"?(S=f+p/2,i==="left"?(m=h,b=m-o,x=S+o,E=S-o):(m=h+g,b=m+o,x=S-o,E=S+o),_=m):(i==="left"?b=h+Math.max(l,d)+o:i==="right"?b=h+g-Math.max(c,u)-o:b=this.caretX,r==="top"?(x=f,S=x-o,m=b-o,_=b+o):(x=f+p,S=x+o,m=b+o,_=b-o),E=x),{x1:m,x2:b,x3:_,y1:x,y2:S,y3:E}}drawTitle(t,e,s){const i=this.title,r=i.length;let o,a,l;if(r){const c=qn(s.rtl,this.x,this.width);for(t.x=gi(this,s.titleAlign,s),e.textAlign=c.textAlign(s.titleAlign),e.textBaseline="middle",o=Nt(s.titleFont),a=s.titleSpacing,e.fillStyle=s.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(i[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=s.titleMarginBottom-a)}}_drawColorBox(t,e,s,i,r){const o=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:l,boxWidth:c}=r,d=Nt(r.bodyFont),u=gi(this,"left",r),h=i.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=e.y+f;if(r.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=i.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Yr(t,p,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Yr(t,p,m,b)}else{t.lineWidth=ct(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const p=i.leftForLtr(h,c),m=i.leftForLtr(i.xPlus(h,1),c-2),b=xn(o.borderRadius);Object.values(b).some(_=>_!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,Ns(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),Ns(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[s]}drawBody(t,e,s){const{body:i}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=s,u=Nt(s.bodyFont);let h=u.lineHeight,f=0;const g=qn(s.rtl,this.x,this.width),p=function(y){e.fillText(y,g.x(t.x+f),t.y+h/2),t.y+=h+r},m=g.textAlign(o);let b,_,x,S,E,C,O;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=gi(this,m,s),e.fillStyle=s.bodyColor,yt(this.beforeBody,p),f=a&&m!=="right"?o==="center"?c/2+d:c+2+d:0,S=0,C=i.length;S<C;++S){for(b=i[S],_=this.labelTextColors[S],e.fillStyle=_,yt(b.before,p),x=b.lines,a&&x.length&&(this._drawColorBox(e,t,S,g,s),h=Math.max(u.lineHeight,l)),E=0,O=x.length;E<O;++E)p(x[E]),h=u.lineHeight;yt(b.after,p)}f=0,h=u.lineHeight,yt(this.afterBody,p),t.y-=r}drawFooter(t,e,s){const i=this.footer,r=i.length;let o,a;if(r){const l=qn(s.rtl,this.x,this.width);for(t.x=gi(this,s.footerAlign,s),t.y+=s.footerMarginTop,e.textAlign=l.textAlign(s.footerAlign),e.textBaseline="middle",o=Nt(s.footerFont),e.fillStyle=s.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(i[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+s.footerSpacing}}drawBackground(t,e,s,i){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:d}=s,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=xn(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,s,i),e.lineTo(a+c-h,l),e.quadraticCurveTo(a+c,l,a+c,l+h),o==="center"&&r==="right"&&this.drawCaret(t,e,s,i),e.lineTo(a+c,l+d-g),e.quadraticCurveTo(a+c,l+d,a+c-g,l+d),o==="bottom"&&this.drawCaret(t,e,s,i),e.lineTo(a+f,l+d),e.quadraticCurveTo(a,l+d,a,l+d-f),o==="center"&&r==="left"&&this.drawCaret(t,e,s,i),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,s=this.$animations,i=s&&s.x,r=s&&s.y;if(i||r){const o=ps[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=Ol(this,t),l=Object.assign({},o,this._size),c=Cl(e,t,l),d=Rl(t,l,c,e);(i._to!==d.x||r._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},r={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=Xt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=s,this.drawBackground(r,t,i,e),Bc(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),Nc(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const s=this._active,i=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!Mi(s,i),o=this._positionChanged(i,e);(r||o)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,s=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,s),a=this._positionChanged(o,t),l=e||!Mi(o,r)||a;return l&&(this._active=o,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,s,i){const r=this.options;if(t.type==="mouseout")return[];if(!i)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,s);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:s,caretY:i,options:r}=this,o=ps[r.position].call(this,t,e);return o!==!1&&(s!==o.x||i!==o.y)}}F(eo,"positioners",ps);var wb={id:"tooltip",_element:eo,positioners:ps,afterInit(n,t,e){e&&(n.tooltip=new eo({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:dd},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},xb=Object.freeze({__proto__:null,Colors:Py,Decimation:Ny,Filler:ib,Legend:db,SubTitle:fb,Title:hb,Tooltip:wb});const kb=(n,t,e,s)=>(typeof t=="string"?(e=n.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function Sb(n,t,e,s){const i=n.indexOf(t);if(i===-1)return kb(n,t,e,s);const r=n.lastIndexOf(t);return i!==r?e:i}const Eb=(n,t)=>n===null?null:Ft(Math.round(n),0,t);function Ll(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class no extends An{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:i,label:r}of e)s[i]===r&&s.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(at(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:Sb(s,t,tt(e,t),this._addedLabels),Eb(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(i=this.getLabels().length-1)),this.min=s,this.max=i}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,i=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=t;o<=e;o++)i.push({value:o});return i}getLabelForValue(t){return Ll.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}F(no,"id","category"),F(no,"defaults",{ticks:{callback:Ll}});function Tb(n,t){const e=[],{bounds:i,step:r,min:o,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=n,f=r||1,g=d-1,{min:p,max:m}=t,b=!at(o),_=!at(a),x=!at(c),S=(m-p)/(u+1);let E=Oa((m-p)/g/f)*f,C,O,y,v;if(E<1e-14&&!b&&!_)return[{value:p},{value:m}];v=Math.ceil(m/E)-Math.floor(p/E),v>g&&(E=Oa(v*E/g/f)*f),at(l)||(C=Math.pow(10,l),E=Math.ceil(E*C)/C),i==="ticks"?(O=Math.floor(p/E)*E,y=Math.ceil(m/E)*E):(O=p,y=m),b&&_&&r&&bg((a-o)/r,E/1e3)?(v=Math.round(Math.min((a-o)/E,d)),E=(a-o)/v,O=o,y=a):x?(O=b?o:O,y=_?a:y,v=c-1,E=(y-O)/v):(v=(y-O)/E,xs(v,Math.round(v),E/1e3)?v=Math.round(v):v=Math.ceil(v));const k=Math.max(Ca(E),Ca(O));C=Math.pow(10,at(l)?k:l),O=Math.round(O*C)/C,y=Math.round(y*C)/C;let A=0;for(b&&(h&&O!==o?(e.push({value:o}),O<o&&A++,xs(Math.round((O+A*E)*C)/C,o,Pl(o,S,n))&&A++):O<o&&A++);A<v;++A){const L=Math.round((O+A*E)*C)/C;if(_&&L>a)break;e.push({value:L})}return _&&h&&y!==a?e.length&&xs(e[e.length-1].value,a,Pl(a,S,n))?e[e.length-1].value=a:e.push({value:a}):(!_||y===a)&&e.push({value:y}),e}function Pl(n,t,{horizontal:e,minRotation:s}){const i=ve(s),r=(e?Math.sin(i):Math.cos(i))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class Ni extends An{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return at(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:i,max:r}=this;const o=l=>i=e?i:l,a=l=>r=s?r:l;if(t){const l=Ce(i),c=Ce(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(i===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(i-l)}this.min=i,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,i;return s?(i=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),e=e||11),e&&(i=Math.min(e,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const i={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=Tb(i,r);return t.bounds==="ticks"&&vc(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const i=(s-e)/Math.max(t.length-1,1)/2;e-=i,s+=i}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return Vs(t,this.chart.options.locale,this.options.ticks.format)}}class so extends Ni{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Rt(t)?t:0,this.max=Rt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=ve(this.options.ticks.minRotation),i=(t?Math.sin(s):Math.cos(s))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/i))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}F(so,"id","linear"),F(so,"defaults",{ticks:{callback:Vi.formatters.numeric}});const Fs=n=>Math.floor(Ge(n)),fn=(n,t)=>Math.pow(10,Fs(n)+t);function Dl(n){return n/Math.pow(10,Fs(n))===1}function $l(n,t,e){const s=Math.pow(10,e),i=Math.floor(n/s);return Math.ceil(t/s)-i}function Ab(n,t){const e=t-n;let s=Fs(e);for(;$l(n,t,s)>10;)s++;for(;$l(n,t,s)<10;)s--;return Math.min(s,Fs(n))}function Ob(n,{min:t,max:e}){t=le(n.min,t);const s=[],i=Fs(t);let r=Ab(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=i>r?Math.pow(10,i):0,c=Math.round((t-l)*o)/o,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,r)),h=le(n.min,Math.round((l+d+u*Math.pow(10,r))*o)/o);for(;h<e;)s.push({value:h,major:Dl(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),h=Math.round((l+d+u*Math.pow(10,r))*o)/o;const f=le(n.max,h);return s.push({value:f,major:Dl(f),significand:u}),s}class io extends An{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=Ni.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return Rt(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Rt(t)?Math.max(0,t):null,this.max=Rt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Rt(this._userMin)&&(this.min=t===fn(this.min,0)?fn(this.min,-1):fn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,i=this.max;const r=a=>s=t?s:a,o=a=>i=e?i:a;s===i&&(s<=0?(r(1),o(10)):(r(fn(s,-1)),o(fn(i,1)))),s<=0&&r(fn(i,-1)),i<=0&&o(fn(s,1)),this.min=s,this.max=i}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=Ob(e,this);return t.bounds==="ticks"&&vc(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":Vs(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Ge(t),this._valueRange=Ge(this.max)-Ge(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Ge(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}F(io,"id","logarithmic"),F(io,"defaults",{ticks:{callback:Vi.formatters.logarithmic,major:{enabled:!0}}});function ro(n){const t=n.ticks;if(t.display&&n.display){const e=Xt(t.backdropPadding);return tt(t.font&&t.font.size,Ot.font.size)+e.height}return 0}function Cb(n,t,e){return e=At(e)?e:[e],{w:Dg(n,t.string,e),h:e.length*t.lineHeight}}function Bl(n,t,e,s,i){return n===s||n===i?{start:t-e/2,end:t+e/2}:n<s||n>i?{start:t-e,end:t}:{start:t,end:t+e}}function Rb(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),s=[],i=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?ht/r:0;for(let l=0;l<r;l++){const c=o.setContext(n.getPointLabelContext(l));i[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+i[l],a),u=Nt(c.font),h=Cb(n.ctx,u,n._pointLabels[l]);s[l]=h;const f=Kt(n.getIndexAngle(l)+a),g=Math.round(xo(f)),p=Bl(g,d.x,h.w,0,180),m=Bl(g,d.y,h.h,90,270);Mb(e,t,f,p,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=Pb(n,s,i)}function Mb(n,t,e,s,i){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;s.start<t.l?(a=(t.l-s.start)/r,n.l=Math.min(n.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),i.start<t.t?(l=(t.t-i.start)/o,n.t=Math.min(n.t,t.t-l)):i.end>t.b&&(l=(i.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function Ib(n,t,e){const s=n.drawingArea,{extra:i,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,s+i+o,r),c=Math.round(xo(Kt(l.angle+Mt))),d=Bb(l.y,a.h,c),u=Db(c),h=$b(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function Lb(n,t){if(!t)return!0;const{left:e,top:s,right:i,bottom:r}=n;return!(Ue({x:e,y:s},t)||Ue({x:e,y:r},t)||Ue({x:i,y:s},t)||Ue({x:i,y:r},t))}function Pb(n,t,e){const s=[],i=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:ro(r)/2,additionalAngle:o?ht/i:0};let c;for(let d=0;d<i;d++){l.padding=e[d],l.size=t[d];const u=Ib(n,d,l);s.push(u),a==="auto"&&(u.visible=Lb(u,c),u.visible&&(c=u))}return s}function Db(n){return n===0||n===180?"center":n<180?"left":"right"}function $b(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function Bb(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function Nb(n,t,e){const{left:s,top:i,right:r,bottom:o}=e,{backdropColor:a}=t;if(!at(a)){const l=xn(t.borderRadius),c=Xt(t.backdropPadding);n.fillStyle=a;const d=s-c.left,u=i-c.top,h=r-s+c.width,f=o-i+c.height;Object.values(l).some(g=>g!==0)?(n.beginPath(),Ns(n,{x:d,y:u,w:h,h:f,radius:l}),n.fill()):n.fillRect(d,u,h,f)}}function jb(n,t){const{ctx:e,options:{pointLabels:s}}=n;for(let i=t-1;i>=0;i--){const r=n._pointLabelItems[i];if(!r.visible)continue;const o=s.setContext(n.getPointLabelContext(i));Nb(e,o,r);const a=Nt(o.font),{x:l,y:c,textAlign:d}=r;En(e,n._pointLabels[i],l,c+a.lineHeight/2,a,{color:o.color,textAlign:d,textBaseline:"middle"})}}function ud(n,t,e,s){const{ctx:i}=n;if(e)i.arc(n.xCenter,n.yCenter,t,0,kt);else{let r=n.getPointPosition(0,t);i.moveTo(r.x,r.y);for(let o=1;o<s;o++)r=n.getPointPosition(o,t),i.lineTo(r.x,r.y)}}function Fb(n,t,e,s,i){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!s||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(i.dash||[]),r.lineDashOffset=i.dashOffset,r.beginPath(),ud(n,e,o,s),r.closePath(),r.stroke(),r.restore())}function Ub(n,t,e){return sn(n,{label:e,index:t,type:"pointLabel"})}class ms extends Ni{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Xt(ro(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Rt(t)&&!isNaN(t)?t:0,this.max=Rt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/ro(this.options))}generateTickLabels(t){Ni.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const i=_t(this.options.pointLabels.callback,[e,s],this);return i||i===0?i:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?Rb(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,i))}getIndexAngle(t){const e=kt/(this._pointLabels.length||1),s=this.options.startAngle||0;return Kt(t*e+ve(s))}getDistanceFromCenterForValue(t){if(at(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(at(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return Ub(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const i=this.getIndexAngle(t)-Mt+s;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:i,bottom:r}=this._pointLabelItems[t];return{left:e,top:s,right:i,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),ud(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:i,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&jb(this,o),i.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=i.setContext(h),g=r.setContext(h);Fb(this,f,l,o,g)}}),s.display){for(t.save(),a=o-1;a>=0;a--){const d=s.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const i=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=s.setContext(this.getContext(l)),d=Nt(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=Xt(c.backdropPadding);t.fillRect(-o/2-u.left,-r-d.size/2-u.top,o+u.width,d.size+u.height)}En(t,a.label,0,-r,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}F(ms,"id","radialLinear"),F(ms,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Vi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),F(ms,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),F(ms,"descriptors",{angleLines:{_fallback:"grid"}});const Xi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},se=Object.keys(Xi);function Nl(n,t){return n-t}function jl(n,t){if(at(t))return null;const e=n._adapter,{parser:s,round:i,isoWeekday:r}=n._parseOpts;let o=t;return typeof s=="function"&&(o=s(o)),Rt(o)||(o=typeof s=="string"?e.parse(o,s):e.parse(o)),o===null?null:(i&&(o=i==="week"&&(Gn(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,i)),+o)}function Fl(n,t,e,s){const i=se.length;for(let r=se.indexOf(n);r<i-1;++r){const o=Xi[se[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=s)return se[r]}return se[i-1]}function zb(n,t,e,s,i){for(let r=se.length-1;r>=se.indexOf(e);r--){const o=se[r];if(Xi[o].common&&n._adapter.diff(i,s,o)>=t-1)return o}return se[e?se.indexOf(e):0]}function Hb(n){for(let t=se.indexOf(n)+1,e=se.length;t<e;++t)if(Xi[se[t]].common)return se[t]}function Ul(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:s,hi:i}=ko(e,t),r=e[s]>=t?e[s]:e[i];n[r]=!0}}function Wb(n,t,e,s){const i=n._adapter,r=+i.startOf(t[0].value,s),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+i.add(a,1,s))l=e[a],l>=0&&(t[l].major=!0);return t}function zl(n,t,e){const s=[],i={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],i[a]=o,s.push({value:a,major:!1});return r===0||!e?s:Wb(n,s,i,e)}class Us extends An{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),i=this._adapter=new Qp._date(t.adapters.date);i.init(e),ws(s.displayFormats,i.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:jl(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:i,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(i=Math.min(i,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=Rt(i)&&!isNaN(i)?i:+e.startOf(Date.now(),s),r=Rt(r)&&!isNaN(r)?r:+e.endOf(Date.now(),s)+1,this.min=Math.min(i,r-1),this.max=Math.max(i+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,i=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const r=this.min,o=this.max,a=xg(i,r,o);return this._unit=e.unit||(s.autoSkip?Fl(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):zb(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:Hb(this._unit),this.initOffsets(i),t.reverse&&a.reverse(),zl(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,i,r;this.options.offset&&t.length&&(i=this.getDecimalForValue(t[0]),t.length===1?e=1-i:e=(this.getDecimalForValue(t[1])-i)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?s=r:s=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Ft(e,0,o),s=Ft(s,0,o),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,i=this.options,r=i.time,o=r.unit||Fl(r.minUnit,e,s,this._getLabelCapacity(e)),a=tt(i.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=Gn(l)||l===!0,d={};let u=e,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(s,e,o)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+o);const g=i.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<s;h=+t.add(h,a,o),f++)Ul(d,h,g);return(h===s||i.bounds==="ticks"||f===1)&&Ul(d,h,g),Object.keys(d).sort(Nl).map(p=>+p)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const i=this.options.time.displayFormats,r=this._unit,o=e||i[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,s,i){const r=this.options,o=r.ticks.callback;if(o)return _t(o,[t,e,s],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=s[e],f=c&&u&&h&&h.major;return this._adapter.format(t,i||(f?u:d))}generateTickLabels(t){let e,s,i;for(e=0,s=t.length;e<s;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,i=ve(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(i),o=Math.sin(i),a=this._resolveTickFontOptions(0).size;return{w:s*r+a*o,h:s*o+a*r}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,i=s[e.unit]||s.millisecond,r=this._tickFormatFunction(t,0,zl(this,[t],this._majorUnit),i),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,s=i.length;e<s;++e)t=t.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const i=this.getLabels();for(e=0,s=i.length;e<s;++e)t.push(jl(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return kc(t.sort(Nl))}}F(Us,"id","time"),F(Us,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function pi(n,t,e){let s=0,i=n.length-1,r,o,a,l;e?(t>=n[s].pos&&t<=n[i].pos&&({lo:s,hi:i}=Fe(n,"pos",t)),{pos:r,time:a}=n[s],{pos:o,time:l}=n[i]):(t>=n[s].time&&t<=n[i].time&&({lo:s,hi:i}=Fe(n,"time",t)),{time:r,pos:a}=n[s],{time:o,pos:l}=n[i]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class oo extends Us{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=pi(e,this.min),this._tableRange=pi(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,i=[],r=[];let o,a,l,c,d;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=s&&i.push(c);if(i.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(o=0,a=i.length;o<a;++o)d=i[o+1],l=i[o-1],c=i[o],Math.round((d+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((i,r)=>i-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(pi(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return pi(this._table,s*this._tableRange+this._minPos,!0)}}F(oo,"id","timeseries"),F(oo,"defaults",Us.defaults);var Vb=Object.freeze({__proto__:null,CategoryScale:no,LinearScale:so,LogarithmicScale:io,RadialLinearScale:ms,TimeScale:Us,TimeSeriesScale:oo});const qb=[Xp,Ay,xb,Vb];ce.register(...qb);var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fd={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(Po,function(){var e=1e3,s=6e4,i=36e5,r="millisecond",o="second",a="minute",l="hour",c="day",d="week",u="month",h="quarter",f="year",g="date",p="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,b=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(j){var I=["th","st","nd","rd"],M=j%100;return"["+j+(I[(M-20)%10]||I[M]||I[0])+"]"}},x=function(j,I,M){var R=String(j);return!R||R.length>=I?j:""+Array(I+1-R.length).join(M)+j},S={s:x,z:function(j){var I=-j.utcOffset(),M=Math.abs(I),R=Math.floor(M/60),D=M%60;return(I<=0?"+":"-")+x(R,2,"0")+":"+x(D,2,"0")},m:function j(I,M){if(I.date()<M.date())return-j(M,I);var R=12*(M.year()-I.year())+(M.month()-I.month()),D=I.clone().add(R,u),P=M-D<0,U=I.clone().add(R+(P?-1:1),u);return+(-(R+(M-D)/(P?D-U:U-D))||0)},a:function(j){return j<0?Math.ceil(j)||0:Math.floor(j)},p:function(j){return{M:u,y:f,w:d,d:c,D:g,h:l,m:a,s:o,ms:r,Q:h}[j]||String(j||"").toLowerCase().replace(/s$/,"")},u:function(j){return j===void 0}},E="en",C={};C[E]=_;var O="$isDayjsObject",y=function(j){return j instanceof L||!(!j||!j[O])},v=function j(I,M,R){var D;if(!I)return E;if(typeof I=="string"){var P=I.toLowerCase();C[P]&&(D=P),M&&(C[P]=M,D=P);var U=I.split("-");if(!D&&U.length>1)return j(U[0])}else{var B=I.name;C[B]=I,D=B}return!R&&D&&(E=D),D||!R&&E},k=function(j,I){if(y(j))return j.clone();var M=typeof I=="object"?I:{};return M.date=j,M.args=arguments,new L(M)},A=S;A.l=v,A.i=y,A.w=function(j,I){return k(j,{locale:I.$L,utc:I.$u,x:I.$x,$offset:I.$offset})};var L=function(){function j(M){this.$L=v(M.locale,null,!0),this.parse(M),this.$x=this.$x||M.x||{},this[O]=!0}var I=j.prototype;return I.parse=function(M){this.$d=function(R){var D=R.date,P=R.utc;if(D===null)return new Date(NaN);if(A.u(D))return new Date;if(D instanceof Date)return new Date(D);if(typeof D=="string"&&!/Z$/i.test(D)){var U=D.match(m);if(U){var B=U[2]-1||0,z=(U[7]||"0").substring(0,3);return P?new Date(Date.UTC(U[1],B,U[3]||1,U[4]||0,U[5]||0,U[6]||0,z)):new Date(U[1],B,U[3]||1,U[4]||0,U[5]||0,U[6]||0,z)}}return new Date(D)}(M),this.init()},I.init=function(){var M=this.$d;this.$y=M.getFullYear(),this.$M=M.getMonth(),this.$D=M.getDate(),this.$W=M.getDay(),this.$H=M.getHours(),this.$m=M.getMinutes(),this.$s=M.getSeconds(),this.$ms=M.getMilliseconds()},I.$utils=function(){return A},I.isValid=function(){return this.$d.toString()!==p},I.isSame=function(M,R){var D=k(M);return this.startOf(R)<=D&&D<=this.endOf(R)},I.isAfter=function(M,R){return k(M)<this.startOf(R)},I.isBefore=function(M,R){return this.endOf(R)<k(M)},I.$g=function(M,R,D){return A.u(M)?this[R]:this.set(D,M)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(M,R){var D=this,P=!!A.u(R)||R,U=A.p(M),B=function(et,nt){var J=A.w(D.$u?Date.UTC(D.$y,nt,et):new Date(D.$y,nt,et),D);return P?J:J.endOf(c)},z=function(et,nt){return A.w(D.toDate()[et].apply(D.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(nt)),D)},$=this.$W,Z=this.$M,W=this.$D,it="set"+(this.$u?"UTC":"");switch(U){case f:return P?B(1,0):B(31,11);case u:return P?B(1,Z):B(0,Z+1);case d:var St=this.$locale().weekStart||0,Q=($<St?$+7:$)-St;return B(P?W-Q:W+(6-Q),Z);case c:case g:return z(it+"Hours",0);case l:return z(it+"Minutes",1);case a:return z(it+"Seconds",2);case o:return z(it+"Milliseconds",3);default:return this.clone()}},I.endOf=function(M){return this.startOf(M,!1)},I.$set=function(M,R){var D,P=A.p(M),U="set"+(this.$u?"UTC":""),B=(D={},D[c]=U+"Date",D[g]=U+"Date",D[u]=U+"Month",D[f]=U+"FullYear",D[l]=U+"Hours",D[a]=U+"Minutes",D[o]=U+"Seconds",D[r]=U+"Milliseconds",D)[P],z=P===c?this.$D+(R-this.$W):R;if(P===u||P===f){var $=this.clone().set(g,1);$.$d[B](z),$.init(),this.$d=$.set(g,Math.min(this.$D,$.daysInMonth())).$d}else B&&this.$d[B](z);return this.init(),this},I.set=function(M,R){return this.clone().$set(M,R)},I.get=function(M){return this[A.p(M)]()},I.add=function(M,R){var D,P=this;M=Number(M);var U=A.p(R),B=function(Z){var W=k(P);return A.w(W.date(W.date()+Math.round(Z*M)),P)};if(U===u)return this.set(u,this.$M+M);if(U===f)return this.set(f,this.$y+M);if(U===c)return B(1);if(U===d)return B(7);var z=(D={},D[a]=s,D[l]=i,D[o]=e,D)[U]||1,$=this.$d.getTime()+M*z;return A.w($,this)},I.subtract=function(M,R){return this.add(-1*M,R)},I.format=function(M){var R=this,D=this.$locale();if(!this.isValid())return D.invalidDate||p;var P=M||"YYYY-MM-DDTHH:mm:ssZ",U=A.z(this),B=this.$H,z=this.$m,$=this.$M,Z=D.weekdays,W=D.months,it=D.meridiem,St=function(nt,J,ut,ft){return nt&&(nt[J]||nt(R,P))||ut[J].slice(0,ft)},Q=function(nt){return A.s(B%12||12,nt,"0")},et=it||function(nt,J,ut){var ft=nt<12?"AM":"PM";return ut?ft.toLowerCase():ft};return P.replace(b,function(nt,J){return J||function(ut){switch(ut){case"YY":return String(R.$y).slice(-2);case"YYYY":return A.s(R.$y,4,"0");case"M":return $+1;case"MM":return A.s($+1,2,"0");case"MMM":return St(D.monthsShort,$,W,3);case"MMMM":return St(W,$);case"D":return R.$D;case"DD":return A.s(R.$D,2,"0");case"d":return String(R.$W);case"dd":return St(D.weekdaysMin,R.$W,Z,2);case"ddd":return St(D.weekdaysShort,R.$W,Z,3);case"dddd":return Z[R.$W];case"H":return String(B);case"HH":return A.s(B,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return et(B,z,!0);case"A":return et(B,z,!1);case"m":return String(z);case"mm":return A.s(z,2,"0");case"s":return String(R.$s);case"ss":return A.s(R.$s,2,"0");case"SSS":return A.s(R.$ms,3,"0");case"Z":return U}return null}(nt)||U.replace(":","")})},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(M,R,D){var P,U=this,B=A.p(R),z=k(M),$=(z.utcOffset()-this.utcOffset())*s,Z=this-z,W=function(){return A.m(U,z)};switch(B){case f:P=W()/12;break;case u:P=W();break;case h:P=W()/3;break;case d:P=(Z-$)/6048e5;break;case c:P=(Z-$)/864e5;break;case l:P=Z/i;break;case a:P=Z/s;break;case o:P=Z/e;break;default:P=Z}return D?P:A.a(P)},I.daysInMonth=function(){return this.endOf(u).$D},I.$locale=function(){return C[this.$L]},I.locale=function(M,R){if(!M)return this.$L;var D=this.clone(),P=v(M,R,!0);return P&&(D.$L=P),D},I.clone=function(){return A.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},j}(),H=L.prototype;return k.prototype=H,[["$ms",r],["$s",o],["$m",a],["$H",l],["$W",c],["$M",u],["$y",f],["$D",g]].forEach(function(j){H[j[1]]=function(I){return this.$g(I,j[0],j[1])}}),k.extend=function(j,I){return j.$i||(j(I,L,k),j.$i=!0),k},k.locale=v,k.isDayjs=y,k.unix=function(j){return k(1e3*j)},k.en=C[E],k.Ls=C,k.p={},k})})(fd);var Gb=fd.exports;const dt=hd(Gb);var gd={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(Po,function(){return function(e,s,i){s.prototype.isBetween=function(r,o,a,l){var c=i(r),d=i(o),u=(l=l||"()")[0]==="(",h=l[1]===")";return(u?this.isAfter(c,a):!this.isBefore(c,a))&&(h?this.isBefore(d,a):!this.isAfter(d,a))||(u?this.isBefore(c,a):!this.isAfter(c,a))&&(h?this.isAfter(d,a):!this.isBefore(d,a))}}})})(gd);var Yb=gd.exports;const Kb=hd(Yb);var Jb={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(n,t){((e,s)=>{n.exports=s()})(Po,function e(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},i,r=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,a={},l=0,c={};function d(y){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(v){var k=E(v);k.chunkSize=parseInt(k.chunkSize),v.step||v.chunk||(k.chunkSize=null),this._handle=new p(k),(this._handle.streamer=this)._config=k}).call(this,y),this.parseChunk=function(v,k){var A=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<A){let H=this._config.newline;H||(L=this._config.quoteChar||'"',H=this._handle.guessLineEndings(v,L)),v=[...v.split(H).slice(A)].join(H)}this.isFirstChunk&&O(this._config.beforeFirstChunk)&&(L=this._config.beforeFirstChunk(v))!==void 0&&(v=L),this.isFirstChunk=!1,this._halted=!1;var A=this._partialLine+v,L=(this._partialLine="",this._handle.parse(A,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(v=L.meta.cursor,A=(this._finished||(this._partialLine=A.substring(v-this._baseIndex),this._baseIndex=v),L&&L.data&&(this._rowCount+=L.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:L,workerId:c.WORKER_ID,finished:A});else if(O(this._config.chunk)&&!k){if(this._config.chunk(L,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=L=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(L.data),this._completeResults.errors=this._completeResults.errors.concat(L.errors),this._completeResults.meta=L.meta),this._completed||!A||!O(this._config.complete)||L&&L.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),A||L&&L.meta.paused||this._nextChunk(),L}this._halted=!0},this._sendError=function(v){O(this._config.error)?this._config.error(v):o&&this._config.error&&s.postMessage({workerId:c.WORKER_ID,error:v,finished:!1})}}function u(y){var v;(y=y||{}).chunkSize||(y.chunkSize=c.RemoteChunkSize),d.call(this,y),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(k){this._input=k,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(v=new XMLHttpRequest,this._config.withCredentials&&(v.withCredentials=this._config.withCredentials),r||(v.onload=C(this._chunkLoaded,this),v.onerror=C(this._chunkError,this)),v.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var k,A=this._config.downloadRequestHeaders;for(k in A)v.setRequestHeader(k,A[k])}var L;this._config.chunkSize&&(L=this._start+this._config.chunkSize-1,v.setRequestHeader("Range","bytes="+this._start+"-"+L));try{v.send(this._config.downloadRequestBody)}catch(H){this._chunkError(H.message)}r&&v.status===0&&this._chunkError()}},this._chunkLoaded=function(){v.readyState===4&&(v.status<200||400<=v.status?this._chunkError():(this._start+=this._config.chunkSize||v.responseText.length,this._finished=!this._config.chunkSize||this._start>=(k=>(k=k.getResponseHeader("Content-Range"))!==null?parseInt(k.substring(k.lastIndexOf("/")+1)):-1)(v),this.parseChunk(v.responseText)))},this._chunkError=function(k){k=v.statusText||k,this._sendError(new Error(k))}}function h(y){(y=y||{}).chunkSize||(y.chunkSize=c.LocalChunkSize),d.call(this,y);var v,k,A=typeof FileReader<"u";this.stream=function(L){this._input=L,k=L.slice||L.webkitSlice||L.mozSlice,A?((v=new FileReader).onload=C(this._chunkLoaded,this),v.onerror=C(this._chunkError,this)):v=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var L=this._input,H=(this._config.chunkSize&&(H=Math.min(this._start+this._config.chunkSize,this._input.size),L=k.call(L,this._start,H)),v.readAsText(L,this._config.encoding));A||this._chunkLoaded({target:{result:H}})},this._chunkLoaded=function(L){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(L.target.result)},this._chunkError=function(){this._sendError(v.error)}}function f(y){var v;d.call(this,y=y||{}),this.stream=function(k){return v=k,this._nextChunk()},this._nextChunk=function(){var k,A;if(!this._finished)return k=this._config.chunkSize,v=k?(A=v.substring(0,k),v.substring(k)):(A=v,""),this._finished=!v,this.parseChunk(A)}}function g(y){d.call(this,y=y||{});var v=[],k=!0,A=!1;this.pause=function(){d.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){d.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(L){this._input=L,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){A&&v.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),v.length?this.parseChunk(v.shift()):k=!0},this._streamData=C(function(L){try{v.push(typeof L=="string"?L:L.toString(this._config.encoding)),k&&(k=!1,this._checkIsFinished(),this.parseChunk(v.shift()))}catch(H){this._streamError(H)}},this),this._streamError=C(function(L){this._streamCleanUp(),this._sendError(L)},this),this._streamEnd=C(function(){this._streamCleanUp(),A=!0,this._streamData("")},this),this._streamCleanUp=C(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function p(y){var v,k,A,L,H=Math.pow(2,53),j=-H,I=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,M=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,R=this,D=0,P=0,U=!1,B=!1,z=[],$={data:[],errors:[],meta:{}};function Z(Q){return y.skipEmptyLines==="greedy"?Q.join("").trim()==="":Q.length===1&&Q[0].length===0}function W(){if($&&A&&(St("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+c.DefaultDelimiter+"'"),A=!1),y.skipEmptyLines&&($.data=$.data.filter(function(ut){return!Z(ut)})),it()){let ut=function(ft,gt){O(y.transformHeader)&&(ft=y.transformHeader(ft,gt)),z.push(ft)};var J=ut;if($)if(Array.isArray($.data[0])){for(var Q=0;it()&&Q<$.data.length;Q++)$.data[Q].forEach(ut);$.data.splice(0,1)}else $.data.forEach(ut)}function et(ut,ft){for(var gt=y.header?{}:[],lt=0;lt<ut.length;lt++){var st=lt,It=ut[lt],It=((ot,pt)=>(Et=>(y.dynamicTypingFunction&&y.dynamicTyping[Et]===void 0&&(y.dynamicTyping[Et]=y.dynamicTypingFunction(Et)),(y.dynamicTyping[Et]||y.dynamicTyping)===!0))(ot)?pt==="true"||pt==="TRUE"||pt!=="false"&&pt!=="FALSE"&&((Et=>{if(I.test(Et)&&(Et=parseFloat(Et),j<Et&&Et<H))return 1})(pt)?parseFloat(pt):M.test(pt)?new Date(pt):pt===""?null:pt):pt)(st=y.header?lt>=z.length?"__parsed_extra":z[lt]:st,It=y.transform?y.transform(It,st):It);st==="__parsed_extra"?(gt[st]=gt[st]||[],gt[st].push(It)):gt[st]=It}return y.header&&(lt>z.length?St("FieldMismatch","TooManyFields","Too many fields: expected "+z.length+" fields but parsed "+lt,P+ft):lt<z.length&&St("FieldMismatch","TooFewFields","Too few fields: expected "+z.length+" fields but parsed "+lt,P+ft)),gt}var nt;$&&(y.header||y.dynamicTyping||y.transform)&&(nt=1,!$.data.length||Array.isArray($.data[0])?($.data=$.data.map(et),nt=$.data.length):$.data=et($.data,0),y.header&&$.meta&&($.meta.fields=z),P+=nt)}function it(){return y.header&&z.length===0}function St(Q,et,nt,J){Q={type:Q,code:et,message:nt},J!==void 0&&(Q.row=J),$.errors.push(Q)}O(y.step)&&(L=y.step,y.step=function(Q){$=Q,it()?W():(W(),$.data.length!==0&&(D+=Q.data.length,y.preview&&D>y.preview?k.abort():($.data=$.data[0],L($,R))))}),this.parse=function(Q,et,nt){var J=y.quoteChar||'"',J=(y.newline||(y.newline=this.guessLineEndings(Q,J)),A=!1,y.delimiter?O(y.delimiter)&&(y.delimiter=y.delimiter(Q),$.meta.delimiter=y.delimiter):((J=((ut,ft,gt,lt,st)=>{var It,ot,pt,Et;st=st||[",","	","|",";",c.RECORD_SEP,c.UNIT_SEP];for(var Re=0;Re<st.length;Re++){for(var ie,rn=st[Re],Lt=0,qt=0,wt=0,xt=(pt=void 0,new b({comments:lt,delimiter:rn,newline:ft,preview:10}).parse(ut)),re=0;re<xt.data.length;re++)gt&&Z(xt.data[re])?wt++:(ie=xt.data[re].length,qt+=ie,pt===void 0?pt=ie:0<ie&&(Lt+=Math.abs(ie-pt),pt=ie));0<xt.data.length&&(qt/=xt.data.length-wt),(ot===void 0||Lt<=ot)&&(Et===void 0||Et<qt)&&1.99<qt&&(ot=Lt,It=rn,Et=qt)}return{successful:!!(y.delimiter=It),bestDelimiter:It}})(Q,y.newline,y.skipEmptyLines,y.comments,y.delimitersToGuess)).successful?y.delimiter=J.bestDelimiter:(A=!0,y.delimiter=c.DefaultDelimiter),$.meta.delimiter=y.delimiter),E(y));return y.preview&&y.header&&J.preview++,v=Q,k=new b(J),$=k.parse(v,et,nt),W(),U?{meta:{paused:!0}}:$||{meta:{paused:!1}}},this.paused=function(){return U},this.pause=function(){U=!0,k.abort(),v=O(y.chunk)?"":v.substring(k.getCharIndex())},this.resume=function(){R.streamer._halted?(U=!1,R.streamer.parseChunk(v,!0)):setTimeout(R.resume,3)},this.aborted=function(){return B},this.abort=function(){B=!0,k.abort(),$.meta.aborted=!0,O(y.complete)&&y.complete($),v=""},this.guessLineEndings=function(ut,J){ut=ut.substring(0,1048576);var J=new RegExp(m(J)+"([^]*?)"+m(J),"gm"),nt=(ut=ut.replace(J,"")).split("\r"),J=ut.split(`
`),ut=1<J.length&&J[0].length<nt[0].length;if(nt.length===1||ut)return`
`;for(var ft=0,gt=0;gt<nt.length;gt++)nt[gt][0]===`
`&&ft++;return ft>=nt.length/2?`\r
`:"\r"}}function m(y){return y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(y){var v=(y=y||{}).delimiter,k=y.newline,A=y.comments,L=y.step,H=y.preview,j=y.fastMode,I=null,M=!1,R=y.quoteChar==null?'"':y.quoteChar,D=R;if(y.escapeChar!==void 0&&(D=y.escapeChar),(typeof v!="string"||-1<c.BAD_DELIMITERS.indexOf(v))&&(v=","),A===v)throw new Error("Comment character same as delimiter");A===!0?A="#":(typeof A!="string"||-1<c.BAD_DELIMITERS.indexOf(A))&&(A=!1),k!==`
`&&k!=="\r"&&k!==`\r
`&&(k=`
`);var P=0,U=!1;this.parse=function(B,z,$){if(typeof B!="string")throw new Error("Input must be a string");var Z=B.length,W=v.length,it=k.length,St=A.length,Q=O(L),et=[],nt=[],J=[],ut=P=0;if(!B)return Lt();if(j||j!==!1&&B.indexOf(R)===-1){for(var ft=B.split(k),gt=0;gt<ft.length;gt++){if(J=ft[gt],P+=J.length,gt!==ft.length-1)P+=k.length;else if($)return Lt();if(!A||J.substring(0,St)!==A){if(Q){if(et=[],Et(J.split(v)),qt(),U)return Lt()}else Et(J.split(v));if(H&&H<=gt)return et=et.slice(0,H),Lt(!0)}}return Lt()}for(var lt=B.indexOf(v,P),st=B.indexOf(k,P),It=new RegExp(m(D)+m(R),"g"),ot=B.indexOf(R,P);;)if(B[P]===R)for(ot=P,P++;;){if((ot=B.indexOf(R,ot+1))===-1)return $||nt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:et.length,index:P}),ie();if(ot===Z-1)return ie(B.substring(P,ot).replace(It,R));if(R===D&&B[ot+1]===D)ot++;else if(R===D||ot===0||B[ot-1]!==D){lt!==-1&&lt<ot+1&&(lt=B.indexOf(v,ot+1));var pt=Re((st=st!==-1&&st<ot+1?B.indexOf(k,ot+1):st)===-1?lt:Math.min(lt,st));if(B.substr(ot+1+pt,W)===v){J.push(B.substring(P,ot).replace(It,R)),B[P=ot+1+pt+W]!==R&&(ot=B.indexOf(R,P)),lt=B.indexOf(v,P),st=B.indexOf(k,P);break}if(pt=Re(st),B.substring(ot+1+pt,ot+1+pt+it)===k){if(J.push(B.substring(P,ot).replace(It,R)),rn(ot+1+pt+it),lt=B.indexOf(v,P),ot=B.indexOf(R,P),Q&&(qt(),U))return Lt();if(H&&et.length>=H)return Lt(!0);break}nt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:et.length,index:P}),ot++}}else if(A&&J.length===0&&B.substring(P,P+St)===A){if(st===-1)return Lt();P=st+it,st=B.indexOf(k,P),lt=B.indexOf(v,P)}else if(lt!==-1&&(lt<st||st===-1))J.push(B.substring(P,lt)),P=lt+W,lt=B.indexOf(v,P);else{if(st===-1)break;if(J.push(B.substring(P,st)),rn(st+it),Q&&(qt(),U))return Lt();if(H&&et.length>=H)return Lt(!0)}return ie();function Et(wt){et.push(wt),ut=P}function Re(wt){var xt=0;return xt=wt!==-1&&(wt=B.substring(ot+1,wt))&&wt.trim()===""?wt.length:xt}function ie(wt){return $||(wt===void 0&&(wt=B.substring(P)),J.push(wt),P=Z,Et(J),Q&&qt()),Lt()}function rn(wt){P=wt,Et(J),J=[],st=B.indexOf(k,P)}function Lt(wt){if(y.header&&!z&&et.length&&!M){var xt=et[0],re=Object.create(null),Cn=new Set(xt);let Xn=!1;for(let ke=0;ke<xt.length;ke++){let oe=xt[ke];if(re[oe=O(y.transformHeader)?y.transformHeader(oe,ke):oe]){let Se,on=re[oe];for(;Se=oe+"_"+on,on++,Cn.has(Se););Cn.add(Se),xt[ke]=Se,re[oe]++,Xn=!0,(I=I===null?{}:I)[Se]=oe}else re[oe]=1,xt[ke]=oe;Cn.add(oe)}Xn&&console.warn("Duplicate headers found and renamed."),M=!0}return{data:et,errors:nt,meta:{delimiter:v,linebreak:k,aborted:U,truncated:!!wt,cursor:ut+(z||0),renamedHeaders:I}}}function qt(){L(Lt()),et=[],nt=[]}},this.abort=function(){U=!0},this.getCharIndex=function(){return P}}function _(y){var v=y.data,k=a[v.workerId],A=!1;if(v.error)k.userError(v.error,v.file);else if(v.results&&v.results.data){var L={abort:function(){A=!0,x(v.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:S,resume:S};if(O(k.userStep)){for(var H=0;H<v.results.data.length&&(k.userStep({data:v.results.data[H],errors:v.results.errors,meta:v.results.meta},L),!A);H++);delete v.results}else O(k.userChunk)&&(k.userChunk(v.results,L,v.file),delete v.results)}v.finished&&!A&&x(v.workerId,v.results)}function x(y,v){var k=a[y];O(k.userComplete)&&k.userComplete(v),k.terminate(),delete a[y]}function S(){throw new Error("Not implemented.")}function E(y){if(typeof y!="object"||y===null)return y;var v,k=Array.isArray(y)?[]:{};for(v in y)k[v]=E(y[v]);return k}function C(y,v){return function(){y.apply(v,arguments)}}function O(y){return typeof y=="function"}return c.parse=function(y,v){var k=(v=v||{}).dynamicTyping||!1;if(O(k)&&(v.dynamicTypingFunction=k,k={}),v.dynamicTyping=k,v.transform=!!O(v.transform)&&v.transform,!v.worker||!c.WORKERS_SUPPORTED)return k=null,c.NODE_STREAM_INPUT,typeof y=="string"?(y=(A=>A.charCodeAt(0)!==65279?A:A.slice(1))(y),k=new(v.download?u:f)(v)):y.readable===!0&&O(y.read)&&O(y.on)?k=new g(v):(s.File&&y instanceof File||y instanceof Object)&&(k=new h(v)),k.stream(y);(k=(()=>{var A;return!!c.WORKERS_SUPPORTED&&(A=(()=>{var L=s.URL||s.webkitURL||null,H=e.toString();return c.BLOB_URL||(c.BLOB_URL=L.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",H,")();"],{type:"text/javascript"})))})(),(A=new s.Worker(A)).onmessage=_,A.id=l++,a[A.id]=A)})()).userStep=v.step,k.userChunk=v.chunk,k.userComplete=v.complete,k.userError=v.error,v.step=O(v.step),v.chunk=O(v.chunk),v.complete=O(v.complete),v.error=O(v.error),delete v.worker,k.postMessage({input:y,config:v,workerId:k.id})},c.unparse=function(y,v){var k=!1,A=!0,L=",",H=`\r
`,j='"',I=j+j,M=!1,R=null,D=!1,P=((()=>{if(typeof v=="object"){if(typeof v.delimiter!="string"||c.BAD_DELIMITERS.filter(function(z){return v.delimiter.indexOf(z)!==-1}).length||(L=v.delimiter),typeof v.quotes!="boolean"&&typeof v.quotes!="function"&&!Array.isArray(v.quotes)||(k=v.quotes),typeof v.skipEmptyLines!="boolean"&&typeof v.skipEmptyLines!="string"||(M=v.skipEmptyLines),typeof v.newline=="string"&&(H=v.newline),typeof v.quoteChar=="string"&&(j=v.quoteChar),typeof v.header=="boolean"&&(A=v.header),Array.isArray(v.columns)){if(v.columns.length===0)throw new Error("Option columns is empty");R=v.columns}v.escapeChar!==void 0&&(I=v.escapeChar+j),v.escapeFormulae instanceof RegExp?D=v.escapeFormulae:typeof v.escapeFormulae=="boolean"&&v.escapeFormulae&&(D=/^[=+\-@\t\r].*$/)}})(),new RegExp(m(j),"g"));if(typeof y=="string"&&(y=JSON.parse(y)),Array.isArray(y)){if(!y.length||Array.isArray(y[0]))return U(null,y,M);if(typeof y[0]=="object")return U(R||Object.keys(y[0]),y,M)}else if(typeof y=="object")return typeof y.data=="string"&&(y.data=JSON.parse(y.data)),Array.isArray(y.data)&&(y.fields||(y.fields=y.meta&&y.meta.fields||R),y.fields||(y.fields=Array.isArray(y.data[0])?y.fields:typeof y.data[0]=="object"?Object.keys(y.data[0]):[]),Array.isArray(y.data[0])||typeof y.data[0]=="object"||(y.data=[y.data])),U(y.fields||[],y.data||[],M);throw new Error("Unable to serialize unrecognized input");function U(z,$,Z){var W="",it=(typeof z=="string"&&(z=JSON.parse(z)),typeof $=="string"&&($=JSON.parse($)),Array.isArray(z)&&0<z.length),St=!Array.isArray($[0]);if(it&&A){for(var Q=0;Q<z.length;Q++)0<Q&&(W+=L),W+=B(z[Q],Q);0<$.length&&(W+=H)}for(var et=0;et<$.length;et++){var nt=(it?z:$[et]).length,J=!1,ut=it?Object.keys($[et]).length===0:$[et].length===0;if(Z&&!it&&(J=Z==="greedy"?$[et].join("").trim()==="":$[et].length===1&&$[et][0].length===0),Z==="greedy"&&it){for(var ft=[],gt=0;gt<nt;gt++){var lt=St?z[gt]:gt;ft.push($[et][lt])}J=ft.join("").trim()===""}if(!J){for(var st=0;st<nt;st++){0<st&&!ut&&(W+=L);var It=it&&St?z[st]:st;W+=B($[et][It],st)}et<$.length-1&&(!Z||0<nt&&!ut)&&(W+=H)}}return W}function B(z,$){var Z,W;return z==null?"":z.constructor===Date?JSON.stringify(z).slice(1,25):(W=!1,D&&typeof z=="string"&&D.test(z)&&(z="'"+z,W=!0),Z=z.toString().replace(P,I),(W=W||k===!0||typeof k=="function"&&k(z,$)||Array.isArray(k)&&k[$]||((it,St)=>{for(var Q=0;Q<St.length;Q++)if(-1<it.indexOf(St[Q]))return!0;return!1})(Z,c.BAD_DELIMITERS)||-1<Z.indexOf(L)||Z.charAt(0)===" "||Z.charAt(Z.length-1)===" ")?j+Z+j:Z)}},c.RECORD_SEP="",c.UNIT_SEP="",c.BYTE_ORDER_MARK="\uFEFF",c.BAD_DELIMITERS=["\r",`
`,'"',c.BYTE_ORDER_MARK],c.WORKERS_SUPPORTED=!r&&!!s.Worker,c.NODE_STREAM_INPUT=1,c.LocalChunkSize=10485760,c.RemoteChunkSize=5242880,c.DefaultDelimiter=",",c.Parser=b,c.ParserHandle=p,c.NetworkStreamer=u,c.FileStreamer=h,c.StringStreamer=f,c.ReadableStreamStreamer=g,s.jQuery&&((i=s.jQuery).fn.parse=function(y){var v=y.config||{},k=[];return this.each(function(H){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var j=0;j<this.files.length;j++)k.push({file:this.files[j],inputElem:this,instanceConfig:i.extend({},v)})}),A(),this;function A(){if(k.length===0)O(y.complete)&&y.complete();else{var H,j,I,M,R=k[0];if(O(y.before)){var D=y.before(R.file,R.inputElem);if(typeof D=="object"){if(D.action==="abort")return H="AbortError",j=R.file,I=R.inputElem,M=D.reason,void(O(y.error)&&y.error({name:H},j,I,M));if(D.action==="skip")return void L();typeof D.config=="object"&&(R.instanceConfig=i.extend(R.instanceConfig,D.config))}else if(D==="skip")return void L()}var P=R.instanceConfig.complete;R.instanceConfig.complete=function(U){O(P)&&P(U,R.file,R.inputElem),L()},c.parse(R.file,R.instanceConfig)}}function L(){k.splice(0,1),A()}}),o&&(s.onmessage=function(y){y=y.data,c.WORKER_ID===void 0&&y&&(c.WORKER_ID=y.workerId),typeof y.input=="string"?s.postMessage({workerId:c.WORKER_ID,results:c.parse(y.input,y.config),finished:!0}):(s.File&&y.input instanceof File||y.input instanceof Object)&&(y=c.parse(y.input,y.config))&&s.postMessage({workerId:c.WORKER_ID,results:y,finished:!0})}),(u.prototype=Object.create(d.prototype)).constructor=u,(h.prototype=Object.create(d.prototype)).constructor=h,(f.prototype=Object.create(f.prototype)).constructor=f,(g.prototype=Object.create(d.prototype)).constructor=g,c})})(Jb);/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:pd,setPrototypeOf:Hl,isFrozen:Xb,getPrototypeOf:Qb,getOwnPropertyDescriptor:Zb}=Object;let{freeze:Zt,seal:fe,create:ao}=Object,{apply:lo,construct:co}=typeof Reflect<"u"&&Reflect;Zt||(Zt=function(t){return t});fe||(fe=function(t){return t});lo||(lo=function(t,e){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return t.apply(e,i)});co||(co=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return new t(...s)});const mi=te(Array.prototype.forEach),t_=te(Array.prototype.lastIndexOf),Wl=te(Array.prototype.pop),rs=te(Array.prototype.push),e_=te(Array.prototype.splice),Ai=te(String.prototype.toLowerCase),Ar=te(String.prototype.toString),Or=te(String.prototype.match),os=te(String.prototype.replace),n_=te(String.prototype.indexOf),s_=te(String.prototype.trim),me=te(Object.prototype.hasOwnProperty),Qt=te(RegExp.prototype.test),as=i_(TypeError);function te(n){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return lo(n,t,s)}}function i_(n){return function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return co(n,e)}}function rt(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ai;Hl&&Hl(n,null);let s=t.length;for(;s--;){let i=t[s];if(typeof i=="string"){const r=e(i);r!==i&&(Xb(t)||(t[s]=r),i=r)}n[i]=!0}return n}function r_(n){for(let t=0;t<n.length;t++)me(n,t)||(n[t]=null);return n}function Ae(n){const t=ao(null);for(const[e,s]of pd(n))me(n,e)&&(Array.isArray(s)?t[e]=r_(s):s&&typeof s=="object"&&s.constructor===Object?t[e]=Ae(s):t[e]=s);return t}function ls(n,t){for(;n!==null;){const s=Zb(n,t);if(s){if(s.get)return te(s.get);if(typeof s.value=="function")return te(s.value)}n=Qb(n)}function e(){return null}return e}const Vl=Zt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Cr=Zt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Rr=Zt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),o_=Zt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Mr=Zt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),a_=Zt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ql=Zt(["#text"]),Gl=Zt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Ir=Zt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yl=Zt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),yi=Zt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),l_=fe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),c_=fe(/<%[\w\W]*|[\w\W]*%>/gm),d_=fe(/\$\{[\w\W]*/gm),u_=fe(/^data-[\-\w.\u00B7-\uFFFF]+$/),h_=fe(/^aria-[\-\w]+$/),md=fe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),f_=fe(/^(?:\w+script|data):/i),g_=fe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),yd=fe(/^html$/i),p_=fe(/^[a-z][.\w]*(-[.\w]+)+$/i);var Kl=Object.freeze({__proto__:null,ARIA_ATTR:h_,ATTR_WHITESPACE:g_,CUSTOM_ELEMENT:p_,DATA_ATTR:u_,DOCTYPE_NAME:yd,ERB_EXPR:c_,IS_ALLOWED_URI:md,IS_SCRIPT_OR_DATA:f_,MUSTACHE_EXPR:l_,TMPLIT_EXPR:d_});const cs={element:1,text:3,progressingInstruction:7,comment:8,document:9},m_=function(){return typeof window>"u"?null:window},y_=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(s=e.getAttribute(i));const r="dompurify"+(s?"#"+s:"");try{return t.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},Jl=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function bd(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:m_();const t=G=>bd(G);if(t.version="3.3.1",t.removed=[],!n||!n.document||n.document.nodeType!==cs.document||!n.Element)return t.isSupported=!1,t;let{document:e}=n;const s=e,i=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:d=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:u,DOMParser:h,trustedTypes:f}=n,g=l.prototype,p=ls(g,"cloneNode"),m=ls(g,"remove"),b=ls(g,"nextSibling"),_=ls(g,"childNodes"),x=ls(g,"parentNode");if(typeof o=="function"){const G=e.createElement("template");G.content&&G.content.ownerDocument&&(e=G.content.ownerDocument)}let S,E="";const{implementation:C,createNodeIterator:O,createDocumentFragment:y,getElementsByTagName:v}=e,{importNode:k}=s;let A=Jl();t.isSupported=typeof pd=="function"&&typeof x=="function"&&C&&C.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:L,ERB_EXPR:H,TMPLIT_EXPR:j,DATA_ATTR:I,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:R,ATTR_WHITESPACE:D,CUSTOM_ELEMENT:P}=Kl;let{IS_ALLOWED_URI:U}=Kl,B=null;const z=rt({},[...Vl,...Cr,...Rr,...Mr,...ql]);let $=null;const Z=rt({},[...Gl,...Ir,...Yl,...yi]);let W=Object.seal(ao(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),it=null,St=null;const Q=Object.seal(ao(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let et=!0,nt=!0,J=!1,ut=!0,ft=!1,gt=!0,lt=!1,st=!1,It=!1,ot=!1,pt=!1,Et=!1,Re=!0,ie=!1;const rn="user-content-";let Lt=!0,qt=!1,wt={},xt=null;const re=rt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Cn=null;const Xn=rt({},["audio","video","img","source","image","track"]);let ke=null;const oe=rt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Se="http://www.w3.org/1998/Math/MathML",on="http://www.w3.org/2000/svg",Me="http://www.w3.org/1999/xhtml";let Rn=Me,er=!1,nr=null;const Zd=rt({},[Se,on,Me],Ar);let Ys=rt({},["mi","mo","mn","ms","mtext"]),Ks=rt({},["annotation-xml"]);const tu=rt({},["title","style","font","a","script"]);let Qn=null;const eu=["application/xhtml+xml","text/html"],nu="text/html";let $t=null,Mn=null;const su=e.createElement("form"),jo=function(w){return w instanceof RegExp||w instanceof Function},sr=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Mn&&Mn===w)){if((!w||typeof w!="object")&&(w={}),w=Ae(w),Qn=eu.indexOf(w.PARSER_MEDIA_TYPE)===-1?nu:w.PARSER_MEDIA_TYPE,$t=Qn==="application/xhtml+xml"?Ar:Ai,B=me(w,"ALLOWED_TAGS")?rt({},w.ALLOWED_TAGS,$t):z,$=me(w,"ALLOWED_ATTR")?rt({},w.ALLOWED_ATTR,$t):Z,nr=me(w,"ALLOWED_NAMESPACES")?rt({},w.ALLOWED_NAMESPACES,Ar):Zd,ke=me(w,"ADD_URI_SAFE_ATTR")?rt(Ae(oe),w.ADD_URI_SAFE_ATTR,$t):oe,Cn=me(w,"ADD_DATA_URI_TAGS")?rt(Ae(Xn),w.ADD_DATA_URI_TAGS,$t):Xn,xt=me(w,"FORBID_CONTENTS")?rt({},w.FORBID_CONTENTS,$t):re,it=me(w,"FORBID_TAGS")?rt({},w.FORBID_TAGS,$t):Ae({}),St=me(w,"FORBID_ATTR")?rt({},w.FORBID_ATTR,$t):Ae({}),wt=me(w,"USE_PROFILES")?w.USE_PROFILES:!1,et=w.ALLOW_ARIA_ATTR!==!1,nt=w.ALLOW_DATA_ATTR!==!1,J=w.ALLOW_UNKNOWN_PROTOCOLS||!1,ut=w.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ft=w.SAFE_FOR_TEMPLATES||!1,gt=w.SAFE_FOR_XML!==!1,lt=w.WHOLE_DOCUMENT||!1,ot=w.RETURN_DOM||!1,pt=w.RETURN_DOM_FRAGMENT||!1,Et=w.RETURN_TRUSTED_TYPE||!1,It=w.FORCE_BODY||!1,Re=w.SANITIZE_DOM!==!1,ie=w.SANITIZE_NAMED_PROPS||!1,Lt=w.KEEP_CONTENT!==!1,qt=w.IN_PLACE||!1,U=w.ALLOWED_URI_REGEXP||md,Rn=w.NAMESPACE||Me,Ys=w.MATHML_TEXT_INTEGRATION_POINTS||Ys,Ks=w.HTML_INTEGRATION_POINTS||Ks,W=w.CUSTOM_ELEMENT_HANDLING||{},w.CUSTOM_ELEMENT_HANDLING&&jo(w.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=w.CUSTOM_ELEMENT_HANDLING.tagNameCheck),w.CUSTOM_ELEMENT_HANDLING&&jo(w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),w.CUSTOM_ELEMENT_HANDLING&&typeof w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(W.allowCustomizedBuiltInElements=w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ft&&(nt=!1),pt&&(ot=!0),wt&&(B=rt({},ql),$=[],wt.html===!0&&(rt(B,Vl),rt($,Gl)),wt.svg===!0&&(rt(B,Cr),rt($,Ir),rt($,yi)),wt.svgFilters===!0&&(rt(B,Rr),rt($,Ir),rt($,yi)),wt.mathMl===!0&&(rt(B,Mr),rt($,Yl),rt($,yi))),w.ADD_TAGS&&(typeof w.ADD_TAGS=="function"?Q.tagCheck=w.ADD_TAGS:(B===z&&(B=Ae(B)),rt(B,w.ADD_TAGS,$t))),w.ADD_ATTR&&(typeof w.ADD_ATTR=="function"?Q.attributeCheck=w.ADD_ATTR:($===Z&&($=Ae($)),rt($,w.ADD_ATTR,$t))),w.ADD_URI_SAFE_ATTR&&rt(ke,w.ADD_URI_SAFE_ATTR,$t),w.FORBID_CONTENTS&&(xt===re&&(xt=Ae(xt)),rt(xt,w.FORBID_CONTENTS,$t)),w.ADD_FORBID_CONTENTS&&(xt===re&&(xt=Ae(xt)),rt(xt,w.ADD_FORBID_CONTENTS,$t)),Lt&&(B["#text"]=!0),lt&&rt(B,["html","head","body"]),B.table&&(rt(B,["tbody"]),delete it.tbody),w.TRUSTED_TYPES_POLICY){if(typeof w.TRUSTED_TYPES_POLICY.createHTML!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof w.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw as('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=w.TRUSTED_TYPES_POLICY,E=S.createHTML("")}else S===void 0&&(S=y_(f,i)),S!==null&&typeof E=="string"&&(E=S.createHTML(""));Zt&&Zt(w),Mn=w}},Fo=rt({},[...Cr,...Rr,...o_]),Uo=rt({},[...Mr,...a_]),iu=function(w){let N=x(w);(!N||!N.tagName)&&(N={namespaceURI:Rn,tagName:"template"});const V=Ai(w.tagName),Tt=Ai(N.tagName);return nr[w.namespaceURI]?w.namespaceURI===on?N.namespaceURI===Me?V==="svg":N.namespaceURI===Se?V==="svg"&&(Tt==="annotation-xml"||Ys[Tt]):!!Fo[V]:w.namespaceURI===Se?N.namespaceURI===Me?V==="math":N.namespaceURI===on?V==="math"&&Ks[Tt]:!!Uo[V]:w.namespaceURI===Me?N.namespaceURI===on&&!Ks[Tt]||N.namespaceURI===Se&&!Ys[Tt]?!1:!Uo[V]&&(tu[V]||!Fo[V]):!!(Qn==="application/xhtml+xml"&&nr[w.namespaceURI]):!1},Ee=function(w){rs(t.removed,{element:w});try{x(w).removeChild(w)}catch{m(w)}},an=function(w,N){try{rs(t.removed,{attribute:N.getAttributeNode(w),from:N})}catch{rs(t.removed,{attribute:null,from:N})}if(N.removeAttribute(w),w==="is")if(ot||pt)try{Ee(N)}catch{}else try{N.setAttribute(w,"")}catch{}},zo=function(w){let N=null,V=null;if(It)w="<remove></remove>"+w;else{const Pt=Or(w,/^[\r\n\t ]+/);V=Pt&&Pt[0]}Qn==="application/xhtml+xml"&&Rn===Me&&(w='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+w+"</body></html>");const Tt=S?S.createHTML(w):w;if(Rn===Me)try{N=new h().parseFromString(Tt,Qn)}catch{}if(!N||!N.documentElement){N=C.createDocument(Rn,"template",null);try{N.documentElement.innerHTML=er?E:Tt}catch{}}const Gt=N.body||N.documentElement;return w&&V&&Gt.insertBefore(e.createTextNode(V),Gt.childNodes[0]||null),Rn===Me?v.call(N,lt?"html":"body")[0]:lt?N.documentElement:Gt},Ho=function(w){return O.call(w.ownerDocument||w,w,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},ir=function(w){return w instanceof u&&(typeof w.nodeName!="string"||typeof w.textContent!="string"||typeof w.removeChild!="function"||!(w.attributes instanceof d)||typeof w.removeAttribute!="function"||typeof w.setAttribute!="function"||typeof w.namespaceURI!="string"||typeof w.insertBefore!="function"||typeof w.hasChildNodes!="function")},Wo=function(w){return typeof a=="function"&&w instanceof a};function Ie(G,w,N){mi(G,V=>{V.call(t,w,N,Mn)})}const Vo=function(w){let N=null;if(Ie(A.beforeSanitizeElements,w,null),ir(w))return Ee(w),!0;const V=$t(w.nodeName);if(Ie(A.uponSanitizeElement,w,{tagName:V,allowedTags:B}),gt&&w.hasChildNodes()&&!Wo(w.firstElementChild)&&Qt(/<[/\w!]/g,w.innerHTML)&&Qt(/<[/\w!]/g,w.textContent)||w.nodeType===cs.progressingInstruction||gt&&w.nodeType===cs.comment&&Qt(/<[/\w]/g,w.data))return Ee(w),!0;if(!(Q.tagCheck instanceof Function&&Q.tagCheck(V))&&(!B[V]||it[V])){if(!it[V]&&Go(V)&&(W.tagNameCheck instanceof RegExp&&Qt(W.tagNameCheck,V)||W.tagNameCheck instanceof Function&&W.tagNameCheck(V)))return!1;if(Lt&&!xt[V]){const Tt=x(w)||w.parentNode,Gt=_(w)||w.childNodes;if(Gt&&Tt){const Pt=Gt.length;for(let ee=Pt-1;ee>=0;--ee){const Le=p(Gt[ee],!0);Le.__removalCount=(w.__removalCount||0)+1,Tt.insertBefore(Le,b(w))}}}return Ee(w),!0}return w instanceof l&&!iu(w)||(V==="noscript"||V==="noembed"||V==="noframes")&&Qt(/<\/no(script|embed|frames)/i,w.innerHTML)?(Ee(w),!0):(ft&&w.nodeType===cs.text&&(N=w.textContent,mi([L,H,j],Tt=>{N=os(N,Tt," ")}),w.textContent!==N&&(rs(t.removed,{element:w.cloneNode()}),w.textContent=N)),Ie(A.afterSanitizeElements,w,null),!1)},qo=function(w,N,V){if(Re&&(N==="id"||N==="name")&&(V in e||V in su))return!1;if(!(nt&&!St[N]&&Qt(I,N))){if(!(et&&Qt(M,N))){if(!(Q.attributeCheck instanceof Function&&Q.attributeCheck(N,w))){if(!$[N]||St[N]){if(!(Go(w)&&(W.tagNameCheck instanceof RegExp&&Qt(W.tagNameCheck,w)||W.tagNameCheck instanceof Function&&W.tagNameCheck(w))&&(W.attributeNameCheck instanceof RegExp&&Qt(W.attributeNameCheck,N)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(N,w))||N==="is"&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&Qt(W.tagNameCheck,V)||W.tagNameCheck instanceof Function&&W.tagNameCheck(V))))return!1}else if(!ke[N]){if(!Qt(U,os(V,D,""))){if(!((N==="src"||N==="xlink:href"||N==="href")&&w!=="script"&&n_(V,"data:")===0&&Cn[w])){if(!(J&&!Qt(R,os(V,D,"")))){if(V)return!1}}}}}}}return!0},Go=function(w){return w!=="annotation-xml"&&Or(w,P)},Yo=function(w){Ie(A.beforeSanitizeAttributes,w,null);const{attributes:N}=w;if(!N||ir(w))return;const V={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$,forceKeepAttr:void 0};let Tt=N.length;for(;Tt--;){const Gt=N[Tt],{name:Pt,namespaceURI:ee,value:Le}=Gt,In=$t(Pt),rr=Le;let Ht=Pt==="value"?rr:s_(rr);if(V.attrName=In,V.attrValue=Ht,V.keepAttr=!0,V.forceKeepAttr=void 0,Ie(A.uponSanitizeAttribute,w,V),Ht=V.attrValue,ie&&(In==="id"||In==="name")&&(an(Pt,w),Ht=rn+Ht),gt&&Qt(/((--!?|])>)|<\/(style|title|textarea)/i,Ht)){an(Pt,w);continue}if(In==="attributename"&&Or(Ht,"href")){an(Pt,w);continue}if(V.forceKeepAttr)continue;if(!V.keepAttr){an(Pt,w);continue}if(!ut&&Qt(/\/>/i,Ht)){an(Pt,w);continue}ft&&mi([L,H,j],Jo=>{Ht=os(Ht,Jo," ")});const Ko=$t(w.nodeName);if(!qo(Ko,In,Ht)){an(Pt,w);continue}if(S&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!ee)switch(f.getAttributeType(Ko,In)){case"TrustedHTML":{Ht=S.createHTML(Ht);break}case"TrustedScriptURL":{Ht=S.createScriptURL(Ht);break}}if(Ht!==rr)try{ee?w.setAttributeNS(ee,Pt,Ht):w.setAttribute(Pt,Ht),ir(w)?Ee(w):Wl(t.removed)}catch{an(Pt,w)}}Ie(A.afterSanitizeAttributes,w,null)},ru=function G(w){let N=null;const V=Ho(w);for(Ie(A.beforeSanitizeShadowDOM,w,null);N=V.nextNode();)Ie(A.uponSanitizeShadowNode,N,null),Vo(N),Yo(N),N.content instanceof r&&G(N.content);Ie(A.afterSanitizeShadowDOM,w,null)};return t.sanitize=function(G){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},N=null,V=null,Tt=null,Gt=null;if(er=!G,er&&(G="<!-->"),typeof G!="string"&&!Wo(G))if(typeof G.toString=="function"){if(G=G.toString(),typeof G!="string")throw as("dirty is not a string, aborting")}else throw as("toString is not a function");if(!t.isSupported)return G;if(st||sr(w),t.removed=[],typeof G=="string"&&(qt=!1),qt){if(G.nodeName){const Le=$t(G.nodeName);if(!B[Le]||it[Le])throw as("root node is forbidden and cannot be sanitized in-place")}}else if(G instanceof a)N=zo("<!---->"),V=N.ownerDocument.importNode(G,!0),V.nodeType===cs.element&&V.nodeName==="BODY"||V.nodeName==="HTML"?N=V:N.appendChild(V);else{if(!ot&&!ft&&!lt&&G.indexOf("<")===-1)return S&&Et?S.createHTML(G):G;if(N=zo(G),!N)return ot?null:Et?E:""}N&&It&&Ee(N.firstChild);const Pt=Ho(qt?G:N);for(;Tt=Pt.nextNode();)Vo(Tt),Yo(Tt),Tt.content instanceof r&&ru(Tt.content);if(qt)return G;if(ot){if(pt)for(Gt=y.call(N.ownerDocument);N.firstChild;)Gt.appendChild(N.firstChild);else Gt=N;return($.shadowroot||$.shadowrootmode)&&(Gt=k.call(s,Gt,!0)),Gt}let ee=lt?N.outerHTML:N.innerHTML;return lt&&B["!doctype"]&&N.ownerDocument&&N.ownerDocument.doctype&&N.ownerDocument.doctype.name&&Qt(yd,N.ownerDocument.doctype.name)&&(ee="<!DOCTYPE "+N.ownerDocument.doctype.name+`>
`+ee),ft&&mi([L,H,j],Le=>{ee=os(ee,Le," ")}),S&&Et?S.createHTML(ee):ee},t.setConfig=function(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};sr(G),st=!0},t.clearConfig=function(){Mn=null,st=!1},t.isValidAttribute=function(G,w,N){Mn||sr({});const V=$t(G),Tt=$t(w);return qo(V,Tt,N)},t.addHook=function(G,w){typeof w=="function"&&rs(A[G],w)},t.removeHook=function(G,w){if(w!==void 0){const N=t_(A[G],w);return N===-1?void 0:e_(A[G],N,1)[0]}return Wl(A[G])},t.removeHooks=function(G){A[G]=[]},t.removeAllHooks=function(){A=Jl()},t}var b_=bd();dt.extend(Kb);const Ut={STORAGE_KEY:"qnb_tracker_v4",DEFAULT_FX:{USD:3.65,EUR:3.95,GBP:4.6,SAR:.97},SUPABASE_URL:"https://fihxypjmvizgwinozjsf.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpaHh5cGptdml6Z3dpbm96anNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzMwMzgsImV4cCI6MjA4NTc0OTAzOH0.t-7r7VgDHOMhM6hB57-PNm8h-By8VKgiUUtxfs8Z4sE",FUNCTIONS_BASE:"https://fihxypjmvizgwinozjsf.supabase.co/functions/v1",SHORTCUT_TEMPLATE_URL:"YOUR_SHORTCUT_TEMPLATE_URL",AUTH_REDIRECT_URL:"https://www.fact.qa/flow/"},zt=Bf(Ut.SUPABASE_URL,Ut.SUPABASE_ANON_KEY),ge={Groceries:{color:"#4CAF50",icon:"",essential:!0},Dining:{color:"#E67E22",icon:"",essential:!1},"Bars & Nightlife":{color:"#AB47BC",icon:"",essential:!1},Coffee:{color:"#795548",icon:"",essential:!1},Delivery:{color:"#FFA726",icon:"",essential:!1},Shopping:{color:"#42A5F5",icon:"",essential:!1},Transport:{color:"#26C6DA",icon:"",essential:!0},Health:{color:"#66BB6A",icon:"",essential:!0},Bills:{color:"#78909C",icon:"",essential:!0},Travel:{color:"#FF7043",icon:"",essential:!1},Entertainment:{color:"#EC407A",icon:"",essential:!1},Transfer:{color:"#8D6E63",icon:"",essential:!1},Family:{color:"#E91E63",icon:"",essential:!1},Other:{color:"#95A5A6",icon:"",essential:!1},Uncategorized:{color:"#E74C3C",icon:"",essential:!1}},__={Micro:{max:25,color:"#BDC3C7",icon:""},Small:{max:100,color:"#95A5A6",icon:""},Medium:{max:500,color:"#7F8C8D",icon:""},Large:{max:2e3,color:"#34495E",icon:""},Major:{max:1/0,color:"#2C3E50",icon:""}},_d={Routine:{color:"#3498DB",icon:"",description:"Regular, repeated spending"},"Night Out":{color:"#9B59B6",icon:"",description:"Evening social spending cluster"},Splurge:{color:"#E74C3C",icon:"",description:"Unusually large purchase"},Trip:{color:"#E67E22",icon:"",description:"Travel-related cluster"},Subscription:{color:"#1ABC9C",icon:"",description:"Recurring fixed amount"},"Work Expense":{color:"#3498DB",icon:"",description:"Likely work-related"},Normal:{color:"#95A5A6",icon:"",description:"Standard transaction"}},en={Essentials:{color:"#75B876",icon:"",types:["Groceries","Bills","Health","Transport"]},"Food & Drinks":{color:"#F4C44E",icon:"",types:["Dining","Coffee","Delivery","Bars & Nightlife"]},"Shopping & Fun":{color:"#9B8AC4",icon:"",types:["Shopping","Entertainment","Travel"]},Family:{color:"#E8A4B8",icon:"",types:["Family"]},Other:{color:"#A8B5C4",icon:"",types:["Transfer","Other","Uncategorized"]}},ze={};Object.entries(ge).forEach(([n,t])=>ze[n]=t.color);Object.entries(en).forEach(([n,t])=>ze[n]=t.color);function v_(n){for(const[t,e]of Object.entries(en))if(e.types.includes(n))return t;return"Other"}function w_(n){const t=n.hour(),e=n.day(),s=[];return(e===5||e===6)&&s.push("Weekend"),t>=7&&t<16&&e>=0&&e<=4&&s.push("Work Hours"),t>=17&&t<21&&s.push("Evening"),(t>=21||t<5)&&s.push("Late Night"),t>=5&&t<7&&s.push("Early Morning"),s.length>0?s:["Normal"]}function x_(n){for(const[t,e]of Object.entries(__))if(n<=e.max)return t;return"Major"}function vd(n){var t;return((t=ge[n])==null?void 0:t.color)||"#95A5A6"}function k_(n){var t;return((t=en[n])==null?void 0:t.color)||"#95A5A6"}const T={allTxns:[],filtered:[],merchantMap:[],recipients:[],categories:new Set,fxRates:{...Ut.DEFAULT_FX},localMappings:{},userContext:[],period:"salary",dateRange:{start:dt().subtract(60,"day"),end:dt()},catTarget:null,currentUser:"default",viewMode:"parent",hasLoaded:!1},he={};document.addEventListener("DOMContentLoaded",async()=>{var t;const{data:n}=await zt.auth.getSession();(t=n==null?void 0:n.session)!=null&&t.user?uo(n.session.user):(document.getElementById("loginScreen").classList.remove("hidden"),document.getElementById("mainApp").classList.add("hidden")),zt.auth.onAuthStateChange((e,s)=>{e==="SIGNED_IN"&&(s!=null&&s.user)&&uo(s.user),e==="SIGNED_OUT"&&(document.getElementById("loginScreen").classList.remove("hidden"),document.getElementById("mainApp").classList.add("hidden"))})});async function S_(){const n=document.getElementById("loginUsername").value.trim();if(!n)return Lr("Please enter your email");const t=document.getElementById("loginBtn");t.textContent="Sending link...",t.disabled=!0;try{const{error:e}=await zt.auth.signInWithOtp({email:n,options:{emailRedirectTo:Ut.AUTH_REDIRECT_URL}});if(e)throw e;Lr("Magic link sent. Check your email.",!1)}catch(e){Lr(e.message||"Login failed")}finally{t.textContent="Send magic link",t.disabled=!1}}async function E_(){await zt.auth.signInWithOAuth({provider:"google",options:{redirectTo:Ut.AUTH_REDIRECT_URL}})}function Lr(n,t=!0){const e=document.getElementById("loginError");e.textContent=n,e.classList.remove("hidden"),e.classList.toggle("text-fact-red",t),e.classList.toggle("text-fact-green",!t),setTimeout(()=>e.classList.add("hidden"),4e3)}async function uo(n){document.getElementById("loginScreen").classList.add("hidden"),document.getElementById("mainApp").classList.remove("hidden"),T.currentUser=n.email||"user",T.authToken=null;const t=document.getElementById("currentUserDisplay");t.textContent=(n.email||"User").split("@")[0];const e=document.getElementById("aiModelName");e&&(e.textContent=localStorage.getItem("fact_ai_model")||"gpt-5-mini"),window.location.hash&&window.location.hash.includes("access_token")&&history.replaceState(null,"",window.location.pathname+window.location.search),L_(),await Ed(),A_();const s=document.getElementById("txnSearch"),i=document.getElementById("txnFilter");s&&s.addEventListener("input",hv(Ql,200)),i&&i.addEventListener("change",Ql)}async function T_(){await zt.auth.signOut(),location.reload()}const wd=[{id:"qnb",name:"QNB (Qatar National Bank)",icon:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>',supported:!0},{id:"other",name:"Other banks",icon:'<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>',supported:!1}];let Qe=0;const ho=["welcome","bank","key","shortcut","test","done"];async function A_(){try{const{data:n}=await zt.auth.getSession();if(!(n!=null&&n.session))return;const t=n.session.access_token,e=n.session.user.id,[s,i]=await Promise.all([zt.from("raw_ledger").select("id",{count:"exact",head:!0}).eq("user_id",e),zt.from("user_keys").select("id",{count:"exact",head:!0}).eq("user_id",e).is("revoked_at",null)]),r=(s.count||0)>0,o=(i.count||0)>0;!r&&!o&&xd()}catch{}}function xd(){Qe=0,Do(),document.getElementById("onboardingModal").classList.remove("hidden")}function kd(){document.getElementById("onboardingModal").classList.add("hidden")}function O_(){if(Qe===ho.length-1){kd();return}Qe++,Do()}function C_(){Qe>0&&(Qe--,Do())}function Do(){const n=ho[Qe],t=document.getElementById("onboardingContent"),e=document.getElementById("onboardingProgress"),s=document.getElementById("onboardingBack"),i=document.getElementById("onboardingNext"),r=(Qe+1)/ho.length*100;e.style.width=r+"%",s.classList.toggle("hidden",Qe===0),n==="welcome"?(i.textContent="Get Started",t.innerHTML=`
            <div class="flex-1 flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center bg-[#0a0a0a]">
                    <img src="icon-512.png" alt="FACT/Flow" class="w-12 h-12 object-contain">
                </div>
                <h2 class="font-display font-bold text-xl">Welcome to FACT/Flow</h2>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted max-w-xs">
                    Let's set up automatic transaction tracking. Your bank SMS messages will be securely parsed and categorized.
                </p>
                <div class="flex items-center gap-2 text-xs text-fact-green">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                    <span>End-to-end encrypted. Your data stays yours.</span>
                </div>
            </div>`):n==="bank"?(i.textContent="Next",t.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Select Your Bank</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">Choose the bank whose SMS alerts you want to track.</p>
            <div class="space-y-3 flex-1">
                ${wd.map(o=>`
                    <button onclick="selectOnboardingBank('${o.id}')" id="bankOpt_${o.id}"
                        class="w-full flex items-center gap-3 p-4 border-2 rounded-xl transition text-left
                            ${o.id==="qnb"?"border-fact-yellow bg-fact-yellow/5":"border-fact-border dark:border-fact-dark-border"}
                            ${o.supported?"hover:border-fact-yellow cursor-pointer":"opacity-50"}">
                        <div class="w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center flex-shrink-0">
                            ${o.icon}
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-sm">${o.name}</div>
                            ${o.supported?'<div class="text-xs text-fact-green">Supported</div>':'<div class="text-xs text-fact-muted">Coming soon</div>'}
                        </div>
                        ${o.id==="qnb"?'<svg class="w-5 h-5 text-fact-yellow flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>':""}
                    </button>
                `).join("")}
            </div>`):n==="key"?(i.textContent="Next",t.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Generate Your API Key</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">This key connects your iOS Shortcut to FACT/Flow securely.</p>
            <div class="flex-1 space-y-4">
                <button onclick="onboardingGenerateKey()" id="onboardingGenKeyBtn"
                    class="w-full px-4 py-3 text-sm bg-fact-ink dark:bg-white text-white dark:text-fact-ink rounded-xl font-medium hover:opacity-90 transition min-h-[48px]">
                    Generate API Key
                </button>
                <div id="onboardingKeyResult" class="hidden space-y-3">
                    <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl">
                        <label class="block text-xs font-medium text-fact-muted dark:text-fact-dark-muted mb-1">Your API Key</label>
                        <div class="flex items-center gap-2">
                            <input type="text" id="onboardingKeyValue" readonly
                                class="flex-1 text-xs font-mono bg-transparent border-none focus:outline-none select-all">
                            <button onclick="copyOnboardingKey()" class="px-3 py-1.5 text-xs bg-fact-yellow text-fact-ink rounded-lg font-medium hover:opacity-80 transition">
                                Copy
                            </button>
                        </div>
                    </div>
                    <div class="flex items-start gap-2 text-xs text-fact-muted dark:text-fact-dark-muted">
                        <svg class="w-4 h-4 text-fact-yellow flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span>Save this key somewhere safe. You'll paste it into the iOS Shortcut in the next step.</span>
                    </div>
                </div>
                <p id="onboardingKeyStatus" class="text-xs text-fact-muted dark:text-fact-dark-muted"></p>
            </div>`):n==="shortcut"?(i.textContent="Next",t.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Install the iOS Shortcut</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">The Shortcut sends your bank SMS messages to FACT/Flow automatically.</p>
            <div class="flex-1 space-y-4">
                <ol class="space-y-3 text-sm">
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">1</span>
                        <span>Tap the button below to open the Shortcut template on your iPhone.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">2</span>
                        <span>Tap <strong>"Add Shortcut"</strong> when prompted.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-yellow/20 text-fact-yellow flex items-center justify-center flex-shrink-0 text-xs font-bold">3</span>
                        <span>Edit the Shortcut and paste your <strong>API Key</strong> and <strong>Supabase URL</strong> into the text fields.</span>
                    </li>
                </ol>
                <a href="${Ut.SHORTCUT_TEMPLATE_URL}" target="_blank"
                    class="inline-flex items-center justify-center w-full px-4 py-3 text-sm bg-fact-ink dark:bg-white text-white dark:text-fact-ink rounded-xl font-medium hover:opacity-90 transition min-h-[48px]">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Get Shortcut Template
                </a>
                <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-xl">
                    <label class="block text-xs font-medium text-fact-muted dark:text-fact-dark-muted mb-1">Supabase URL (paste into Shortcut)</label>
                    <div class="flex items-center gap-2">
                        <input type="text" value="${Ut.FUNCTIONS_BASE}/flow-sms" readonly
                            class="flex-1 text-xs font-mono bg-transparent border-none focus:outline-none select-all">
                        <button onclick="navigator.clipboard.writeText('${Ut.FUNCTIONS_BASE}/flow-sms')" class="px-3 py-1.5 text-xs bg-fact-yellow text-fact-ink rounded-lg font-medium hover:opacity-80 transition">
                            Copy
                        </button>
                    </div>
                </div>
            </div>`):n==="test"?(i.textContent="Next",t.innerHTML=`
            <h2 class="font-display font-semibold text-lg">Test Your Setup</h2>
            <p class="text-sm text-fact-muted dark:text-fact-dark-muted">Send a test to make sure everything is connected.</p>
            <div class="flex-1 space-y-4">
                <ol class="space-y-3 text-sm">
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">1</span>
                        <span>Open your <strong>Messages</strong> app on iPhone.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">2</span>
                        <span>Find a recent QNB bank SMS (purchase or transfer alert).</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <span class="w-6 h-6 rounded-full bg-fact-green/20 text-fact-green flex items-center justify-center flex-shrink-0 text-xs font-bold">3</span>
                        <span>Long-press the message, tap <strong>Share</strong>, and choose the <strong>FACT/Flow</strong> Shortcut.</span>
                    </li>
                </ol>
                <div class="p-4 bg-fact-yellow/10 rounded-xl text-center">
                    <p class="text-sm font-medium">After sharing, refresh this page to see the transaction appear.</p>
                    <p class="text-xs text-fact-muted mt-1">You can skip this and test later.</p>
                </div>
            </div>`):n==="done"&&(i.textContent="Start Using FACT/Flow",t.innerHTML=`
            <div class="flex-1 flex flex-col items-center justify-center text-center space-y-4">
                <div class="w-16 h-16 rounded-full bg-fact-green/20 flex items-center justify-center">
                    <svg class="w-8 h-8 text-fact-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                </div>
                <h2 class="font-display font-bold text-xl">You're All Set!</h2>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted max-w-xs">
                    Transactions will be tracked automatically whenever you share a bank SMS via the Shortcut.
                </p>
                <div class="space-y-2 text-xs text-fact-muted dark:text-fact-dark-muted">
                    <p>You can always access setup again from <strong>Settings</strong>.</p>
                </div>
            </div>`)}function R_(n){wd.forEach(t=>{const e=document.getElementById("bankOpt_"+t.id);e&&(e.classList.toggle("border-fact-yellow",t.id===n),e.classList.toggle("bg-fact-yellow/5",t.id===n),e.classList.toggle("border-fact-border",t.id!==n),e.classList.toggle("dark:border-fact-dark-border",t.id!==n))})}async function M_(){var e;const n=document.getElementById("onboardingGenKeyBtn"),t=document.getElementById("onboardingKeyStatus");n.textContent="Generating...",n.disabled=!0;try{const{data:s}=await zt.auth.getSession(),i=(e=s==null?void 0:s.session)==null?void 0:e.access_token;if(!i)throw new Error("Not authenticated");const o=await(await fetch(`${Ut.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({action:"create"})})).json();if(o.error)throw new Error(o.error);localStorage.setItem("fact_shortcut_key_id",o.keyId||""),document.getElementById("onboardingKeyValue").value=o.key,document.getElementById("onboardingKeyResult").classList.remove("hidden"),n.classList.add("hidden"),t.textContent=""}catch(s){t.textContent="Error: "+s.message,n.textContent="Generate API Key",n.disabled=!1}}function I_(){const n=document.getElementById("onboardingKeyValue");navigator.clipboard.writeText(n.value);const t=n.parentElement.querySelector("button");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},1500)}function Sd(){return`${Ut.STORAGE_KEY}_${T.currentUser}`}function L_(){try{const n=localStorage.getItem(Sd());if(n){const t=JSON.parse(n);T.localMappings=t.mappings||{}}}catch{}}function P_(){localStorage.setItem(Sd(),JSON.stringify({mappings:T.localMappings}))}async function Ed(){var n;document.getElementById("loadingState").classList.remove("hidden"),document.getElementById("mainContent").classList.add("hidden");try{const{data:t}=await zt.auth.getSession(),e=(n=t==null?void 0:t.session)==null?void 0:n.access_token;if(!e)throw new Error("AUTH_REQUIRED");const s=await fetch(`${Ut.FUNCTIONS_BASE}/flow-data`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({sheets:["RawLedger","MerchantMap","FXRates","UserContext","Recipients"]})});if(s.status===401)throw new Error("AUTH_REQUIRED");const i=await s.json();if((i==null?void 0:i.code)==="AUTH_REQUIRED"||(i==null?void 0:i.error)==="AUTH_REQUIRED")throw new Error("AUTH_REQUIRED");if(i!=null&&i.error)throw new Error(i.error);const r=i==null?void 0:i.data;if(!r)throw new Error("No data returned");r.FXRates&&D_(r.FXRates.slice(1)),r.MerchantMap&&$_(r.MerchantMap),r.UserContext&&B_(r.UserContext),r.Recipients&&N_(r.Recipients),r.RawLedger&&W_(r.RawLedger),document.getElementById("lastSync").textContent=`Synced ${dt().format("HH:mm")}`,document.getElementById("loadingState").classList.add("hidden"),document.getElementById("mainContent").classList.remove("hidden"),T.period==="salary"||!T.hasLoaded?(T.hasLoaded=!0,Td()):Od(T.period),T.hasLoaded&&typeof jt=="function"&&jt(`Synced ${T.allTxns.length} transactions`,"success"),typeof zs=="function"&&setTimeout(()=>zs(),1e3),typeof po=="function"&&setTimeout(()=>po(),3e3)}catch(t){if(console.error("Sync error:",t),String(t.message||t).includes("AUTH_REQUIRED")){await zt.auth.signOut(),document.getElementById("loginScreen").classList.remove("hidden"),document.getElementById("mainApp").classList.add("hidden");return}typeof jt=="function"?jt("Sync failed: "+t.message,"error"):alert("Sync failed. Check your connection.")}}function D_(n){n.forEach(t=>{const e=mt(t[0]),s=parseFloat(t[1]);e&&!isNaN(s)&&(T.fxRates[e]=s)})}function $_(n){var t;n.length&&((t=n[0][0])!=null&&t.toLowerCase().includes("pattern"))&&n.shift(),T.merchantMap=[],T.categories.clear(),n.forEach(e=>{const s=mt(e[0]).toLowerCase(),i=mt(e[1]),r=mt(e[2])||i,o=mt(e[3]);s&&o&&(T.merchantMap.push({pattern:s,display:i,consolidated:r,category:o}),T.categories.add(o))}),T.categories.add("Uncategorized"),Mv()}function B_(n){var t;n.length&&((t=n[0][0])!=null&&t.toLowerCase().includes("type"))&&n.shift(),T.userContext=n.map(e=>({type:mt(e[0]),key:mt(e[1]),value:mt(e[2]),details:mt(e[3]),dateAdded:mt(e[4]),source:mt(e[5])})).filter(e=>e.type&&e.value),console.log("[Data] Loaded",T.userContext.length,"user context entries")}function N_(n){var t;n.length&&((t=n[0][0])!=null&&t.toString().toLowerCase().includes("phone"))&&n.shift(),T.recipients=n.map(e=>({id:mt(e[4])||null,phone:j_(String(e[0]||"")),bankAccount:mt(e[1]),shortName:mt(e[2]),longName:mt(e[3])})).filter(e=>e.shortName||e.longName),console.log("[Data] Loaded",T.recipients.length,"recipients")}function j_(n){if(!n)return"";let t=n.replace(/\D/g,"");return t.startsWith("974")&&t.length>8&&(t=t.slice(3)),t}function F_(n){if(!n||!T.recipients.length)return null;const t=n.toLowerCase(),e=n.replace(/\D/g,"");for(const s of T.recipients){if(s.phone&&e.includes(s.phone))return{...s,matchType:"phone"};if(s.bankAccount){const i=s.bankAccount.toLowerCase(),r=s.bankAccount.slice(-4);if(t.includes(i)||e.includes(r))return{...s,matchType:"account"}}if(s.longName){const i=s.longName.toLowerCase().split(/\s+/).filter(r=>r.length>2);for(const r of i)if(t.includes(r))return{...s,matchType:"name"}}if(s.shortName&&t.includes(s.shortName.toLowerCase()))return{...s,matchType:"shortName"}}return null}function U_(n){const t=[];for(const e of T.userContext){const s=e.key.toLowerCase();e.value.toLowerCase();const i=`${n.raw} ${n.counterparty} ${n.display}`.toLowerCase(),r=`qar ${Math.round(n.amount)}`;(i.includes(s)||r===s.replace(/\s+/g," ").trim()||s.includes("to ")&&n.counterparty.toLowerCase().includes(s.replace("to ","")))&&t.push(e)}return t}function z_(n){const t=U_(n);for(const e of t){const s=e.value.toLowerCase();if(s.includes("not a splurge")||s.includes("not splurge")||s.includes("is my")||s.includes("is actually")||s.includes("bill")||s.includes("rent")||s.includes("subscription")||s.includes("regular"))return!0}return!1}function H_(n){const t=mt(n),e=parseFloat(t);if(!isNaN(e)&&e>4e4&&e<6e4){const i=Math.floor(e),r=e-i,o=24*60*60*1e3,l=Date.UTC(1899,11,30)+i*o,c=new Date(l),d=c.getUTCFullYear(),u=c.getUTCMonth(),h=c.getUTCDate(),f=Math.round(r*24*60),g=Math.floor(f/60),p=f%60,m=dt(new Date(d,u,h,g,p));return m.isValid()?m:dt()}const s=dt(t);return s.isValid()?s:dt()}function W_(n){const t=n[0]||[],e=t.length>=10&&(mt(t[7])==="Category"||mt(t[8])==="Category"),s=e?{ts:0,amount:1,currency:2,counterparty:3,card:4,direction:5,txnType:6,category:7,subcategory:8,confidence:9,context:10,raw:11}:{ts:0,amount:1,currency:2,counterparty:3,card:4,direction:5,txnType:6,raw:7},i=n.filter(r=>mt(r[1])!=="Amount"&&!isNaN(parseFloat(r[1])));T.allTxns=i.map(r=>{var y;const o=mt(r[s.raw]),a=mt(r[s.counterparty])||"",l=mt(r[s.card])||"",c=mt(r[s.currency])||"QAR",d=parseFloat(r[s.amount]),u=T.fxRates[c]||1,h=c==="QAR"?d:d*u,f=H_(r[s.ts]);let g=null,p=null,m=null;if(e){g=mt(r[s.subcategory])||mt(r[s.category])||null,p=mt(r[s.confidence])||null;try{m=r[s.context]?JSON.parse(mt(r[s.context])):null}catch{m=null}}const b=V_(o,g),_=mt(r[s.txnType]),S=`${o} ${a} ${l} ${_}`.toLowerCase().includes("salary"),E={what:b.merchantType,when:w_(f),size:x_(h),pattern:"Normal"},O=["transfer","fawran","internal transfer"].some(v=>_.toLowerCase().includes(v)||o.toLowerCase().includes(v))?F_(a):null;return{date:f,amount:h,currency:c,raw:o,counterparty:a,card:l,display:b.display,consolidated:b.consolidated,merchantType:b.merchantType,summaryGroup:v_(b.merchantType),direction:mt(r[s.direction]),txnType:_,confidence:p,aiContext:m,isSalary:S,recipient:O,resolvedName:(O==null?void 0:O.shortName)||null,resolvedLongName:(O==null?void 0:O.longName)||null,dims:E,isWorkHours:E.when.includes("Work Hours"),isLateNight:E.when.includes("Late Night"),isWeekend:E.when.includes("Weekend"),isLarge:E.size==="Large"||E.size==="Major",isEssential:((y=ge[b.merchantType])==null?void 0:y.essential)||!1}}).sort((r,o)=>o.date-r.date),q_()}function V_(n,t=null){const e=n.toLowerCase();if(T.localMappings[e]){const i=T.localMappings[e];return{display:i.display,consolidated:i.consolidated,merchantType:i.merchantType||i.category||"Other"}}if(t&&ge[t])return{display:n,consolidated:n,merchantType:t};const s=T.merchantMap.find(i=>e.includes(i.pattern));if(s){const r={Groceries:"Groceries",Dining:"Dining","Bars & Hotels":"Bars & Nightlife",Delivery:"Delivery",Shopping:"Shopping",Hobbies:"Entertainment",Bills:"Bills",Transport:"Transport",Travel:"Travel",Health:"Health","Family Transfers":"Family",Family:"Family",Transfers:"Transfer",Fees:"Transfer"}[s.category]||s.category||"Other";return{display:s.display,consolidated:s.consolidated,merchantType:r}}return{display:n,consolidated:n,merchantType:"Uncategorized"}}function q_(){const n=T.allTxns.filter(i=>i.direction==="OUT"),t={};n.forEach(i=>{const r=i.date.format("YYYY-MM-DD");t[r]||(t[r]=[]),t[r].push(i)}),Object.values(t).forEach(i=>{const r=i.filter(o=>o.isLateNight&&["Bars & Nightlife","Dining","Coffee"].includes(o.merchantType));r.length>=2&&r.forEach(o=>o.dims.pattern="Night Out")}),n.forEach(i=>{i.isWorkHours&&["Dining","Coffee"].includes(i.merchantType)&&i.dims.pattern==="Normal"&&(i.dims.pattern="Work Expense")});const e={};n.forEach(i=>{e[i.merchantType]||(e[i.merchantType]={sum:0,count:0}),e[i.merchantType].sum+=i.amount,e[i.merchantType].count++}),Object.keys(e).forEach(i=>{e[i].avg=e[i].sum/e[i].count}),n.forEach(i=>{var o;const r=((o=e[i.merchantType])==null?void 0:o.avg)||0;r>0&&i.amount>r*3&&i.dims.pattern==="Normal"&&(z_(i)||(i.dims.pattern="Splurge"))});const s={};n.forEach(i=>{s[i.consolidated]||(s[i.consolidated]=[]),s[i.consolidated].push(i)}),Object.values(s).forEach(i=>{if(i.length<2)return;i.sort((d,u)=>d.date-u.date);const r=[];for(let d=1;d<i.length;d++)r.push(i[d].date.diff(i[d-1].date,"day"));const o=r.reduce((d,u)=>d+u,0)/r.length,a=i.map(d=>d.amount),l=a.reduce((d,u)=>d+u,0)/a.length,c=a.every(d=>Math.abs(d-l)<l*.1);o>=25&&o<=35&&c&&i.forEach(d=>d.dims.pattern="Subscription")})}function $o(){var o;const n=T.allTxns.filter(a=>a.direction==="IN"&&a.isSalary).sort((a,l)=>l.date-a.date);if(n.length===0)return{salaries:[],avgInterval:30};const t=n.map(a=>Math.round(a.amount/100)*100),e={};t.forEach(a=>e[a]=(e[a]||0)+1);const s=(o=Object.entries(e).sort((a,l)=>l[1]-a[1])[0])==null?void 0:o[0],i=s?n.filter(a=>Math.abs(a.amount-s)/s<.1):n;let r=30;if(i.length>=2){let a=0;for(let l=1;l<Math.min(i.length,6);l++)a+=i[l-1].date.diff(i[l].date,"day");r=Math.round(a/(Math.min(i.length,6)-1))}return{salaries:i,avgInterval:r}}function G_(){if(!T.userContext||!T.userContext.length)return null;const n=T.userContext.filter(s=>s.type==="income");if(!n.length)return null;const t=n.find(s=>(s.key||"").toLowerCase().includes("salary"))||n[0],e=parseInt(t.value,10);return isNaN(e)?null:Math.min(Math.max(e,1),31)}function Y_(){const{salaries:n,avgInterval:t}=$o(),e=G_();if(e){let i=dt().date(e);i.isBefore(dt(),"day")&&(i=i.add(1,"month"));const r=i.daysInMonth();e>r&&(i=i.date(r));const o=i.day();return o===5&&(i=i.subtract(1,"day")),o===6&&(i=i.subtract(2,"day")),i}if(n.length===0)return dt().add(30,"day");const s=n[0].date;if(n.length>=2){const i=n.slice(0,6).map(a=>a.date.date()),r=Math.round(i.reduce((a,l)=>a+l,0)/i.length);if(i.every(a=>Math.abs(a-r)<=3)){let a=dt().date(r);if(a.isBefore(dt(),"day")&&(a=a.add(1,"month")),r>28){const c=a.daysInMonth();r>c&&(a=a.date(c))}const l=a.day();return l===5&&(a=a.subtract(1,"day")),l===6&&(a=a.subtract(2,"day")),a}}return s.add(t,"day")}function Td(){const{salaries:n,avgInterval:t}=$o();n.length>=2?(T.dateRange={start:n[1].date,end:dt()},T.period="salary"):n.length===1?(T.dateRange={start:n[0].date,end:dt()},T.period="salary"):(T.dateRange={start:dt().subtract(90,"day"),end:dt()},T.period="last90"),document.querySelectorAll(".period-btn").forEach(e=>{e.classList.toggle("active",e.dataset.period===T.period)}),Cd(),Qi()}function Ad(){const{salaries:n,avgInterval:t}=$o(),e=Y_(),s=dt().startOf("day"),i=e.startOf("day"),r=Math.max(0,i.diff(s,"day")),o=T.filtered.filter(f=>f.direction==="IN").reduce((f,g)=>f+g.amount,0),a=T.filtered.filter(f=>f.direction==="OUT").reduce((f,g)=>f+g.amount,0),l=o-a,c=r>0?Math.max(0,l/r):0,d=T.dateRange.end.diff(T.dateRange.start,"day")+1,u=d>0?a/d:0,h=c>=u;return{income:o,expenses:a,net:l,daysUntilSalary:r,nextSalaryDate:e,dailyBudget:c,avgDailySpend:u,onTrack:h,lastSalaryAmount:n.length>0?n[0].amount:0}}function mt(n){return n?n.toString().replace(/^"|"$/g,"").trim():""}function Od(n){T.period=n;const t=dt();switch(n){case"thisMonth":T.dateRange={start:t.startOf("month"),end:t};break;case"lastMonth":T.dateRange={start:t.subtract(1,"month").startOf("month"),end:t.subtract(1,"month").endOf("month")};break;case"last90":T.dateRange={start:t.subtract(90,"day"),end:t};break;case"thisYear":T.dateRange={start:t.startOf("year"),end:t};break}document.querySelectorAll(".period-btn").forEach(e=>{e.classList.toggle("active",e.dataset.period===n)}),Cd(),Qi()}function Cd(){const{start:n,end:t}=T.dateRange,s=n.year()===t.year()?"MMM D":"MMM D, YY";document.getElementById("dateRangeDisplay").textContent=`${n.format(s)}  ${t.format("MMM D, YYYY")}`}function K_(){document.getElementById("startDate").value=T.dateRange.start.format("YYYY-MM-DD"),document.getElementById("endDate").value=T.dateRange.end.format("YYYY-MM-DD"),document.getElementById("dateModal").classList.remove("hidden")}function Rd(){document.getElementById("dateModal").classList.add("hidden")}function J_(){const n=dt(document.getElementById("startDate").value),t=dt(document.getElementById("endDate").value);n.isValid()&&t.isValid()&&n.isBefore(t)?(T.period="custom",T.dateRange={start:n,end:t},document.querySelectorAll(".period-btn").forEach(e=>{e.classList.toggle("active",e.dataset.period==="custom")}),Rd(),Qi()):alert("Please select a valid date range")}function Md(n){localStorage.setItem("fact_settings_tab",n),["general","goals","contacts"].forEach(s=>{const i=document.getElementById(`tab${s.charAt(0).toUpperCase()+s.slice(1)}`),r=document.getElementById(`panel${s.charAt(0).toUpperCase()+s.slice(1)}`),o=s===n;i&&(i.setAttribute("aria-selected",o),i.classList.toggle("border-fact-yellow",o),i.classList.toggle("border-transparent",!o),i.classList.toggle("text-fact-ink",o),i.classList.toggle("dark:text-fact-dark-ink",o),i.classList.toggle("text-fact-muted",!o)),r&&r.classList.toggle("hidden",!o)});const e=document.getElementById("settingsFooter");e&&e.classList.toggle("hidden",n!=="general"),n==="goals"?tr():n==="contacts"&&Gd()}function Id(n=null){const t=localStorage.getItem("fact_ai_model")||"gpt-5-mini";document.getElementById("settingsAiModel").value=t,document.getElementById("settingsCurrentPass").value="",document.getElementById("settingsNewPass").value="",document.getElementById("settingsConfirmPass").value="",document.getElementById("settingsPassError").classList.add("hidden"),document.getElementById("settingsPassSuccess").classList.add("hidden");const e=n||localStorage.getItem("fact_settings_tab")||"general";document.getElementById("settingsModal").classList.remove("hidden"),Md(e)}function Ld(){document.getElementById("settingsModal").classList.add("hidden")}function X_(){const n=document.getElementById("settingsAiModel").value;localStorage.setItem("fact_ai_model",n);const t=document.getElementById("aiModelName");t&&(t.textContent=n),typeof jt=="function"&&jt("Settings saved","success"),Ld()}async function Q_(){var t;const n=document.getElementById("shortcutKeyStatus");n.textContent="Generating key...";try{const{data:e}=await zt.auth.getSession(),s=(t=e==null?void 0:e.session)==null?void 0:t.access_token;if(!s)throw new Error("Not authenticated");const r=await(await fetch(`${Ut.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({action:"create"})})).json();if(r.error)throw new Error(r.error);localStorage.setItem("fact_shortcut_key_id",r.keyId||"");const o=document.getElementById("shortcutKeyBox"),a=document.getElementById("shortcutKeyValue");a.value=r.key,o.classList.remove("hidden"),n.textContent="Key generated. Paste it into your Shortcut."}catch(e){n.textContent="Failed to generate key: "+e.message}}async function Z_(){var e;const n=document.getElementById("shortcutKeyStatus"),t=localStorage.getItem("fact_shortcut_key_id");if(!t){n.textContent="No active key to revoke.";return}n.textContent="Revoking key...";try{const{data:s}=await zt.auth.getSession(),i=(e=s==null?void 0:s.session)==null?void 0:e.access_token;if(!i)throw new Error("Not authenticated");const o=await(await fetch(`${Ut.FUNCTIONS_BASE}/flow-keys`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({action:"revoke",keyId:t})})).json();if(o.error)throw new Error(o.error);localStorage.removeItem("fact_shortcut_key_id"),document.getElementById("shortcutKeyBox").classList.add("hidden"),document.getElementById("shortcutKeyValue").value="",n.textContent="Key revoked."}catch(s){n.textContent="Failed to revoke key: "+s.message}}function tv(){document.getElementById("shortcutKeyValue").select(),document.execCommand("copy")}function ev(){const n=document.getElementById("shortcutTemplateLink");n.href=Ut.SHORTCUT_TEMPLATE_URL,document.getElementById("shortcutSetupModal").classList.remove("hidden")}function nv(){document.getElementById("shortcutSetupModal").classList.add("hidden")}function sv(){return localStorage.getItem("fact_ai_model")||"gpt-5-mini"}async function iv(){document.getElementById("settingsCurrentPass").value;const n=document.getElementById("settingsNewPass").value,t=document.getElementById("settingsConfirmPass").value,e=document.getElementById("settingsPassError"),s=document.getElementById("settingsPassSuccess");if(e.classList.add("hidden"),s.classList.add("hidden"),!n||!t){e.textContent="Please fill in new password fields",e.classList.remove("hidden");return}if(n!==t){e.textContent="New passwords do not match",e.classList.remove("hidden");return}if(n.length<6){e.textContent="Password must be at least 6 characters",e.classList.remove("hidden");return}try{const{error:i}=await zt.auth.updateUser({password:n});if(i){e.textContent=i.message,e.classList.remove("hidden");return}s.textContent="Password updated successfully",s.classList.remove("hidden"),document.getElementById("settingsCurrentPass").value="",document.getElementById("settingsNewPass").value="",document.getElementById("settingsConfirmPass").value=""}catch(i){e.textContent="Connection error: "+i.message,e.classList.remove("hidden")}}function Qi(){const{start:n,end:t}=T.dateRange;T.filtered=T.allTxns.filter(e=>e.date.isBetween(n,t,"day","[]")),T.txnSort=T.txnSort||"date-desc",T.txnFilter=T.txnFilter||"",uv(),Dd(),Pd(),Zi(),Sv(),Hd(),rv(),ov()}function rv(){document.getElementById("todayDate").textContent=dt().format("dddd, MMM D");const n=On();document.getElementById("todaySpent").textContent=`QAR ${Y(n.spent)}`,document.getElementById("todayBudget").textContent=`QAR ${Y(n.budget)}`,vv(),xv(),kv(),typeof Fi=="function"&&Fi(),wn&&typeof fo=="function"&&(fo(),Bd())}function ov(){const n=dt().startOf("day"),t=T.allTxns.filter(s=>s.direction==="OUT"&&s.date.isAfter(n.subtract(1,"day"))),e=_v(t);if(e.length>0&&!T.impulseBannerDismissed){const s=e[e.length-1];document.getElementById("impulseMessage").textContent=`${s.count} purchases (QAR ${Y(s.total)}) in 30 minutes`,document.getElementById("impulseBanner").style.display="block"}}function av(){document.getElementById("impulseBanner").style.display="none",T.impulseBannerDismissed=!0}function Pd(){const n=T.filtered.filter(e=>e.direction==="OUT"),t=document.getElementById("categoryBreakdown");if(T.viewMode==="parent"){const e={};n.forEach(r=>{e[r.summaryGroup]||(e[r.summaryGroup]={total:0,count:0}),e[r.summaryGroup].total+=r.amount,e[r.summaryGroup].count++});const s=n.reduce((r,o)=>r+o.amount,0),i=Object.entries(e).sort((r,o)=>o[1].total-r[1].total);t.innerHTML=i.map(([r,o])=>{var d,u;const a=s>0?(o.total/s*100).toFixed(0):0,l=((d=en[r])==null?void 0:d.color)||"#999",c=((u=en[r])==null?void 0:u.icon)||"";return`
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition" onclick="openParentDrilldown('${r}')">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: ${l}20">
                        <span>${c}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium truncate">${r}</span>
                            <span class="text-sm font-bold">${Y(o.total)}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <div class="flex-1 h-1.5 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full rounded-full" style="width: ${a}%; background: ${l}"></div>
                            </div>
                            <span class="text-[10px] text-fact-muted">${a}%</span>
                        </div>
                    </div>
                </div>
            `}).join("")}else{const e={};n.forEach(r=>{e[r.merchantType]||(e[r.merchantType]={total:0,count:0}),e[r.merchantType].total+=r.amount,e[r.merchantType].count++});const s=n.reduce((r,o)=>r+o.amount,0),i=Object.entries(e).sort((r,o)=>o[1].total-r[1].total);t.innerHTML=i.slice(0,10).map(([r,o])=>{var d,u;const a=s>0?(o.total/s*100).toFixed(0):0,l=((d=ge[r])==null?void 0:d.color)||"#999",c=((u=ge[r])==null?void 0:u.icon)||"";return`
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition" onclick="openDrilldown('${r}')">
                    <div class="w-6 h-6 rounded-full flex items-center justify-center text-xs" style="background: ${l}20">
                        ${c}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-medium truncate">${r}</span>
                            <span class="text-xs font-bold">${Y(o.total)}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-0.5">
                            <div class="flex-1 h-1 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden">
                                <div class="h-full rounded-full" style="width: ${a}%; background: ${l}"></div>
                            </div>
                            <span class="text-[9px] text-fact-muted">${o.count}</span>
                        </div>
                    </div>
                </div>
            `}).join("")}}function lv(n){T.txnSort=n,Zi()}function cv(n){T.txnFilter=n.toLowerCase(),Zi()}function dv(n){T.viewMode=n;const t=document.getElementById("viewParent"),e=document.getElementById("viewSubcat");n==="parent"?(t.classList.add("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),t.classList.remove("text-fact-muted","dark:text-fact-dark-muted"),e.classList.remove("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),e.classList.add("text-fact-muted","dark:text-fact-dark-muted")):(e.classList.add("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),e.classList.remove("text-fact-muted","dark:text-fact-dark-muted"),t.classList.remove("bg-fact-ink","dark:bg-fact-dark-ink","text-white","dark:text-fact-dark-bg"),t.classList.add("text-fact-muted","dark:text-fact-dark-muted")),Pd(),Dd()}function Dd(){const n=T.filtered.filter(o=>o.direction==="OUT");let t,e,s;if(T.viewMode==="parent"){const o={};n.forEach(l=>{const c=l.summaryGroup;o[c]=(o[c]||0)+l.amount}),t=["Essentials","Food & Drinks","Shopping & Fun","Family","Other"].filter(l=>o[l]>0),e=t.map(l=>o[l]),s=t.map(l=>ze[l]||"#999")}else{const o={};n.forEach(l=>o[l.merchantType]=(o[l.merchantType]||0)+l.amount);const a=Object.entries(o).sort((l,c)=>c[1]-l[1]);t=a.map(l=>l[0]),e=a.map(l=>l[1]),s=t.map(l=>ze[l]||"#999")}const i=e.reduce((o,a)=>o+a,0);document.getElementById("donutTotal").textContent=Y(i);const r=document.getElementById("donutChart");he.donut&&he.donut.destroy(),he.donut=new ce(r,{type:"doughnut",data:{labels:t,datasets:[{data:e,backgroundColor:s,borderWidth:2,borderColor:document.documentElement.classList.contains("dark")?"#1a1a1a":"#ffffff",hoverOffset:12,hoverBorderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"65%",animation:{animateRotate:!0,duration:600},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(15, 15, 15, 0.95)",titleColor:"#F4C44E",bodyColor:"#ffffff",borderColor:"#F4C44E",borderWidth:1,cornerRadius:8,padding:12,displayColors:!0,boxPadding:6,caretSize:8,caretPadding:10,yAlign:"bottom",callbacks:{title:o=>{var a;return((a=o[0])==null?void 0:a.label)||""},label:o=>{const a=o.raw,l=(a/i*100).toFixed(1);return` QAR ${Y(a)} (${l}%)`},afterLabel:()=>"Click to see details "}}},onClick:(o,a)=>{if(a.length>0){const l=a[0].index;T.viewMode==="parent"?jd(t[l]):Nd(t[l])}},onHover:(o,a)=>{o.native.target.style.cursor=a.length>0?"pointer":"default"}}})}function uv(){const n=Ad();document.getElementById("daysUntilSalary").textContent=n.daysUntilSalary,document.getElementById("nextSalaryDate").textContent=`~${n.nextSalaryDate.format("MMM D")}`,document.getElementById("projIncome").textContent=Y(n.income),document.getElementById("projExpense").textContent=Y(n.expenses);const t=document.getElementById("projNet");t.textContent=Y(n.net),t.className=`font-display font-bold text-lg ${n.net>=0?"text-fact-green":"text-fact-red"}`,document.getElementById("suggestedDaily").textContent=`${Y(n.dailyBudget)}/day`,document.getElementById("avgDailySpend").textContent=Y(n.avgDailySpend);const e=document.getElementById("budgetStatus");n.onTrack?(e.textContent="On Track",e.className="text-[10px] px-2 py-0.5 rounded-full bg-fact-green/20 text-fact-green font-medium"):(e.textContent="Over Budget",e.className="text-[10px] px-2 py-0.5 rounded-full bg-fact-red/20 text-fact-red font-medium")}function Y(n){return Math.round(n).toLocaleString()}function hv(n,t){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>n(...s),t)}}const Pr=window.marked||{parse:n=>n.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")};function vt(n){const t=document.createElement("div");return t.textContent=n,t.innerHTML}function ji(n){return b_.sanitize(n,{ALLOWED_TAGS:["p","br","strong","em","b","i","ul","ol","li","h1","h2","h3","h4","code","pre","blockquote","a","span","div"],ALLOWED_ATTR:["href","target","class"],ALLOW_DATA_ATTR:!1})}function jt(n,t="info",e=3e3){const s=document.getElementById("toastContainer"),i=document.createElement("div");i.className=`toast ${t}`;const r={success:"",error:"",info:""};i.innerHTML=`
        <span>${r[t]||r.info}</span>
        <span>${vt(n)}</span>
    `,s.appendChild(i),setTimeout(()=>{i.classList.add("toast-exit"),setTimeout(()=>i.remove(),300)},e)}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/flow/sw.js").then(n=>console.log("[PWA] Service worker registered")).catch(n=>console.log("[PWA] Service worker registration failed:",n))});let ys;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),ys=n,localStorage.getItem("pwa_install_dismissed")||setTimeout(()=>{document.getElementById("installBanner").style.display="flex"},3e3)});function fv(){ys&&(ys.prompt(),ys.userChoice.then(n=>{n.outcome==="accepted"&&console.log("[PWA] User accepted install"),ys=null,document.getElementById("installBanner").style.display="none"}))}function gv(){document.getElementById("installBanner").style.display="none",localStorage.setItem("pwa_install_dismissed","true")}function pv(){const n=localStorage.getItem("fact_dark_mode"),t=document.getElementById("themeToggle");n==="true"?(document.body.classList.add("dark-mode"),t.classList.add("dark")):n==="false"?(document.body.classList.remove("dark-mode"),t.classList.remove("dark")):window.matchMedia("(prefers-color-scheme: dark)").matches&&t.classList.add("dark")}function mv(){const n=document.body,t=document.getElementById("themeToggle");n.classList.contains("dark-mode")?(n.classList.remove("dark-mode"),t.classList.remove("dark"),localStorage.setItem("fact_dark_mode","false")):(n.classList.add("dark-mode"),t.classList.add("dark"),localStorage.setItem("fact_dark_mode","true"))}let wn=!1;function yv(){wn=!wn,localStorage.setItem(`fact_focus_mode_${T.currentUser}`,wn),$d(),jt(wn?"Focus Mode enabled - simplified view":"Full view restored","info")}function $d(){const n=document.body,t=document.getElementById("focusToggle"),e=document.getElementById("focusHero"),s=document.getElementById("quickInsight");wn?(n.classList.add("focus-mode"),t==null||t.classList.add("active"),e==null||e.classList.remove("hidden"),s==null||s.classList.remove("hidden"),fo(),Bd()):(n.classList.remove("focus-mode"),t==null||t.classList.remove("active"),e==null||e.classList.add("hidden"),s==null||s.classList.add("hidden"))}function fo(){var a;const n=On(),t=document.getElementById("focusHeroNumber"),e=document.getElementById("focusDaysToSalary"),s=document.getElementById("focusStreak");if(!t)return;const i=Math.max(0,n.remaining);t.textContent=`QAR ${Y(i)}`,t.className="focus-hero-number breathe",n.status==="danger"?t.classList.add("danger"):n.status==="warning"?t.classList.add("warning"):t.classList.add("positive");const r=((a=document.getElementById("daysUntilSalary"))==null?void 0:a.textContent)||"--";e&&(e.textContent=r);const o=nn();s&&(s.textContent=o.currentStreak||"0")}function Bd(){const n=document.getElementById("quickInsightText"),t=document.getElementById("quickInsightSubtext");if(!n||!t)return;const e=On(),s=nn();e.status==="danger"?(n.textContent="Budget alert! Consider pausing spending.",t.textContent=`You've spent ${Math.round(e.spent/e.budget*100)}% of today's budget`):e.status==="warning"?(n.textContent="Halfway through your daily budget",t.textContent=`QAR ${Y(e.remaining)} left - spend wisely!`):s.currentStreak>=3?(n.textContent=` ${s.currentStreak}-day streak! You're crushing it!`,t.textContent="Keep the momentum going"):(n.textContent="You're doing great today!",t.textContent=`QAR ${Y(e.remaining)} left to spend`)}function bv(){localStorage.getItem(`fact_focus_mode_${T.currentUser}`)==="true"&&(wn=!0,$d())}function _v(n){const t=[],e=[...n].sort((s,i)=>s.date.unix()-i.date.unix());for(let s=0;s<e.length;s++){const i=e[s].date,r=[e[s]];for(let o=s+1;o<e.length&&e[o].date.diff(i,"minute")<=30;o++)r.push(e[o]);r.length>=3&&(t.push({time:i,count:r.length,total:r.reduce((o,a)=>o+a.amount,0),transactions:r}),s+=r.length-1)}return t}function On(){const n=dt().startOf("day"),e=T.allTxns.filter(o=>o.direction==="OUT"&&o.date.isAfter(n)&&o.date.isBefore(n.add(1,"day"))).reduce((o,a)=>o+a.amount,0),i=Ad().recommended||300,r=e/i*100;return{spent:e,budget:i,remaining:Math.max(0,i-e),percentage:r,status:r<50?"safe":r<80?"warning":"danger"}}function vv(){const n=On(),t=document.getElementById("dailyBudgetMeter");if(!t)return;const e=t.querySelector(".budget-meter-fill");e&&(e.style.width=`${Math.min(100,n.percentage)}%`,e.className=`budget-meter-fill ${n.status}`);const s=document.getElementById("dailyBudgetLabel");s&&(s.textContent=`${Y(n.remaining)} left today`,s.className=n.status==="danger"?"text-fact-red":"text-fact-muted dark:text-fact-dark-muted"),n.percentage>=80&&n.percentage<100&&!T.dailyWarningShown?(jt(` You've used ${n.percentage.toFixed(0)}% of today's budget`,"info"),T.dailyWarningShown=!0):n.percentage>=100&&!T.dailyOverShown&&(jt(` Over budget today! Spent ${Y(n.spent)} of ${Y(n.budget)}`,"error"),T.dailyOverShown=!0)}function nn(){try{return JSON.parse(localStorage.getItem(`fact_streak_${T.currentUser}`))||{currentStreak:0,longestStreak:0,lastGoodDay:null}}catch{return{currentStreak:0,longestStreak:0,lastGoodDay:null}}}function wv(n){localStorage.setItem(`fact_streak_${T.currentUser}`,JSON.stringify(n))}function xv(){const n=On(),t=nn(),e=dt().format("YYYY-MM-DD"),s=dt().subtract(1,"day").format("YYYY-MM-DD");return n.status!=="danger"?(t.lastGoodDay===s?t.currentStreak++:t.lastGoodDay!==e&&(t.currentStreak=1),t.lastGoodDay=e,t.longestStreak=Math.max(t.longestStreak,t.currentStreak)):t.lastGoodDay!==e&&t.lastGoodDay!==s&&(t.currentStreak=0),wv(t),t}function kv(){const n=nn(),t=document.getElementById("streakContainer");t&&(n.currentStreak>0?t.innerHTML=`
            <div class="streak-badge">
                <span></span>
                <span>${n.currentStreak} day${n.currentStreak>1?"s":""}</span>
            </div>
        `:t.innerHTML=`
            <div class="text-xs text-fact-muted dark:text-fact-dark-muted">
                Stay under budget to start a streak!
            </div>
        `)}function Tn(){try{return JSON.parse(localStorage.getItem(`fact_goals_${T.currentUser}`))||[]}catch{return[]}}function Bo(n){localStorage.setItem(`fact_goals_${T.currentUser}`,JSON.stringify(n))}function Zi(){const n=document.getElementById("recentTxns");if(!n)return;let t=[...T.filtered];switch(T.txnFilter&&(t=t.filter(e=>e.display.toLowerCase().includes(T.txnFilter)||e.raw.toLowerCase().includes(T.txnFilter)||e.merchantType.toLowerCase().includes(T.txnFilter))),T.txnSort){case"date-asc":t.sort((e,s)=>e.date-s.date);break;case"amount-desc":t.sort((e,s)=>s.amount-e.amount);break;case"amount-asc":t.sort((e,s)=>e.amount-s.amount);break;case"date-desc":default:t.sort((e,s)=>s.date-e.date)}n.innerHTML=t.slice(0,15).map(e=>qs(e)).join("")}function qs(n){var o;const t=n.direction==="OUT",e=vd(n.merchantType),s=((o=ge[n.merchantType])==null?void 0:o.icon)||"",i=btoa(unescape(encodeURIComponent(n.raw))),r=n.resolvedName?`${n.resolvedName}`:n.display;return n.resolvedLongName||n.counterparty||n.raw,`
        <div class="txn-row p-3 flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800" data-raw="${i}" onclick="openCatModalSafe(this)">
            <div class="flex items-center gap-3 min-w-0">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm flex-shrink-0" style="background:${e}20">${s}</div>
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${vt(r)}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted truncate">${n.date.format("MMM D, HH:mm")}  ${vt(n.merchantType)}</div>
                </div>
            </div>
            <div class="text-right flex-shrink-0 ml-2">
                <div class="font-display font-semibold text-sm ${t?"":"text-fact-green"}">${t?"":"+"}${Y(n.amount)}</div>
                ${n.currency!=="QAR"?`<div class="text-[10px] text-fact-muted">${n.currency}</div>`:""}
            </div>
        </div>
    `}function Sv(){const n=T.filtered.filter(i=>i.merchantType==="Uncategorized"&&i.direction==="OUT"),t=n.length,e=n.reduce((i,r)=>i+r.amount,0),s=document.getElementById("uncatAlert");if(s){s.classList.toggle("hidden",t===0);const i=document.getElementById("uncatCount"),r=document.getElementById("uncatAmount");i&&(i.textContent=t),r&&(r.textContent=Y(e))}}const Xl={Essentials:{icon:"",subcategories:["Groceries","Bills","Health","Transport"]},"Food & Drinks":{icon:"",subcategories:["Dining","Coffee","Delivery","Bars & Nightlife"]},"Shopping & Fun":{icon:"",subcategories:["Shopping","Entertainment","Travel"]},Family:{icon:"",subcategories:["Family"]},Other:{icon:"",subcategories:["Transfer","Other","Uncategorized"]}};function Nd(n){var b;const t=T.filtered.filter(_=>_.direction==="OUT"&&_.merchantType===n),e=t.reduce((_,x)=>_+x.amount,0),s=T.dateRange.end.diff(T.dateRange.start,"day"),i=T.dateRange.start.subtract(s+1,"day"),r=T.dateRange.start.subtract(1,"day"),a=T.allTxns.filter(_=>_.direction==="OUT"&&_.merchantType===n&&_.date.isBetween(i,r,"day","[]")).reduce((_,x)=>_+x.amount,0),l=a>0?(e-a)/a*100:0;document.getElementById("drilldownTitle").textContent=n,document.getElementById("drilldownSubtitle").textContent=`${t.length} transactions`,document.getElementById("drilldownTotal").textContent=`QAR ${Y(e)}`,document.getElementById("drilldownDelta").textContent=(l>=0?"+":"")+l.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${l<=0?"text-fact-green":"text-fact-red"}`;const c={};t.forEach(_=>{const x=_.date.format("YYYY-MM-DD");c[x]=(c[x]||0)+_.amount});const d=[];let u=T.dateRange.start;for(;u.isBefore(T.dateRange.end)||u.isSame(T.dateRange.end,"day");)d.push(u.format("YYYY-MM-DD")),u=u.add(1,"day");const h=document.getElementById("drilldownTimeline");he.drilldownTimeline&&he.drilldownTimeline.destroy();const f=ze[n]||"#999";he.drilldownTimeline=new ce(h,{type:"bar",data:{labels:d.map(_=>dt(_).format("D")),datasets:[{data:d.map(_=>c[_]||0),backgroundColor:f,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/d.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}});const g={};t.forEach(_=>{g[_.consolidated]||(g[_.consolidated]={total:0,count:0}),g[_.consolidated].total+=_.amount,g[_.consolidated].count++});const p=Object.entries(g).map(([_,x])=>({name:_,...x})).sort((_,x)=>x.total-_.total).slice(0,5),m=((b=p[0])==null?void 0:b.total)||1;document.getElementById("drilldownMerchants").innerHTML=`
        <p class="text-xs font-medium mb-2">Top Merchants</p>
        ${p.map(_=>`
            <div class="flex items-center gap-2 cursor-pointer hover:opacity-80" onclick="closeDrilldown(); openMerchantDrilldown('${_.name.replace(/'/g,"\\'")}')">
                <div class="flex-1 min-w-0">
                    <div class="flex justify-between text-xs mb-0.5">
                        <span class="truncate">${vt(_.name)}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${_.count}x</span>
                            <span class="font-medium">${Y(_.total)}</span>
                        </div>
                    </div>
                    <div class="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full rounded-full" style="width:${_.total/m*100}%;background:${f}"></div>
                    </div>
                </div>
            </div>
        `).join("")}
    `,document.getElementById("drilldownTxns").innerHTML=t.slice(0,20).map(_=>qs(_)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function Ev(){document.getElementById("drilldownModal").classList.add("hidden")}function jd(n){var x,S,E,C,O;const t=((x=Xl[n])==null?void 0:x.subcategories)||((S=en[n])==null?void 0:S.types)||[],e=T.filtered.filter(y=>y.direction==="OUT"&&t.includes(y.merchantType)),s=e.reduce((y,v)=>y+v.amount,0),i=T.dateRange.end.diff(T.dateRange.start,"day"),r=T.dateRange.start.subtract(i+1,"day"),o=T.dateRange.start.subtract(1,"day"),l=T.allTxns.filter(y=>y.direction==="OUT"&&t.includes(y.merchantType)&&y.date.isBetween(r,o,"day","[]")).reduce((y,v)=>y+v.amount,0),c=l>0?(s-l)/l*100:0,d=((E=Xl[n])==null?void 0:E.icon)||((C=en[n])==null?void 0:C.icon)||"";document.getElementById("drilldownTitle").textContent=`${d} ${n}`,document.getElementById("drilldownSubtitle").textContent=`${e.length} transactions  ${t.length} subcategories`,document.getElementById("drilldownTotal").textContent=`QAR ${Y(s)}`,document.getElementById("drilldownDelta").textContent=(c>=0?"+":"")+c.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${c<=0?"text-fact-green":"text-fact-red"}`;const u=ze[n]||k_(n),h={};e.forEach(y=>{const v=y.date.format("YYYY-MM-DD");h[v]=(h[v]||0)+y.amount});const f=[];let g=T.dateRange.start;for(;g.isBefore(T.dateRange.end)||g.isSame(T.dateRange.end,"day");)f.push(g.format("YYYY-MM-DD")),g=g.add(1,"day");const p=document.getElementById("drilldownTimeline");he.drilldownTimeline&&he.drilldownTimeline.destroy(),he.drilldownTimeline=new ce(p,{type:"bar",data:{labels:f.map(y=>dt(y).format("D")),datasets:[{data:f.map(y=>h[y]||0),backgroundColor:u,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/f.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}});const m={};e.forEach(y=>{m[y.merchantType]=(m[y.merchantType]||0)+y.amount});const b=Object.entries(m).sort((y,v)=>v[1]-y[1]),_=((O=b[0])==null?void 0:O[1])||1;document.getElementById("drilldownMerchants").innerHTML=`
        <p class="text-xs font-medium mb-2 -mt-2">Subcategories</p>
        ${b.map(([y,v])=>{const k=ze[y]||u;return`
                <div class="flex items-center gap-2 cursor-pointer hover:opacity-80" onclick="closeDrilldown(); openDrilldown('${y}')">
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between text-xs mb-0.5">
                            <span class="truncate">${vt(y)}</span>
                            <span class="font-medium">${Y(v)}</span>
                        </div>
                        <div class="h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full" style="width:${v/_*100}%;background:${k}"></div>
                        </div>
                    </div>
                </div>
            `}).join("")}
    `,document.getElementById("drilldownTxns").innerHTML=e.slice(0,20).map(y=>qs(y)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function Tv(n){var m;const t=T.filtered.filter(b=>b.direction==="OUT"&&b.consolidated===n),e=t.reduce((b,_)=>b+_.amount,0),s=t.length>0?e/t.length:0;document.getElementById("drilldownTitle").textContent=n,document.getElementById("drilldownSubtitle").textContent=`${t.length} transactions  Avg: QAR ${Y(s)}`,document.getElementById("drilldownTotal").textContent=`QAR ${Y(e)}`;const i=T.dateRange.end.diff(T.dateRange.start,"day"),r=T.dateRange.start.subtract(i+1,"day"),o=T.dateRange.start.subtract(1,"day"),l=T.allTxns.filter(b=>b.direction==="OUT"&&b.consolidated===n&&b.date.isBetween(r,o,"day","[]")).reduce((b,_)=>b+_.amount,0),c=l>0?(e-l)/l*100:0;document.getElementById("drilldownDelta").textContent=(c>=0?"+":"")+c.toFixed(0)+"%",document.getElementById("drilldownDelta").className=`font-display font-bold text-2xl ${c<=0?"text-fact-green":"text-fact-red"}`;const d=((m=t[0])==null?void 0:m.merchantType)||"Other",u=ze[d]||"#999",h={};t.forEach(b=>{const _=b.date.format("YYYY-MM-DD");h[_]=(h[_]||0)+b.amount});const f=[];let g=T.dateRange.start;for(;g.isBefore(T.dateRange.end)||g.isSame(T.dateRange.end,"day");)f.push(g.format("YYYY-MM-DD")),g=g.add(1,"day");const p=document.getElementById("drilldownTimeline");he.drilldownTimeline&&he.drilldownTimeline.destroy(),he.drilldownTimeline=new ce(p,{type:"bar",data:{labels:f.map(b=>dt(b).format("D")),datasets:[{data:f.map(b=>h[b]||0),backgroundColor:u,borderRadius:2,barThickness:Math.min(10,Math.max(2,300/f.length))}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}}),document.getElementById("drilldownMerchants").innerHTML=`
        <div class="grid grid-cols-3 gap-3">
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Transactions</div>
                <div class="font-display font-bold">${t.length}</div>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Average</div>
                <div class="font-display font-bold">${Y(s)}</div>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mb-1">Category</div>
                <div class="font-display font-bold text-sm truncate">${vt(d)}</div>
            </div>
        </div>
    `,document.getElementById("drilldownTxns").innerHTML=t.slice(0,30).map(b=>qs(b)).join(""),document.getElementById("drilldownModal").classList.remove("hidden")}function Av(){const n=T.filtered.filter(t=>t.merchantType==="Uncategorized"&&t.direction==="OUT");document.getElementById("uncatList").innerHTML=n.map(t=>`
            <div class="p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer" data-raw="${btoa(unescape(encodeURIComponent(t.raw)))}" onclick="closeUncatModal(); openCatModalSafe(this)">
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${vt(t.raw)}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${t.date.format("MMM D, HH:mm")}</div>
                </div>
                <div class="font-display font-semibold text-sm">${Y(t.amount)}</div>
            </div>
        `).join(""),document.getElementById("uncatModal").classList.remove("hidden")}function Ov(){document.getElementById("uncatModal").classList.add("hidden")}function Cv(n){T.catTarget=n;const t=T.allTxns.find(s=>s.raw.toLowerCase()===n.toLowerCase());T.catTargetPreviousType=(t==null?void 0:t.merchantType)||null,document.getElementById("catModalRaw").textContent=n,document.getElementById("catModalName").value="";const e=document.getElementById("catModalRecipient");if(e&&(t!=null&&t.recipient)){const s=t.recipient;document.getElementById("catModalRecipientName").textContent=s.longName||s.shortName;const i=s.matchType==="phone"?`Phone: ${s.phone}`:s.matchType==="account"?`Account: ...${s.bankAccount.slice(-4)}`:"Name match";document.getElementById("catModalRecipientDetails").textContent=i,e.classList.remove("hidden")}else e&&e.classList.add("hidden");document.getElementById("catModal").classList.remove("hidden")}function Fd(){document.getElementById("catModal").classList.add("hidden")}async function Rv(){var s;const n=T.catTarget,t=document.getElementById("catModalName").value||n,e=document.getElementById("catModalCat").value;if(!e){alert("Please select a category");return}T.localMappings[n.toLowerCase()]={display:t,consolidated:t,category:e},P_(),T.allTxns.forEach(i=>{i.raw.toLowerCase()===n.toLowerCase()&&(i.display=t,i.consolidated=t,i.merchantType=e)}),Fd(),Qi();try{const{data:i}=await zt.auth.getSession(),r=(s=i==null?void 0:i.session)==null?void 0:s.access_token;if(!r)throw new Error("Not authenticated");await fetch(`${Ut.FUNCTIONS_BASE}/flow-learn`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({counterparty:n,merchantType:e,consolidated:t,previousType:T.catTargetPreviousType||null})}),T.catTargetPreviousType=null}catch(i){console.warn("Failed to sync categorization:",i.message)}}function Mv(){const n=Array.from(T.categories).filter(s=>s!=="Uncategorized").sort(),t=document.getElementById("catModalCat");t&&(t.innerHTML=n.map(s=>`<option value="${vt(s)}">${vt(s)}</option>`).join(""));const e=document.getElementById("txnFilter");e&&(e.innerHTML='<option value="">All Categories</option>'+Array.from(T.categories).sort().map(s=>`<option value="${vt(s)}">${vt(s)}</option>`).join(""))}function Iv(){document.getElementById("txnModalCount").textContent=`${T.filtered.length} transactions`,document.getElementById("txnSearch").value="",document.getElementById("txnFilter").value="",Ud(T.filtered),document.getElementById("txnModal").classList.remove("hidden")}function Lv(){document.getElementById("txnModal").classList.add("hidden")}function Ql(){const n=document.getElementById("txnSearch").value.toLowerCase(),t=document.getElementById("txnFilter").value;let e=T.filtered;n&&(e=e.filter(s=>s.display.toLowerCase().includes(n)||s.raw.toLowerCase().includes(n))),t&&(e=e.filter(s=>s.merchantType===t)),document.getElementById("txnModalCount").textContent=`${e.length} transactions`,Ud(e)}function Ud(n){document.getElementById("txnModalList").innerHTML=n.slice(0,100).map(t=>qs(t)).join("")}function No(){const n=T.filtered.filter(s=>s.direction==="OUT"),t={};n.forEach(s=>{t[s.merchantType]||(t[s.merchantType]={total:0,count:0,txns:[]}),t[s.merchantType].total+=s.amount,t[s.merchantType].count++,t[s.merchantType].txns.push(s)});let e=`Period: ${T.dateRange.start.format("MMM D")} - ${T.dateRange.end.format("MMM D, YYYY")}
`;return e+=`Total Transactions: ${n.length}
`,e+=`Total Spent: QAR ${Y(n.reduce((s,i)=>s+i.amount,0))}

`,e+=`By Type:
`,Object.entries(t).sort((s,i)=>i[1].total-s[1].total).forEach(([s,i])=>{e+=`- ${s}: QAR ${Y(i.total)} (${i.count} txns)
`}),e+=`
Recent transactions (last 30):
`,n.slice(0,30).forEach(s=>{e+=`${s.date.format("MMM D HH:mm")} | ${s.display} | QAR ${Y(s.amount)} | ${s.merchantType} | ${s.dims.when.join(", ")} | ${s.dims.pattern}
`}),e}const bs=[];async function zd(n){var r,o,a;const t=n||((o=(r=document.getElementById("aiChatInput"))==null?void 0:r.value)==null?void 0:o.trim());if(!t)return;const e=document.getElementById("aiChatMessages"),s=document.getElementById("aiChatInput");s&&(s.value=""),e&&(e.innerHTML+=`
            <div class="flex justify-end">
                <div class="bg-fact-yellow/20 rounded-lg px-3 py-2 max-w-[85%]">
                    <p class="text-sm">${vt(t)}</p>
                </div>
            </div>
        `),bs.push({role:"user",content:t});const i="loading-"+Date.now();e&&(e.innerHTML+=`
            <div id="${i}" class="flex justify-start">
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2">
                    <p class="text-sm text-fact-muted animate-pulse">Thinking...</p>
                </div>
            </div>
        `,e.scrollTop=e.scrollHeight);try{const l=No(),c=bs.slice(-6).map(C=>`${C.role==="user"?"User":"Assistant"}: ${C.content}`).join(`
`),d=`Transaction Data:
${l}

Conversation:
${c}`,{data:u}=await zt.auth.getSession(),h=(a=u==null?void 0:u.session)==null?void 0:a.access_token;if(!h)throw new Error("Not authenticated");const g=await(await fetch(`${Ut.FUNCTIONS_BASE}/flow-ai`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({q:t,data:d,model:sv()})})).json();if(g.error)throw new Error(g.error);if(g.remembered){bs.push({role:"assistant",content:g.message});const C=document.getElementById(i);C&&(C.innerHTML=`
                    <div class="bg-fact-green/10 border border-fact-green/30 rounded-lg px-3 py-2 max-w-[85%]">
                        <div class="flex items-center gap-1 text-fact-green text-xs font-medium mb-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            Noted
                        </div>
                        <p class="text-sm">${ji(g.message)}</p>
                    </div>
                `);return}const p=g.answer;if(!p||p.trim()==="")throw new Error("No response received from AI. Please try again.");if(bs.push({role:"assistant",content:p}),g.model){const C=document.getElementById("aiModelName");if(C){const O=g.mode==="deep"?' <span class="text-fact-green"></span>':"",y=g.contextLoaded,k=y&&y.income+y.payees+y.corrections+y.preferences+(y.rules||0)>0?' <span class="text-fact-purple" title="Using your context"></span>':"";C.innerHTML=vt(g.model)+O+k}}const m=g.contextLoaded,b=m&&m.income+m.payees+m.corrections+m.preferences+(m.rules||0)>0,_=g.mode==="deep"?'<div class="text-[9px] text-fact-green font-medium mb-1"> DEEP ANALYSIS</div>':"",x=[];m!=null&&m.income&&x.push(`${m.income} income`),m!=null&&m.payees&&x.push(`${m.payees} payees`),m!=null&&m.corrections&&x.push(`${m.corrections} corrections`),m!=null&&m.rules&&x.push(`${m.rules} rules`),m!=null&&m.merchants&&x.push(`${m.merchants} merchants`);const S=b?`<div class="text-[9px] text-fact-purple font-medium mb-1"> Using ${x.join(", ")}</div>`:"",E=document.getElementById(i);if(E){const C=typeof Pr<"u"&&Pr.parse?Pr.parse(p):p.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>");E.innerHTML=`
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2 max-w-[85%]">
                    ${_}${S}
                    <div class="text-sm prose prose-sm dark:prose-invert">${ji(C)}</div>
                </div>
            `}Gs("fact_asked_ai")}catch(l){const c=document.getElementById(i);c&&(c.innerHTML=`
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2">
                    <p class="text-sm text-fact-red">Error: ${vt(l.message)}</p>
                </div>
            `)}e&&(e.scrollTop=e.scrollHeight)}function Pv(){bs.length=0;const n=document.getElementById("aiChatMessages");n&&(n.innerHTML=`
            <div class="text-fact-muted dark:text-fact-dark-muted text-xs">Ask me anything about your spending...</div>
        `)}function Hd(){const n=T.filtered.filter(u=>u.direction==="OUT"),t=[],e=n.filter(u=>u.dims.pattern==="Night Out");if(e.length>0){const u=e.reduce((h,f)=>h+f.amount,0);t.push({icon:"",text:`${e.length} Night Out transactions totaling QAR ${Y(u)}`,filter:"nightOut"})}const s=n.filter(u=>u.dims.pattern==="Work Expense");if(s.length>0){const u=s.reduce((h,f)=>h+f.amount,0);t.push({icon:"",text:`${s.length} potential work expenses (QAR ${Y(u)})`,filter:"workHours"})}const i=n.filter(u=>u.dims.pattern==="Splurge");if(i.length>0){const u=i.reduce((h,f)=>h+f.amount,0);t.push({icon:"",text:`${i.length} splurge purchases (QAR ${Y(u)})`,filter:"splurge"})}const r=n.filter(u=>u.dims.pattern==="Subscription");if(r.length>0){const u=[...new Set(r.map(h=>h.consolidated))];t.push({icon:"",text:`${u.length} detected subscriptions`,filter:"subscription"})}const o=n.filter(u=>u.isLateNight);if(o.length>=3){const u=o.reduce((h,f)=>h+f.amount,0);t.push({icon:"",text:`QAR ${Y(u)} spent late at night (${o.length} txns)`,filter:"lateNight"})}const a=n.filter(u=>u.isLarge);a.length>0&&t.push({icon:"",text:`${a.length} large purchases (500+ QAR each)`,filter:"large"});const l=document.getElementById("insightsTags"),c=document.getElementById("insightsSection"),d=document.getElementById("insightsCount");if(d&&(d.textContent=t.length),!!c)if(t.length===0)c.classList.add("hidden");else{c.classList.remove("hidden");const u={nightOut:"bg-fact-purple/15 text-fact-purple border-fact-purple/30",workHours:"bg-fact-yellow/15 text-fact-ink border-fact-yellow/50",splurge:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800",subscription:"bg-fact-green/15 text-fact-green border-fact-green/30",lateNight:"bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800",large:"bg-gray-100 dark:bg-gray-800 text-fact-ink dark:text-fact-dark-ink border-fact-border dark:border-fact-dark-border"};l&&(l.innerHTML=t.map(h=>{const f=u[h.filter]||"bg-gray-100 dark:bg-gray-800 text-fact-muted border-fact-border";return`<button onclick="filterByDimension('${h.filter}')"
                    class="inline-flex items-center gap-1.5 px-2.5 py-1 text-[11px] font-medium rounded-full border ${f} hover:scale-105 transition-transform cursor-pointer">
                    <span>${h.icon}</span>
                    <span>${h.text}</span>
                </button>`}).join(""))}}function Dv(){const n=document.getElementById("aiInsightsContainer");n&&n.classList.add("hidden")}async function $v(){var s;const n=document.getElementById("refreshInsightsBtn"),t=document.getElementById("aiInsightsContainer"),e=document.getElementById("aiInsightsList");if(n){n.disabled=!0,n.innerHTML=`
        <svg class="w-3 h-3 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Analyzing...
    `;try{const i=No(),r=T.userContext.length>0?`

User corrections/context: `+T.userContext.map(u=>u.value).join("; "):"",{data:o}=await zt.auth.getSession(),a=(s=o==null?void 0:o.session)==null?void 0:s.access_token;if(!a)throw new Error("Not authenticated");const c=await(await fetch(`${Ut.FUNCTIONS_BASE}/flow-ai`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({q:"Give me 3-5 quick bullet-point insights about this spending data. Be specific with numbers. Focus on patterns, anomalies, and actionable observations. Use emojis for each point. Keep each insight to one short sentence."+r,data:i,model:"gpt-5.1"})})).json();if(c.error)throw new Error(c.error);const d=c.answer.split(`
`).filter(u=>u.trim().length>0).map(u=>u.replace(/^[-*]\s*/,"").trim()).filter(u=>u.length>0).slice(0,5);d.length>0&&t&&e&&(t.classList.remove("hidden"),e.innerHTML=d.map(u=>`
                <div class="px-2.5 py-1.5 text-[11px] bg-gradient-to-r from-fact-purple/5 to-fact-yellow/5 border border-fact-purple/20 rounded-lg text-fact-ink dark:text-fact-dark-ink">
                    ${ji(u)}
                </div>
            `).join(""))}catch(i){t&&e&&(t.classList.remove("hidden"),e.innerHTML=`<div class="text-[11px] text-fact-red">Error: ${vt(i.message)}</div>`)}finally{n.disabled=!1,n.innerHTML=`
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Refresh
        `}}}function Bv(n){let t=[],e="";const s=T.filtered.filter(i=>i.direction==="OUT");switch(n){case"workHours":t=s.filter(i=>i.isWorkHours),e=" Work Hours Spending";break;case"lateNight":t=s.filter(i=>i.isLateNight),e=" Late Night Spending";break;case"nightOut":t=s.filter(i=>i.dims.pattern==="Night Out"),e=" Night Out Sessions";break;case"splurge":t=s.filter(i=>i.dims.pattern==="Splurge"),e=" Splurge Purchases";break;case"large":t=s.filter(i=>i.isLarge),e=" Large Purchases (500+ QAR)";break;case"subscription":t=s.filter(i=>i.dims.pattern==="Subscription"),e=" Detected Subscriptions";break;case"clear":Vd();return;default:return}Wd(t,e)}function Wd(n,t){const e=n.reduce((i,r)=>i+r.amount,0),s=n.length>0?e/n.length:0;document.getElementById("filteredTitle").textContent=t,document.getElementById("filteredSubtitle").textContent=`${n.length} transactions`,document.getElementById("filteredTotal").textContent=`QAR ${Y(e)}`,document.getElementById("filteredCount").textContent=n.length,document.getElementById("filteredAvg").textContent=`QAR ${Y(s)}`,document.getElementById("filteredList").innerHTML=n.map(i=>Nv(i)).join(""),document.getElementById("filteredModal").classList.remove("hidden")}function Vd(){document.getElementById("filteredModal").classList.add("hidden")}function Nv(n){var o,a;const t=n.direction==="OUT",e=vd(n.merchantType),s=((o=ge[n.merchantType])==null?void 0:o.icon)||"",i=vt(n.dims.pattern),r=n.dims.pattern!=="Normal"?`<span class="text-[10px] px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800">${((a=_d[n.dims.pattern])==null?void 0:a.icon)||""} ${i}</span>`:"";return`
        <div class="txn-row p-3 flex items-center justify-between">
            <div class="flex items-center gap-3 min-w-0">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center text-sm" style="background:${e}20">${s}</div>
                <div class="min-w-0">
                    <div class="font-medium text-sm truncate">${vt(n.display)}</div>
                    <div class="flex items-center gap-2 text-[10px] text-fact-muted dark:text-fact-dark-muted">
                        <span>${n.date.format("MMM D, HH:mm")}</span>
                        <span></span>
                        <span>${vt(n.dims.when.join(", "))}</span>
                        ${r}
                    </div>
                </div>
            </div>
            <div class="text-right">
                <div class="font-display font-semibold text-sm ${t?"":"text-fact-green"}">${t?"":"+"}${Y(n.amount)}</div>
                <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted">${n.dims.size}</div>
            </div>
        </div>
    `}let _e=null,Ts=!1;function qd(){if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const n=window.SpeechRecognition||window.webkitSpeechRecognition;_e=new n,_e.continuous=!1,_e.interimResults=!0,_e.lang="en-US",_e.onresult=t=>{const e=Array.from(t.results).map(i=>i[0].transcript).join(""),s=document.getElementById("aiChatInput");s&&(s.value=e)},_e.onend=()=>{Ts=!1;const t=document.getElementById("voiceBtn"),e=document.getElementById("voiceStatus");t&&t.classList.remove("listening"),e&&e.classList.add("hidden");const s=document.getElementById("aiChatInput");s&&s.value.trim()&&zd()},_e.onerror=t=>{console.error("Voice recognition error:",t.error),Ts=!1;const e=document.getElementById("voiceBtn"),s=document.getElementById("voiceStatus");e&&e.classList.remove("listening"),s&&s.classList.add("hidden")}}}function jv(){if(_e||qd(),!_e){alert("Voice input is not supported in this browser");return}const n=document.getElementById("voiceBtn"),t=document.getElementById("voiceStatus");if(Ts)_e.stop(),Ts=!1,n&&n.classList.remove("listening"),t&&t.classList.add("hidden");else{_e.start(),Ts=!0,n&&n.classList.add("listening"),t&&t.classList.remove("hidden"),Gs("fact_used_voice");const e=document.getElementById("aiChatInput");e&&(e.value="")}}function Fv(){Id("goals")}function tr(){const n=Tn(),t=document.getElementById("settingsGoalsList");if(!t)return;if(n.length===0){t.innerHTML=`
            <div class="text-center py-8">
                <div class="text-3xl mb-2"></div>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted">No budget goals set yet</p>
                <p class="text-xs text-fact-muted dark:text-fact-dark-muted mt-1">Set spending limits to track your progress</p>
            </div>
        `;return}const e=dt(),s=e.startOf("month"),i=T.allTxns.filter(c=>c.direction==="OUT"&&c.date.isAfter(s)&&c.date.isBefore(e.add(1,"day"))),r={};i.forEach(c=>{r[c.merchantType]=(r[c.merchantType]||0)+c.amount});const o=e.daysInMonth(),l=e.date()/o*100;t.innerHTML=n.map((c,d)=>{const u=r[c.category]||0,h=Math.min(100,u/c.amount*100),f=Math.max(0,c.amount-u),g=h>100?"#E57373":h>80?"#F4C44E":"#75B876";return`
            <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${(ge[c.category]||{}).icon||""}</span>
                        <span class="font-medium text-sm">${vt(c.category)}</span>
                    </div>
                    <button onclick="deleteGoal(${d})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-fact-red/10 text-fact-muted hover:text-fact-red transition" aria-label="Delete goal">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="flex items-baseline justify-between mb-2">
                    <div class="font-display">
                        <span class="text-xl font-bold">${Y(u)}</span>
                        <span class="text-sm text-fact-muted dark:text-fact-dark-muted">/ ${Y(c.amount)}</span>
                    </div>
                    <span class="text-xs ${h>100?"text-fact-red":"text-fact-green"}">${Y(f)} left</span>
                </div>
                <div class="goal-progress">
                    <div class="goal-progress-bar" style="width: ${h}%; background: ${g}"></div>
                    <div class="goal-progress-marker" style="left: ${l}%" title="Expected pace"></div>
                </div>
                <div class="flex justify-between mt-2 text-[10px] text-fact-muted dark:text-fact-dark-muted">
                    <span>${h.toFixed(0)}% used</span>
                    <span>${h>l?" Ahead of pace":" On track"}</span>
                </div>
            </div>
        `}).join("")}function Uv(){const n=Object.keys(ge).filter(s=>s!=="Uncategorized"),t=document.getElementById("goalCategory");t&&(t.innerHTML=n.map(s=>{var i;return`<option value="${s}">${((i=ge[s])==null?void 0:i.icon)||""} ${s}</option>`}).join(""));const e=document.getElementById("goalAmount");e&&(e.value=""),document.getElementById("addGoalModal").classList.remove("hidden")}function zv(){document.getElementById("addGoalModal").classList.add("hidden")}function Hv(){const n=document.getElementById("goalCategory").value,t=parseFloat(document.getElementById("goalAmount").value);if(!n||!t||t<=0){jt("Please select a category and enter a valid amount","error");return}const e=Tn(),s=e.findIndex(i=>i.category===n);s>=0?(e[s].amount=t,jt(`Updated ${n} goal`,"success")):(e.push({category:n,amount:t}),jt(`Added ${n} goal`,"success")),Bo(e),zv(),tr()}async function Wv(n){const t=Tn(),e=t[n];await Jd({title:"Delete Budget Goal",message:`Remove the ${e.category} budget of QAR ${Y(e.amount)}?`,confirmText:"Delete",cancelText:"Keep",type:"danger"})&&(t.splice(n,1),Bo(t),tr(),jt(`Removed ${e.category} goal`,"info"))}function Gd(){var s;const n=document.getElementById("recipientsList");if(!n)return;const t=(((s=document.getElementById("recipientSearch"))==null?void 0:s.value)||"").toLowerCase();let e=T.recipients||[];if(t&&(e=e.filter(i=>{var r,o,a,l;return((r=i.shortName)==null?void 0:r.toLowerCase().includes(t))||((o=i.longName)==null?void 0:o.toLowerCase().includes(t))||((a=i.phone)==null?void 0:a.includes(t))||((l=i.bankAccount)==null?void 0:l.toLowerCase().includes(t))})),e.length===0){n.innerHTML=`
            <div class="text-center py-8">
                <div class="text-3xl mb-2"></div>
                <p class="text-sm text-fact-muted dark:text-fact-dark-muted">
                    ${t?"No contacts match your search":"No contacts added yet"}
                </p>
                <p class="text-xs text-fact-muted dark:text-fact-dark-muted mt-1">
                    Add contacts to see friendly names on transfers
                </p>
            </div>
        `;return}n.innerHTML=e.map((i,r)=>`
        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl group">
            <div class="flex-1 min-w-0">
                <div class="font-medium text-sm truncate">${vt(i.shortName||"Unnamed")}</div>
                ${i.longName?`<div class="text-xs text-fact-muted truncate">${vt(i.longName)}</div>`:""}
                <div class="flex gap-3 mt-1 text-[10px] text-fact-muted">
                    ${i.phone?`<span> ${vt(i.phone)}</span>`:""}
                    ${i.bankAccount?`<span> ...${vt(i.bankAccount.slice(-4))}</span>`:""}
                </div>
            </div>
            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition">
                <button onclick="editRecipient(${r})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Edit contact">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                </button>
                <button onclick="deleteRecipient(${r})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-fact-red/10 text-fact-muted hover:text-fact-red transition" aria-label="Delete contact">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
        </div>
    `).join("")}function Vv(){Yd(),document.getElementById("heatmapModal").classList.remove("hidden"),Gs("fact_viewed_heatmap")}function qv(){document.getElementById("heatmapModal").classList.add("hidden")}function Yd(){const n=document.getElementById("heatmapContainer");if(!n)return;const t=T.allTxns.filter(g=>g.direction==="OUT"),e=dt(),s=e.subtract(90,"day"),i={};t.forEach(g=>{if(g.date.isAfter(s)&&g.date.isBefore(e.add(1,"day"))){const p=g.date.format("YYYY-MM-DD");i[p]=(i[p]||0)+g.amount}});const r=Object.values(i),o=Math.max(...r,1),a=r.length>0?r.reduce((g,p)=>g+p,0)/r.length:0,l=[];let c=[],d=s;const u=d.day();for(let g=0;g<u;g++)c.push(null);for(;d.isBefore(e)||d.isSame(e,"day");){const g=d.format("YYYY-MM-DD"),p=i[g]||0;c.push({date:d,amount:p,key:g}),d.day()===6&&(l.push(c),c=[]),d=d.add(1,"day")}c.length>0&&l.push(c);const h=g=>{if(g===0)return"#E5E5E5";const p=g/o;return p<.25?"#C6E48B":p<.5?"#7BC96F":p<.75?"#239A3B":"#196127"},f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];n.innerHTML=`
        <div class="flex gap-1">
            <div class="flex flex-col gap-1 text-[9px] text-fact-muted dark:text-fact-dark-muted mr-1">
                ${f.map((g,p)=>`<div class="h-3 flex items-center">${p%2===1?g:""}</div>`).join("")}
            </div>
            ${l.map(g=>`
                <div class="flex flex-col gap-1">
                    ${[0,1,2,3,4,5,6].map(p=>{const m=g[p];if(!m)return'<div class="heatmap-cell" style="background: transparent"></div>';const b=h(m.amount),_=`${m.date.format("MMM D")}: QAR ${Y(m.amount)}`;return`<div class="heatmap-cell" style="background: ${b}" title="${_}" onclick="drilldownDate('${m.key}')"></div>`}).join("")}
                </div>
            `).join("")}
        </div>
        <div class="mt-4 grid grid-cols-3 gap-4 text-center text-xs">
            <div>
                <div class="text-lg font-display font-bold">${Y(r.reduce((g,p)=>g+p,0))}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Total (90 days)</div>
            </div>
            <div>
                <div class="text-lg font-display font-bold">${Y(a)}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Daily Avg</div>
            </div>
            <div>
                <div class="text-lg font-display font-bold">${Y(o)}</div>
                <div class="text-fact-muted dark:text-fact-dark-muted">Max Day</div>
            </div>
        </div>
    `}function Gv(){const n=document.getElementById("exportIcon");n&&n.classList.add("export-spin");try{const t=["Date","Time","Amount","Currency","Merchant","Category","Direction","Pattern"],e=T.filtered.map(a=>[a.date.format("YYYY-MM-DD"),a.date.format("HH:mm"),a.amount.toFixed(2),a.currency,`"${a.display.replace(/"/g,'""')}"`,a.merchantType,a.direction,a.dims.pattern]),s=[t.join(","),...e.map(a=>a.join(","))].join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),o=URL.createObjectURL(i);r.setAttribute("href",o),r.setAttribute("download",`fact-flow-${T.dateRange.start.format("YYYY-MM-DD")}-to-${T.dateRange.end.format("YYYY-MM-DD")}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),jt(`Exported ${e.length} transactions`,"success"),Gs("fact_exported")}catch(t){jt("Export failed: "+t.message,"error")}finally{setTimeout(()=>{n&&n.classList.remove("export-spin")},500)}}const go={"first-login":{icon:"",name:"First Steps",desc:"Opened FACT/Flow for the first time",check:()=>!0},"first-categorize":{icon:"",name:"Organizer",desc:"Categorized your first transaction",check:()=>Object.keys(T.localMappings||{}).length>0},"ten-categorize":{icon:"",name:"Sorting Pro",desc:"Categorized 10 transactions",check:()=>Object.keys(T.localMappings||{}).length>=10},"first-goal":{icon:"",name:"Goal Setter",desc:"Set your first budget goal",check:()=>Tn().length>0},"three-goals":{icon:"",name:"Triple Threat",desc:"Set 3 budget goals",check:()=>Tn().length>=3},"streak-3":{icon:"",name:"On Fire",desc:"3-day under-budget streak",check:()=>nn().longestStreak>=3},"streak-7":{icon:"",name:"Week Warrior",desc:"7-day under-budget streak",check:()=>nn().longestStreak>=7},"ask-ai":{icon:"",name:"AI Explorer",desc:"Asked AI for spending advice",check:()=>localStorage.getItem("fact_asked_ai")==="true"},"voice-input":{icon:"",name:"Voice Commander",desc:"Used voice input",check:()=>localStorage.getItem("fact_used_voice")==="true"},"dark-mode":{icon:"",name:"Night Owl",desc:"Switched to dark mode",check:()=>localStorage.getItem("fact_dark_mode")==="true"},"export-data":{icon:"",name:"Data Analyst",desc:"Exported your data to CSV",check:()=>localStorage.getItem("fact_exported")==="true"},"heatmap-view":{icon:"",name:"Pattern Seeker",desc:"Viewed the spending heatmap",check:()=>localStorage.getItem("fact_viewed_heatmap")==="true"},"generosity-set":{icon:"",name:"Generous Heart",desc:"Set a generosity budget",check:()=>localStorage.getItem(`fact_generosity_${T.currentUser}`)!==null}};function Kd(){try{return JSON.parse(localStorage.getItem(`fact_achievements_${T.currentUser}`))||[]}catch{return[]}}function Yv(n){localStorage.setItem(`fact_achievements_${T.currentUser}`,JSON.stringify(n))}function zs(){const n=Kd(),t=[];return Object.entries(go).forEach(([e,s])=>{!n.includes(e)&&s.check()&&(n.push(e),t.push({id:e,...s}))}),t.length>0&&(Yv(n),setTimeout(()=>Kv(t[0]),500)),n}function Kv(n){const t=document.getElementById("celebrationOverlay");if(!t)return;const e=["#F4C44E","#75B876","#B593C6","#E57373","#64B5F6"];let s="";for(let i=0;i<50;i++){const r=e[Math.floor(Math.random()*e.length)],o=Math.random()*100,a=Math.random()*2,l=5+Math.random()*10;s+=`<div class="confetti" style="left: ${o}%; background: ${r}; width: ${l}px; height: ${l}px; animation-delay: ${a}s; border-radius: ${Math.random()>.5?"50%":"0"}"></div>`}t.innerHTML=`
        <div class="celebration-overlay" onclick="closeCelebration()">
            ${s}
            <div class="celebration-box" onclick="event.stopPropagation()">
                <div class="celebration-icon">${n.icon}</div>
                <h2 class="font-display font-bold text-xl text-fact-ink mt-2">Achievement Unlocked!</h2>
                <h3 class="font-display font-semibold text-lg text-fact-ink mt-1">${n.name}</h3>
                <p class="text-sm text-fact-ink/70 mt-2">${n.desc}</p>
                <button onclick="closeCelebration()" class="mt-4 px-6 py-2 bg-fact-ink text-white rounded-full font-medium">
                    Awesome! 
                </button>
            </div>
        </div>
    `,t.classList.remove("hidden"),setTimeout(Jv,5e3)}function Jv(){const n=document.getElementById("celebrationOverlay");n&&(n.classList.add("hidden"),n.innerHTML="")}function Xv(){const n=Kd(),t=document.getElementById("achievementsList"),e=document.getElementById("achievementProgress");e&&(e.textContent=`${n.length} of ${Object.keys(go).length} unlocked`),t&&(t.innerHTML=Object.entries(go).map(([s,i])=>{const r=n.includes(s);return`
                <div class="achievement-badge ${r?"":"locked"}">
                    <div class="badge-icon">${i.icon}</div>
                    <div class="text-xs font-medium">${i.name}</div>
                    <div class="text-[10px] text-fact-muted dark:text-fact-dark-muted mt-1">${r?i.desc:"???"}</div>
                </div>
            `}).join("")),document.getElementById("achievementsModal").classList.remove("hidden")}function Qv(){document.getElementById("achievementsModal").classList.add("hidden")}function Gs(n){localStorage.setItem(n,"true"),setTimeout(zs,100)}function Jd(n){return new Promise(t=>{const{title:e,message:s,confirmText:i="Confirm",cancelText:r="Cancel",type:o="warning"}=n,a=document.getElementById("confirmModal");if(!a){t(!1);return}const l={warning:{bg:"bg-fact-yellow",icon:""},danger:{bg:"bg-fact-red",icon:""},info:{bg:"bg-fact-purple",icon:""}},c=l[o]||l.warning;a.innerHTML=`
            <div class="confirm-overlay" onclick="event.target === this && confirmResolve(false)">
                <div class="confirm-box">
                    <div class="text-4xl mb-4">${c.icon}</div>
                    <h3 class="font-display font-semibold text-lg mb-2">${vt(e)}</h3>
                    <p class="text-sm text-fact-muted dark:text-fact-dark-muted mb-6">${vt(s)}</p>
                    <div class="flex gap-3">
                        <button onclick="confirmResolve(false)" class="flex-1 px-4 py-2 text-sm rounded-lg border border-fact-border dark:border-fact-dark-border hover:bg-gray-50 dark:hover:bg-gray-800">${r}</button>
                        <button onclick="confirmResolve(true)" class="flex-1 px-4 py-2 text-sm rounded-lg ${c.bg} text-white font-medium">${i}</button>
                    </div>
                </div>
            </div>
        `,a.classList.remove("hidden"),window.confirmResolve=d=>{a.classList.add("hidden"),a.innerHTML="",t(d)}})}const Zv=[{id:"gifts",name:"Gifts & Presents",default:!0},{id:"charity",name:"Charity & Donations",default:!0},{id:"treats",name:"Treating Others (meals, drinks)",default:!0},{id:"social",name:"Social Outings (I paid for everyone)",default:!1},{id:"family",name:"Family Support",default:!1}];function Xd(){try{const n=localStorage.getItem(`fact_generosity_${T.currentUser}`);if(n)return JSON.parse(n)}catch{}return null}function t0(){const n=document.getElementById("generosityBudgetInput"),t=parseFloat(n==null?void 0:n.value)||0,e=[];document.querySelectorAll('#generosityCategories input[type="checkbox"]:checked').forEach(i=>{e.push(i.value)});const s={budget:t,categories:e,enabled:t>0};localStorage.setItem(`fact_generosity_${T.currentUser}`,JSON.stringify(s)),setTimeout(()=>zs(),500),Qd(),Fi(),jt("Generosity budget saved! ","success")}function e0(){const n=Xd()||{budget:0,categories:["gifts","charity","treats"]},t=document.getElementById("generosityBudgetInput");t&&(t.value=n.budget||"");const e=document.getElementById("generosityCategories");e&&(e.innerHTML=Zv.map(s=>{var r;const i=((r=n.categories)==null?void 0:r.includes(s.id))||!n.categories&&s.default;return`
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" value="${s.id}" ${i?"checked":""}
                        class="w-4 h-4 rounded border-fact-border text-fact-purple focus:ring-fact-purple">
                    <span>${s.name}</span>
                </label>
            `}).join("")),document.getElementById("generosityModal").classList.remove("hidden")}function Qd(){document.getElementById("generosityModal").classList.add("hidden")}function Fi(){const n=Xd(),t=document.getElementById("generosityCard");if(!t)return;if(!n||!n.enabled){t.classList.add("hidden");return}t.classList.remove("hidden");const e=dt(),s=e.startOf("month"),o=T.allTxns.filter(f=>f.direction==="OUT"&&f.date.isAfter(s)&&f.date.isBefore(e.add(1,"day"))).filter(f=>f.merchantType==="Family"||f.summaryGroup==="Family").reduce((f,g)=>f+g.amount,0),a=Math.max(0,n.budget-o),l=n.budget>0?Math.min(o/n.budget*100,100):0,c=document.getElementById("generositySpent"),d=document.getElementById("generosityBudget"),u=document.getElementById("generosityMeterFill"),h=document.getElementById("generosityStatus");c&&(c.textContent=`QAR ${Y(o)}`),d&&(d.textContent=`QAR ${Y(n.budget)}`),u&&(u.style.width=`${l}%`,u.className=`generosity-meter-fill ${o>n.budget?"over":""}`),h&&(o>n.budget?(h.textContent=`Over budget by QAR ${Y(o-n.budget)}`,h.className="text-xs text-fact-red"):(h.textContent=`QAR ${Y(a)} left to give `,h.className="text-xs text-fact-muted dark:text-fact-dark-muted"))}function n0(){const n=document.getElementById("healthScoreModal");if(!n)return;const t=On(),e=nn(),s=Tn();let i=50;t.status==="safe"?i+=20:t.status==="warning"&&(i+=10),i+=Math.min(20,e.currentStreak*4),i+=Math.min(10,s.length*3);const r=document.getElementById("healthScoreNumber");r&&(r.textContent=i);const o=document.getElementById("healthStatusLabel"),a=document.getElementById("healthStatusDesc");o&&a&&(i>=80?(o.textContent="Excellent!",a.textContent="Your finances are in great shape"):i>=60?(o.textContent="Good",a.textContent="You're on the right track"):(o.textContent="Needs Work",a.textContent="Let's focus on building better habits")),n.classList.remove("hidden"),Gs("fact_health_score")}function s0(){document.getElementById("healthScoreModal").classList.add("hidden")}function po(){const t=dt().hour();(t>=22||t<5)&&!sessionStorage.getItem("fact_nudge_shown")&&(sessionStorage.setItem("fact_nudge_shown","true"),Math.random()>.7&&jt(" Late night spending? Sleep on it!","info"))}document.addEventListener("DOMContentLoaded",()=>{bv(),pv()});window.attemptLogin=S_;window.loginWithGoogle=E_;window.logout=T_;window.showApp=uo;window.syncData=Ed;window.setPeriod=Od;window.setSalaryPeriod=Td;window.openDatePicker=K_;window.closeDatePicker=Rd;window.applyCustomDate=J_;window.openSettings=Id;window.closeSettings=Ld;window.saveSettings=X_;window.switchSettingsTab=Md;window.generateShortcutKey=Q_;window.revokeShortcutKey=Z_;window.copyShortcutKey=tv;window.openShortcutSetup=ev;window.closeShortcutSetup=nv;window.changePassword=iv;window.setViewMode=dv;window.sortTransactions=lv;window.filterTransactions=cv;window.openOnboarding=xd;window.closeOnboarding=kd;window.onboardingNext=O_;window.onboardingPrev=C_;window.selectOnboardingBank=R_;window.onboardingGenerateKey=M_;window.copyOnboardingKey=I_;window.toggleDarkMode=mv;window.toggleFocusMode=yv;window.dismissImpulseBanner=av;window.installPWA=fv;window.dismissInstall=gv;window.showToast=jt;window.formatNum=Y;window.escapeHtml=vt;window.sanitizeHTML=ji;window.getGoals=Tn;window.saveGoals=Bo;window.checkDailyBudget=On;window.getStreakData=nn;window.STATE=T;window.CONFIG=Ut;window.supabaseClient=zt;window.dayjs=dt;window.Chart=ce;window.MERCHANT_TYPES=ge;window.SUMMARY_GROUPS=en;window.CAT_COLORS=ze;window.PATTERNS=_d;window.askAIChat=zd;window.clearAIChat=Pv;window.closeAchievements=Qv;window.closeAiInsights=Dv;window.closeGenerositySettings=Qd;window.closeHealthScore=s0;window.exportCSV=Gv;window.filterByDimension=Bv;window.openGenerositySettings=e0;window.openGoals=Fv;window.openHeatmap=Vv;window.openTxnModal=Iv;window.openUncatModal=Av;window.refreshInsights=$v;window.saveGenerositySettings=t0;window.toggleVoiceInput=jv;window.renderRecentTxns=Zi;window.openDrilldown=Nd;window.closeDrilldown=Ev;window.openParentDrilldown=jd;window.openMerchantDrilldown=Tv;window.closeUncatModal=Ov;window.openCatModal=Cv;window.closeCatModal=Fd;window.saveCategorization=Rv;window.closeTxnModal=Lv;window.closeFilteredModal=Vd;window.showFilteredResults=Wd;window.closeHeatmap=qv;window.openAchievements=Xv;window.openHealthScore=n0;window.renderQuickInsights=Hd;window.renderGenerosityBudget=Fi;window.renderPatternWarnings=po;window.checkAchievements=zs;window.showConfirm=Jd;window.renderSettingsGoalsList=tr;window.addNewGoal=Uv;window.saveGoal=Hv;window.deleteGoal=Wv;window.renderRecipientsList=Gd;window.renderHeatmap=Yd;window.prepareTransactionSummary=No;window.initVoiceRecognition=qd;
