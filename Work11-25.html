<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Personal Trainer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #f8fafc;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .card {
            background-color: #1e293b; /* Slate 800 */
            border-radius: 16px;
            transition: transform 0.1s ease;
        }
        .card:active {
            transform: scale(0.98);
        }
        .btn-primary {
            background: linear-gradient(to right, #3b82f6, #2563eb);
            color: white;
        }
        .btn-success {
            background: linear-gradient(to right, #22c55e, #16a34a);
            color: white;
        }
        .btn-ai {
            background: linear-gradient(to right, #8b5cf6, #d946ef);
            color: white;
        }
        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- GEMINI API CONFIG ---
        const apiKey = ""; // API Key provided by environment

        // --- ICONS ---
        const Zap = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
            </svg>
        );
        const Battery = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="2" y="7" width="16" height="10" rx="2" ry="2" />
                <line x1="22" y1="11" x2="22" y2="13" />
            </svg>
        );
        const Dumbbell = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6.5 6.5l11 11" />
                <path d="M21 21l-1-1" />
                <path d="M3 3l1 1" />
                <path d="M18 22l4-4" />
                <path d="M2 6l4-4" />
                <path d="M3 10l7-7" />
                <path d="M14 21l7-7" />
            </svg>
        );
        const CheckCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        );
        const Trophy = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M10 14.66V17" />
                <path d="M14 14.66V17" />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
            </svg>
        );
        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 18l6-6-6-6" />
            </svg>
        );
        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M15 18l-6-6 6-6" />
            </svg>
        );
        const Play = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                 <polygon points="5 3 19 12 5 21 5 3" />
            </svg>
        );
        const Sparkles = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
            </svg>
        );
        const Send = ({ size = 24, className = "" }) => (
             <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="22" y1="2" x2="11" y2="13" />
                <polygon points="22 2 15 22 11 13 2 9 22 2" />
            </svg>
        );
        const Utensils = ({ size = 24, className = "" }) => (
             <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" />
                <path d="M7 2v20" />
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" />
            </svg>
        );

        // --- API UTILS ---
        const callGemini = async (prompt) => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            const delays = [1000, 2000, 4000, 8000, 16000];
            
            for (let i = 0; i < delays.length; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't get a response.";
                } catch (error) {
                    if (i === delays.length - 1) {
                         console.error("Gemini API failed:", error);
                         return "I'm having trouble connecting. Please check your connection.";
                    }
                    await new Promise(resolve => setTimeout(resolve, delays[i]));
                }
            }
        };


        // --- DATA ---
        const WORKOUTS = {
            quick: [
                { id: 'uGytJAZA6m0', title: '5 Min Belly Fat Loss', creator: '5-Min Fitness', duration: '5 min' },
                { id: 'fSP7IZp1-bc', title: '5 Min Low Impact Fat Burn', creator: 'Tracy Campoli', duration: '5 min' },
                { id: 'ds6qHs07ats', title: '3 Min Energetic HIIT', creator: 'officialdeevy', duration: '3 min' }
            ],
            medium: [
                { id: 'AA9Nu5Xah9U', title: '10 Min Cardio HIIT', creator: 'Oliver Sjostrom', duration: '10 min' },
                { id: 'LvV7K_i7aDQ', title: '10 Min Sweat Sesh', creator: 'MadFit', duration: '10 min' },
                { id: 'd6EX80cR_zw', title: '10 Min Intense All Standing', creator: 'Oliver Sjostrom', duration: '10 min' }
            ],
            long: [
                { id: 'Bvc6XXRpXDU', title: '20 Min Fat Burn (No Jump)', creator: 'Oliver Sjostrom', duration: '20 min' },
                { id: 'x0QXubT27wg', title: '20 Min Intense HIIT', creator: 'Oliver Sjostrom', duration: '20 min' },
                { id: 'Jh72gk4WrIg', title: '20 Min Feel Good HIIT', creator: 'Monika Larssen', duration: '20 min' }
            ]
        };

        // --- USER BIO CONTEXT FOR LLM ---
        const USER_CONTEXT = `User Profile: 40-year-old male, 172cm, 80kg. Former dancer/raver (used to endurance dance 16h, now sedentary). Taking Cipralex (SSRI) which caused 8kg weight gain. Goal: Lose belly fat, get lean, avoid bulk. Needs high energy to compensate for sedentary lifestyle but safe for 40yo joints.`;

        const App = () => {
            const [view, setView] = useState('dashboard'); // dashboard, selection, player, aicoach
            const [category, setCategory] = useState(null);
            const [currentVideo, setCurrentVideo] = useState(null);
            const [completedCount, setCompletedCount] = useState(0);
            const [lastWorkoutDate, setLastWorkoutDate] = useState(null);
            const [showConfetti, setShowConfetti] = useState(false);
            const [aiResponseMsg, setAiResponseMsg] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);

            // Load progress
            useEffect(() => {
                const storedCount = localStorage.getItem('workoutCount');
                const storedDate = localStorage.getItem('lastWorkoutDate');
                const currentWeek = getWeekNumber(new Date());
                const storedWeek = localStorage.getItem('workoutWeek');

                if (storedWeek && parseInt(storedWeek) !== currentWeek) {
                    setCompletedCount(0);
                    localStorage.setItem('workoutWeek', currentWeek);
                } else if (storedCount) {
                    setCompletedCount(parseInt(storedCount));
                }
                if (storedDate) setLastWorkoutDate(storedDate);
            }, []);

            const getWeekNumber = (d) => {
                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
                var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
                return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            }

            const handleCategorySelect = (cat) => {
                setCategory(cat);
                setView('selection');
            };

            const handleVideoSelect = (video) => {
                setCurrentVideo(video);
                setView('player');
            };

            const handleComplete = () => {
                const newCount = completedCount + 1;
                setCompletedCount(newCount);
                const today = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
                setLastWorkoutDate(today);
                
                localStorage.setItem('workoutCount', newCount);
                localStorage.setItem('lastWorkoutDate', today);
                localStorage.setItem('workoutWeek', getWeekNumber(new Date()));

                setAiResponseMsg(null);
                setShowConfetti(true);
            };

            const handleGetSnack = async () => {
                setIsAiLoading(true);
                const prompt = `You are a nutritionist for a 40-year-old male (172cm, 80kg) looking to lose belly fat. He just finished a ${currentVideo.duration} workout: "${currentVideo.title}". Suggest ONE simple, delicious, low-calorie post-workout snack that aids recovery without adding bulk. Max 20 words.`;
                try {
                    const text = await callGemini(prompt);
                    setAiResponseMsg(text);
                } catch (e) {
                    setAiResponseMsg("Apple and a handful of almonds.");
                } finally {
                    setIsAiLoading(false);
                }
            };
            
            const handleGetMotivation = async () => {
                setIsAiLoading(true);
                const prompt = `Generate a high-energy, punchy motivation quote for a former raver turning 40 who needs to crush a workout to lose belly fat. Use DJ/Music metaphors if possible. Max 15 words.`;
                 try {
                    const text = await callGemini(prompt);
                    // Simple alert for the dashboard motivation for simplicity
                    alert("ðŸŽ§ " + text);
                } catch (e) {
                    alert("Let's go! The beat drops when you move.");
                } finally {
                    setIsAiLoading(false);
                }
            };

            const handleBack = () => {
                if (view === 'player') setView('selection');
                else if (view === 'selection' || view === 'aicoach') {
                    setCategory(null);
                    setView('dashboard');
                }
            };

            // --- VIEWS ---

            // 1. DASHBOARD
            const Dashboard = () => (
                <div className="space-y-6 pb-20">
                    <header className="flex justify-between items-center mb-6">
                        <div>
                            <h1 className="text-2xl font-bold text-white">Hello!</h1>
                            <p className="text-slate-400 text-sm">Ready to compensate?</p>
                        </div>
                        <div className="bg-slate-800 p-2 rounded-full">
                            <div className="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                                {completedCount}
                            </div>
                        </div>
                    </header>

                    {/* Stats Card */}
                    <div className="card p-5 flex items-center justify-between bg-gradient-to-r from-slate-800 to-slate-700 shadow-lg">
                        <div>
                            <p className="text-slate-400 text-xs uppercase font-bold tracking-wider mb-1">Weekly Goal</p>
                            <div className="flex items-baseline space-x-1">
                                <span className="text-3xl font-bold text-white">{completedCount}</span>
                                <span className="text-slate-400">/ 5</span>
                            </div>
                        </div>
                        <div className="text-right">
                             <p className="text-slate-400 text-xs uppercase font-bold tracking-wider mb-1">Last Session</p>
                             <p className="text-white text-sm">{lastWorkoutDate || "Let's start!"}</p>
                        </div>
                    </div>

                    {/* AI Action Buttons */}
                    <div className="grid grid-cols-2 gap-4">
                        <button 
                            onClick={() => setView('aicoach')}
                            className="btn-ai p-4 rounded-2xl flex flex-col items-center justify-center shadow-lg shadow-purple-500/20 active:scale-95 transition-transform"
                        >
                            <Sparkles size={24} className="text-white mb-2" />
                            <span className="font-bold text-white text-sm">AI Coach</span>
                        </button>
                        <button 
                            onClick={handleGetMotivation}
                            disabled={isAiLoading}
                            className="bg-slate-800 p-4 rounded-2xl flex flex-col items-center justify-center border border-slate-700 active:scale-95 transition-transform"
                        >
                            {isAiLoading ? (
                                <div className="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                            ) : (
                                <>
                                    <Zap size={24} className="text-yellow-400 mb-2" />
                                    <span className="font-bold text-white text-sm">Hype Me Up</span>
                                </>
                            )}
                        </button>
                    </div>

                    <div className="space-y-2">
                        <p className="text-white font-semibold text-lg">How much time do you have?</p>
                        
                        <button onClick={() => handleCategorySelect('quick')} className="w-full card p-4 flex items-center space-x-4 hover:bg-slate-700">
                            <div className="bg-yellow-500/20 p-3 rounded-xl">
                                <Zap className="text-yellow-400" />
                            </div>
                            <div className="text-left flex-1">
                                <h3 className="font-bold text-white">Quick Fix</h3>
                                <p className="text-slate-400 text-sm">3-5 Minutes â€¢ No Excuses</p>
                            </div>
                            <div className="text-slate-500"><ChevronRight /></div>
                        </button>

                        <button onClick={() => handleCategorySelect('medium')} className="w-full card p-4 flex items-center space-x-4 hover:bg-slate-700">
                            <div className="bg-blue-500/20 p-3 rounded-xl">
                                <Battery className="text-blue-400" />
                            </div>
                            <div className="text-left flex-1">
                                <h3 className="font-bold text-white">Solid Session</h3>
                                <p className="text-slate-400 text-sm">10 Minutes â€¢ Gym Day Follow-up</p>
                            </div>
                            <div className="text-slate-500"><ChevronRight /></div>
                        </button>

                        <button onClick={() => handleCategorySelect('long')} className="w-full card p-4 flex items-center space-x-4 hover:bg-slate-700">
                            <div className="bg-red-500/20 p-3 rounded-xl">
                                <Dumbbell className="text-red-400" />
                            </div>
                            <div className="text-left flex-1">
                                <h3 className="font-bold text-white">Max Compensation</h3>
                                <p className="text-slate-400 text-sm">20 Minutes â€¢ Fat Burn Focus</p>
                            </div>
                            <div className="text-slate-500"><ChevronRight /></div>
                        </button>
                    </div>
                </div>
            );

            // 2. SELECTION
            const Selection = () => {
                const videos = WORKOUTS[category];
                const titles = { quick: "Quick Fix (3-5m)", medium: "Solid Session (10m)", long: "Max Compensation (20m)" };
                
                return (
                    <div className="space-y-6 h-full flex flex-col">
                        <div className="flex items-center space-x-2 mb-2">
                            <button onClick={handleBack} className="p-2 -ml-2 text-slate-400 hover:text-white">
                                <ChevronLeft />
                            </button>
                            <h2 className="text-xl font-bold">{titles[category]}</h2>
                        </div>
                        <p className="text-slate-400 text-sm">Select a routine for today. Try to rotate them!</p>
                        <div className="grid gap-4">
                            {videos.map((v, idx) => (
                                <button key={idx} onClick={() => handleVideoSelect(v)} className="card p-0 overflow-hidden group text-left">
                                    <div className="relative h-32 bg-slate-700">
                                        <img src={`https://img.youtube.com/vi/${v.id}/mqdefault.jpg`} alt={v.title} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                                        <div className="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">{v.duration}</div>
                                        <div className="absolute inset-0 flex items-center justify-center">
                                             <div className="bg-white/20 p-3 rounded-full backdrop-blur-sm group-hover:scale-110 transition-transform">
                                                <Play className="w-6 h-6 text-white" />
                                             </div>
                                        </div>
                                    </div>
                                    <div className="p-4">
                                        <h3 className="font-bold text-white truncate">{v.title}</h3>
                                        <p className="text-sm text-slate-400">{v.creator}</p>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            // 3. PLAYER
            const Player = () => (
                <div className="flex flex-col h-full relative">
                    <div className="flex items-center justify-between mb-4">
                         <button onClick={handleBack} className="p-2 -ml-2 text-slate-400 hover:text-white flex items-center text-sm">
                            <ChevronLeft className="w-5 h-5 mr-1" /> Back
                        </button>
                    </div>
                    <div className="video-container mb-6">
                        <iframe src={`https://www.youtube.com/embed/${currentVideo.id}?rel=0&modestbranding=1&autoplay=1`} title="YouTube video player" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowFullScreen></iframe>
                    </div>
                    <div className="flex-1">
                        <h2 className="text-2xl font-bold text-white mb-2">{currentVideo.title}</h2>
                        <p className="text-slate-400 mb-8">{currentVideo.creator} â€¢ {currentVideo.duration}</p>
                    </div>
                    <button onClick={handleComplete} className="w-full btn-success py-4 rounded-xl font-bold text-lg shadow-lg shadow-green-500/20 active:scale-95 transition-transform flex items-center justify-center space-x-2">
                        <CheckCircle size={24} />
                        <span>Workout Complete</span>
                    </button>
                </div>
            );

            // 4. AI COACH
            const AICoach = () => {
                const [input, setInput] = useState('');
                const [messages, setMessages] = useState([
                    { role: 'ai', text: 'Hey! I know you are working hard to offset the sedentary lifestyle. I\'m your AI Coach. Ask me anything about your form, knee safety, or nutrition while taking Cipralex.' }
                ]);
                const [loading, setLoading] = useState(false);
                const messagesEndRef = useRef(null);

                const scrollToBottom = () => {
                    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
                };
                useEffect(scrollToBottom, [messages]);

                const handleSend = async () => {
                    if (!input.trim()) return;
                    const userMsg = input;
                    setInput('');
                    setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                    setLoading(true);

                    // Injected Context for better answers
                    const prompt = `You are an expert personal trainer. ${USER_CONTEXT}. The user asks: "${userMsg}". Keep answer concise, motivating, and actionable (under 3 sentences if possible).`;
                    
                    try {
                        const aiResponse = await callGemini(prompt);
                        setMessages(prev => [...prev, { role: 'ai', text: aiResponse }]);
                    } catch (error) {
                        setMessages(prev => [...prev, { role: 'ai', text: "Sorry, I'm having trouble connecting right now." }]);
                    } finally {
                        setLoading(false);
                    }
                };

                return (
                    <div className="flex flex-col h-full bg-slate-900">
                         <div className="flex items-center space-x-2 mb-4 pb-4 border-b border-slate-800">
                            <button onClick={handleBack} className="p-2 -ml-2 text-slate-400 hover:text-white">
                                <ChevronLeft />
                            </button>
                            <div className="flex items-center space-x-2">
                                <Sparkles size={20} className="text-purple-400" />
                                <h2 className="text-xl font-bold text-white">AI Coach</h2>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto space-y-4 mb-4 pr-2">
                            {messages.map((msg, idx) => (
                                <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-br-none' : 'bg-slate-800 text-slate-200 rounded-bl-none border border-slate-700'}`}>
                                        {msg.text}
                                    </div>
                                </div>
                            ))}
                            {loading && (
                                <div className="flex justify-start">
                                    <div className="bg-slate-800 p-4 rounded-2xl rounded-bl-none border border-slate-700 flex space-x-1">
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        <div className="flex items-center space-x-2 bg-slate-800 p-2 rounded-full border border-slate-700">
                            <input 
                                type="text" 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                placeholder="Ask about pain, diet, or form..."
                                className="flex-1 bg-transparent text-white px-4 py-2 focus:outline-none text-sm placeholder-slate-500"
                            />
                            <button onClick={handleSend} disabled={loading} className="p-3 bg-purple-600 rounded-full text-white hover:bg-purple-500 disabled:opacity-50 transition-colors">
                                <Send size={18} />
                            </button>
                        </div>
                    </div>
                );
            };

            // 5. SUCCESS OVERLAY with Gemini Integration
            const SuccessOverlay = () => (
                 <div className="absolute inset-0 bg-black/95 backdrop-blur-md z-50 flex flex-col items-center justify-center text-center p-6 animate-fade-in">
                    <div className="bg-green-500 w-20 h-20 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-green-500/50 animate-bounce">
                        <CheckCircle size={40} className="text-white" />
                    </div>
                    <h2 className="text-3xl font-bold text-white mb-4">Workout Complete!</h2>
                    
                    {/* Dynamic AI Message Area */}
                    <div className="bg-slate-800/80 p-6 rounded-2xl border border-slate-700 max-w-sm w-full mb-6 min-h-[100px] flex flex-col items-center justify-center">
                        {aiResponseMsg ? (
                            <p className="text-slate-200 text-lg font-medium leading-relaxed animate-fade-in">
                                {aiResponseMsg}
                            </p>
                        ) : (
                            <>
                                <p className="text-slate-400 mb-4">Great job! What do you need now?</p>
                                {isAiLoading ? (
                                    <div className="flex space-x-1">
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                        <div className="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                                    </div>
                                ) : (
                                    <button 
                                        onClick={handleGetSnack}
                                        className="flex items-center space-x-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-bold transition-colors"
                                    >
                                        <Utensils size={16} />
                                        <span>Get Snack Idea</span>
                                    </button>
                                )}
                            </>
                        )}
                    </div>
                    
                    <button onClick={() => { setShowConfetti(false); setView('dashboard'); }} className="mt-4 text-slate-400 hover:text-white text-sm underline">
                        Return to Dashboard
                    </button>
                </div>
            );

            return (
                <div className="min-h-screen p-6 max-w-md mx-auto relative">
                    {showConfetti && <SuccessOverlay />}
                    {view === 'dashboard' && <Dashboard />}
                    {view === 'selection' && <Selection />}
                    {view === 'player' && <Player />}
                    {view === 'aicoach' && <AICoach />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
